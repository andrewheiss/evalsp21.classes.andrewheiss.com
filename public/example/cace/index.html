<!DOCTYPE html>
<html lang="en-us" 
      xmlns:og="http://ogp.me/ns#" 
      xmlns:fb="https://www.facebook.com/2008/fbml">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.2.0 for Hugo" />
  

  

  
  
  
  
  
  

  

  
  
  
    
  
  <meta name="description" content="Compliance and treatment effects Throughout this course, we&rsquo;ve talked about the difference between the average treatment effect (ATE), or the average effect of a program for an entire population, and conditional average treatment effect (CATE), or the average effect of a program for some segment of the population." />

  
  <link rel="alternate" hreflang="en-us" href="/example/cace/" />

  







  




  
  
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    <meta name="theme-color" content="#5271FF" />
  

  
  
    
    <script src="/js/mathjax-config.js"></script>
  

  
  
  
  
    
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha256-FMvZuGapsJLjouA6k7Eo2lusoAX9i0ShlWFG6qt7SLc=" crossorigin="anonymous">

    
    

    
    
    
      
    
    

    
    
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
    
      
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Sans+Condensed:400,400i,700,700i%7CBarlow:ital,wght@0,400;0,700;1,400;1,700&display=swap">
      
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.563f345701788434b4fee407179620aa.css" />

  



  

  

  




  
  
  

  

  
    <link rel="manifest" href="/index.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hua2ec155b4296a9c9791d015323e16eb5_11927_32x32_fill_lanczos_center_2.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hua2ec155b4296a9c9791d015323e16eb5_11927_180x180_fill_lanczos_center_2.png" />

  <link rel="canonical" href="/example/cace/" />

  
  
  
  
  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary" />
  
    <meta property="twitter:site" content="@valentiandrade" />
    <meta property="twitter:creator" content="@valentiandrade" />
  
  <meta property="og:site_name" content="Análisis Estadístico en R" />
  <meta property="og:url" content="/example/cace/" />
  <meta property="og:title" content="Complier average treatment effects | Análisis Estadístico en R" />
  <meta property="og:description" content="Compliance and treatment effects Throughout this course, we&rsquo;ve talked about the difference between the average treatment effect (ATE), or the average effect of a program for an entire population, and conditional average treatment effect (CATE), or the average effect of a program for some segment of the population." /><meta property="og:image" content="/media/logo_hu02bc8dfe7cae86b2ee03430b67caeaf2_22353_300x300_fit_lanczos_2.png" />
    <meta property="twitter:image" content="/media/logo_hu02bc8dfe7cae86b2ee03430b67caeaf2_22353_300x300_fit_lanczos_2.png" /><meta property="og:locale" content="en-us" />
  
    
      <meta
        property="article:published_time"
        content="2020-10-28T00:00:00&#43;00:00"
      />
    
    <meta property="article:modified_time" content="2020-10-28T00:00:00&#43;00:00">
  

  



  

  

  <link rel="stylesheet" type="text/css" href="/custom-css/print.css" media="print" />

  <link rel="shortcut icon" href="/favicon.ico" />
  <link rel="apple-touch-icon-precomposed" sizes="57x57" href="/img/apple-touch-icon-57x57.png" />
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/img/apple-touch-icon-114x114.png" />
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/img/apple-touch-icon-72x72.png" />
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144x144.png" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/img/apple-touch-icon-120x120.png" />
  <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/img/apple-touch-icon-152x152.png" />
  <link rel="icon" type="image/png" href="/img/favicon-32x32.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="/img/favicon-16x16.png" sizes="16x16" />
  <meta name="application-name" content="2255: Análisis Estadístico en R" />
  <meta name="msapplication-TileColor" content="#FFFFFF" />
  <meta name="msapplication-TileImage" content="/img/mstile-144x144.png" />


  <title>Complier average treatment effects | Análisis Estadístico en R</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper  ">

  
  
  
  
  
  <script src="/js/wowchemy-init.js"></script>

    




    











  


<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container-xl">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/"><img src="/media/logo_hu02bc8dfe7cae86b2ee03430b67caeaf2_22353_0x70_resize_lanczos_2.png" alt="Análisis Estadístico en R"></a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/"><img src="/media/logo_hu02bc8dfe7cae86b2ee03430b67caeaf2_22353_0x70_resize_lanczos_2.png" alt="Análisis Estadístico en R"></a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-end" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        
        <li class="nav-item dropdown">
          <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>Organización</span><span class="caret"></span>
          </a>
          <div class="dropdown-menu">
            
              <a class="dropdown-item" href="/schedule/"><span>Planificación</span></a>
            
              <a class="dropdown-item" href="/syllabus/"><span>Syllabus</span></a>
            
          </div>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/content/"><span>Clases</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link  active" href="/example/"><span>Prácticos</span></a>
        </li>

        
        

        
        <li class="nav-item dropdown">
          <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>Tareas <i class="fab fa-github"></i></span><span class="caret"></span>
          </a>
          <div class="dropdown-menu">
            
              <a class="dropdown-item" href="/assignment/"><span>Tareas</span></a>
            
              <a class="dropdown-item" href="https://classroom.github.com/classrooms/86887318-learn-r-uah-2021"><span>Github Classroom<i class="fab fa-github"></i></span></a>
            
          </div>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/resource/"><span>Recursos</span></a>
        </li>

        
        

        

        
        
        
          
            
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="https://join.slack.com/t/learn-r-uah/shared_invite/zt-sh9uysuu-IzEG8~u5k2YYGWgpAFTRFA" target="_blank" rel="noopener"><span><i class="fab fa-slack"></i></span></a>
        </li>

        
        

        

        
        
        
          
            
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="https://rstudio.cloud/" target="_blank" rel="noopener"><span><i class="fab fa-r-project"></i></span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

      
      

      
      

      
      

      
      

    </ul>

  </div>
</nav>



    

<div class="container-fluid docs">
    <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
            





  
    
  




<form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-3" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <span><i class="fas fa-bars"></i></span>
  </button>

  
</form>

<nav class="collapse docs-links" id="docs-nav">
  

  
  
  
    
  

  
  <div class="docs-toc-item">
    <a class="docs-toc-link" >Información general</a>

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" >Datos</a>

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" >Ejemplos</a>

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/example/rstudio-tidyverse/">Examples</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/example/rstudio-tidyverse/">R, RStudio, and the tidyverse</a>
      </li>

      
      <li >
        <a href="/example/regression/">Regression</a>
      </li>

      
      <li >
        <a href="/example/dags/">DAGs</a>
      </li>

      
      <li >
        <a href="/example/po-ate-cate/">Potential outcomes, ATEs, and CATEs</a>
      </li>

      
      <li >
        <a href="/example/rcts/">RCTs</a>
      </li>

      
      <li >
        <a href="/example/matching-ipw/">Matching and IPW</a>
      </li>

      
      <li >
        <a href="/example/diff-in-diff/">Diff-in-diff</a>
      </li>

      
      <li >
        <a href="/example/rdd/">Regression discontinuity</a>
      </li>

      
      <li >
        <a href="/example/iv/">Instrumental variables</a>
      </li>

      
      <li class="active">
        <a href="/example/cace/">ITT and CACE</a>
      </li>

      
      <li >
        <a href="/example/rdd-fuzzy/">Fuzzy regression discontinuity</a>
      </li>

      
    </ul>
    

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/example/">Overview</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/example/">Code examples</a>
      </li>

      
    </ul>
    

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/example/random-numbers/">Simulated data</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/example/random-numbers/">Random numbers</a>
      </li>

      
      <li >
        <a href="/example/synthetic-data/">Synthetic data</a>
      </li>

      
    </ul>
    

  </div>
  
  
</nav>

        </div>

        
        <div class="d-none d-xl-block col-xl-2 docs-toc">
            <ul class="nav toc-top">
                <li><a href="#" id="back_to_top" class="docs-toc-title">Contents</a></li>
            </ul>

            <nav id="TableOfContents">
  <ul>
    <li><a href="#compliance-and-treatment-effects">Compliance and treatment effects</a></li>
    <li><a href="#finding-compliers-with-a-mind-reading-time-machine">Finding compliers with a mind-reading time machine</a></li>
    <li><a href="#finding-compliers-in-actual-data">Finding compliers in actual data</a></li>
    <li><a href="#finding-the-itt">Finding the ITT</a></li>
    <li><a href="#finding-the-proportion-of-compliers">Finding the proportion of compliers</a></li>
    <li><a href="#finding-the-cacelate-with-iv2sls">Finding the CACE/LATE with IV/2SLS</a></li>
  </ul>
</nav>

 
        </div>
        

        <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">

            <article class="article">

                <div class="docs-article-container">
                    <h1>Complier average treatment effects</h1>

                    

                    

                    

                    <div class="article-style">
                        <h2 id="compliance-and-treatment-effects">Compliance and treatment effects</h2>
<p>Throughout this course, we&rsquo;ve talked about the difference between the average treatment effect (ATE), or the average effect of a program for <em>an entire population</em>, and conditional average treatment effect (CATE), or the average effect of a program for some segment of the population. There are all sorts of CATEs: you can find the CATE for men vs. women, for people who are treated with the program (the average treatment on the treated, or ATT or TOT), for people who are not treated with the program (the average treatment on the untreated, or ATU), and so on.</p>
<p>One important type of CATE is the effect of a program on just those who <em>comply</em> with the program. We can call this the complier average treatment effect, but the acronym would be the same as conditional average treatment effect, so we&rsquo;ll call it the <strong>complier average causal effect</strong> or CACE.</p>
<p>Thinking about compliance is important. You might randomly assign people to receive treatment or a program, but people might not do what you tell them. Additionally, people might do the program if assigned to do it, but they would have done it anyway. We can split the population into four types of people:</p>
<ul>
<li><strong>Compliers</strong>: People who follow whatever their assignment is (if assigned to treatment, they do the program; if assigned to control, they don&rsquo;t)</li>
<li><strong>Always takers</strong>: People who will receive or seek out the program regardless of assignment (if assigned to treatment, they do the program; if assigned to control, they still do the program)</li>
<li><strong>Never takers</strong>: People who will not receive or seek out the program regardless of assignment (if assigned to treatment, they don&rsquo;t do the program; if assigned to control, they also don&rsquo;t do it)</li>
<li><strong>Defiers</strong>: People who will do the opposite of whatever their assignment is (if assigned to treatment, they don&rsquo;t do the program; if assigned to control, they do the program)</li>
</ul>
<p>To simplify things, evaluators and econometricians assume that defiers don&rsquo;t exist based on the idea of <em>monotonicity</em>, which means that we can assume that the effect of being assigned to treatment only increases the likelihood of participating in the program (and doesn&rsquo;t make it more likely).</p>
<p>The tricky part about trying to find who the compliers are in a sample is that we can&rsquo;t know what people would have done in the absence of treatment. If we see that someone in the experiment was assigned to be in the treatment group and they then participated in the program, they could be a complier (since they did what they were assigned to do), or they could be an always taker (they did what they were assigned to do, but they would have done it anyway). Due to the fundamental problem of causal inference, we cannot know what each person would have done in a parallel world.</p>
<p>We can use data from a hypothetical program to see how these three types of compliers distort our outcomes, and more importantly, how we can disentangle compliers from their always- and never-taker counterparts.</p>
<p>If you want to follow along with this example, you can download these two datasets:</p>
<ul>
<li><a href="/data/bed_nets_time_machine.csv"><i class="fas fa-table"></i> <code>bed_nets_time_machine.csv</code></a></li>
<li><a href="/data/bed_nets_observed.csv"><i class="fas fa-table"></i> <code>bed_nets_observed.csv</code></a></li>
</ul>
<h2 id="finding-compliers-with-a-mind-reading-time-machine">Finding compliers with a mind-reading time machine</h2>
<p>First let&rsquo;s load the data and reorder some of the categories:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">library</span>(tidyverse)  <span style="color:#75715e"># ggplot(), %&gt;%, mutate(), and friends</span>
<span style="color:#a6e22e">library</span>(broom)  <span style="color:#75715e"># Convert models to data frames</span>
<span style="color:#a6e22e">library</span>(estimatr)  <span style="color:#75715e"># Run 2SLS models in one step with iv_robust()</span>

bed_nets <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read_csv</span>(<span style="color:#e6db74">&#34;data/bed_nets_observed.csv&#34;</span>) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#75715e"># Make &#34;No bed net&#34; (control) come first</span>
  <span style="color:#a6e22e">mutate</span>(bed_net <span style="color:#f92672">=</span> <span style="color:#a6e22e">fct_relevel</span>(bed_net, <span style="color:#e6db74">&#34;No bed net&#34;</span>))

bed_nets_time_machine <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read_csv</span>(<span style="color:#e6db74">&#34;data/bed_nets_time_machine.csv&#34;</span>) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#75715e"># Make &#34;No bed net&#34; come first and &#34;Complier&#34; come first</span>
  <span style="color:#a6e22e">mutate</span>(bed_net <span style="color:#f92672">=</span> <span style="color:#a6e22e">fct_relevel</span>(bed_net, <span style="color:#e6db74">&#34;No bed net&#34;</span>),
         status <span style="color:#f92672">=</span> <span style="color:#a6e22e">fct_relevel</span>(status, <span style="color:#e6db74">&#34;Complier&#34;</span>))
</code></pre></div><p>This is what we would be able to see if we could read everyone&rsquo;s minds. There are always takers who will use a bed net regardless of the program, and they&rsquo;ll have higher health outcomes. However, those better outcomes are because of something endogenous—there&rsquo;s something else that makes these people always pursue bed nets, and that&rsquo;s likely related to health. We probably want to not consider them when looking for the program effect. There are never takers who won&rsquo;t ever use a bed net, and they have worse health outcomes. Again, there&rsquo;s endogeneity here—something is causing them to not use the bed nets, and it likely also causes their health level. We don&rsquo;t want to look at them either.</p>
<p>The first group—the compliers—are the people we want to focus on. Here we see that the program had an effect when compared to a control group.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">set.seed</span>(<span style="color:#ae81ff">1234</span>)  <span style="color:#75715e"># Make the jittering the same every time</span>

<span style="color:#a6e22e">ggplot</span>(bed_nets_time_machine, <span style="color:#a6e22e">aes</span>(y <span style="color:#f92672">=</span> health, x <span style="color:#f92672">=</span> treatment)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_point</span>(<span style="color:#a6e22e">aes</span>(shape <span style="color:#f92672">=</span> bed_net, color <span style="color:#f92672">=</span> status),
             position <span style="color:#f92672">=</span> <span style="color:#a6e22e">position_jitter</span>(height <span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>, width <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.25</span>)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">facet_wrap</span>(<span style="color:#a6e22e">vars</span>(status)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">labs</span>(color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Type of person&#34;</span>, shape <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Compliance&#34;</span>,
       x <span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>, y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Health status&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">scale_color_viridis_d</span>(option <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;plasma&#34;</span>, end <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.85</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme_bw</span>()
</code></pre></div><p><img src="/example/cace_files/figure-html/mind-reading-groups-1.png" width="75%" style="display: block; margin: auto;" /></p>
<h2 id="finding-compliers-in-actual-data">Finding compliers in actual data</h2>
<p>This is what we actually see in the data, though. You can tell who some of the always takers are (those who used bed nets after being assigned to the control group) and who some of the never takers are (those who did not use a bed net after being assigned to the treatment group), but compliers are mixed up with the always and never takers. We have to somehow disentangle them!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">set.seed</span>(<span style="color:#ae81ff">1234</span>)
<span style="color:#a6e22e">ggplot</span>(bed_nets_time_machine, <span style="color:#a6e22e">aes</span>(y <span style="color:#f92672">=</span> health, x <span style="color:#f92672">=</span> bed_net)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_point</span>(<span style="color:#a6e22e">aes</span>(shape <span style="color:#f92672">=</span> bed_net, color <span style="color:#f92672">=</span> status),
             position <span style="color:#f92672">=</span> <span style="color:#a6e22e">position_jitter</span>(height <span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>, width <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.25</span>)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">facet_wrap</span>(<span style="color:#a6e22e">vars</span>(treatment)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">labs</span>(color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Type of person&#34;</span>, shape <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Compliance&#34;</span>,
       x <span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>, y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Health status&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">scale_color_viridis_d</span>(option <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;plasma&#34;</span>, end <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.85</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme_bw</span>()
</code></pre></div><p><img src="/example/cace_files/figure-html/compliers-actual-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>We can do this by assuming the proportion of compliers, never takers, and always takers are equally spread across treatment and control (which we can assume through the magic of randomization). If that&rsquo;s the case, we can calculate the intent to treat (ITT) effect, which is the CATE of being assigned treatment (or the effect of being assigned treatment on health status, regardless of actual compliance).</p>
<p>The ITT is actually composed of three different causal effects: the complier average causal effect (CACE), the always taker average causal effect (ATACE), and the never taker average causal effect (NTACE). In the formula below, <code>\(\pi\)</code> stands for the proportion of people in each group. Formally, the ITT can be defined like this:</p>
<p>$$
<code>\begin{aligned} \text{ITT}\ =\ &amp; \color{#0D0887}{\pi_\text{compliers} \times (\text{T} - \text{C})_\text{compliers}} + \\ &amp;\color{#B7318A}{\pi_\text{always takers} \times (\text{T} - \text{C})_\text{always takers}} + \\ &amp;\color{#FEBA2C}{\pi_\text{never takers} \times (\text{T} - \text{C})_\text{never takers}} \end{aligned}</code>
$$</p>
<p>We can simplify this to this acronymized version:</p>
<p>$$
\text{ITT}\ =\ \color{#0D0887}{\pi_\text{C} \text{CACE}} + \color{#B7318A}{\pi_\text{A} \text{ATACE}} + \color{#FEBA2C}{\pi_\text{N} \text{NTACE}}
$$</p>
<p>The number we care about the most here is the CACE, which is stuck in the middle of the equation. But we can rescue it with some fun logical and algebraic trickery!</p>
<p>If we assume that assignment to treatment doesn&rsquo;t make someone more likely to be an always taker or a never taker, we can set the ATACE and NTACE to zero, leaving us with just three variables to worry about: ITT, <code>\(\pi_\text{c}\)</code>, and CACE:</p>
<p>$$
<code>\begin{aligned} \text{ITT}\ =\ &amp; \color{#0D0887}{\pi_\text{C} \text{CACE}} + \color{#B7318A}{\pi_\text{A} \text{ATACE}} + \color{#FEBA2C}{\pi_\text{N} \text{NTACE}} \\[6pt] =\ &amp; \color{#0D0887}{\pi_\text{C} \text{CACE}} + \color{#B7318A}{\pi_\text{A} \times 0} + \color{#FEBA2C}{\pi_\text{N} \times 0}\\[6pt] \text{ITT}\ =\ &amp; \color{#0D0887}{\pi_\text{C} \text{CACE}} \end{aligned}</code>
$$</p>
<p>We can use algebra to rearrange this formula so that we&rsquo;re left with an equation that starts with CACE (since that&rsquo;s the value we care about):</p>
<p>$$
\text{CACE} = \frac{\text{ITT}}{\pi_\text{C}}
$$</p>
<p>If we can find the ITT and the proportion of compliers, we can find the complier average causal effect (CACE). Fortunately, both those pieces—ITT and <code>\(\pi_\text{C}\)</code>—are findable in the data we have!</p>
<h2 id="finding-the-itt">Finding the ITT</h2>
<p>The ITT is easy to find with a simple OLS model:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">itt_model <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">lm</span>(health <span style="color:#f92672">~</span> treatment, data <span style="color:#f92672">=</span> bed_nets)

<span style="color:#a6e22e">tidy</span>(itt_model)
<span style="color:#75715e">## # A tibble: 2 x 5</span>
<span style="color:#75715e">##   term               estimate std.error statistic  p.value</span>
<span style="color:#75715e">##   &lt;chr&gt;                 &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span>
<span style="color:#75715e">## 1 (Intercept)           40.9      0.444     92.1  0.      </span>
<span style="color:#75715e">## 2 treatmentTreatment     5.99     0.630      9.51 5.36e-21</span>

ITT <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">tidy</span>(itt_model) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">filter</span>(term <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;treatmentTreatment&#34;</span>) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">pull</span>(estimate)
</code></pre></div><p>The ITT here is ≈6—being assigned treatment increases average health status by 5.99 health points.</p>
<h2 id="finding-the-proportion-of-compliers">Finding the proportion of compliers</h2>
<p>The proportion of compliers is a little trickier, but doable with some algebraic trickery. Recall from the graph above that the people who were in the treatment group and who complied are a combination of always takers and compliers. This means we can say:</p>
<p>$$
<code>\begin{aligned} \pi_\text{A} + \pi_\text{C} =&amp; \text{% yes in treatment; or} \\ \pi_\text{C} =&amp; \text{% yes in treatment} - \pi_\text{A} \end{aligned}</code>
$$</p>
<p>We actually know <code>\(\pi_\text{A}\)</code>—remember in the graph above that the people who were in the control group and who used bed nets are guaranteed to be always takers (none of them are compliers or never takers). If we assume that the proportion of always takers is the same in both treatment and control, we can use that percent here, giving us this final equation for <code>\(\pi_\text{C}\)</code>:</p>
<p>$$
<code>\begin{aligned} \pi_\text{C} =&amp; \text{% yes in treatment} - \pi_\text{A} \\ =&amp; \text{% yes in treatment} - \text{% yes in control} \end{aligned}</code>
$$</p>
<p>So, if we can find the percent of people assigned to treatment who used bed nets, find the percent of people assigned to control and used bed nets, and subtract the two percentages, we&rsquo;ll have the proportion of compliers, or <code>\(\pi_\text{C}\)</code>. We can do that with the data we have (61% - 19.5% = 41.5% compliers):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">bed_nets <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(treatment, bed_net) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">summarize</span>(n <span style="color:#f92672">=</span> <span style="color:#a6e22e">n</span>()) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">mutate</span>(prop <span style="color:#f92672">=</span> n <span style="color:#f92672">/</span> <span style="color:#a6e22e">sum</span>(n))
<span style="color:#75715e">## # A tibble: 4 x 4</span>
<span style="color:#75715e">## # Groups:   treatment [2]</span>
<span style="color:#75715e">##   treatment bed_net        n  prop</span>
<span style="color:#75715e">##   &lt;chr&gt;     &lt;fct&gt;      &lt;int&gt; &lt;dbl&gt;</span>
<span style="color:#75715e">## 1 Control   No bed net   808 0.805</span>
<span style="color:#75715e">## 2 Control   Bed net      196 0.195</span>
<span style="color:#75715e">## 3 Treatment No bed net   388 0.390</span>
<span style="color:#75715e">## 4 Treatment Bed net      608 0.610</span>

<span style="color:#75715e"># pi_c = prop yes in treatment - prop yes in control</span>
pi_c <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0.6104418</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">0.1952191</span>
</code></pre></div><p>Finally, now that we know both the ITT and <code>\(\pi_\text{C}\)</code>, we can find the CACE (or the LATE):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">CACE <span style="color:#f92672">&lt;-</span> ITT <span style="color:#f92672">/</span> pi_c
CACE
<span style="color:#75715e">## [1] 14.42</span>
</code></pre></div><p>It&rsquo;s 14.4, which means that using bed nets increased health by 14 health points <em>for compliers</em> (which is a lot bigger than the 6 that we found before). We successfully filtered out the always takers and the never takers, and we have our complier-specific causal effect.</p>
<h2 id="finding-the-cacelate-with-iv2sls">Finding the CACE/LATE with IV/2SLS</h2>
<p>Doing that is super tedious though! What if there was an easier way to find the effect of the bed net program for just the compliers? We can do this with IV/2SLS regression by using assignment to treatment as an instrument.</p>
<p>Assignment to treatment works as an instrument because it&rsquo;s (1) relevant, since being told to use bed nets is probably highly correlated with using bed nets, (2) exclusive, since the only way that being told to use bed nets can cause changes in health is through the actual use of the bed nets, and (3) exogenous, since being told to use bed nets probably isn&rsquo;t related to other things that cause health.</p>
<p>Here&rsquo;s a 2SLS regression with assignment to treatment as the instrument:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">model_2sls <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">iv_robust</span>(health <span style="color:#f92672">~</span> bed_net <span style="color:#f92672">|</span> treatment, data <span style="color:#f92672">=</span> bed_nets)
<span style="color:#a6e22e">tidy</span>(model_2sls)
<span style="color:#75715e">##             term estimate std.error statistic   p.value conf.low conf.high   df outcome</span>
<span style="color:#75715e">## 1    (Intercept)    38.12    0.5151     74.01 0.000e+00    37.11     39.13 1998  health</span>
<span style="color:#75715e">## 2 bed_netBed net    14.42    1.2538     11.50 1.087e-29    11.96     16.88 1998  health</span>
</code></pre></div><p>The coefficient for <code>bed_net</code> is identical to the CACE that we found manually! Instrumental variables are helpful for isolated program effects to only compliers when you&rsquo;re dealing with noncompliance.</p>

                    </div>

                    



                    
                    <div class="article-widget">
                        
<div class="post-nav">
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Previous</div>
    <a href="/example/rdd-fuzzy/" rel="next">Fuzzy regression discontinuity</a>
  </div>
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Next</div>
    <a href="/example/rdd/" rel="prev">Regression discontinuity</a>
  </div>
  
</div>

                    </div>
                    
                </div>

                <div class="body-footer">
                    <p>Last updated on October 28, 2020</p>

                    





                    



                </div>

            </article>

            <footer>
    <hr>

    <div class="row course-info">
        <div class="col-md-7">
            <p>
                <strong>2255: Análisis Estadístico en R (II° Semestre- 2021)</strong><br>

                <a href="https://www.uahurtado.cl/" target="_blank" rel="noopener">Universidad Alberto Hurtado</a> &emsp;&emsp;
                <a href="http://sociologia.uahurtado.cl/" target="_blank" rel="noopener">Departamento de Sociología</a>
            </p>

            <p>
                <a href="https://valentinaandrade.netlify.app/" target="_blank" rel="noopener"><i class="fas fa-user"></i>
                    Valentina Andrade</a> &emsp;&emsp;
                <a href="mailto:valentinaandrade@uchile.cl"><i class="fas fa-envelope"></i>
                    valentinaandrade@uchile.cl</a>
            </p>

            <p>
                <i class="far fa-calendar-alt"></i> Clases: Lunes 16.30-17.40 &emsp;&emsp;
                <i class="fas fa-pencil-alt"></i> Práctico: Lunes 18.00-19.20 
                <br><i class="fas fa-university"></i> Online, en link de Zoom
            </p>
        </div>

        <div class="col-md-5 credits">
            <p>All content licensed under a <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" rel="noopener">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>.</p>
            
            <p>Content <i class="fab fa-creative-commons"></i> 2021. Web developed by Andrew Heiss and custom by <a href="https://valentinaandrade.netlify.app/" target="_blank" rel="noopener">Valentina Andrade</a></p>
        
            <p>This site created with the <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> in <a href="https://bookdown.org/yihui/blogdown/" target="_blank" rel="noopener">blogdown</a> and <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a>. </p>
            
            <p><a href="https://github.com/valentinaandrade" target="_blank" rel="noopener"><i class="fab fa-github"></i> View the source at GitHub.</a></p>
        </div>
    </div>
</footer>


        </main>
    </div>
</div>

        

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/instant.page/5.1.0/instantpage.min.js" integrity="sha512-1+qUtKoh9XZW7j+6LhRMAyOrgSQKenQ4mluTR+cvxXjP1Z54RxZuzstR/H9kgPXQsVB8IW7DMDFUJpzLjvhGSQ==" crossorigin="anonymous"></script>

      
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      

      
      

      

      

    

    
    
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.2/anchor.min.js" integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    
    
    

    
    

    
    
    
    

    
    <script src="/js/bootstrap.bundle.min.8b7df62fd2da18ce73e29c13cc0a6198.js"></script>

    
    

    
    
    
    
    
    
    
    
    
    <script src="/en/js/wowchemy.min.c6ceb5c48772e46156651a48070d6139.js"></script>

    

<script src="/js/math-code.js"></script>


    
    

    
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>

</html>
