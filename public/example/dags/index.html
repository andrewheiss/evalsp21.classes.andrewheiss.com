<!DOCTYPE html>
<html lang="en-us" 
      xmlns:og="http://ogp.me/ns#" 
      xmlns:fb="https://www.facebook.com/2008/fbml">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.2.0 for Hugo" />
  

  

  
  
  
  
  
  

  

  
  
  
    
  
  <meta name="description" content="DAGs with dagitty.net The easiest way to quickly build DAGs and find adjustment sets and testable implications is to use dagitty.net.
This video shows how to use it:
DAGs with R, ggdag, and dagitty You can use the ggdag and dagitty packages in R to build and work with DAGs too." />

  
  <link rel="alternate" hreflang="en-us" href="/example/dags/" />

  







  




  
  
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    <meta name="theme-color" content="#5271FF" />
  

  
  
    
    <script src="/js/mathjax-config.js"></script>
  

  
  
  
  
    
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha256-FMvZuGapsJLjouA6k7Eo2lusoAX9i0ShlWFG6qt7SLc=" crossorigin="anonymous">

    
    

    
    
    
      
    
    

    
    
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
    
      
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Sans+Condensed:400,400i,700,700i%7CBarlow:ital,wght@0,400;0,700;1,400;1,700&display=swap">
      
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.563f345701788434b4fee407179620aa.css" />

  



  

  

  




  
  
  

  

  
    <link rel="manifest" href="/index.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hua2ec155b4296a9c9791d015323e16eb5_11927_32x32_fill_lanczos_center_2.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hua2ec155b4296a9c9791d015323e16eb5_11927_180x180_fill_lanczos_center_2.png" />

  <link rel="canonical" href="/example/dags/" />

  
  
  
  
  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary" />
  
    <meta property="twitter:site" content="@valentiandrade" />
    <meta property="twitter:creator" content="@valentiandrade" />
  
  <meta property="og:site_name" content="Análisis Estadístico en R" />
  <meta property="og:url" content="/example/dags/" />
  <meta property="og:title" content="DAGs | Análisis Estadístico en R" />
  <meta property="og:description" content="DAGs with dagitty.net The easiest way to quickly build DAGs and find adjustment sets and testable implications is to use dagitty.net.
This video shows how to use it:
DAGs with R, ggdag, and dagitty You can use the ggdag and dagitty packages in R to build and work with DAGs too." /><meta property="og:image" content="/media/logo_hu02bc8dfe7cae86b2ee03430b67caeaf2_22353_300x300_fit_lanczos_2.png" />
    <meta property="twitter:image" content="/media/logo_hu02bc8dfe7cae86b2ee03430b67caeaf2_22353_300x300_fit_lanczos_2.png" /><meta property="og:locale" content="en-us" />
  
    
      <meta
        property="article:published_time"
        content="2020-09-11T00:00:00&#43;00:00"
      />
    
    <meta property="article:modified_time" content="2020-09-11T00:00:00&#43;00:00">
  

  



  

  

  <link rel="stylesheet" type="text/css" href="/custom-css/print.css" media="print" />

  <link rel="shortcut icon" href="/favicon.ico" />
  <link rel="apple-touch-icon-precomposed" sizes="57x57" href="/img/apple-touch-icon-57x57.png" />
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/img/apple-touch-icon-114x114.png" />
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/img/apple-touch-icon-72x72.png" />
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144x144.png" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/img/apple-touch-icon-120x120.png" />
  <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/img/apple-touch-icon-152x152.png" />
  <link rel="icon" type="image/png" href="/img/favicon-32x32.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="/img/favicon-16x16.png" sizes="16x16" />
  <meta name="application-name" content="2255: Análisis Estadístico en R" />
  <meta name="msapplication-TileColor" content="#FFFFFF" />
  <meta name="msapplication-TileImage" content="/img/mstile-144x144.png" />


  <title>DAGs | Análisis Estadístico en R</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper  ">

  
  
  
  
  
  <script src="/js/wowchemy-init.js"></script>

    




    











  


<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container-xl">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/"><img src="/media/logo_hu02bc8dfe7cae86b2ee03430b67caeaf2_22353_0x70_resize_lanczos_2.png" alt="Análisis Estadístico en R"></a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/"><img src="/media/logo_hu02bc8dfe7cae86b2ee03430b67caeaf2_22353_0x70_resize_lanczos_2.png" alt="Análisis Estadístico en R"></a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-end" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        
        <li class="nav-item dropdown">
          <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>Organización</span><span class="caret"></span>
          </a>
          <div class="dropdown-menu">
            
              <a class="dropdown-item" href="/schedule/"><span>Planificación</span></a>
            
              <a class="dropdown-item" href="/syllabus/"><span>Syllabus</span></a>
            
          </div>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/content/"><span>Clases</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link  active" href="/example/"><span>Prácticos</span></a>
        </li>

        
        

        
        <li class="nav-item dropdown">
          <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>Tareas <i class="fab fa-github"></i></span><span class="caret"></span>
          </a>
          <div class="dropdown-menu">
            
              <a class="dropdown-item" href="/assignment/"><span>Tareas</span></a>
            
              <a class="dropdown-item" href="https://classroom.github.com/classrooms/86887318-learn-r-uah-2021"><span>Github Classroom<i class="fab fa-github"></i></span></a>
            
          </div>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/resource/"><span>Recursos</span></a>
        </li>

        
        

        

        
        
        
          
            
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="https://join.slack.com/t/learn-r-uah/shared_invite/zt-sh9uysuu-IzEG8~u5k2YYGWgpAFTRFA" target="_blank" rel="noopener"><span><i class="fab fa-slack"></i></span></a>
        </li>

        
        

        

        
        
        
          
            
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="https://rstudio.cloud/" target="_blank" rel="noopener"><span><i class="fab fa-r-project"></i></span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

      
      

      
      

      
      

      
      

    </ul>

  </div>
</nav>



    

<div class="container-fluid docs">
    <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
            





  
    
  




<form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-3" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <span><i class="fas fa-bars"></i></span>
  </button>

  
</form>

<nav class="collapse docs-links" id="docs-nav">
  

  
  
  
    
  

  
  <div class="docs-toc-item">
    <a class="docs-toc-link" >Información general</a>

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" >Datos</a>

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" >Ejemplos</a>

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/example/rstudio-tidyverse/">Examples</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/example/rstudio-tidyverse/">R, RStudio, and the tidyverse</a>
      </li>

      
      <li >
        <a href="/example/regression/">Regression</a>
      </li>

      
      <li class="active">
        <a href="/example/dags/">DAGs</a>
      </li>

      
      <li >
        <a href="/example/po-ate-cate/">Potential outcomes, ATEs, and CATEs</a>
      </li>

      
      <li >
        <a href="/example/rcts/">RCTs</a>
      </li>

      
      <li >
        <a href="/example/matching-ipw/">Matching and IPW</a>
      </li>

      
      <li >
        <a href="/example/diff-in-diff/">Diff-in-diff</a>
      </li>

      
      <li >
        <a href="/example/rdd/">Regression discontinuity</a>
      </li>

      
      <li >
        <a href="/example/iv/">Instrumental variables</a>
      </li>

      
      <li >
        <a href="/example/cace/">ITT and CACE</a>
      </li>

      
      <li >
        <a href="/example/rdd-fuzzy/">Fuzzy regression discontinuity</a>
      </li>

      
    </ul>
    

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/example/">Overview</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/example/">Code examples</a>
      </li>

      
    </ul>
    

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/example/random-numbers/">Simulated data</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/example/random-numbers/">Random numbers</a>
      </li>

      
      <li >
        <a href="/example/synthetic-data/">Synthetic data</a>
      </li>

      
    </ul>
    

  </div>
  
  
</nav>

        </div>

        
        <div class="d-none d-xl-block col-xl-2 docs-toc">
            <ul class="nav toc-top">
                <li><a href="#" id="back_to_top" class="docs-toc-title">Contents</a></li>
            </ul>

            <nav id="TableOfContents">
  <ul>
    <li><a href="#dags-with-dagittynet">DAGs with dagitty.net</a></li>
    <li><a href="#dags-with-r-ggdag-and-dagitty">DAGs with R, ggdag, and dagitty</a>
      <ul>
        <li><a href="#live-coding-example">Live coding example</a></li>
        <li><a href="#basic-dags">Basic DAGs</a></li>
        <li><a href="#layouts-and-manual-coordinates">Layouts and manual coordinates</a></li>
        <li><a href="#node-names-and-labels">Node names and labels</a></li>
        <li><a href="#paths-and-adjustment-sets">Paths and adjustment sets</a></li>
        <li><a href="#plot-dag-from-dagittynet-with-ggdag">Plot DAG from dagitty.net with <code>ggdag()</code></a></li>
      </ul>
    </li>
    <li><a href="#mosquito-net-example">Mosquito net example</a>
      <ul>
        <li><a href="#conditional-independencies">Conditional independencies</a></li>
        <li><a href="#mosquito-net-adjustment-sets">Mosquito net adjustment sets</a></li>
      </ul>
    </li>
  </ul>
</nav>

 
        </div>
        

        <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">

            <article class="article">

                <div class="docs-article-container">
                    <h1>DAGs</h1>

                    

                    

                    

                    <div class="article-style">
                        <h2 id="dags-with-dagittynet">DAGs with dagitty.net</h2>
<p>The easiest way to quickly build DAGs and find adjustment sets and testable implications is to use <a href="http://dagitty.net/" target="_blank" rel="noopener">dagitty.net</a>.</p>
<p>This video shows how to use it:</p>
<div class="embed-responsive embed-responsive-16by9">
<iframe class="embed-responsive-item" src="https://www.youtube.com/embed/3euqrnD9w7c" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div>
<h2 id="dags-with-r-ggdag-and-dagitty">DAGs with R, ggdag, and dagitty</h2>
<p>You can use the <a href="https://ggdag.malco.io/" target="_blank" rel="noopener"><strong>ggdag</strong></a> and <a href="http://dagitty.net/primer/" target="_blank" rel="noopener"><strong>dagitty</strong></a> packages in R to build and work with DAGs too. I typically draw an initial DAG in my browser with dagitty.net and then I rewrite it in code in R so that it&rsquo;s more official and formal and reproducible.</p>
<h3 id="live-coding-example">Live coding example</h3>
<div class="embed-responsive embed-responsive-16by9">
<iframe class="embed-responsive-item" src="https://www.youtube.com/embed/uoAjyyToUTE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div>
<h3 id="basic-dags">Basic DAGs</h3>
<p><em>(This is a heavily cleaned up and annotated version of the code from the video.)</em></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Load packages</span>
<span style="color:#a6e22e">library</span>(tidyverse)  <span style="color:#75715e"># For dplyr, ggplot, and friends</span>
<span style="color:#a6e22e">library</span>(ggdag)      <span style="color:#75715e"># For plotting DAGs</span>
<span style="color:#a6e22e">library</span>(dagitty)    <span style="color:#75715e"># For working with DAG logic</span>
</code></pre></div><p>The general process for making and working with DAGs in R is to create a DAG object with <code>dagify()</code> and then plot it with <code>ggdag()</code>. The documentation for <strong>ggdag</strong> is really good and helpful and full of examples. Check these pages for all sorts of additional details:</p>
<ul>
<li><a href="https://ggdag.malco.io/articles/intro-to-ggdag.html" target="_blank" rel="noopener">&ldquo;An introduction to ggdag&rdquo;</a></li>
<li><a href="https://ggdag.malco.io/articles/intro-to-dags.html" target="_blank" rel="noopener">&ldquo;An introduction to directed acyclic graphs&rdquo;</a></li>
<li><a href="https://ggdag.malco.io/reference/index.html" target="_blank" rel="noopener">List of all ggdag-related functions</a></li>
</ul>
<p>The syntax for <code>dagify()</code> is similar to the formula syntax you&rsquo;ve been using for building regression models with <code>lm()</code>. The formulas you use in <code>dagify()</code> indicate the relationships between nodes.</p>
<p>For instance, in this DAG, <code>y</code> is caused by <code>x</code>, <code>a</code>, and <code>b</code> (<code>y ~ x + a + b</code>), and <code>x</code> is caused by <code>a</code> and <code>b</code> (<code>x ~ a + b</code>). This means that <code>a</code> and <code>b</code> are confounders. Use the <code>exposure</code> and <code>outcome</code> arguments to specify which nodes are the exposure (or treatment/intervention/program) and the outcome.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Create super basic DAG</span>
simple_dag <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">dagify</span>(
  y <span style="color:#f92672">~</span> x <span style="color:#f92672">+</span> a <span style="color:#f92672">+</span> b,
  x <span style="color:#f92672">~</span> a <span style="color:#f92672">+</span> b,
  exposure <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;x&#34;</span>,
  outcome <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;y&#34;</span>
)

<span style="color:#75715e"># Adding a theme_dag() layer to the plot makes it have a white background with no axis labels</span>
<span style="color:#a6e22e">ggdag</span>(simple_dag) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme_dag</span>()
</code></pre></div><p><img src="/example/dags_files/figure-html/super-basic-dag-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>If you want to plot which nodes are the exposure and outcome, use <code>ggdag_status()</code> instead:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">ggdag_status</span>(simple_dag) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme_dag</span>()
</code></pre></div><p><img src="/example/dags_files/figure-html/simple-status-1.png" width="75%" style="display: block; margin: auto;" /></p>
<h3 id="layouts-and-manual-coordinates">Layouts and manual coordinates</h3>
<p>Notice how the layout is different in both of those graphs. By default, <code>ggdag()</code> positions the nodes randomly every time using a network algorithm. You can change the algorithm by using the <code>layout</code> argument: <code>ggdag(simple_dag, layout = &quot;nicely&quot;)</code>. You can see a full list of possible algorithms by running <code>?layout_tbl_graph_igraph</code> in the console.</p>
<p>Alternatively, you can specify your own coordinates so that the nodes are positioned in the same place every time. Do this with the <code>coords</code> argument in <code>dagify()</code>.</p>
<p>The best way to figure out what these numbers should be is to draw the DAG on paper or on a whiteboard and add a grid to it and then figure out the coordinates. For instance, in this DAG there are three rows and three columns: <code>x</code> and <code>y</code> go in the middle row (row 2) while <code>a</code> and <code>b</code> go in the middle column (column 2). It can also be helpful to not include <code>theme_dag()</code> at first so you can see the numbers for the underlying grid. Once you have everything positioned correctly, add <code>theme_dag()</code> to clean it up.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">simple_dag_with_coords <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">dagify</span>(
  y <span style="color:#f92672">~</span> x <span style="color:#f92672">+</span> a <span style="color:#f92672">+</span> b,
  x <span style="color:#f92672">~</span> a <span style="color:#f92672">+</span> b,
  exposure <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;x&#34;</span>,
  outcome <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;y&#34;</span>,
  coords <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(x <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(x <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, a <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, b <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, y <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>),
                y <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(x <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, a <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, b <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>, y <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>))
)

<span style="color:#a6e22e">ggdag_status</span>(simple_dag_with_coords) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme_dag</span>()
</code></pre></div><p><img src="/example/dags_files/figure-html/dag-with-coords-1.png" width="75%" style="display: block; margin: auto;" /></p>
<h3 id="node-names-and-labels">Node names and labels</h3>
<p>The variable names you use do not have to be limited to just <code>x</code>, <code>y</code>, and other lowercase letters. You can any names you want, as long as there are no spaces.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">dag_with_var_names <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">dagify</span>(
  outcome <span style="color:#f92672">~</span> treatment <span style="color:#f92672">+</span> confounder1 <span style="color:#f92672">+</span> confounder2,
  treatment <span style="color:#f92672">~</span> confounder1 <span style="color:#f92672">+</span> confounder2,
  exposure <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;treatment&#34;</span>,
  outcome <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;outcome&#34;</span>
)

<span style="color:#a6e22e">ggdag_status</span>(dag_with_var_names) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme_dag</span>()
</code></pre></div><p><img src="/example/dags_files/figure-html/dag-with-names-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>However, unless you use very short names, it is likely that the text will not fit inside the nodes. To get around this, you can add labels to the nodes using the <code>labels</code> argument in <code>dagify()</code>. Plot the labels by setting <code>use_labels = &quot;label&quot;</code> in <code>ggdag()</code>. You can turn off the text in the nodes with <code>text = FALSE</code> in <code>ggdag()</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">simple_dag_with_coords_and_labels <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">dagify</span>(
  y <span style="color:#f92672">~</span> x <span style="color:#f92672">+</span> a <span style="color:#f92672">+</span> b,
  x <span style="color:#f92672">~</span> a <span style="color:#f92672">+</span> b,
  exposure <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;x&#34;</span>,
  outcome <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;y&#34;</span>,
  labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Outcome&#34;</span>, x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Treatment&#34;</span>,
             a <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Confounder 1&#34;</span>, b <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Confounder 2&#34;</span>),
  coords <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(x <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(x <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, a <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, b <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, y <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>),
                y <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(x <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, a <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, b <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>, y <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>))
)

<span style="color:#a6e22e">ggdag_status</span>(simple_dag_with_coords_and_labels,
             use_labels <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;label&#34;</span>, text <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">guides</span>(fill <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, color <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>) <span style="color:#f92672">+</span>  <span style="color:#75715e"># Disable the legend</span>
  <span style="color:#a6e22e">theme_dag</span>()
</code></pre></div><p><img src="/example/dags_files/figure-html/dag-with-labels-1.png" width="75%" style="display: block; margin: auto;" /></p>
<h3 id="paths-and-adjustment-sets">Paths and adjustment sets</h3>
<p>R can also perform analysis on DAG objects. For example, we can find all the testable implications from the DAG using the <code>impliedConditionalIndependencies()</code> function from the <strong>dagitty</strong> package. For this simple DAG, there is only one: <code>a</code> should be independent of <code>b</code>. If we had a dataset with columns for each of these variables, we could check if this is true by running <code>cor(a, b)</code> to see if the two are related.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">impliedConditionalIndependencies</span>(simple_dag)
<span style="color:#75715e">## a _||_ b</span>
</code></pre></div><p>We can also find all the paths between <code>x</code> and <code>y</code> using the <code>paths()</code> function from the <strong>dagitty</strong> package. We can see that there are three open paths between <code>x</code> and <code>y</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">paths</span>(simple_dag)
<span style="color:#75715e">## $paths</span>
<span style="color:#75715e">## [1] &#34;x -&gt; y&#34;      &#34;x &lt;- a -&gt; y&#34; &#34;x &lt;- b -&gt; y&#34;</span>
<span style="color:#75715e">## </span>
<span style="color:#75715e">## $open</span>
<span style="color:#75715e">## [1] TRUE TRUE TRUE</span>
</code></pre></div><p>The first open path is fine—we want a single <em>d</em>-connected relationship between treatment and outcome—but the other two indicate that there is confounding from <code>a</code> and <code>b</code>. We can see what each of these paths are with the <code>ggdag_paths()</code> function from the <strong>ggdag</strong> package:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">ggdag_paths</span>(simple_dag_with_coords) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme_dag</span>()
</code></pre></div><p><img src="/example/dags_files/figure-html/plot-dag-paths-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>Instead of listing out all the possible paths and identifying backdoors by hand, you can use the <code>adjustmentSets()</code> function in the <strong>dagitty</strong> package to programmatically find all the nodes that need to be adjusted. Here we see that both <code>a</code> and <code>b</code> need to be controlled for to isolate the <code>x -&gt; y</code> relationship.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">adjustmentSets</span>(simple_dag)
<span style="color:#75715e">## { a, b }</span>
</code></pre></div><p>You can also visualize the adjustment sets with <code>ggdag_adjustment_set()</code> in the <strong>ggdag</strong> package. Make sure you set <code>shadow = TRUE</code> to draw the arrows coming out of the adjusted nodes—by default, those are not included.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">ggdag_adjustment_set</span>(simple_dag_with_coords, shadow <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme_dag</span>()
</code></pre></div><p><img src="/example/dags_files/figure-html/plot-adjustment-sets-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>R will find minimally sufficient adjustment sets, which includes the fewest number of adjustments needed to close all backdoors between <code>x</code> and <code>y</code>. In this example DAG there was only one set of variables (<code>a</code> and <code>b</code>), but in other situations there could be many possible sets, or none if the causal effect is not identifiable.</p>
<h3 id="plot-dag-from-dagittynet-with-ggdag">Plot DAG from dagitty.net with <code>ggdag()</code></h3>
<p>If you use <a href="http://dagitty.net/" target="_blank" rel="noopener">dagitty.net</a> to draw a DAG, you&rsquo;ll notice that it generates some code for you in the model code section:</p>
<p><img src="/img/example/dagitty-code.png" width="75%" style="display: block; margin: auto;" /></p>
<p>You can copy that <code>dag{ ... }</code> code and paste it into R to define a DAG object rather than use the <code>dagify()</code> function. To do this, use the <code>dagitty()</code> function from the <strong>dagitty</strong> library and include the whole generated model code in single quotes (<code>''</code>):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">model_from_dagitty <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">dagitty</span>(<span style="color:#e6db74">&#39;dag {
</span><span style="color:#e6db74">bb=&#34;0,0,1,1&#34;
</span><span style="color:#e6db74">&#34;A confounder&#34; [pos=&#34;0.809,0.306&#34;]
</span><span style="color:#e6db74">&#34;Another confounder&#34; [pos=&#34;0.810,0.529&#34;]
</span><span style="color:#e6db74">&#34;Some outcome&#34; [outcome,pos=&#34;0.918,0.432&#34;]
</span><span style="color:#e6db74">&#34;Some treatment&#34; [exposure,pos=&#34;0.681,0.426&#34;]
</span><span style="color:#e6db74">&#34;A confounder&#34; -&gt; &#34;Some outcome&#34;
</span><span style="color:#e6db74">&#34;A confounder&#34; -&gt; &#34;Some treatment&#34;
</span><span style="color:#e6db74">&#34;Another confounder&#34; -&gt; &#34;Some outcome&#34;
</span><span style="color:#e6db74">&#34;Another confounder&#34; -&gt; &#34;Some treatment&#34;
</span><span style="color:#e6db74">&#34;Some treatment&#34; -&gt; &#34;Some outcome&#34;
</span><span style="color:#e6db74">}
</span><span style="color:#e6db74">&#39;</span>)

<span style="color:#a6e22e">ggdag</span>(model_from_dagitty) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme_dag</span>()
</code></pre></div><p><img src="/example/dags_files/figure-html/code-from-dagitty-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>By default it&rsquo;s going to look ugly because (1) the node labels don&rsquo;t fit, and (2) slight differences in the coordinates make it so the nodes don&rsquo;t perfectly align with each other. To fix coordinate alignment, you can modify the numbers in the generated DAG code. Here I rounded the numbers so that they&rsquo;re all 0.3, 0.8, etc.</p>
<p>To fix the label issue, you can add the <code>use_labels</code> argument like normally. Only here, you can&rsquo;t specify <code>use_labels = &quot;label&quot;</code>. Instead, when you specify a DAG using dagitty&rsquo;s code like this, the column in the underlying dataset that contains the labels is named <code>name</code>, so you need to use <code>use_labels = &quot;name&quot;</code>.</p>
<p>Other <code>ggdag()</code> variations like <code>ggdag_status()</code> will still work fine.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">model_from_dagitty_rounded <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">dagitty</span>(<span style="color:#e6db74">&#39;dag {
</span><span style="color:#e6db74">bb=&#34;0,0,1,1&#34;
</span><span style="color:#e6db74">&#34;A confounder&#34; [pos=&#34;0.8,0.3&#34;]
</span><span style="color:#e6db74">&#34;Another confounder&#34; [pos=&#34;0.8,0.5&#34;]
</span><span style="color:#e6db74">&#34;Some outcome&#34; [outcome,pos=&#34;0.9,0.4&#34;]
</span><span style="color:#e6db74">&#34;Some treatment&#34; [exposure,pos=&#34;0.7,0.4&#34;]
</span><span style="color:#e6db74">&#34;A confounder&#34; -&gt; &#34;Some outcome&#34;
</span><span style="color:#e6db74">&#34;A confounder&#34; -&gt; &#34;Some treatment&#34;
</span><span style="color:#e6db74">&#34;Another confounder&#34; -&gt; &#34;Some outcome&#34;
</span><span style="color:#e6db74">&#34;Another confounder&#34; -&gt; &#34;Some treatment&#34;
</span><span style="color:#e6db74">&#34;Some treatment&#34; -&gt; &#34;Some outcome&#34;
</span><span style="color:#e6db74">}
</span><span style="color:#e6db74">&#39;</span>)

<span style="color:#a6e22e">ggdag_status</span>(model_from_dagitty_rounded, text <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, use_labels <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;name&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">guides</span>(color <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>) <span style="color:#f92672">+</span>  <span style="color:#75715e"># Turn off legend</span>
  <span style="color:#a6e22e">theme_dag</span>()
</code></pre></div><p><img src="/example/dags_files/figure-html/code-from-dagitty-better-1.png" width="75%" style="display: block; margin: auto;" /></p>
<h2 id="mosquito-net-example">Mosquito net example</h2>
<h3 id="conditional-independencies">Conditional independencies</h3>
<p>You can test if your stated relationships are correct by looking at the conditional independencies that are implied by the DAG. In dagitty.net, these appear in the sidebar in the &ldquo;Testable implications&rdquo; section. To show how this works, we&rsquo;ll use a simulated dataset that I generated about a fictional mosquito net program. Download the data here if you want to follow along:</p>
<ul>
<li><a href="/data/mosquito_nets.csv"><i class="fas fa-table"></i> <code>mosquito_nets.csv</code></a></li>
</ul>
<p>Researchers are interested in whether using mosquito nets decreases an individual&rsquo;s risk of contracting malaria. They have collected data from 1,752 households in an unnamed country and have variables related to environmental factors, individual health, and household characteristics. Additionally, this country has a special government program that provides free mosquito nets to households that meet specific requirements: to qualify for the program, there must be more than 4 members of the household, and the household&rsquo;s monthly income must be lower than $700 a month. Households are not automatically enrolled in the program, and many do not use it. The data is not experimental—researchers have no control over who uses mosquito nets, and individual households make their own choices over whether to apply for free nets or buy their own nets, as well as whether they use the nets if they have them.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">mosquito_dag <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">dagify</span>(
  malaria_risk <span style="color:#f92672">~</span> net <span style="color:#f92672">+</span> income <span style="color:#f92672">+</span> health <span style="color:#f92672">+</span> temperature <span style="color:#f92672">+</span> resistance,
  net <span style="color:#f92672">~</span> income <span style="color:#f92672">+</span> health <span style="color:#f92672">+</span> temperature <span style="color:#f92672">+</span> eligible <span style="color:#f92672">+</span> household,
  eligible <span style="color:#f92672">~</span> income <span style="color:#f92672">+</span> household,
  health <span style="color:#f92672">~</span> income,
  exposure <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;net&#34;</span>,
  outcome <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;malaria_risk&#34;</span>,
  coords <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(x <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(malaria_risk <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span>, net <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>, income <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>, health <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>,
                      temperature <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>, resistance <span style="color:#f92672">=</span> <span style="color:#ae81ff">8.5</span>, eligible <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, household <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>),
                y <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(malaria_risk <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, net <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, income <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>, health <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>,
                      temperature <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>, resistance <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, eligible <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>, household <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)),
  labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(malaria_risk <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Risk of malaria&#34;</span>, net <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Mosquito net&#34;</span>, income <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Income&#34;</span>,
             health <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Health&#34;</span>, temperature <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Nighttime temperatures&#34;</span>,
             resistance <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Insecticide resistance&#34;</span>,
             eligible <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Eligible for program&#34;</span>, household <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Number in household&#34;</span>)
)

<span style="color:#a6e22e">ggdag_status</span>(mosquito_dag, use_labels <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;label&#34;</span>, text <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">guides</span>(fill <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, color <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>) <span style="color:#f92672">+</span>  <span style="color:#75715e"># Disable the legend</span>
  <span style="color:#a6e22e">theme_dag</span>()
</code></pre></div><p><img src="/example/dags_files/figure-html/build-mosquito-dag-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>The causal graph above  outlines the complete relationship between mosquito net use and risk of malaria. Each node in the DAG is a column in the dataset collected by the researchers, and includes the following:</p>
<ul>
<li>Malaria risk (<code>malaria_risk</code>): The likelihood that someone in the household will be infected with malaria. Measured on a scale of 0–100, with higher values indicating higher risk.</li>
<li>Mosquito net (<code>net</code> and <code>net_num</code>): A binary variable indicating if the household used mosquito nets.</li>
<li>Eligible for program (<code>eligible</code>): A binary variable indicating if the household is eligible for the free net program.</li>
<li>Income (<code>income</code>): The household&rsquo;s monthly income, in US dollars.</li>
<li>Nighttime temperatures (<code>temperature</code>): The average temperature at night, in Celsius.</li>
<li>Health (<code>health</code>): Self-reported healthiness in the household. Measured on a scale of 0–100, with higher values indicating better health.</li>
<li>Number in household (<code>household</code>): Number of people living in the household.</li>
<li>Insecticide resistance (<code>resistance</code>): Some strains of mosquitoes are more resistant to insecticide and thus pose a higher risk of infecting people with malaria. This is measured on a scale of 0–100, with higher values indicating higher resistance.</li>
</ul>
<p>According to the DAG, malaria risk is caused by income, temperatures, health, insecticide resistance, and mosquito net use. People who live in hotter regions, have lower incomes, have worse health, are surrounded by mosquitoes with high resistance to insecticide, and who do not use mosquito nets are at higher risk of contracting malaria than those who do not. Mosquito net use is caused by income, nighttime temperatures, health, the number of people living in the house, and eligibility for the free net program. People who live in areas that are cooler at night, have higher incomes, have better health, have more people in the home, and are eligible for free government nets are more likely to regularly use nets than those who do not. The DAG also shows that eligibility for the free net program is caused by income and household size, since households must meet specific thresholds to qualify.</p>
<p>First, let&rsquo;s download the dataset, put in a folder named <code>data</code>, and load it:</p>
<ul>
<li><a href="/data/mosquito_nets.csv"><i class="fas fa-table"></i> <code>mosquito_nets.csv</code></a></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Load the data.</span>
<span style="color:#75715e"># It&#39;d be a good idea to click on the &#34;mosquito_nets.csv&#34; object in the</span>
<span style="color:#75715e"># Environment panel in RStudio to see what the data looks like after you load it</span>
mosquito_nets <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read_csv</span>(<span style="color:#e6db74">&#34;data/mosquito_nets.csv&#34;</span>)
</code></pre></div><p>We can use this data to check if the relationships defined by our DAG reflect reality. Recall that <em>d</em>-separation implies that nodes are statistically independent of each other and do not transfer associational information. If you draw the mosquito net DAG with dagitty.net, or if you run <code>impliedConditionalIndependencies()</code> in R, you can see a list of all the implied conditional independencies.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">impliedConditionalIndependencies</span>(mosquito_dag)
<span style="color:#75715e">## elgb _||_ hlth | incm</span>
<span style="color:#75715e">## elgb _||_ mlr_ | hlth, incm, net, tmpr</span>
<span style="color:#75715e">## elgb _||_ rsst</span>
<span style="color:#75715e">## elgb _||_ tmpr</span>
<span style="color:#75715e">## hlth _||_ hshl</span>
<span style="color:#75715e">## hlth _||_ rsst</span>
<span style="color:#75715e">## hlth _||_ tmpr</span>
<span style="color:#75715e">## hshl _||_ incm</span>
<span style="color:#75715e">## hshl _||_ mlr_ | hlth, incm, net, tmpr</span>
<span style="color:#75715e">## hshl _||_ rsst</span>
<span style="color:#75715e">## hshl _||_ tmpr</span>
<span style="color:#75715e">## incm _||_ rsst</span>
<span style="color:#75715e">## incm _||_ tmpr</span>
<span style="color:#75715e">## net _||_ rsst</span>
<span style="color:#75715e">## rsst _||_ tmpr</span>
</code></pre></div><p>The <code>_||_</code> symbol in the output here is the <code>\(\perp\)</code> symbol, which means &ldquo;independent of&rdquo;. The <code>|</code> in the output means &ldquo;given&rdquo;.</p>
<p>In the interest of space, we will not verify all these implied independencies, but we can test a few of them:</p>
<ul>
<li>
<p><code>\(\text{Health} \perp \text{Household members}\)</code>: (Read as <em>&ldquo;Health is independent of household member count&rdquo;</em>.) Health should be independent of the number of people in each household. In the data, the two variables should not be correlated. This is indeed the case:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">cor</span>(mosquito_nets<span style="color:#f92672">$</span>health, mosquito_nets<span style="color:#f92672">$</span>household)
<span style="color:#75715e">## [1] 9.8e-05</span>
</code></pre></div></li>
<li>
<p><code>\(\text{Income} \perp \text{Insecticide resistance}\)</code>: (Read as <em>&ldquo;Income is independent of insecticide resistance&rdquo;</em>.) Income should be independent of insecticide resistance. This is again true:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">cor</span>(mosquito_nets<span style="color:#f92672">$</span>income, mosquito_nets<span style="color:#f92672">$</span>resistance)
<span style="color:#75715e">## [1] 0.014</span>
</code></pre></div></li>
<li>
<p><code>\(\text{Malaria risk} \perp \text{Household members}\ |\ \text{Health, Income, Bed net use, Temperature}\)</code>: (Read as <em>&ldquo;Malaria risk is independent of house member count given health, income, bed net use, and temperature&rdquo;</em>.) Malaria risk should be independent of the number of household members given similar levels of health, income, mosquito net use, and nighttime temperatures. We cannot use <code>cor()</code> to test this implication, since there are many variables involved, but we can use a regression model to check if the number of household members is significantly related to malaria risk. It is not significant ($t = -0.17$, <code>\(p = 0.863\)</code>), which means the two are independent, as expected.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">lm</span>(malaria_risk <span style="color:#f92672">~</span> household <span style="color:#f92672">+</span> health <span style="color:#f92672">+</span> income <span style="color:#f92672">+</span> net <span style="color:#f92672">+</span> temperature,
   data <span style="color:#f92672">=</span> mosquito_nets) <span style="color:#f92672">%&gt;%</span>
  broom<span style="color:#f92672">::</span><span style="color:#a6e22e">tidy</span>()
<span style="color:#75715e">## # A tibble: 6 x 5</span>
<span style="color:#75715e">##   term        estimate std.error statistic   p.value</span>
<span style="color:#75715e">##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span>
<span style="color:#75715e">## 1 (Intercept)  76.2      0.966      78.9   0.       </span>
<span style="color:#75715e">## 2 household    -0.0155   0.0893     -0.173 8.63e-  1</span>
<span style="color:#75715e">## 3 health        0.148    0.0107     13.9   9.75e- 42</span>
<span style="color:#75715e">## 4 income       -0.0751   0.00104   -72.6   0.       </span>
<span style="color:#75715e">## 5 netTRUE     -10.4      0.266     -39.2   2.63e-241</span>
<span style="color:#75715e">## 6 temperature   1.01     0.0310     32.5   1.88e-181</span>
</code></pre></div></li>
</ul>
<p>We can check all the other conditional independencies to see if the DAG captures the reality of the full system of factors that influence mosquito net use and malaria risk. If there are substantial and significant correlations between nodes that should be independent, there is likely an issue with the specification of the DAG. Return to the theory of how the phenomena are generated and refine the DAG more.</p>
<h3 id="mosquito-net-adjustment-sets">Mosquito net adjustment sets</h3>
<p>There is a direct path between mosquito net use and the risk of malaria, but the effect is not causally identified due to several other open paths. We can either list out all the paths and find which open paths have arrows pointing backwards into the mosquito net node (run <code>paths(mosquito_dag)</code> to see these results), or we can let R find the appropriate adjustment sets automatically:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">adjustmentSets</span>(mosquito_dag)
<span style="color:#75715e">## { health, income, temperature }</span>
</code></pre></div><p>Based on the relationships between all the nodes in the DAG, adjusting for health, income, and temperature is enough to close all backdoors and identify the relationship between net use and malaria risk. Importantly, we do not need to worry about any of the nodes related to the government program for free nets, since those nodes are not <em>d</em>-connected to malaria risk. We only need to worry about confounding relationships.</p>
<p>We can confirm this graphically with <code>ggdag_adjustment_set()</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">ggdag_adjustment_set</span>(mosquito_dag, shadow <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>,
                     use_labels <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;label&#34;</span>, text <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme_dag</span>()
</code></pre></div><p><img src="/example/dags_files/figure-html/plot-mosquito-adjustment-fake-1.png" width="75%" style="display: block; margin: auto;" /></p>

                    </div>

                    



                    
                    <div class="article-widget">
                        
<div class="post-nav">
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Previous</div>
    <a href="/example/po-ate-cate/" rel="next">Potential outcomes, ATEs, and CATEs</a>
  </div>
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Next</div>
    <a href="/example/regression/" rel="prev">Regression</a>
  </div>
  
</div>

                    </div>
                    
                </div>

                <div class="body-footer">
                    <p>Last updated on September 11, 2020</p>

                    





                    



                </div>

            </article>

            <footer>
    <hr>

    <div class="row course-info">
        <div class="col-md-7">
            <p>
                <strong>2255: Análisis Estadístico en R (II° Semestre- 2021)</strong><br>

                <a href="https://www.uahurtado.cl/" target="_blank" rel="noopener">Universidad Alberto Hurtado</a> &emsp;&emsp;
                <a href="http://sociologia.uahurtado.cl/" target="_blank" rel="noopener">Departamento de Sociología</a>
            </p>

            <p>
                <a href="https://valentinaandrade.netlify.app/" target="_blank" rel="noopener"><i class="fas fa-user"></i>
                    Valentina Andrade</a> &emsp;&emsp;
                <a href="mailto:valentinaandrade@uchile.cl"><i class="fas fa-envelope"></i>
                    valentinaandrade@uchile.cl</a>
            </p>

            <p>
                <i class="far fa-calendar-alt"></i> Clases: Lunes 16.30-17.40 &emsp;&emsp;
                <i class="fas fa-pencil-alt"></i> Práctico: Lunes 18.00-19.20 
                <br><i class="fas fa-university"></i> Online, en link de Zoom
            </p>
        </div>

        <div class="col-md-5 credits">
            <p>All content licensed under a <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" rel="noopener">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>.</p>
            
            <p>Content <i class="fab fa-creative-commons"></i> 2021. Web developed by Andrew Heiss and custom by <a href="https://valentinaandrade.netlify.app/" target="_blank" rel="noopener">Valentina Andrade</a></p>
        
            <p>This site created with the <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> in <a href="https://bookdown.org/yihui/blogdown/" target="_blank" rel="noopener">blogdown</a> and <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a>. </p>
            
            <p><a href="https://github.com/valentinaandrade" target="_blank" rel="noopener"><i class="fab fa-github"></i> View the source at GitHub.</a></p>
        </div>
    </div>
</footer>


        </main>
    </div>
</div>

        

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/instant.page/5.1.0/instantpage.min.js" integrity="sha512-1+qUtKoh9XZW7j+6LhRMAyOrgSQKenQ4mluTR+cvxXjP1Z54RxZuzstR/H9kgPXQsVB8IW7DMDFUJpzLjvhGSQ==" crossorigin="anonymous"></script>

      
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      

      
      

      

      

    

    
    
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.2/anchor.min.js" integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    
    
    

    
    

    
    
    
    

    
    <script src="/js/bootstrap.bundle.min.8b7df62fd2da18ce73e29c13cc0a6198.js"></script>

    
    

    
    
    
    
    
    
    
    
    
    <script src="/en/js/wowchemy.min.c6ceb5c48772e46156651a48070d6139.js"></script>

    

<script src="/js/math-code.js"></script>


    
    

    
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>

</html>
