<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Code examples | Análisis Estadístico en R</title>
    <link>/example/</link>
      <atom:link href="/example/index.xml" rel="self" type="application/rss+xml" />
    <description>Code examples</description>
    <generator>Wowchemy (https://wowchemy.com)</generator><lastBuildDate>Sat, 31 Oct 2020 00:00:00 +0000</lastBuildDate>
    <image>
      <url>/media/icon_hua2ec155b4296a9c9791d015323e16eb5_11927_512x512_fill_lanczos_center_2.png</url>
      <title>Code examples</title>
      <link>/example/</link>
    </image>
    
    <item>
      <title>Generating random numbers</title>
      <link>/example/random-numbers/</link>
      <pubDate>Sat, 31 Oct 2020 00:00:00 +0000</pubDate>
      <guid>/example/random-numbers/</guid>
      <description>&lt;script src=&#34;/rmarkdown-libs/kePrint-0.0.1/kePrint.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;/rmarkdown-libs/lightable-0.0.1/lightable.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;p&gt;In your final project, you will generate a synthetic dataset and use it to conduct an evaluation of some social program. Generating fake or simulated data is an &lt;em&gt;incredibly powerful skill&lt;/em&gt;, but it takes some practice. Here are a bunch of helpful resources and code examples of how to use different R functions to generate random numbers that follow specific distributions (or probability shapes).&lt;/p&gt;
&lt;p&gt;This example focuses primarily on distributions. Each of the columns you&amp;rsquo;ll generate will be completely independent from each other and there will be no correlation between them. &lt;a href=&#34;/example/synthetic-data/&#34;&gt;The example for generating synthetic data&lt;/a&gt; provides code and a bunch of examples of how to build in correlations between columns.&lt;/p&gt;
&lt;p&gt;First, make sure you load the libraries we&amp;rsquo;ll use throughout the example:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(tidyverse)
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(patchwork)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;seeds&#34;&gt;Seeds&lt;/h2&gt;
&lt;p&gt;When R (or any computer program, really) generates random numbers, it uses an algorithm to simulate randomness. This algorithm always starts with an initial number, or seed. Typically it will use something like the current number of milliseconds since some date, so that every time you generate random numbers they&amp;rsquo;ll be different. Look at this, for instance:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Choose 3 numbers between 1 and 10&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;sample&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;)
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] 9 4 7&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Choose 3 numbers between 1 and 10&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;sample&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;)
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] 5 6 9&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;They&amp;rsquo;re different both times.&lt;/p&gt;
&lt;p&gt;That&amp;rsquo;s ordinarily totally fine, but if you care about reproducibility (like having a synthetic dataset with the same random values, or having jittered points in a plot be in the same position every time you knit), it&amp;rsquo;s a good idea to set your own seed. This ensures that the random numbers you generate are the same every time you generate them.&lt;/p&gt;
&lt;p&gt;Do this by feeding &lt;code&gt;set.seed()&lt;/code&gt; some numbers. It doesn&amp;rsquo;t matter what number you use—it just has to be a whole number. People have all sorts of favorite seeds:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;1&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;13&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;42&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;1234&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;12345&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;20201101&lt;/code&gt; (i.e. the current date)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;8675309&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;You could even go to &lt;a href=&#34;https://www.random.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;random.org&lt;/a&gt; and use atmospheric noise to generate a seed, and then use that in R.&lt;/p&gt;
&lt;p&gt;Here&amp;rsquo;s what happens when you generate random numbers after setting a seed:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Set a seed&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)

&lt;span style=&#34;color:#75715e&#34;&gt;# Choose 3 numbers between 1 and 10&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;sample&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;)
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] 10  6  5&lt;/span&gt;

&lt;span style=&#34;color:#75715e&#34;&gt;# Set a seed&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)

&lt;span style=&#34;color:#75715e&#34;&gt;# Choose another 3 numbers between 1 and 10&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;sample&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;)
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] 10  6  5&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;They&amp;rsquo;re the same!&lt;/p&gt;
&lt;p&gt;Once you set a seed, it influences any function that does anything random, but it doesn&amp;rsquo;t reset. For instance, if you set a seed once and then run &lt;code&gt;sample()&lt;/code&gt; twice, you&amp;rsquo;ll get different numbers the second time, but you&amp;rsquo;ll get the same different numbers every time:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Set a seed&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)

&lt;span style=&#34;color:#75715e&#34;&gt;# Choose 3 numbers between 1 and 10&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;sample&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;)
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] 10  6  5&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;sample&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;)  &lt;span style=&#34;color:#75715e&#34;&gt;# This will be different!&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] 9 5 6&lt;/span&gt;

&lt;span style=&#34;color:#75715e&#34;&gt;# Set a seed again&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)

&lt;span style=&#34;color:#75715e&#34;&gt;# Choose 3 numbers between 1 and 10&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;sample&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;)
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] 10  6  5&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;sample&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;)  &lt;span style=&#34;color:#75715e&#34;&gt;# This will be different, but the same as before!&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] 9 5 6&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Typically it&amp;rsquo;s easiest to just include &lt;code&gt;set.seed(SOME_NUMBER)&lt;/code&gt; at the top of your script after you load all the libraries. Some functions have a &lt;code&gt;seed&lt;/code&gt; argument, and it&amp;rsquo;s a good idea to use it: &lt;code&gt;position_jitter(..., seed = 1234)&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id=&#34;distributions&#34;&gt;Distributions&lt;/h2&gt;
&lt;p&gt;Remember in elementary school when you&amp;rsquo;d decide on playground turns by saying &amp;ldquo;Pick a number between 1 and 10&amp;rdquo; and whoever was the closest would win? When you generate random numbers in R, you&amp;rsquo;re essentially doing the same thing, only with some fancier bells and whistles.&lt;/p&gt;
&lt;p&gt;When you ask someone to choose a number between 1 and 10, any of those numbers should be equally likely. 1 isn&amp;rsquo;t really less common than 5 or anything. In some situations, though, there are numbers that are more likely to appear than others (i.e. when you roll two dice, it&amp;rsquo;s pretty rare to get a 2, but pretty common to get a 7). These different kinds of likelihood change the shape of the &lt;em&gt;distribution&lt;/em&gt; of possible values. There are &lt;a href=&#34;https://en.wikipedia.org/wiki/List_of_probability_distributions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;hundreds of different distributions&lt;/a&gt;, but for the sake of generating data, there are only a few that you need to know.&lt;/p&gt;
&lt;h3 id=&#34;uniform-distribution&#34;&gt;Uniform distribution&lt;/h3&gt;
&lt;p&gt;In a &lt;a href=&#34;https://en.wikipedia.org/wiki/Discrete_uniform_distribution&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;uniform distribution&lt;/a&gt;, every number is equally likely. This is the &amp;ldquo;pick a number between 1 and 10&amp;rdquo; scenario, or rolling a single die. There are a couple ways to work with a uniform distribution in R: (1) &lt;code&gt;sample()&lt;/code&gt; and (2) &lt;code&gt;runif()&lt;/code&gt;.&lt;/p&gt;
&lt;h4 id=&#34;sample&#34;&gt;&lt;code&gt;sample()&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;The &lt;code&gt;sample()&lt;/code&gt; function chooses an element from a list.&lt;/p&gt;
&lt;p&gt;For instance, let&amp;rsquo;s pretend we have six possible numbers (like a die, or like 6 categories on a survey), like this:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;possible_answers &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;)  &lt;span style=&#34;color:#75715e&#34;&gt;# We could also write this as 1:6 instead&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;If we want to randomly choose from this list, you&amp;rsquo;d use &lt;code&gt;sample()&lt;/code&gt;. The &lt;code&gt;size&lt;/code&gt; argument defines how many numbers to choose.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Choose 1 random number&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;sample&lt;/span&gt;(possible_answers, size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] 4&lt;/span&gt;

&lt;span style=&#34;color:#75715e&#34;&gt;# Choose 3 random numbers&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;sample&lt;/span&gt;(possible_answers, size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;)
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] 2 6 5&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;One important argument you can use is &lt;code&gt;replace&lt;/code&gt;, which essentially puts the number back into the pool of possible numbers. Imagine having a bowl full of ping pong balls with the numbers 1–6 on them. If you take the number &amp;ldquo;3&amp;rdquo; out, you can&amp;rsquo;t draw it again. If you put it back in, you can pull it out again. The &lt;code&gt;replace&lt;/code&gt; argument puts the number back after it&amp;rsquo;s drawn:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Choose 10 random numbers, with replacement&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;sample&lt;/span&gt;(possible_answers, size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;, replace &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;)
&lt;span style=&#34;color:#75715e&#34;&gt;##  [1] 6 4 6 6 6 4 4 5 4 3&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;If you don&amp;rsquo;t specify &lt;code&gt;replace = TRUE&lt;/code&gt;, and you try to choose more numbers than are in the set, you&amp;rsquo;ll get an error:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Choose 8 numbers between 1 and 6, but don&amp;#39;t replace them.&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# This won&amp;#39;t work!&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;sample&lt;/span&gt;(possible_answers, size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;)
&lt;span style=&#34;color:#75715e&#34;&gt;## Error in sample.int(length(x), size, replace, prob): cannot take a sample larger than the population when &amp;#39;replace = FALSE&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;It&amp;rsquo;s hard to see patterns in the outcomes when generating just a handful of numbers, but easier when you do a lot. Let&amp;rsquo;s roll a die 1,000 times:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)
die &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tibble&lt;/span&gt;(value &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sample&lt;/span&gt;(possible_answers,
                             size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;,
                             replace &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;))
die &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;count&lt;/span&gt;(value)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 6 x 2&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   value     n&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;dbl&amp;gt; &amp;lt;int&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1     1   161&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2     2   153&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3     3   188&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4     4   149&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5     5   157&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6     6   192&lt;/span&gt;

&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(die, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; value)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_bar&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;labs&lt;/span&gt;(title &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;1,000 rolls of a single die&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/random-numbers_files/figure-html/dice-roll-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;In this case, 3 and 6 came up more often than the others, but that&amp;rsquo;s just because of randomness. If we rolled the die 100,000 times, the bars should basically be the same:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)
die &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tibble&lt;/span&gt;(value &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sample&lt;/span&gt;(possible_answers,
                             size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;100000&lt;/span&gt;,
                             replace &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;))

&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(die, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; value)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_bar&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;labs&lt;/span&gt;(title &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;100,000 rolls of a single die&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/random-numbers_files/figure-html/dice-roll-lots-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;h4 id=&#34;runif&#34;&gt;&lt;code&gt;runif()&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;Another way to generate uniformly distributed numbers is to use the &lt;code&gt;runif()&lt;/code&gt; function (which is short for &amp;ldquo;random uniform&amp;rdquo;, and which took me years to realize, and for years I wondered why people used a function named &amp;ldquo;run if&amp;rdquo; when there&amp;rsquo;s no if statement anywhere??)&lt;/p&gt;
&lt;p&gt;&lt;code&gt;runif()&lt;/code&gt; will choose numbers between a minimum and a maximum. These numbers will not be whole numbers. By default, the min and max are 0 and 1:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;runif&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;)
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] 0.09862 0.96294 0.88655 0.05623 0.44452&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Here are 5 numbers between 35 and 56:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;runif&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;, min &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;35&lt;/span&gt;, max &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;56&lt;/span&gt;)
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] 46.83 42.89 37.75 53.22 46.13&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Since these aren&amp;rsquo;t whole numbers, you can round them to make them look more realistic (like, if you were generating a column for age, you probably don&amp;rsquo;t want people who are 21.5800283 years old):&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Generate 5 people between the ages of 18 and 35&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;round&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;runif&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;, min &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;, max &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;35&lt;/span&gt;), &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] 21 28 33 34 31&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;You can confirm that each number has equal probability if you make a histogram. Here are 5,000 random people between 18 and 35:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)
lots_of_numbers &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tibble&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;runif&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;5000&lt;/span&gt;, min &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;, max &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;35&lt;/span&gt;))

&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(lots_of_numbers, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; x)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_histogram&lt;/span&gt;(binwidth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;, boundary &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/random-numbers_files/figure-html/runif-plot-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;h3 id=&#34;normal-distribution&#34;&gt;Normal distribution&lt;/h3&gt;
&lt;p&gt;The whole &amp;ldquo;choose a number between 1 and 10&amp;rdquo; idea of a uniform distribution is neat and conceptually makes sense, but most numbers that exist in the world tend to have higher probabilities around certain values—almost like gravity around a specific point. For instance, income in the United States is not uniformly distributed—a handful of people are really really rich, lots are very poor, and most are kind of clustered around an average.&lt;/p&gt;
&lt;p&gt;The idea of having possible values clustered around an average is how the rest of these distributions work (uniform distributions don&amp;rsquo;t have any sort of central gravity point; all these others do). Each distribution is defined by different things called &lt;em&gt;parameters&lt;/em&gt;, or values that determine the shape of the probabilities and locations of the clusters.&lt;/p&gt;
&lt;p&gt;A super common type of distribution is the &lt;a href=&#34;https://en.wikipedia.org/wiki/Normal_distribution&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;normal distribution&lt;/a&gt;. This is the famous &amp;ldquo;bell curve&amp;rdquo; you learn about in earlier statistics classes. A normal distribution has two parameters:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;A mean (the center of the cluster)&lt;/li&gt;
&lt;li&gt;A standard deviation (how much spread there is around the mean).&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;In R, you can generate random numbers from a normal distribution with the &lt;code&gt;rnorm()&lt;/code&gt; function. It takes three arguments: the number of numbers you want to generate, the mean, and the standard deviation. It defaults to a mean of 0 and a standard deviation of 1, which means most numbers will cluster around 0, with a lot between −1 and 1, and some going up to −2 and 2 (technically 67% of numbers will be between −1 and 1, while 95% of numbers will be between −2–2ish)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;rnorm&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;)
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] -1.3662  0.5392 -1.3219 -0.2813 -2.1049&lt;/span&gt;

&lt;span style=&#34;color:#75715e&#34;&gt;# Cluster around 10, with an SD of 4&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;rnorm&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;, mean &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;, sd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;)
&lt;span style=&#34;color:#75715e&#34;&gt;## [1]  3.530  7.105 11.227 10.902 13.743&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;When working with uniform distributions, it&amp;rsquo;s easy to know how high or low your random values might go, since you specify a minimum and maximum number. With a normal distribution, you don&amp;rsquo;t specify starting and ending points—you specify a middle and a spread, so it&amp;rsquo;s harder to guess the whole range. Plotting random values is thus essential. Here&amp;rsquo;s 1,000 random numbers clustered around 10 with a standard deviation of 4:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)

plot_data &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tibble&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rnorm&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;, mean &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;, sd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;))
&lt;span style=&#34;color:#a6e22e&#34;&gt;head&lt;/span&gt;(plot_data)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 6 x 1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##        x&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##    &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1  5.17 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 11.1  &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 14.3  &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4  0.617&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5 11.7  &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6 12.0&lt;/span&gt;

&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(plot_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; x)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_histogram&lt;/span&gt;(binwidth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, boundary &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/random-numbers_files/figure-html/normal-10-4-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Neat. Most numbers are around 10; lots are between 5 and 15; some go as high as 25 and as low as −5.&lt;/p&gt;
&lt;p&gt;Watch what happens if you change the standard deviation to 10 to make the spread wider:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)

plot_data &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tibble&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rnorm&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;, mean &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;, sd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;))
&lt;span style=&#34;color:#a6e22e&#34;&gt;head&lt;/span&gt;(plot_data)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 6 x 1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##        x&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##    &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1  -2.07&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2  12.8 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3  20.8 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4 -13.5 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5  14.3 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6  15.1&lt;/span&gt;

&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(plot_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; x)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_histogram&lt;/span&gt;(binwidth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, boundary &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/random-numbers_files/figure-html/normal-10-10-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;It&amp;rsquo;s still centered around 10, but now you get values as high as 40 and as low as −20. The data is more spread out now.&lt;/p&gt;
&lt;p&gt;When simulating data, you&amp;rsquo;ll most often use a normal distribution just because it&amp;rsquo;s easy and lots of things follow that pattern in the real world. Incomes, ages, education, etc. all have a kind of gravity to them, and a normal distribution is a good way of showing that gravity. For instance, here are 1,000 simulated people with reasonable random incomes, ages, and years of education:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)

fake_people &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tibble&lt;/span&gt;(income &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rnorm&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;, mean &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;40000&lt;/span&gt;, sd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;15000&lt;/span&gt;),
                      age &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rnorm&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;, mean &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;25&lt;/span&gt;, sd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;),
                      education &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rnorm&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;, mean &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;16&lt;/span&gt;, sd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;))
&lt;span style=&#34;color:#a6e22e&#34;&gt;head&lt;/span&gt;(fake_people)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 6 x 3&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   income   age education&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##    &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 21894. 15.4      12.1 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 44161. 27.4      15.6 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 56267. 12.7      15.6 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4  4815. 30.1      20.8 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5 46437. 30.6       9.38&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6 47591.  9.75     11.8&lt;/span&gt;

fake_income &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(fake_people, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; income)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_histogram&lt;/span&gt;(binwidth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5000&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;, boundary &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;labs&lt;/span&gt;(title &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Simulated income&amp;#34;&lt;/span&gt;)

fake_age &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(fake_people, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; age)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_histogram&lt;/span&gt;(binwidth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;, boundary &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;labs&lt;/span&gt;(title &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Simulated age&amp;#34;&lt;/span&gt;)

fake_education &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(fake_people, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; education)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_histogram&lt;/span&gt;(binwidth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;, boundary &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;labs&lt;/span&gt;(title &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Simulated education&amp;#34;&lt;/span&gt;)

fake_income &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; fake_age &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; fake_education
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/random-numbers_files/figure-html/reasonable-normal-1.png&#34; width=&#34;100%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;These three columns all have different centers and spreads. Income is centered around &lt;span&gt;$45,000&lt;/span&gt;, going up to almost &lt;span&gt;$100,000&lt;/span&gt; and as low as &lt;span&gt;−$10,000&lt;/span&gt;; age is centered around 25, going as low as 0 and as high as 50; education is centered around 16, going as low as 3 and as high as 28. Cool.&lt;/p&gt;
&lt;p&gt;Again, when generating these numbers, it&amp;rsquo;s really hard to know how high or low these ranges will be, so it&amp;rsquo;s a good idea to plot them constantly. I settled on &lt;code&gt;sd = 4&lt;/code&gt; for education only because I tried things like &lt;code&gt;1&lt;/code&gt; and &lt;code&gt;10&lt;/code&gt; and got wild looking values (everyone basically at 16 with little variation, or everyone ranging from −20 to 50, which makes no sense when thinking about years of education). Really it&amp;rsquo;s just a process of trial and error until the data looks good and reasonable.&lt;/p&gt;
&lt;h3 id=&#34;truncated-normal-distribution&#34;&gt;Truncated normal distribution&lt;/h3&gt;
&lt;p&gt;Sometimes you&amp;rsquo;ll end up with negative numbers that make no sense. Look at income in the plot above, for instance. Some people are earning −$10,000 year. The rest of the distribution looks okay, but those negative values are annoying.&lt;/p&gt;
&lt;p&gt;To fix this, you can use something called a &lt;a href=&#34;https://en.wikipedia.org/wiki/Truncated_normal_distribution&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;truncated normal distribution&lt;/a&gt;, which lets you specify a mean and standard deviation, just like a regular normal distribution, but also lets you specify a minimum and/or maximum so you don&amp;rsquo;t get values that go too high or too low.&lt;/p&gt;
&lt;p&gt;R doesn&amp;rsquo;t have a truncated normal function built-in, but you can install &lt;a href=&#34;https://github.com/olafmersmann/truncnorm&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;the &lt;strong&gt;truncnorm&lt;/strong&gt; package&lt;/a&gt; and use the &lt;code&gt;rtruncnorm()&lt;/code&gt; function. A truncated normal distribution has four parameters:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;A mean (&lt;code&gt;mean&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;A standard deviation (&lt;code&gt;sd&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;A minimum (optional) (&lt;code&gt;a&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;A maximum (optional) (&lt;code&gt;b&lt;/code&gt;)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;For instance, let&amp;rsquo;s pretend you have a youth program designed to target people who are between 12 and 21 years old, with most around 14. You can generate numbers with a mean of 14 and a standard deviation of 5, but you&amp;rsquo;ll create people who are too old, too young, or even negatively aged!&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)

plot_data &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tibble&lt;/span&gt;(fake_age &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rnorm&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;, mean &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;14&lt;/span&gt;, sd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;))
&lt;span style=&#34;color:#a6e22e&#34;&gt;head&lt;/span&gt;(plot_data)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 6 x 1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   fake_age&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##      &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1     7.96&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2    15.4 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3    19.4 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4     2.27&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5    16.1 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6    16.5&lt;/span&gt;

&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(plot_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; fake_age)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_histogram&lt;/span&gt;(binwidth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;, boundary &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/random-numbers_files/figure-html/nontruncated-normal-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;To fix this, truncate the range at 12 and 21:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(truncnorm)  &lt;span style=&#34;color:#75715e&#34;&gt;# For rtruncnorm()&lt;/span&gt;

&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)

plot_data &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tibble&lt;/span&gt;(fake_age &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rtruncnorm&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;, mean &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;14&lt;/span&gt;, sd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;, a &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;12&lt;/span&gt;, b &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;21&lt;/span&gt;))
&lt;span style=&#34;color:#a6e22e&#34;&gt;head&lt;/span&gt;(plot_data)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 6 x 1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   fake_age&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##      &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1     15.4&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2     19.4&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3     16.1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4     16.5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5     14.3&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6     18.8&lt;/span&gt;

&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(plot_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; fake_age)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_histogram&lt;/span&gt;(binwidth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;, boundary &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/random-numbers_files/figure-html/truncated-normal-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;And voila! A bunch of people between 12 and 21, with most around 14, with no invalid values.&lt;/p&gt;
&lt;h3 id=&#34;beta-distribution&#34;&gt;Beta distribution&lt;/h3&gt;
&lt;p&gt;Normal distributions are neat, but they&amp;rsquo;re symmetrical around the mean (unless you truncate them). What if your program involves a test with a maximum of 100 points where most people score around 85, but a sizable portion score below that. In other words, it&amp;rsquo;s not centered at 85, but is skewed left.&lt;/p&gt;
&lt;p&gt;To simulate this kind of distribution, we can use a Beta distribution. Beta distributions are neat because they naturally only range between 0 and 1—they&amp;rsquo;re perfect for things like percentages or proportions or or 100-based exams.&lt;/p&gt;
&lt;p&gt;Unlike a normal distribution, where you use the mean and standard deviation as parameters, Beta distributions take two non-intuitive parameters:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;shape1&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;shape2&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;What the heck are these shapes though?! &lt;a href=&#34;https://stats.stackexchange.com/a/47782/3025&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;This answer at Cross Validated&lt;/a&gt; does an &lt;em&gt;excellent&lt;/em&gt; job of explaining the intuition behind Beta distributions and it&amp;rsquo;d be worth it to read it.&lt;/p&gt;
&lt;p&gt;Basically, Beta distributions are good at modeling probabilities of things, and &lt;code&gt;shape1&lt;/code&gt; and &lt;code&gt;shape2&lt;/code&gt; represent specific parts of a probability formula.&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s say that there&amp;rsquo;s an exam with 10 points where most people score a 6/10. Another way to think about this is that an exam is a collection of correct answers and incorrect answers, and that the percent correct follows this equation:&lt;/p&gt;
&lt;p&gt;$$
\frac{\text{Number correct}}{\text{Number correct} + \text{Number incorrect}}
$$&lt;/p&gt;
&lt;p&gt;If you scored a 6, you could write that as:&lt;/p&gt;
&lt;p&gt;$$
\frac{6}{6 + 4}
$$&lt;/p&gt;
&lt;p&gt;To make it more general, we can use Greek variable names: &lt;code&gt;\(\alpha\)&lt;/code&gt; for the number correct and &lt;code&gt;\(\beta\)&lt;/code&gt; for the number incorrect, leaving us with this:&lt;/p&gt;
&lt;p&gt;$$
\frac{\alpha}{\alpha + \beta}
$$&lt;/p&gt;
&lt;p&gt;Neat.&lt;/p&gt;
&lt;p&gt;In a Beta distribution, the &lt;code&gt;\(\alpha\)&lt;/code&gt; and &lt;code&gt;\(\beta\)&lt;/code&gt; in that equation correspond to &lt;code&gt;shape1&lt;/code&gt; and &lt;code&gt;shape2&lt;/code&gt;. If we want to generate random scores for this test where most people get 6/10, we can use &lt;code&gt;rbeta()&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)

plot_data &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tibble&lt;/span&gt;(exam_score &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rbeta&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;, shape1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;, shape2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;)) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# rbeta() generates numbers between 0 and 1, so multiply everything by 10 to&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# scale up the exam scores&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(exam_score &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; exam_score &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;)

&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(plot_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; exam_score)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_histogram&lt;/span&gt;(binwidth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;scale_x_continuous&lt;/span&gt;(breaks &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/random-numbers_files/figure-html/beta-example1-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Most people score around 6, with a bunch at 5 and 7, and fewer in the tails. Importantly, it&amp;rsquo;s &lt;em&gt;not&lt;/em&gt; centered at 6—the distribution is asymmetric.&lt;/p&gt;
&lt;p&gt;The magic of—and most confusing part about—Beta distributions is that you can get all sorts of curves by just changing the shape parameters. To make this easier to see, we can make a bunch of different Beta distributions. Instead of plotting them with histograms, we&amp;rsquo;ll use density plots (and instead of generating random numbers, we&amp;rsquo;ll plot the actual full range of the distribution (that&amp;rsquo;s what &lt;code&gt;dbeta&lt;/code&gt; and &lt;code&gt;geom_function()&lt;/code&gt; do in all these examples)).&lt;/p&gt;
&lt;p&gt;Here&amp;rsquo;s what we saw before, with &lt;code&gt;\(\alpha\)&lt;/code&gt; (&lt;code&gt;shape1&lt;/code&gt;) = 6 and &lt;code&gt;\(\beta\)&lt;/code&gt; (&lt;code&gt;shape2&lt;/code&gt;) = 4:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_function&lt;/span&gt;(fun &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; dbeta, args &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(shape1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;, shape2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/random-numbers_files/figure-html/beta-6-4-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Again, there&amp;rsquo;s a peak at 0.6 (or 6), which is what we expected.&lt;/p&gt;
&lt;p&gt;We can make the distribution narrower if we scale the shapes up. Here pretty much everyone scores around 50% and 75%.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_function&lt;/span&gt;(fun &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; dbeta, args &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(shape1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;60&lt;/span&gt;, shape2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;40&lt;/span&gt;))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/random-numbers_files/figure-html/beta-60-44-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;So far all these curves look like normal distributions, just slightly skewed. But when if most people score 90–100%? Or most fail? A Beta distribution can handle that too:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_function&lt;/span&gt;(fun &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; dbeta, args &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(shape1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;9&lt;/span&gt;, shape2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;), color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;blue&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_function&lt;/span&gt;(fun &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; dbeta, args &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(shape1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, shape2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;9&lt;/span&gt;), color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;red&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/random-numbers_files/figure-html/beta-1-9-9-1-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;With &lt;code&gt;shape1 = 9&lt;/code&gt; and &lt;code&gt;shape2 = 1&lt;/code&gt; (or &lt;code&gt;\(\frac{9}{9 + 1}\)&lt;/code&gt;) we get most around 90%, while &lt;code&gt;shape1 = 1&lt;/code&gt; and &lt;code&gt;shape2 = 9&lt;/code&gt; (or &lt;code&gt;\(\frac{1}{1 + 9}\)&lt;/code&gt;) gets us most around 10%.&lt;/p&gt;
&lt;p&gt;Check out all these other shapes too:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_function&lt;/span&gt;(fun &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; dbeta, args &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(shape1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;, shape2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;), color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;blue&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_function&lt;/span&gt;(fun &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; dbeta, args &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(shape1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, shape2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;), color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;red&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_function&lt;/span&gt;(fun &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; dbeta, args &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(shape1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;80&lt;/span&gt;, shape2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;23&lt;/span&gt;), color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;orange&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_function&lt;/span&gt;(fun &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; dbeta, args &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(shape1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;13&lt;/span&gt;, shape2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;17&lt;/span&gt;), color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;brown&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/random-numbers_files/figure-html/beta-lots-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;In real life, if I don&amp;rsquo;t want to figure out the math behind the &lt;code&gt;\(\frac{\alpha}{\alpha + \beta}\)&lt;/code&gt; shape values, I end up just choosing different numbers until it looks like the shape I want, and then I use &lt;code&gt;rbeta()&lt;/code&gt; with those parameter values. Like, how about we generate some numbers based on the red line above, with &lt;code&gt;shape1 = 2&lt;/code&gt; and &lt;code&gt;shape2 = 5&lt;/code&gt;, which looks like it should be centered around 0.2ish ($\frac{2}{2 + 5} = 0.2857$):&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)

plot_data &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tibble&lt;/span&gt;(thing &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rbeta&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;, shape1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, shape2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;)) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(thing &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; thing &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;100&lt;/span&gt;)
&lt;span style=&#34;color:#a6e22e&#34;&gt;head&lt;/span&gt;(plot_data)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 6 x 1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   thing&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 10.1 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 34.5 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 55.3 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4  2.19&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5 38.0 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6 39.9&lt;/span&gt;

&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(plot_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; thing)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_histogram&lt;/span&gt;(binwidth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;, boundary &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/random-numbers_files/figure-html/beta-2-5-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;It worked! Most values are around 20ish, but some go up to 60–80.&lt;/p&gt;
&lt;h3 id=&#34;binomial-distribution&#34;&gt;Binomial distribution&lt;/h3&gt;
&lt;p&gt;Often you&amp;rsquo;ll want to generate a column that only has two values: yes/no, treated/untreated, before/after, big/small, red/blue, etc. You&amp;rsquo;ll also likely want to control the proportions (25% treated, 62% blue, etc.). You can do this in two different ways: (1) &lt;code&gt;sample()&lt;/code&gt; and (2) &lt;code&gt;rbinom()&lt;/code&gt;.&lt;/p&gt;
&lt;h4 id=&#34;sample-1&#34;&gt;&lt;code&gt;sample()&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;We already saw &lt;code&gt;sample()&lt;/code&gt; when we talked about uniform distributions. To generate a binary variable with &lt;code&gt;sample()&lt;/code&gt;, just feed it a list of two possible values:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)

&lt;span style=&#34;color:#75715e&#34;&gt;# Choose 5 random T/F values&lt;/span&gt;
possible_things &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;)
&lt;span style=&#34;color:#a6e22e&#34;&gt;sample&lt;/span&gt;(possible_things, &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;, replace &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;)
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] FALSE FALSE FALSE FALSE  TRUE&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;R will choose these values with equal/uniform probability by default, but you can change that in &lt;code&gt;sample()&lt;/code&gt; with the &lt;code&gt;prob&lt;/code&gt; argument. For instance, pretend you want to simulate an election. According to the latest polls, one candidate has an 80% chance of winning. You want to randomly choose a winner based on that chance. Here&amp;rsquo;s how to do that with &lt;code&gt;sample()&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)
candidates &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Person 1&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Person 2&amp;#34;&lt;/span&gt;)
&lt;span style=&#34;color:#a6e22e&#34;&gt;sample&lt;/span&gt;(candidates, size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, prob &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;0.8&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.2&lt;/span&gt;))
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] &amp;#34;Person 1&amp;#34;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Person 1 wins!&lt;/p&gt;
&lt;p&gt;It&amp;rsquo;s hard to see the weighted probabilities when you just choose one, so let&amp;rsquo;s pretend there are 1,000 elections:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)
fake_elections &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tibble&lt;/span&gt;(winner &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sample&lt;/span&gt;(candidates,
                                         size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;,
                                         prob &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;0.8&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.2&lt;/span&gt;),
                                         replace &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;))
fake_elections &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;count&lt;/span&gt;(winner)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 2 x 2&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   winner       n&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;    &amp;lt;int&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 Person 1   792&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 Person 2   208&lt;/span&gt;

&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(fake_elections, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; winner)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_bar&lt;/span&gt;()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/random-numbers_files/figure-html/fake-election-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Person 1 won 792 of the elections. Neat.&lt;/p&gt;
&lt;p&gt;(This is essentially what election forecasting websites like FiveThirtyEight do! They just do it with way more sophisticated simulations.)&lt;/p&gt;
&lt;h4 id=&#34;rbinom&#34;&gt;&lt;code&gt;rbinom()&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;Instead of using &lt;code&gt;sample()&lt;/code&gt;, you can use a formal distribution called the &lt;a href=&#34;https://en.wikipedia.org/wiki/Binomial_distribution&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;binomial distribution&lt;/a&gt;. This distribution is often used for things that might have &amp;ldquo;trials&amp;rdquo; or binary outcomes that are like success/failure or yes/no or true/false&lt;/p&gt;
&lt;p&gt;The binomial distribution takes two parameters:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;size&lt;/code&gt;: The number of &amp;ldquo;trials&amp;rdquo;, or times that an event happens&lt;/li&gt;
&lt;li&gt;&lt;code&gt;prob&lt;/code&gt;: The probability of success in each trial&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;It&amp;rsquo;s easiest to see some examples of this. Let&amp;rsquo;s say you have a program that has a 60% success rate and it is tried on groups of 20 people 5 times. The parameters are thus &lt;code&gt;size = 20&lt;/code&gt; (since there are twenty people per group) and &lt;code&gt;prob = 0.6&lt;/code&gt; (since there is a 60% chance of success):&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)

&lt;span style=&#34;color:#a6e22e&#34;&gt;rbinom&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;, size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;20&lt;/span&gt;, prob &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.6&lt;/span&gt;)
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] 15 11 11 11 10&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The results here mean that in group 1, 15/20 (75%) people had success, in group 2, 11/20 (55%) people had success, and so on. Not every group will have exactly 60%, but they&amp;rsquo;re all kind of clustered around that.&lt;/p&gt;
&lt;p&gt;HOWEVER, I don&amp;rsquo;t like using &lt;code&gt;rbinom()&lt;/code&gt; like this, since this is all group-based, and when you&amp;rsquo;re generating fake people you generally want to use individuals, or groups of 1. So instead, I assume that &lt;code&gt;size = 1&lt;/code&gt;, which means that each &amp;ldquo;group&amp;rdquo; is only one person large. This forces the generated numbers to either be 0 or 1:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)

&lt;span style=&#34;color:#a6e22e&#34;&gt;rbinom&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;, size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, prob &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.6&lt;/span&gt;)
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] 1 0 0 0 0&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Here, only 1 of the 5 people were 1/TRUE/yes, which is hardly close to a 60% chance overall, but that&amp;rsquo;s because we only generated 5 numbers. If we generate lots, we can see the probability of yes emerge:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;12345&lt;/span&gt;)

plot_data &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tibble&lt;/span&gt;(thing &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rbinom&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;2000&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, prob &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.6&lt;/span&gt;)) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Make this a factor since it&amp;#39;s basically a yes/no categorical variable&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(thing &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;factor&lt;/span&gt;(thing))

plot_data &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;count&lt;/span&gt;(thing) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(proportion &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; n &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sum&lt;/span&gt;(n))
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 2 x 3&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   thing     n proportion&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;fct&amp;gt; &amp;lt;int&amp;gt;      &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 0       840      0.42 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 1      1160      0.580&lt;/span&gt;

&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(plot_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; thing)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_bar&lt;/span&gt;()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/random-numbers_files/figure-html/plot-binomial-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;58% of the 2,000 fake people here were 1/TRUE/yes, which is close to the goal of 60%. Perfect.&lt;/p&gt;
&lt;h3 id=&#34;poisson-distribution&#34;&gt;Poisson distribution&lt;/h3&gt;
&lt;p&gt;One last common distribution that you might find helpful when simulating data is the &lt;a href=&#34;https://en.wikipedia.org/wiki/Poisson_binomial_distribution&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Poisson distribution&lt;/a&gt; (in French, &lt;a href=&#34;https://www.youtube.com/watch?v=UoJxBEQRLd0&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&amp;ldquo;poisson&amp;rdquo; = fish&lt;/a&gt;, but here it&amp;rsquo;s not actually named after the animal, but after &lt;a href=&#34;https://en.wikipedia.org/wiki/Sim%C3%A9on_Denis_Poisson&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;French mathematician Siméon Denis Poisson&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;A Poisson distribution is special because it generates whole numbers (i.e. nothing like 1.432) that follow a skewed pattern (i.e. more smaller values than larger values). There&amp;rsquo;s all sorts of fancy math behind it that you don&amp;rsquo;t need to worry about so much—all you need to know is that it&amp;rsquo;s good at modeling things called &lt;a href=&#34;https://en.wikipedia.org/wiki/Poisson_point_process&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Poisson processes&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;For instance, let&amp;rsquo;s say you&amp;rsquo;re sitting at the front door of a coffee shop (in pre-COVID days) and you count how many people are in each arriving group. You&amp;rsquo;ll see something like this:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1 person&lt;/li&gt;
&lt;li&gt;1 person&lt;/li&gt;
&lt;li&gt;2 people&lt;/li&gt;
&lt;li&gt;1 person&lt;/li&gt;
&lt;li&gt;3 people&lt;/li&gt;
&lt;li&gt;2 people&lt;/li&gt;
&lt;li&gt;1 person&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Lots of groups of one, some groups of two, fewer groups of three, and so on. &lt;em&gt;That&amp;rsquo;s&lt;/em&gt; a Poisson process: a bunch of independent random events that combine into grouped events.&lt;/p&gt;
&lt;p&gt;That sounds weird and esoteric (and it is!), but it reflects lots of real world phenomena, and things you&amp;rsquo;ll potentially want to measure in a program. For instance, the number of kids a family has follows a type of Poisson process. Lots of families have 1, some have 2, fewer have 3, even fewer have 4, and so on. The number of cars in traffic, the number of phone calls received by an office, arrival times in a line, and even the outbreak of wars are all examples of Poisson processes.&lt;/p&gt;
&lt;p&gt;You can generate numbers from a Poisson distribution with the &lt;code&gt;rpois()&lt;/code&gt; function in R. This distribution only takes a single parameter:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;lambda&lt;/code&gt; ($\lambda$)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The &lt;code&gt;\(\lambda\)&lt;/code&gt; value controls the rate or speed that a Poisson process increases (i.e. jumps from 1 to 2, from 2 to 3, from 3 to 4, etc.). &lt;em&gt;I have absolutely zero mathematical intuition for how it works.&lt;/em&gt; The two shape parameters for a Beta distribution at least fit in a fraction and you can wrap your head around that, but the lambda in a Poisson distribution is just a mystery to me. So whenever I use a Poisson distribution for something, I just play with the lambda until the data looks reasonable.&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s assume that the number of kids a family has follows a Poisson process. Here&amp;rsquo;s how we can use &lt;code&gt;rpois()&lt;/code&gt; to generate that data:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;123&lt;/span&gt;)

&lt;span style=&#34;color:#75715e&#34;&gt;# 10 different families&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;rpois&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;, lambda &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
&lt;span style=&#34;color:#75715e&#34;&gt;##  [1] 0 2 1 2 3 0 1 2 1 1&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Cool. Most families have 0–1 kids; some have 2; one has 3.&lt;/p&gt;
&lt;p&gt;It&amp;rsquo;s easier to see these patterns with a plot:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)

plot_data &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tibble&lt;/span&gt;(num_kids &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rpois&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;500&lt;/span&gt;, lambda &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;))
&lt;span style=&#34;color:#a6e22e&#34;&gt;head&lt;/span&gt;(plot_data)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 6 x 1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   num_kids&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##      &amp;lt;int&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1        0&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2        1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3        1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4        1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5        2&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6        1&lt;/span&gt;

plot_data &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;group_by&lt;/span&gt;(num_kids) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;summarize&lt;/span&gt;(count &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;n&lt;/span&gt;()) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(proportion &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; count &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sum&lt;/span&gt;(count))
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 6 x 3&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   num_kids count proportion&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##      &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;      &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1        0   180      0.36 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2        1   187      0.374&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3        2    87      0.174&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4        3    32      0.064&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5        4    11      0.022&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6        5     3      0.006&lt;/span&gt;

&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(plot_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; num_kids)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_bar&lt;/span&gt;()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/random-numbers_files/figure-html/plot-poisson-lambda1-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Here 75ish% of families have 0–1 kids (36% + 37.4%), 17% have 2 kids, 6% have 3, 2% have 4, and only 0.6% have 5.&lt;/p&gt;
&lt;p&gt;We can play with the &lt;code&gt;\(\lambda\)&lt;/code&gt; to increase the rate of kids per family:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)

plot_data &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tibble&lt;/span&gt;(num_kids &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rpois&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;500&lt;/span&gt;, lambda &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;))
&lt;span style=&#34;color:#a6e22e&#34;&gt;head&lt;/span&gt;(plot_data)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 6 x 1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   num_kids&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##      &amp;lt;int&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1        0&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2        2&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3        2&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4        2&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5        4&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6        2&lt;/span&gt;

plot_data &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;group_by&lt;/span&gt;(num_kids) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;summarize&lt;/span&gt;(count &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;n&lt;/span&gt;()) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(proportion &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; count &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sum&lt;/span&gt;(count))
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 8 x 3&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   num_kids count proportion&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##      &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;      &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1        0    62      0.124&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2        1   135      0.27 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3        2   145      0.290&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4        3    88      0.176&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5        4    38      0.076&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6        5    19      0.038&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 7        6    10      0.02 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 8        7     3      0.006&lt;/span&gt;

&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(plot_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; num_kids)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_bar&lt;/span&gt;()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/random-numbers_files/figure-html/plot-poisson-lambda3-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Now most families have 1–2 kids. Cool.&lt;/p&gt;
&lt;h2 id=&#34;rescaling-numbers&#34;&gt;Rescaling numbers&lt;/h2&gt;
&lt;p&gt;All these different distributions are good at generating general shapes:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Uniform: a bunch of random numbers with no central gravity&lt;/li&gt;
&lt;li&gt;Normal: an average ± some variation&lt;/li&gt;
&lt;li&gt;Beta: different shapes and skews and gravities between 0 and 1&lt;/li&gt;
&lt;li&gt;Binomial: yes/no outcomes that follow some probability&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The shapes are great, but you also care about the values of these numbers. This can be tricky. As we saw earlier with a normal distribution, sometimes you&amp;rsquo;ll get values that go below zero or above some value you care about. We fixed that with a truncated normal distribution, but not all distributions have truncated versions. Additionally, if you&amp;rsquo;re using a Beta distribution, you&amp;rsquo;re stuck in a 0–1 scale (or 0–10 or 0–100 if you multiply the value by 10 or 100 or whatever).&lt;/p&gt;
&lt;p&gt;What if you want a fun skewed Beta shape for a variable like income or some other value that doesn&amp;rsquo;t fit within a 0–1 range? You can rescale any set of numbers after-the-fact using the &lt;code&gt;rescale()&lt;/code&gt; function from the &lt;strong&gt;scales&lt;/strong&gt; library and rescale things to whatever range you want.&lt;/p&gt;
&lt;p&gt;For instance, let&amp;rsquo;s say that income isn&amp;rsquo;t normally distributed, but is right-skewed with a handful of rich people. This might look like a Beta distribution with &lt;code&gt;shape1 = 2&lt;/code&gt; and &lt;code&gt;shape2 = 5&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_function&lt;/span&gt;(fun &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; dbeta, args &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(shape1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, shape2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/random-numbers_files/figure-html/beta-2-5-income-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;If we generate random numbers from this distribution, they&amp;rsquo;ll all be stuck between 0 and 1:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)

fake_people &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tibble&lt;/span&gt;(income &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rbeta&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;, shape1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, shape2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;))

&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(fake_people, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; income)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_histogram&lt;/span&gt;(binwidth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.1&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;, boundary &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/random-numbers_files/figure-html/beta-income-not-scaled-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;We can take those underling 0–1 values and rescale them to some other range using the &lt;code&gt;rescale()&lt;/code&gt; function. We can specify the minimum and maximum values in the &lt;code&gt;to&lt;/code&gt; argument. Here we&amp;rsquo;ll scale it up so that 0 = &lt;span&gt;$10,000&lt;/span&gt; and 1 = &lt;span&gt;$100,000&lt;/span&gt;. Our rescaled version follows the same skewed Beta distribution shape, but now we&amp;rsquo;re using better values!&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(scales)

fake_people_scaled &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; fake_people &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(income_scaled &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rescale&lt;/span&gt;(income, to &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;10000&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;100000&lt;/span&gt;)))
&lt;span style=&#34;color:#a6e22e&#34;&gt;head&lt;/span&gt;(fake_people_scaled)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 6 x 2&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   income income_scaled&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##    &amp;lt;dbl&amp;gt;         &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 0.101         21154.&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 0.345         49014.&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 0.553         72757.&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4 0.0219        12176.&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5 0.380         53036.&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6 0.399         55162.&lt;/span&gt;

&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(fake_people_scaled, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; income_scaled)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_histogram&lt;/span&gt;(binwidth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5000&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;, boundary &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/random-numbers_files/figure-html/beta-income-scaled-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;This works for anything, really. For instance, instead of specifying a mean and standard deviation for a normal distribution and hoping that the generated values don&amp;rsquo;t go too high or too low, you can generate a normal distribution with a mean of 0 and standard deviation of 1 and then rescale it to the range you want:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)

fake_data &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tibble&lt;/span&gt;(age_not_scaled &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rnorm&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;, mean &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, sd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(age &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rescale&lt;/span&gt;(age_not_scaled, to &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;65&lt;/span&gt;)))
&lt;span style=&#34;color:#a6e22e&#34;&gt;head&lt;/span&gt;(fake_data)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 6 x 2&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   age_not_scaled   age&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##            &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1         -1.21   33.6&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2          0.277  44.2&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3          1.08   49.9&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4         -2.35   25.5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5          0.429  45.3&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6          0.506  45.8&lt;/span&gt;

plot_unscaled &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(fake_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; age_not_scaled)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_histogram&lt;/span&gt;(binwidth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;, boundary &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)

plot_scaled &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(fake_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; age)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_histogram&lt;/span&gt;(binwidth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;, boundary &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)

plot_unscaled &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; plot_scaled
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/random-numbers_files/figure-html/normal-scaled-up-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;This gives you less control over the center of the distribution (here it happens to be 40 because that&amp;rsquo;s in the middle of 18 and 65), but it gives you more control over the edges of the distribution.&lt;/p&gt;
&lt;p&gt;Rescaling things is really helpful when building in effects and interacting columns with other columns, since multiplying variables by different coefficients can make the values go way out of the normal range. You&amp;rsquo;ll see a lot more of that in the &lt;a href=&#34;/example/synthetic-data/&#34;&gt;synthetic data example&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&#34;summary&#34;&gt;Summary&lt;/h2&gt;
&lt;p&gt;Phew. We covered a lot here, and we barely scratched the surface of all the distributions that exist. Here&amp;rsquo;s a helpful summary of the main distributions you should care about:&lt;/p&gt;
&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt; Distribution &lt;/th&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt; Description &lt;/th&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt; Situations &lt;/th&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt; Parameters &lt;/th&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt; Code &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Uniform &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Numbers between a minimum and maximum; everything equally likely &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; ID numbers, age &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; &lt;code&gt;min&lt;/code&gt;, &lt;code&gt;max&lt;/code&gt; &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; &lt;code&gt;sample()&lt;/code&gt; or &lt;code&gt;runif()&lt;/code&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Normal &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Numbers bunched up around an average with a surrounding spread; numbers closer to average more likely &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Income, education, most types of numbers that have some sort of central tendency &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; &lt;code&gt;mean&lt;/code&gt;, &lt;code&gt;sd&lt;/code&gt; &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; &lt;code&gt;rnorm()&lt;/code&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Truncated normal &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Normal distribution + constraints on minimum and/or maximum values &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Anything with a normal distribution &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; &lt;code&gt;mean&lt;/code&gt;, &lt;code&gt;sd&lt;/code&gt;, &lt;code&gt;a&lt;/code&gt; (minimum), &lt;code&gt;b&lt;/code&gt; (maximum) &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; &lt;code&gt;truncnorm::rtruncnorm()&lt;/code&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Beta &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Numbers constrained between 0 and 1 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Anything with percents; anything on a 0–1(00) scale; anything, really, if you use &lt;code&gt;rescale()&lt;/code&gt; to rescale it &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; &lt;code&gt;shape1&lt;/code&gt; ($\alpha$), &lt;code&gt;shape2&lt;/code&gt; ($\beta$) ($\frac{\alpha}{\alpha + \beta}$) &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; &lt;code&gt;rbeta()&lt;/code&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Binomial &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Binary variables &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Treatment/control, yes/no, true/false, 0/1 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; &lt;code&gt;size&lt;/code&gt;, &lt;code&gt;prob&lt;/code&gt; &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; &lt;code&gt;sample(..., prob = 0.5)&lt;/code&gt; or &lt;code&gt;rbinom()&lt;/code&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Poisson &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Whole numbers that represent counts of things &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Number of kids, number of cities lived in, arrival times &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; &lt;code&gt;lambda&lt;/code&gt; &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; &lt;code&gt;rpois()&lt;/code&gt; &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;example&#34;&gt;Example&lt;/h2&gt;
&lt;p&gt;And here&amp;rsquo;s an example dataset of 1,000 fake people and different characteristics. One shortcoming of this fake data is that each of these columns is completely independent—there&amp;rsquo;s no relationship between age and education and family size and income. You can see how to make these columns correlated (and make one cause another!) in the &lt;a href=&#34;/example/synthetic-data&#34;&gt;example for synthetic data&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)

&lt;span style=&#34;color:#75715e&#34;&gt;# Set the number of people here once so it&amp;#39;s easier to change later&lt;/span&gt;
n_people &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;

example_fake_people &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tibble&lt;/span&gt;(
  id &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;n_people,
  opinion &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sample&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;, n_people, replace &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;),
  age &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;runif&lt;/span&gt;(n_people, min &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;, max &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;80&lt;/span&gt;),
  income &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rnorm&lt;/span&gt;(n_people, mean &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;50000&lt;/span&gt;, sd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10000&lt;/span&gt;),
  education &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rtruncnorm&lt;/span&gt;(n_people, mean &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;16&lt;/span&gt;, sd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;, a &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;, b &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;24&lt;/span&gt;),
  happiness &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rbeta&lt;/span&gt;(n_people, shape1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, shape2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;),
  treatment &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sample&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;), n_people, replace &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;, prob &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;0.3&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.7&lt;/span&gt;)),
  size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rbinom&lt;/span&gt;(n_people, size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, prob &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt;),
  family_size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rpois&lt;/span&gt;(n_people, lambda &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;# Add one so there are no 0s&lt;/span&gt;
) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Adjust some of these columns&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(opinion &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;recode&lt;/span&gt;(opinion, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;1&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Strongly disagree&amp;#34;&lt;/span&gt;,
                          &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;2&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Disagree&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;3&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Neutral&amp;#34;&lt;/span&gt;,
                          &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;4&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Agree&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;5&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Strongly agree&amp;#34;&lt;/span&gt;)) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;recode&lt;/span&gt;(size, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Small&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;1&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Large&amp;#34;&lt;/span&gt;)) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(happiness &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rescale&lt;/span&gt;(happiness, to &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;)))

&lt;span style=&#34;color:#a6e22e&#34;&gt;head&lt;/span&gt;(example_fake_people)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 6 x 9&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##      id opinion             age income education happiness treatment size  family_size&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;int&amp;gt; &amp;lt;chr&amp;gt;             &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt; &amp;lt;lgl&amp;gt;     &amp;lt;chr&amp;gt;       &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1     1 Agree              31.7 43900.      18.3      7.20 TRUE      Large           1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2     2 Disagree           52.9 34696.      17.1      4.73 TRUE      Large           2&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3     3 Strongly agree     45.3 43263.      17.1      7.32 FALSE     Large           4&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4     4 Agree              34.9 40558.      11.7      4.18 FALSE     Small           2&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5     5 Strongly disagree  50.3 41392.      13.3      2.61 TRUE      Small           2&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6     6 Strongly agree     63.6 69917.      11.2      4.36 FALSE     Small           2&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;plot_opinion &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(example_fake_people, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; opinion)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_bar&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;guides&lt;/span&gt;(fill &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;labs&lt;/span&gt;(title &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Opinion (uniform with sample())&amp;#34;&lt;/span&gt;)

plot_age &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(example_fake_people, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; age)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_histogram&lt;/span&gt;(binwidth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;, boundary &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;labs&lt;/span&gt;(title &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Age (uniform with runif())&amp;#34;&lt;/span&gt;)

plot_income &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(example_fake_people, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; income)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_histogram&lt;/span&gt;(binwidth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5000&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;, boundary &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;labs&lt;/span&gt;(title &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Income (normal)&amp;#34;&lt;/span&gt;)

plot_education &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(example_fake_people, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; education)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_histogram&lt;/span&gt;(binwidth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;, boundary &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;labs&lt;/span&gt;(title &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Education (truncated normal)&amp;#34;&lt;/span&gt;)

plot_happiness &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(example_fake_people, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; happiness)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_histogram&lt;/span&gt;(binwidth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;scale_x_continuous&lt;/span&gt;(breaks &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;labs&lt;/span&gt;(title &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Happiness (Beta, rescaled to 1-8)&amp;#34;&lt;/span&gt;)

plot_treatment &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(example_fake_people, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; treatment)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_bar&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;labs&lt;/span&gt;(title &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Treatment (binary with sample())&amp;#34;&lt;/span&gt;)

plot_size &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(example_fake_people, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; size)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_bar&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;labs&lt;/span&gt;(title &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Size (binary with rbinom())&amp;#34;&lt;/span&gt;)

plot_family &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(example_fake_people, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; family_size)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_bar&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;scale_x_continuous&lt;/span&gt;(breaks &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;labs&lt;/span&gt;(title &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Family size (Poisson)&amp;#34;&lt;/span&gt;)

(plot_opinion &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; plot_age) &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; (plot_income &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; plot_education)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/random-numbers_files/figure-html/example-plots-1-1.png&#34; width=&#34;100%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;(plot_happiness &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; plot_treatment) &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; (plot_size &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; plot_family)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/random-numbers_files/figure-html/example-plots-2-1.png&#34; width=&#34;100%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>The ultimate guide to generating synthetic data for causal inference</title>
      <link>/example/synthetic-data/</link>
      <pubDate>Sat, 31 Oct 2020 00:00:00 +0000</pubDate>
      <guid>/example/synthetic-data/</guid>
      <description>&lt;p&gt;In the &lt;a href=&#34;/example/random-numbers/&#34;&gt;example guide for generating random numbers&lt;/a&gt;, we explored how to use a bunch of different statistical distributions to create variables that had reasonable values. However, each of the columns that we generated there were completely independent of each other. In the final example, we made some data with columns like age, education, and income, but none of those were related, though in real life they would be.&lt;/p&gt;
&lt;p&gt;Generating random variables is fairly easy: choose some sort of distributional shape, set parameters like a mean and standard deviation, and let randomness take over. Forcing variables to be related is a little trickier and involves a little math. But don&amp;rsquo;t worry! That math is all just regression stuff!&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(tidyverse)
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(broom)
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(patchwork)
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(scales)
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(ggdag)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;basic-example&#34;&gt;Basic example&lt;/h2&gt;
&lt;h3 id=&#34;relationships-and-regression&#34;&gt;Relationships and regression&lt;/h3&gt;
&lt;p&gt;Let&amp;rsquo;s pretend we want to predict someone&amp;rsquo;s happiness on a 10-point scale based on the number of cookies they&amp;rsquo;ve eaten and whether or not their favorite color is blue.&lt;/p&gt;
&lt;p&gt;$$
\text{Happiness} = \beta_0 + \beta_1 \text{Cookies eaten} + \beta_2 \text{Favorite color is blue} + \varepsilon
$$&lt;/p&gt;
&lt;p&gt;We can generate a fake dataset with columns for happiness (Beta distribution clustered around 7ish), cookies (Poisson distribution), and favorite color (binomial distribution for blue/not blue):&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)

n_people &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;
happiness_simple &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tibble&lt;/span&gt;(
  id &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;n_people,
  happiness &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rbeta&lt;/span&gt;(n_people, shape1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;, shape2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;),
  cookies &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rpois&lt;/span&gt;(n_people, lambda &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;),
  color_blue &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sample&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Blue&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Not blue&amp;#34;&lt;/span&gt;), n_people, replace &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;)
) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Adjust some of the columns&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(happiness &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;round&lt;/span&gt;(happiness &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;),
         cookies &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; cookies &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,
         color_blue &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;fct_relevel&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;factor&lt;/span&gt;(color_blue), &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Not blue&amp;#34;&lt;/span&gt;))

&lt;span style=&#34;color:#a6e22e&#34;&gt;head&lt;/span&gt;(happiness_simple)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 6 x 4&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##      id happiness cookies color_blue&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt; &amp;lt;fct&amp;gt;     &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1     1       8.7       2 Blue      &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2     2       6.5       2 Not blue  &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3     3       4.8       2 Blue      &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4     4       9.6       3 Not blue  &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5     5       6.2       1 Not blue  &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6     6       6.1       2 Blue&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We have a neat dataset now, so let&amp;rsquo;s run a regression. Is eating more cookies or liking blue associated with greater happiness?&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_happiness1 &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(happiness &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; cookies &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; color_blue, data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; happiness_simple)
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_happiness1)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 3 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term           estimate std.error statistic p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;             &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)     7.06       0.105     67.0     0    &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 cookies        -0.00884    0.0419    -0.211   0.833&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 color_blueBlue -0.0202     0.0861    -0.235   0.815&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Not really. The coefficients for both &lt;code&gt;cookies&lt;/code&gt; and &lt;code&gt;color_blueBlue&lt;/code&gt; are basically 0 and not statistically significant. That makes sense since the three columns are completely independent of each other. If there were any significant effects, that&amp;rsquo;d be strange and solely because of random chance.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;For the sake of your final project, you can just leave all the columns completely independent of each other if you want.&lt;/strong&gt; None of your results will be significant and you won&amp;rsquo;t see any effects anywhere, but you can still build models, run all the pre-model diagnostics, and create graphs and tables based on this data.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;strong&gt;HOWEVER&lt;/strong&gt;&lt;/em&gt;, it will be far more useful to you if you generate relationships. The whole goal of this class is to find causal effects in observational, non-experimental data. If you can generate synthetic non-experimental data and bake in a known causal effect, you can know if your different methods for recovering that effect are working.&lt;/p&gt;
&lt;p&gt;So how do we bake in correlations and causal effects?&lt;/p&gt;
&lt;h3 id=&#34;explanatory-variables-linked-to-outcome-no-connection-between-explanatory-variables&#34;&gt;Explanatory variables linked to outcome; no connection between explanatory variables&lt;/h3&gt;
&lt;p&gt;To help with the intuition of how to link these columns, think about the model we&amp;rsquo;re building:&lt;/p&gt;
&lt;p&gt;$$
\text{Happiness} = \beta_0 + \beta_1 \text{Cookies eaten} + \beta_2 \text{Favorite color is blue} + \varepsilon
$$&lt;/p&gt;
&lt;p&gt;This model provides estimates for all those betas. Throughout the semester, we&amp;rsquo;ve used the analogy of sliders and switches to describe regression coefficients. Here we have both:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;\(\beta_0\)&lt;/code&gt;: The average baseline happiness.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;\(\beta_1\)&lt;/code&gt;: The additional change in happiness that comes from eating one cookie. This is a &lt;em&gt;slider&lt;/em&gt;: move cookies up by one and happiness changes by &lt;code&gt;\(\beta_1\)&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;\(\beta_2\)&lt;/code&gt;: The change in happiness that comes from having your favorite color be blue. This is a &lt;em&gt;switch&lt;/em&gt;: turn on &amp;ldquo;blue&amp;rdquo; for someone and their happiness changes by &lt;code&gt;\(\beta_2\)&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We can invent our own coefficients and use some math to build them into the dataset. Let&amp;rsquo;s use these numbers as our targets:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;\(\beta_0\)&lt;/code&gt;: Average happiness is 7&lt;/li&gt;
&lt;li&gt;&lt;code&gt;\(\beta_1\)&lt;/code&gt;: Eating one more cookie boosts happiness by 0.25 points&lt;/li&gt;
&lt;li&gt;&lt;code&gt;\(\beta_2\)&lt;/code&gt;: People who like blue have 0.75 higher happiness&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;When generating the data, we can&amp;rsquo;t just use &lt;code&gt;rbeta()&lt;/code&gt; by itself to generate happiness, since happiness depends on both cookies and favorite color (that&amp;rsquo;s why we call it a dependent variable). To build in this effect, we can add a new column that uses math and modifies the underlying &lt;code&gt;rbeta()&lt;/code&gt;-based happiness score:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;happiness_with_effect &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; happiness_simple &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Turn the categorical favorite color column into TRUE/FALSE so we can do math with it&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(color_blue_binary &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ifelse&lt;/span&gt;(color_blue &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Blue&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;)) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Make a new happiness column that uses coefficients for cookies and favorite color&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(happiness_modified &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; happiness &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;0.25&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; cookies) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;0.75&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; color_blue_binary))
&lt;span style=&#34;color:#a6e22e&#34;&gt;head&lt;/span&gt;(happiness_with_effect)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 6 x 6&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##      id happiness cookies color_blue color_blue_binary happiness_modified&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt; &amp;lt;fct&amp;gt;      &amp;lt;lgl&amp;gt;                          &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1     1       8.7       2 Blue       TRUE                            9.95&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2     2       6.5       2 Not blue   FALSE                           7   &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3     3       4.8       2 Blue       TRUE                            6.05&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4     4       9.6       3 Not blue   FALSE                          10.4 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5     5       6.2       1 Not blue   FALSE                           6.45&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6     6       6.1       2 Blue       TRUE                            7.35&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now that we have a new &lt;code&gt;happiness_modified&lt;/code&gt; column we can run a model using it as the outcome:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_happiness2 &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(happiness_modified &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; cookies &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; color_blue, data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; happiness_with_effect)
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_happiness2)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 3 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term           estimate std.error statistic  p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;             &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)       7.06     0.105      67.0  0.      &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 cookies           0.241    0.0419      5.76 1.13e- 8&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 color_blueBlue    0.730    0.0861      8.48 8.25e-17&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Whoa! Look at those coefficients! They&amp;rsquo;re exactly what we tried to build in! The baseline happiness (intercept) is ≈7, eating one cookie is associated with a ≈0.25 increase in happiness, and liking blue is associated with a ≈0.75 increase in happiness.&lt;/p&gt;
&lt;p&gt;However, we originally said that happiness was a 0-10 point scale. After boosting it with extra happiness for cookies and liking blue, there are some people who score higher than 10:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Original scale&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(happiness_with_effect, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; happiness)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_histogram&lt;/span&gt;(binwidth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;scale_x_continuous&lt;/span&gt;(breaks &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;coord_cartesian&lt;/span&gt;(xlim &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/synthetic-data_files/figure-html/happiness-dist-normal-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Scaled up&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(happiness_with_effect, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; happiness_modified)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_histogram&lt;/span&gt;(binwidth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;scale_x_continuous&lt;/span&gt;(breaks &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;coord_cartesian&lt;/span&gt;(xlim &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/synthetic-data_files/figure-html/happiness-dist-scaled-up-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;To fix that, we can use the &lt;code&gt;rescale()&lt;/code&gt; function from the &lt;strong&gt;scales&lt;/strong&gt; package to force the new &lt;code&gt;happiness_modified&lt;/code&gt; variable to fit back in its original range:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;happiness_with_effect &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; happiness_with_effect &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(happiness_rescaled &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rescale&lt;/span&gt;(happiness_modified, to &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;)))

&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(happiness_with_effect, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; happiness_rescaled)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_histogram&lt;/span&gt;(binwidth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;scale_x_continuous&lt;/span&gt;(breaks &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;coord_cartesian&lt;/span&gt;(xlim &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/synthetic-data_files/figure-html/happiness-scaled-down-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Everything is back in the 3–10 range now. However, the rescaling also rescaled our built-in effects. Look what happens if we use the &lt;code&gt;happiness_rescaled&lt;/code&gt; in the model:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_happiness3 &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(happiness_rescaled &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; cookies &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; color_blue, data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; happiness_with_effect)
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_happiness3)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 3 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term           estimate std.error statistic  p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;             &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)       6.34     0.0910     69.6  0.      &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 cookies           0.208    0.0362      5.76 1.13e- 8&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 color_blueBlue    0.631    0.0744      8.48 8.25e-17&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now the baseline happiness is 6.3, the cookies effect is 0.2, and the blue effect is 0.63. These effects shrunk because we shrunk the data back down to have a maximum of 10.&lt;/p&gt;
&lt;p&gt;There are probably fancy mathy ways to rescale data &lt;em&gt;and&lt;/em&gt; keep the coefficients the same size, but rather than figure that out (who even wants to do that?!), my strategy is just to play with numbers until the results look good. Instead of using a 0.25 cookie effect and 0.75 blue effect, I make those effects bigger so that the rescaled version is roughly what I really want. There&amp;rsquo;s no systematic way to do this—I ran this chunk below a bunch of times until the numbers worked.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)

n_people &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;
happiness_real_effect &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tibble&lt;/span&gt;(
  id &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;n_people,
  happiness_baseline &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rbeta&lt;/span&gt;(n_people, shape1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;, shape2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;),
  cookies &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rpois&lt;/span&gt;(n_people, lambda &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;),
  color_blue &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sample&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Blue&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Not blue&amp;#34;&lt;/span&gt;), n_people, replace &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;)
) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Adjust some of the columns&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(happiness_baseline &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;round&lt;/span&gt;(happiness_baseline &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;),
         cookies &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; cookies &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,
         color_blue &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;fct_relevel&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;factor&lt;/span&gt;(color_blue), &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Not blue&amp;#34;&lt;/span&gt;)) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Turn the categorical favorite color column into TRUE/FALSE so we can do math with it&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(color_blue_binary &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ifelse&lt;/span&gt;(color_blue &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Blue&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;)) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Make a new happiness column that uses coefficients for cookies and favorite color&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(happiness_effect &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; happiness_baseline &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
           (&lt;span style=&#34;color:#ae81ff&#34;&gt;0.31&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; cookies) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;# Cookie effect&lt;/span&gt;
           (&lt;span style=&#34;color:#ae81ff&#34;&gt;0.91&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; color_blue_binary)) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;# Blue effect&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Rescale to 3-10, since that&amp;#39;s what the original happiness column looked like&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(happiness &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rescale&lt;/span&gt;(happiness_effect, to &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;)))

model_does_this_work_yet &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(happiness &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; cookies &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; color_blue, data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; happiness_real_effect)
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_does_this_work_yet)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 3 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term           estimate std.error statistic  p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;             &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)       6.15     0.0886     69.4  0.      &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 cookies           0.253    0.0352      7.19 1.25e-12&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 color_blueBlue    0.749    0.0724     10.3  7.44e-24&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;There&amp;rsquo;s nothing magical about the 0.31 and 0.91 numbers I used here; I just kept changing those to different things until the regression coefficients ended up at ≈0.25 and ≈0.75. Also, I gave up on trying to make the baseline happiness 7. It&amp;rsquo;s possible to do—you&amp;rsquo;d just need to also shift the underlying Beta distribution up (like &lt;code&gt;shape1 = 9, shape2 = 2&lt;/code&gt; or something). But then you&amp;rsquo;d also need to change the coefficients more. You&amp;rsquo;ll end up with 3 moving parts and it can get complicated, so I don&amp;rsquo;t worry too much about it, since what we care about the most here is the effect of cookies and favorite color, not baseline levels of happiness.&lt;/p&gt;
&lt;p&gt;Phew. We successfully connected cookies and favorite color to happiness and we have effects that are measurable with regression! One last thing that I would do is get rid of some of the intermediate columns like &lt;code&gt;color_blue_binary&lt;/code&gt; or &lt;code&gt;happiness_effect&lt;/code&gt;—we only used those for the behind-the-scenes math of creating the effect. Here&amp;rsquo;s our final synthetic dataset:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;happiness &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; happiness_real_effect &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;select&lt;/span&gt;(id, happiness, cookies, color_blue)
&lt;span style=&#34;color:#a6e22e&#34;&gt;head&lt;/span&gt;(happiness)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 6 x 4&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##      id happiness cookies color_blue&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt; &amp;lt;fct&amp;gt;     &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1     1      8.81       2 Blue      &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2     2      6.20       2 Not blue  &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3     3      5.53       2 Blue      &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4     4      9.07       3 Not blue  &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5     5      5.68       1 Not blue  &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6     6      6.63       2 Blue&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We can save that as a CSV file with &lt;code&gt;write_csv()&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;write_csv&lt;/span&gt;(happiness, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;data/happiness_fake_data.csv&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;explanatory-variables-linked-to-outcome-connection-between-explanatory-variables&#34;&gt;Explanatory variables linked to outcome; connection between explanatory variables&lt;/h3&gt;
&lt;p&gt;In that cookie example, we assumed that both cookie consumption and favorite color are associated with happiness. We also assumed that cookie consumption and favorite color are &lt;em&gt;not&lt;/em&gt; related to each other. But what if they are? What if people who like blue eat more cookies?&lt;/p&gt;
&lt;p&gt;We&amp;rsquo;ve already used regression-based math to connect explanatory variables to outcome variables. We can use that same intuition to connect explanatory variables to each other.&lt;/p&gt;
&lt;p&gt;The easiest way to think about this is with DAGs. Here&amp;rsquo;s the DAG for the model we just ran:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;happiness_dag1 &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;dagify&lt;/span&gt;(hap &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; cook &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; blue,
                         coords &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(hap &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, cook &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, blue &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;),
                                       y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(hap &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, cook &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, blue &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;)))

&lt;span style=&#34;color:#a6e22e&#34;&gt;ggdag&lt;/span&gt;(happiness_dag1) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;theme_dag&lt;/span&gt;()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/synthetic-data_files/figure-html/happiness-dag-rct-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Both cookies and favorite color cause happiness, but there&amp;rsquo;s no link between them. Notice that &lt;code&gt;dagify()&lt;/code&gt; uses the same model syntax that &lt;code&gt;lm()&lt;/code&gt; does: &lt;code&gt;hap ~ cook + blue&lt;/code&gt;. If we think of this just like a regression model, we can pretend that there are coefficients there too: &lt;code&gt;hap ~ 0.25*cook + 0.75*blue&lt;/code&gt;. We don&amp;rsquo;t actually include any coefficients in the DAG or anything, but it helps with the intuition.&lt;/p&gt;
&lt;p&gt;But what if people who like blue eat more cookies on average? For whatever reason, let&amp;rsquo;s pretend that liking blue causes you to eat 0.5 more cookies, on average. Here&amp;rsquo;s the new DAG:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;happiness_dag2 &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;dagify&lt;/span&gt;(hap &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; cook &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; blue,
                         cook &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; blue,
                         coords &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(hap &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, cook &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, blue &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;),
                                       y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(hap &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, cook &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, blue &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;)))

&lt;span style=&#34;color:#a6e22e&#34;&gt;ggdag&lt;/span&gt;(happiness_dag2) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;theme_dag&lt;/span&gt;()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/synthetic-data_files/figure-html/happiness-dag-confounding-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Now we have two different equations: &lt;code&gt;hap ~ cook + blue&lt;/code&gt; and &lt;code&gt;cook ~ blue&lt;/code&gt;. Conveniently, these both translate to models, and we know the coefficients we want!&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;hap ~ 0.25*cook + 0.75*blue&lt;/code&gt;: This is what we built before—cookies boost happiness by 0.25 and liking blue boosts happiness by 0.75&lt;/li&gt;
&lt;li&gt;&lt;code&gt;cook ~ 0.3*blue&lt;/code&gt;: This is what we just proposed—liking blue boosts cookies by 0.5&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We can follow the same process we did when building the cookie and blue effects into happiness to also build a blue effect into cookies!&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)

n_people &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;
happiness_cookies_blue &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tibble&lt;/span&gt;(
  id &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;n_people,
  happiness_baseline &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rbeta&lt;/span&gt;(n_people, shape1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;, shape2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;),
  cookies &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rpois&lt;/span&gt;(n_people, lambda &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;),
  color_blue &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sample&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Blue&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Not blue&amp;#34;&lt;/span&gt;), n_people, replace &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;)
) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Adjust some of the columns&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(happiness_baseline &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;round&lt;/span&gt;(happiness_baseline &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;),
         cookies &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; cookies &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,
         color_blue &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;fct_relevel&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;factor&lt;/span&gt;(color_blue), &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Not blue&amp;#34;&lt;/span&gt;)) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Turn the categorical favorite color column into TRUE/FALSE so we can do math with it&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(color_blue_binary &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ifelse&lt;/span&gt;(color_blue &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Blue&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;)) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Make blue have an effect on cookie consumption&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(cookies &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; cookies &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; color_blue_binary)) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Make a new happiness column that uses coefficients for cookies and favorite color&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(happiness_effect &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; happiness_baseline &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
           (&lt;span style=&#34;color:#ae81ff&#34;&gt;0.31&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; cookies) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;# Cookie effect&lt;/span&gt;
           (&lt;span style=&#34;color:#ae81ff&#34;&gt;0.91&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; color_blue_binary)) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;# Blue effect&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Rescale to 3-10, since that&amp;#39;s what the original happiness column looked like&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(happiness &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rescale&lt;/span&gt;(happiness_effect, to &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;)))
&lt;span style=&#34;color:#a6e22e&#34;&gt;head&lt;/span&gt;(happiness_cookies_blue)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 6 x 7&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##      id happiness_baseline cookies color_blue color_blue_binary happiness_effect happiness&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;int&amp;gt;              &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt; &amp;lt;fct&amp;gt;      &amp;lt;lgl&amp;gt;                        &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1     1                8.7     2.5 Blue       TRUE                         10.4       8.84&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2     2                6.5     2   Not blue   FALSE                         7.12      6.14&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3     3                4.8     2.5 Blue       TRUE                          6.48      5.61&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4     4                9.6     3   Not blue   FALSE                        10.5       8.96&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5     5                6.2     1   Not blue   FALSE                         6.51      5.63&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6     6                6.1     2.5 Blue       TRUE                          7.78      6.69&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Notice now that people who like blue eat partial cookies, as expected. We can verify that there&amp;rsquo;s a relationship between liking blue and cookies by running a model:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(cookies &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; color_blue, data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; happiness_cookies_blue) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;()
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 2 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term           estimate std.error statistic   p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;             &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)       2.07     0.0451     45.9  3.51e-248&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 color_blueBlue    0.460    0.0651      7.07 2.96e- 12&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Yep. Liking blue is associated with 0.46 more cookies on average (it&amp;rsquo;s not quite 0.5, but that&amp;rsquo;s because of randomness).&lt;/p&gt;
&lt;p&gt;Now let&amp;rsquo;s do some neat DAG magic. Let&amp;rsquo;s say we&amp;rsquo;re interested in the causal effect of cookies on happiness. We could run a naive model:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_happiness_naive &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(happiness &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; cookies, data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; happiness_cookies_blue)
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_happiness_naive)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 2 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term        estimate std.error statistic  p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;          &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)    6.27     0.0894     70.1  0.      &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 cookies        0.325    0.0354      9.18 2.40e-19&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Based on this, eating a cookie causes you to have 0.325 more happiness points. But that&amp;rsquo;s wrong! Liking the color blue is a confounder and opens a path between cookies and happiness. You can see the confounding both in the DAG (since blue points to both the cookie node and the happiness node) and in the math (liking blue boosts happiness + liking blue boosts cookie consumption, which boosts happiness).&lt;/p&gt;
&lt;p&gt;To fix this confounding, we need to statistically adjust for liking blue and close the backdoor path. Ordinarily we&amp;rsquo;d do this with something like &lt;a href=&#34;/example/matching-ipw/&#34;&gt;matching or inverse probability weighting&lt;/a&gt;, but here we can just include liking blue as a control variable (since it&amp;rsquo;s linearly related to both cookies and happiness):&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_happiness_ate &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(happiness &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; cookies &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; color_blue, data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; happiness_cookies_blue)
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_happiness_ate)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 3 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term           estimate std.error statistic  p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;             &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)       6.09     0.0870     70.0  0.      &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 cookies           0.249    0.0346      7.19 1.25e-12&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 color_blueBlue    0.739    0.0729     10.1  4.70e-23&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;After adjusting for backdoor confounding, eating one additional cookie &lt;em&gt;causes&lt;/em&gt; a 0.249 point increase in happiness. This is the effect we originally built into the data!&lt;/p&gt;
&lt;p&gt;If you wanted, we could rescale the number of cookies just like we rescaled happiness before, since sometimes adding effects to columns changes their reasonable ranges.&lt;/p&gt;
&lt;p&gt;Now that we have a good working dataset, we can keep the columns we care about and save it as a CSV file for later use:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;happiness &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; happiness_cookies_blue &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;select&lt;/span&gt;(id, happiness, cookies, color_blue)
&lt;span style=&#34;color:#a6e22e&#34;&gt;head&lt;/span&gt;(happiness)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 6 x 4&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##      id happiness cookies color_blue&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt; &amp;lt;fct&amp;gt;     &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1     1      8.84     2.5 Blue      &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2     2      6.14     2   Not blue  &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3     3      5.61     2.5 Blue      &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4     4      8.96     3   Not blue  &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5     5      5.63     1   Not blue  &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6     6      6.69     2.5 Blue&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;write_csv&lt;/span&gt;(happiness, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;data/happiness_fake_data.csv&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;adding-extra-noise&#34;&gt;Adding extra noise&lt;/h3&gt;
&lt;p&gt;We&amp;rsquo;ve got columns that follow specific distributions, and we&amp;rsquo;ve got columns that are statistically related to each other. We can add one more wrinkle to make our fake data even more fun (and even more reflective of real life). We can add some noise.&lt;/p&gt;
&lt;p&gt;Right now, the effects we&amp;rsquo;re finding are &lt;em&gt;too&lt;/em&gt; perfect. When we used &lt;code&gt;mutate()&lt;/code&gt; to add a 0.25 boost in happiness for every cookie people ate, we added &lt;em&gt;exactly&lt;/em&gt; 0.25 happiness points. If someone ate 2 cookies, they got 0.5 more happiness; if they ate 5, they got 1.25 more.&lt;/p&gt;
&lt;p&gt;What if the cookie effect isn&amp;rsquo;t exactly 0.25, but somewhere &lt;em&gt;around&lt;/em&gt; 0.25? For some people it&amp;rsquo;s 0.1, for others it&amp;rsquo;s 0.3, for others it&amp;rsquo;s 0.22. We can use the same ideas we talked about in the &lt;a href=&#34;/example/random-numbers/&#34;&gt;random numbers example&lt;/a&gt; to generate a &lt;em&gt;distribution&lt;/em&gt; of an effect. For instance, let&amp;rsquo;s say that the average cookie effect is 0.25, but it can vary somewhat with a standard deviation of 0.15:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;temp_data &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tibble&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rnorm&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;10000&lt;/span&gt;, mean &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.25&lt;/span&gt;, sd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.15&lt;/span&gt;))

&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(temp_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; x)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_histogram&lt;/span&gt;(binwidth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.05&lt;/span&gt;, boundary &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/synthetic-data_files/figure-html/random-cookie-effect-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Sometimes it can go as low as −0.25; sometimes it can go as high as 0.75; normally it&amp;rsquo;s around 0.25.&lt;/p&gt;
&lt;p&gt;Nothing in the model explains why it&amp;rsquo;s higher or lower for some people—it&amp;rsquo;s just random noise. Remember that the model accounts for that! This random variation is what the &lt;code&gt;\(\varepsilon\)&lt;/code&gt; is for in this model equation:&lt;/p&gt;
&lt;p&gt;$$
\text{Happiness} = \beta_0 + \beta_1 \text{Cookies eaten} + \beta_2 \text{Favorite color is blue} + \varepsilon
$$&lt;/p&gt;
&lt;p&gt;We can build that uncertainty into the fake column! Instead of using &lt;code&gt;0.31 * cookies&lt;/code&gt; when generating &lt;code&gt;happiness&lt;/code&gt; (which is technically 0.25, but shifted up to account for rescaling happiness back down after), we&amp;rsquo;ll make a column for the cookie effect and then multiply &lt;em&gt;that&lt;/em&gt; by the number of cookies.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)

n_people &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;
happiness_cookies_noisier &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tibble&lt;/span&gt;(
  id &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;n_people,
  happiness_baseline &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rbeta&lt;/span&gt;(n_people, shape1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;, shape2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;),
  cookies &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rpois&lt;/span&gt;(n_people, lambda &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;),
  cookie_effect &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rnorm&lt;/span&gt;(n_people, mean &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.31&lt;/span&gt;, sd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.2&lt;/span&gt;),
  color_blue &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sample&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Blue&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Not blue&amp;#34;&lt;/span&gt;), n_people, replace &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;)
) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Adjust some of the columns&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(happiness_baseline &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;round&lt;/span&gt;(happiness_baseline &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;),
         cookies &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; cookies &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,
         color_blue &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;fct_relevel&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;factor&lt;/span&gt;(color_blue), &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Not blue&amp;#34;&lt;/span&gt;)) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Turn the categorical favorite color column into TRUE/FALSE so we can do math with it&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(color_blue_binary &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ifelse&lt;/span&gt;(color_blue &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Blue&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;)) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Make blue have an effect on cookie consumption&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(cookies &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; cookies &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; color_blue_binary)) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Make a new happiness column that uses coefficients for cookies and favorite&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# color. Importantly, instead of using 0.31 * cookies, we&amp;#39;ll use the random&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# cookie effect we generated earlier&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(happiness_effect &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; happiness_baseline &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
           (cookie_effect &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; cookies) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
           (&lt;span style=&#34;color:#ae81ff&#34;&gt;0.91&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; color_blue_binary)) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Rescale to 3-10, since that&amp;#39;s what the original happiness column looked like&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(happiness &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rescale&lt;/span&gt;(happiness_effect, to &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;)))
&lt;span style=&#34;color:#a6e22e&#34;&gt;head&lt;/span&gt;(happiness_cookies_noisier)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 6 x 8&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##      id happiness_baseline cookies cookie_effect color_blue color_blue_binary happiness_effect happiness&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;int&amp;gt;              &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;         &amp;lt;dbl&amp;gt; &amp;lt;fct&amp;gt;      &amp;lt;lgl&amp;gt;                        &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1     1                8.7     2.5        0.124  Blue       TRUE                          9.92      8.16&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2     2                6.5     2.5        0.370  Blue       TRUE                          8.34      7.02&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3     3                4.8     2.5        0.326  Blue       TRUE                          6.53      5.72&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4     4                9.6     3.5        0.559  Blue       TRUE                         12.5       9.98&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5     5                6.2     1.5        0.0631 Blue       TRUE                          7.20      6.21&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6     6                6.1     2          0.222  Not blue   FALSE                         6.54      5.73&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now let&amp;rsquo;s look at the cookie effect in this noisier data:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_noisier &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(happiness &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; cookies &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; color_blue, data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; happiness_cookies_noisier)
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_noisier)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 3 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term           estimate std.error statistic  p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;             &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)       6.11     0.0779     78.4  0.      &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 cookies           0.213    0.0314      6.79 1.92e-11&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 color_blueBlue    0.650    0.0671      9.68 3.01e-21&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The effect is a little smaller now because of the extra noise, so we&amp;rsquo;d need to mess with the 0.31 and 0.91 coefficients more to get those numbers back up to 0.25 and 0.75.&lt;/p&gt;
&lt;p&gt;While this didn&amp;rsquo;t influence the findings too much here, it can have consequences for other variables. For instance, in the previous section we said that the color blue influences cookie consumption. If the blue effect on cookies isn&amp;rsquo;t precisely 0.5 but follows some sort of distribution (sometimes small, sometimes big, sometimes negative, sometimes zero), that will influence cookies differently. That random effect on cookie consumption will then work together with the random effect of cookies on happiness, resulting in multiple varied values.&lt;/p&gt;
&lt;p&gt;For instance, imagine the average effect of liking blue on cookies is 0.5, and the average effect of cookies on happiness is 0.25. For one person, their blue-on-cookie effect might be 0.392, which changes the number of cookies they eat. Their cookie-on-happiness effect is 0.573, which changes their happiness. Both of those random effects work together to generate the final happiness.&lt;/p&gt;
&lt;p&gt;If you want more realistic-looking synthetic data, it&amp;rsquo;s a good idea to add some random noise wherever you can.&lt;/p&gt;
&lt;h2 id=&#34;visualizing-variables-and-relationships&#34;&gt;Visualizing variables and relationships&lt;/h2&gt;
&lt;p&gt;Going through this process requires &lt;em&gt;a ton&lt;/em&gt; of trial and error. You will change all sorts of numbers to make sure the relationships you&amp;rsquo;re building work. This is especially the case if you rescale things, since that rescales your effects. There are a lot of moving parts and this is a complicated process.&lt;/p&gt;
&lt;p&gt;You&amp;rsquo;ll run your data generation chunks lots and lots and lots of times, tinkering with the numbers as you go. This example makes it look easy, since it&amp;rsquo;s the final product, but I ran all these chunks over and over again until I got the causal effect and relationships just right.&lt;/p&gt;
&lt;p&gt;It&amp;rsquo;s best if you also create plots and models to see what the relationships look like&lt;/p&gt;
&lt;h3 id=&#34;visualizing-one-variable&#34;&gt;Visualizing one variable&lt;/h3&gt;
&lt;p&gt;We covered a bunch of distributions in the &lt;a href=&#34;/example/random-numbers/&#34;&gt;random number generation&lt;/a&gt; example, but it&amp;rsquo;s hard to think about what a standard deviation of 2 vs 10 looks like, or what happens when you mess with the shape parameters in a Beta distribution.&lt;/p&gt;
&lt;p&gt;It&amp;rsquo;s best to visualize these variables. You could build the variable into your official dataset and then look at it, but I find it&amp;rsquo;s often faster to just look at what a general distribution looks like first. The easiest way to do this is generate a dataset with just one column in it and look at it, either with a histogram or a density plot.&lt;/p&gt;
&lt;p&gt;For instance, what does a Beta distribution with &lt;code&gt;shape1 = 3&lt;/code&gt; and &lt;code&gt;shape2 = 16&lt;/code&gt; look like? The math says it should peak around 0.15ish ($\frac{3}{3 + 16}$), and that looks like the case:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;temp_data &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tibble&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rbeta&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;10000&lt;/span&gt;, shape1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, shape2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;16&lt;/span&gt;))

plot1 &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(temp_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; x)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_histogram&lt;/span&gt;(binwidth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.05&lt;/span&gt;, boundary &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;)

plot2 &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(temp_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; x)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_density&lt;/span&gt;()

plot1 &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; plot2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/synthetic-data_files/figure-html/vis-beta-example-1.png&#34; width=&#34;65%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;What if we want a normal distribution centered around 100, with most values range from 50 to 150. That&amp;rsquo;s range of ±50, but that doesn&amp;rsquo;t mean the &lt;code&gt;sd&lt;/code&gt; will be 50—it&amp;rsquo;ll be much smaller than that, like 25ish. Tinker with the numbers until it looks right.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;temp_data &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tibble&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rnorm&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;10000&lt;/span&gt;, mean &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;100&lt;/span&gt;, sd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;25&lt;/span&gt;))

plot1 &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(temp_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; x)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_histogram&lt;/span&gt;(binwidth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;, boundary &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;)

plot2 &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(temp_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; x)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_density&lt;/span&gt;()

plot1 &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; plot2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/synthetic-data_files/figure-html/vis-normal-example-1.png&#34; width=&#34;65%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;h3 id=&#34;visualizing-two-continuous-variables&#34;&gt;Visualizing two continuous variables&lt;/h3&gt;
&lt;p&gt;If you have two continuous/numeric columns, it&amp;rsquo;s best to use a scatterplot. For instance, let&amp;rsquo;s make two columns based on the Beta and normal distributions above, and we&amp;rsquo;ll make it so that y goes up by 0.25 for every increase in x, along with some noise:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)

temp_data &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tibble&lt;/span&gt;(
  x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rnorm&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;, mean &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;100&lt;/span&gt;, sd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;25&lt;/span&gt;)
) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rbeta&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;, shape1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, shape2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;16&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;# Baseline distribution&lt;/span&gt;
           (&lt;span style=&#34;color:#ae81ff&#34;&gt;0.25&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; x) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;# Effect of x&lt;/span&gt;
           &lt;span style=&#34;color:#a6e22e&#34;&gt;rnorm&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;, mean &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, sd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;))  &lt;span style=&#34;color:#75715e&#34;&gt;# Add some noise&lt;/span&gt;

&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(temp_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; x, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; y)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_point&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_smooth&lt;/span&gt;(method &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lm&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/synthetic-data_files/figure-html/vis-two-continuous-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;We can confirm the effect with a model:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(y &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; x, data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; temp_data) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;()
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 2 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term        estimate std.error statistic  p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;          &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)    1.98     1.28        1.54 1.24e- 1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 x              0.235    0.0125     18.8  1.49e-67&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;visualizing-a-binary-variable-and-a-continuous-variable&#34;&gt;Visualizing a binary variable and a continuous variable&lt;/h3&gt;
&lt;p&gt;If you have one binary column and one continuous/numeric column, it&amp;rsquo;s generally best to &lt;em&gt;not&lt;/em&gt; use a scatterplot. Instead, either look at the distribution of the continuous variable across the binary variable with a faceted histogram or overlaid density plot, or look at the average of the continuous variable across the different values of the binary variable with a point range.&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s make two columns: a continuous outcome (y) and a binary treatment (x). Being in the treatment group causes an increase of 20 points, on average.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)

temp_data &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tibble&lt;/span&gt;(
  treatment &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rbinom&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;, size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, prob &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt;)  &lt;span style=&#34;color:#75715e&#34;&gt;# Make 1000 0/1 values with 50% chance of each&lt;/span&gt;
) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(outcome &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rbeta&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;, shape1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, shape2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;16&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;# Baseline distribution&lt;/span&gt;
           (&lt;span style=&#34;color:#ae81ff&#34;&gt;20&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; treatment) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;# Effect of treatment&lt;/span&gt;
           &lt;span style=&#34;color:#a6e22e&#34;&gt;rnorm&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;, mean &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, sd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;20&lt;/span&gt;)) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;   &lt;span style=&#34;color:#75715e&#34;&gt;# Add some noise&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(treatment &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;factor&lt;/span&gt;(treatment))  &lt;span style=&#34;color:#75715e&#34;&gt;# Make treatment a factor/categorical variable&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We can check the numbers with a model:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(outcome &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; treatment, data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; temp_data) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;()
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 2 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term        estimate std.error statistic  p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;          &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)    0.244     0.935     0.261 7.94e- 1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 treatment1    20.9       1.30     16.1   4.70e-52&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Here&amp;rsquo;s what that looks like as a histogram:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(temp_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; outcome, fill &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; treatment)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_histogram&lt;/span&gt;(binwidth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;, boundary &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;guides&lt;/span&gt;(fill &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;# Turn off the fill legend since it&amp;#39;s redundant&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;facet_wrap&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;vars&lt;/span&gt;(treatment), ncol &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/synthetic-data_files/figure-html/vis-histogram-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;And as overlapping densities:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(temp_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; outcome, fill &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; treatment)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_density&lt;/span&gt;(alpha &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/synthetic-data_files/figure-html/vis-density-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;And with a point range:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# hahaha these error bars are tiny&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(temp_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; treatment, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; outcome, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; treatment)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;stat_summary&lt;/span&gt;(geom &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;pointrange&amp;#34;&lt;/span&gt;, fun.data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;mean_se&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;guides&lt;/span&gt;(color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;)  &lt;span style=&#34;color:#75715e&#34;&gt;# Turn off the color legend since it&amp;#39;s redundant&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/synthetic-data_files/figure-html/vis-pointrange-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;h2 id=&#34;specific-examples&#34;&gt;Specific examples&lt;/h2&gt;
&lt;h3 id=&#34;tldr-the-general-process&#34;&gt;tl;dr: The general process&lt;/h3&gt;
&lt;p&gt;Those previous sections go into a lot of detail. In general, here&amp;rsquo;s the process you should follow when building relationships in synthetic data:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Draw a DAG that maps out how all the columns you care about are related.&lt;/li&gt;
&lt;li&gt;Specify how those nodes are measured.&lt;/li&gt;
&lt;li&gt;Specify the relationships between the nodes based on the DAG equations.&lt;/li&gt;
&lt;li&gt;Generate random columns that stand alone. Generate related columns using regression math. Consider adding random noise. This is an entirely trial and error process until you get numbers that look good. Rely &lt;em&gt;heavily&lt;/em&gt; on plots as you try different coefficients and parameters. Optionally rescale any columns that go out of reasonable bounds. If you rescale, you&amp;rsquo;ll need to tinker with the coefficients you used since the final effects will also get rescaled.&lt;/li&gt;
&lt;li&gt;Verify all relationships with plots and models.&lt;/li&gt;
&lt;li&gt;Try it out!&lt;/li&gt;
&lt;li&gt;Save the data.&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;creating-an-effect-in-an-observational-dag&#34;&gt;Creating an effect in an observational DAG&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Draw a DAG that maps out how all the columns you care about are related.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Here&amp;rsquo;s a simple DAG that shows the causal effect of mosquito net usage on malaria risk. Income and health both influence and confound net use and malaria risk, and income also influences health.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;mosquito_dag &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;dagify&lt;/span&gt;(mal &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; net &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; inc &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; hlth,
                       net &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; inc &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; hlth,
                       hlth &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; inc,
                       coords &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(mal &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;, net &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, inc &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, hlth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;),
                                     y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(mal &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, net &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, inc &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, hlth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;)))
&lt;span style=&#34;color:#a6e22e&#34;&gt;ggdag&lt;/span&gt;(mosquito_dag) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;theme_dag&lt;/span&gt;()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/synthetic-data_files/figure-html/observational-dag-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Specify how those nodes are measured.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;For the sake of this example, we&amp;rsquo;ll measure these nodes like so. See &lt;a href=&#34;/example/random-numbers&#34;&gt;the random number example&lt;/a&gt; for more details about the distributions.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Malaria risk&lt;/strong&gt;: scale from 0–100, mostly around 40, but ranging from 10ish to 80ish. Best to use a Beta distribution.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Net use&lt;/strong&gt;: binary 0/1, TRUE/FALSE variable, where 50% of people use nets. Best to use a binomial distribution. However, since we want to use other variables that increase the likelihood of using a net, we&amp;rsquo;ll do some cool tricky stuff, explained later.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Income&lt;/strong&gt;: weekly income, measured in dollars, mostly around 500 ± 300. Best to use a normal distribution.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Health&lt;/strong&gt;: scale from 0–100, mostly around 70, but ranging from 50ish to 100. Best to use a Beta distribution.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Specify the relationships between the nodes based on the DAG equations.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;There are three models in this DAG:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;hlth ~ inc&lt;/code&gt;&lt;/strong&gt;: Income influences health. We&amp;rsquo;ll assume that every 10 dollars/week is associated with a 1 point increase in health (so a 1 dollar incrrease is associated with a 0.02 point increase in health)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;net ~ inc + hlth&lt;/code&gt;&lt;/strong&gt;: Income and health both increase the probability of net usage. This is where we do some cool tricky stuff.&lt;/p&gt;
&lt;p&gt;Both income and health have an effect on the probability of bed net use, but bed net use is measured as a 0/1, TRUE/FALSE variable. If we run a regression with &lt;code&gt;net&lt;/code&gt; as the outcome, we can&amp;rsquo;t really interpret the coefficients like &amp;ldquo;a 1 point increase in health is associated with a 0.42 point increase in bed net being TRUE.&amp;rdquo; That doesn&amp;rsquo;t even make sense.&lt;/p&gt;
&lt;p&gt;Ordinarily, when working with binary outcome variables, you use logistic regression models (see &lt;a href=&#34;/example/matching-ipw/#oversimplified-crash-course-in-logistic-regression&#34;&gt;the crash course we had when talking about propensity scores here&lt;/a&gt;). In this kind of regression, the coefficients in the model represent changes in the &lt;em&gt;log odds&lt;/em&gt; of using a net. As we discuss in &lt;a href=&#34;/example/matching-ipw/#oversimplified-crash-course-in-logistic-regression&#34;&gt;the crash course section&lt;/a&gt;, log odds are typically impossible to interpet. If you exponentiate them, you get odds ratios, which let you say things like &amp;ldquo;a 1 point increase in health is associated with a 15% increase in the likelihood of using a net.&amp;rdquo; Technically we could include coefficients for a logistic regression model and simulate probabilities of using a net or not using log odds and odds ratios (and that&amp;rsquo;s what I do in the rain barrel data from Problem Set 3 (&lt;a href=&#34;https://github.com/andrewheiss/evalf20.classes.andrewheiss.com/blob/master/content/assignment/03-problem-set.Rmd#L225&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;see code here&lt;/a&gt;)), but that&amp;rsquo;s really hard to wrap your head around since you&amp;rsquo;re dealing with strange uninterpretable coefficients. So we won&amp;rsquo;t do that here.&lt;/p&gt;
&lt;p&gt;Instead, we&amp;rsquo;ll do some fun trickery. We&amp;rsquo;ll create something called a &amp;ldquo;bed net score&amp;rdquo; that gets bigger as income and health increase. We&amp;rsquo;ll say that a 1 point increase in health score is associated with a 1.5 point increase in bed net score, and a 1 dollar increase in income is associated with a 0.5 point increase in bed net score. This results in a column that ranges all over the place, from 200 to 500 (in this case; that won&amp;rsquo;t always be true). This column definitely doesn&amp;rsquo;t look like a TRUE/FALSE binary column—it&amp;rsquo;s just a bunch of numbers. That&amp;rsquo;s okay!&lt;/p&gt;
&lt;p&gt;We&amp;rsquo;ll then use the &lt;code&gt;rescale()&lt;/code&gt; function from the &lt;strong&gt;scales&lt;/strong&gt; package to take this bed net score and scale it down so that it goes from 0.05 to 0.95. This represents a person&amp;rsquo;s probability of using a bed net.&lt;/p&gt;
&lt;p&gt;Finally, we&amp;rsquo;ll use that probability in the &lt;code&gt;rbinom()&lt;/code&gt; function to generate a 0 or 1 for each person. Some people will have a high probability because of their income and health, like 0.9, and will most likely use a net. Some people might have a 0.15 probability and will likely not use a net.&lt;/p&gt;
&lt;p&gt;When you generate binary variables like this, it&amp;rsquo;s hard to know the exact effect you&amp;rsquo;ll get, so it&amp;rsquo;s best to tinker with the numbers until you see relationships that you want.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;mal ~ net + inc + hlth&lt;/code&gt;&lt;/strong&gt;: Finally net use, income, and health all have an effect on the risk of malaria. Building this relationship is easy since it&amp;rsquo;s just a regular linear regression model (since malaria risk is not binary). We&amp;rsquo;ll say that a 1 dollar increase in income is associated with a &lt;em&gt;decrease&lt;/em&gt; in risk, a 1 point increase in health is associated with a &lt;em&gt;decrease&lt;/em&gt; in risk, and using a net is associated with a 15 point &lt;em&gt;decrease&lt;/em&gt; in risk. That&amp;rsquo;s the casual effect we&amp;rsquo;re building in to the DAG.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Generate random columns that stand alone. Generate related columns using regression math. Consider adding random noise. This is an entirely trial and error process until you get numbers that look good. Rely &lt;em&gt;heavily&lt;/em&gt; on plots as you try different coefficients and parameters. Optionally rescale any columns that go out of reasonable bounds. If you rescale, you&amp;rsquo;ll need to tinker with the coefficients you used since the final effects will also get rescaled.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Here we go! Let&amp;rsquo;s make some data. I&amp;rsquo;ll comment the code below so you can see what&amp;rsquo;s happening at each step.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Make this randomness consistent&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)
   
&lt;span style=&#34;color:#75715e&#34;&gt;# Simulate 1138 people (just for fun)&lt;/span&gt;
n_people &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1138&lt;/span&gt;
   
net_data &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tibble&lt;/span&gt;(
  &lt;span style=&#34;color:#75715e&#34;&gt;# Make an ID column (not necessary, but nice to have)&lt;/span&gt;
  id &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;n_people,
  &lt;span style=&#34;color:#75715e&#34;&gt;# Generate income variable: normal, 500 ± 300&lt;/span&gt;
  income &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rnorm&lt;/span&gt;(n_people, mean &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;500&lt;/span&gt;, sd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt;)
) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Generate health variable: beta, centered around 70ish&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(health_base &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rbeta&lt;/span&gt;(n_people, shape1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;, shape2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;100&lt;/span&gt;,
         &lt;span style=&#34;color:#75715e&#34;&gt;# Health increases by 0.02 for every dollar in income&lt;/span&gt;
         health_income_effect &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; income &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.02&lt;/span&gt;,
         &lt;span style=&#34;color:#75715e&#34;&gt;# Make the final health score and add some noise&lt;/span&gt;
         health &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; health_base &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; health_income_effect &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rnorm&lt;/span&gt;(n_people, mean &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, sd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;),
         &lt;span style=&#34;color:#75715e&#34;&gt;# Rescale so it doesn&amp;#39;t go above 100&lt;/span&gt;
         health &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rescale&lt;/span&gt;(health, to &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;min&lt;/span&gt;(health), &lt;span style=&#34;color:#ae81ff&#34;&gt;100&lt;/span&gt;))) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Generate net variable based on income, health, and random noise&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(net_score &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; income) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;1.5&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; health) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rnorm&lt;/span&gt;(n_people, mean &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, sd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;15&lt;/span&gt;),
         &lt;span style=&#34;color:#75715e&#34;&gt;# Scale net score down to 0.05 to 0.95 to create a probability of using a net&lt;/span&gt;
         net_probability &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rescale&lt;/span&gt;(net_score, to &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;0.05&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.95&lt;/span&gt;)),
         &lt;span style=&#34;color:#75715e&#34;&gt;# Randomly generate a 0/1 variable using that probability&lt;/span&gt;
         net &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rbinom&lt;/span&gt;(n_people, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, net_probability)) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Finally generate a malaria risk variable based on income, health, net use,&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# and random noise&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(malaria_risk_base &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rbeta&lt;/span&gt;(n_people, shape1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;, shape2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;100&lt;/span&gt;,
         &lt;span style=&#34;color:#75715e&#34;&gt;# Risk goes down by 10 when using a net. Because we rescale things,&lt;/span&gt;
         &lt;span style=&#34;color:#75715e&#34;&gt;# though, we have to make the effect a lot bigger here so it scales&lt;/span&gt;
         &lt;span style=&#34;color:#75715e&#34;&gt;# down to -10. Risk also decreases as health and income go up. I played&lt;/span&gt;
         &lt;span style=&#34;color:#75715e&#34;&gt;# with these numbers until they created reasonable coefficients.&lt;/span&gt;
         malaria_effect &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;-30&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; net) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;-1.9&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; health) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;-0.1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; income),
         &lt;span style=&#34;color:#75715e&#34;&gt;# Make the final malaria risk score and add some noise&lt;/span&gt;
         malaria_risk &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; malaria_risk_base &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; malaria_effect &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rnorm&lt;/span&gt;(n_people, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, sd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;),
         &lt;span style=&#34;color:#75715e&#34;&gt;# Rescale so it doesn&amp;#39;t go below 0,&lt;/span&gt;
         malaria_risk &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rescale&lt;/span&gt;(malaria_risk, to &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;)))
   
&lt;span style=&#34;color:#75715e&#34;&gt;# Look at all these columns!&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;head&lt;/span&gt;(net_data)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 6 x 11&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##      id income health_base health_income_effect health net_score net_probability   net malaria_risk_base malaria_effect malaria_risk&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;int&amp;gt;  &amp;lt;dbl&amp;gt;       &amp;lt;dbl&amp;gt;                &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;           &amp;lt;dbl&amp;gt; &amp;lt;int&amp;gt;             &amp;lt;dbl&amp;gt;          &amp;lt;dbl&amp;gt;        &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1     1   409.        61.2                 8.19   63.1      301.           0.369     0              37.9          -161.         45.1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2     2   521.        83.9                10.4    83.5      409.           0.684     1              55.0          -241.         23.4&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3     3   581.        64.6                11.6    73.0      426.           0.735     0              53.0          -197.         36.5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4     4   324.        62.0                 6.48   60.6      255.           0.235     0              68.4          -148.         58.7&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5     5   532.        69.2                10.6    73.4      373.           0.578     1              63.2          -223.         32.7&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6     6   538.        36.6                10.8    42.6      295.           0.351     0              38.6          -135.         52.5&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify all relationships with plots and models.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s see if we have the relationships we want. Income looks like it&amp;rsquo;s associated with health:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(net_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; income, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; health)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_point&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_smooth&lt;/span&gt;(method &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lm&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/synthetic-data_files/figure-html/check-income-health-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;   
&lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(health &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; income, data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; net_data) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;()
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 2 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term        estimate std.error statistic  p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;          &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)  59.1      2.54        23.3  2.24e-98&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 income        0.0169   0.00504      3.36 8.15e- 4&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;It looks like richer and healthier people are more likely to use nets:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;net_income &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(net_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; income, fill &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;as.factor&lt;/span&gt;(net))) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_density&lt;/span&gt;(alpha &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.7&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;theme&lt;/span&gt;(legend.position &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;bottom&amp;#34;&lt;/span&gt;)
   
net_health &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(net_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; health, fill &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;as.factor&lt;/span&gt;(net))) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_density&lt;/span&gt;(alpha &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.7&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;theme&lt;/span&gt;(legend.position &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;bottom&amp;#34;&lt;/span&gt;)
   
net_income &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; net_health
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/synthetic-data_files/figure-html/check-income-health-nets-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Income increasing makes it 1% more likely to use a net; health increasing make it 2% more likely to use a net:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;glm&lt;/span&gt;(net &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; income &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; health, family &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;binomial&lt;/span&gt;(link &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;logit&amp;#34;&lt;/span&gt;), data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; net_data) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(exponentiate &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 3 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term        estimate std.error statistic  p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;          &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)   0.0186  0.532        -7.49 6.64e-14&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 income        1.01    0.000864      6.47 9.93e-11&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 health        1.02    0.00491       3.89 9.92e- 5&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Try it out!&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Is the effect in there? Let&amp;rsquo;s try finding it by controlling for our two backdoors: health and income. Ordinarily we should do something like &lt;a href=&#34;/example/matching-ipw/&#34;&gt;matching or inverse probability weighting&lt;/a&gt;, but we&amp;rsquo;ll just do regular regression here (which is okay-ish, since all these variables are indeed linearly related with each other—we made them that way!)&lt;/p&gt;
&lt;p&gt;If we just look at the effect of nets on malaria risk without any statistical adjustment, we see that net cause a decrease of 13 points in malaria risk. This is wrong though becuase there&amp;rsquo;s confounding.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Wrong correlation-is-not-causation effect&lt;/span&gt;
model_net_naive &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(malaria_risk &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; net, data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; net_data)
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_net_naive)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 2 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term        estimate std.error statistic   p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;          &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)     41.9     0.413     102.  0.       &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 net            -13.6     0.572     -23.7 2.90e-101&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;If we control for the confounders, we get the 10 point ATE. It works!&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Correctly adjusted ATE effect&lt;/span&gt;
model_net_ate &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(malaria_risk &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; net &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; health &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; income, data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; net_data)
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_net_ate)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 4 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term        estimate std.error statistic   p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;          &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)  97.3      1.28         76.1 0.       &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 net         -10.5      0.317       -33.2 1.32e-169&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 health       -0.608    0.0123      -49.4 1.25e-284&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4 income       -0.0320   0.00213     -15.0 1.20e- 46&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Save the data.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Since it works, let&amp;rsquo;s save it:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# In the end, all we need is id, income, health, net, and malaria risk:&lt;/span&gt;
net_data_final &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; net_data &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;select&lt;/span&gt;(id, income, health, net, malaria_risk)
&lt;span style=&#34;color:#a6e22e&#34;&gt;head&lt;/span&gt;(net_data_final)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 6 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##      id income health   net malaria_risk&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;int&amp;gt;  &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt; &amp;lt;int&amp;gt;        &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1     1   409.   63.1     0         45.1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2     2   521.   83.5     1         23.4&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3     3   581.   73.0     0         36.5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4     4   324.   60.6     0         58.7&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5     5   532.   73.4     1         32.7&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6     6   538.   42.6     0         52.5&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Save it as a CSV file&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;write_csv&lt;/span&gt;(net_data_final, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;data/bed_nets.csv&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;brief-pep-talk-intermission&#34;&gt;Brief pep talk intermission&lt;/h3&gt;
&lt;p&gt;Generating data for a full complete observational DAG like the example above is complicated and hard. These other forms of causal inference are &lt;em&gt;design-based&lt;/em&gt; (i.e. tied to specific contexts like before/after treatment/control or arbitrary cutoffs) instead of &lt;em&gt;model-based&lt;/em&gt;, so they&amp;rsquo;re actually a lot easier to simulate! So don&amp;rsquo;t be scared away yet!&lt;/p&gt;
&lt;h3 id=&#34;creating-an-effect-for-rcts&#34;&gt;Creating an effect for RCTs&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Draw a DAG that maps out how all the columns you care about are related.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;RCTs are great because they make DAGs really easy! In a well-randomized RCT, you get to delete all arrows going into the treatment node in a DAG. We&amp;rsquo;ll stick with the same mosquito net situation we just used, but make it randomized:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;rct_dag &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;dagify&lt;/span&gt;(mal &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; net &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; inc &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; hlth,
                  hlth &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; inc,
                  coords &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(mal &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;, net &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, inc &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, hlth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;),
                                y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(mal &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, net &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, inc &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, hlth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;)))
&lt;span style=&#34;color:#a6e22e&#34;&gt;ggdag&lt;/span&gt;(rct_dag) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;theme_dag&lt;/span&gt;()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/synthetic-data_files/figure-html/rct-dag-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Specify how those nodes are measured.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;We&amp;rsquo;ll measure these nodes the same way as before:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Malaria risk&lt;/strong&gt;: scale from 0–100, mostly around 40, but ranging from 10ish to 80ish. Best to use a Beta distribution.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Net use&lt;/strong&gt;: binary 0/1, TRUE/FALSE variable, where 50% of people use nets. Best to use a binomial distribution.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Income&lt;/strong&gt;: weekly income, measured in dollars, mostly around 500 ± 300. Best to use a normal distribution.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Health&lt;/strong&gt;: scale from 0–100, mostly around 70, but ranging from 50ish to 100. Best to use a Beta distribution.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Specify the relationships between the nodes based on the DAG equations.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;This is where RCTs are great. Because we removed all the arrows going into &lt;code&gt;net&lt;/code&gt;, we don&amp;rsquo;t need to build any relationships that influence net use. Net use is randomized! We don&amp;rsquo;t need to make strange &amp;ldquo;bed net scores&amp;rdquo; and give people boosts according to income or health or anything. There are only two models in this DAG:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;hlth ~ inc&lt;/code&gt;&lt;/strong&gt;: Income influences health. We&amp;rsquo;ll assume that every 10 dollars/week is associated with a 1 point increase in health (so a 1 dollar incrrease is associated with a 0.02 point increase in health)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;mal ~ net + inc + hlth&lt;/code&gt;&lt;/strong&gt;: Net use, income, and health all have an effect on the risk of malaria. We&amp;rsquo;ll say that a 1 dollar increase in income is associated with a &lt;em&gt;decrease&lt;/em&gt; in risk, a 1 point increase in health is associated with a &lt;em&gt;decrease&lt;/em&gt; in risk, and using a net is associated with a 15 point &lt;em&gt;decrease&lt;/em&gt; in risk. That&amp;rsquo;s the casual effect we&amp;rsquo;re building in to the DAG.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Generate random columns that stand alone. Generate related columns using regression math. Consider adding random noise. This is an entirely trial and error process until you get numbers that look good. Rely &lt;em&gt;heavily&lt;/em&gt; on plots as you try different coefficients and parameters. Optionally rescale any columns that go out of reasonable bounds. If you rescale, you&amp;rsquo;ll need to tinker with the coefficients you used since the final effects will also get rescaled.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s make this data. It&amp;rsquo;ll be a lot easier than the full DAG we did before. Again, I&amp;rsquo;ll comment the code below so you can see what&amp;rsquo;s happening at each step.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Make this randomness consistent&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)
   
&lt;span style=&#34;color:#75715e&#34;&gt;# Simulate 793 people (just for fun)&lt;/span&gt;
n_people &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;793&lt;/span&gt;
   
rct_data &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tibble&lt;/span&gt;(
  &lt;span style=&#34;color:#75715e&#34;&gt;# Make an ID column (not necessary, but nice to have)&lt;/span&gt;
  id &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;n_people,
  &lt;span style=&#34;color:#75715e&#34;&gt;# Generate income variable: normal, 500 ± 300&lt;/span&gt;
  income &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rnorm&lt;/span&gt;(n_people, mean &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;500&lt;/span&gt;, sd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt;)
) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Generate health variable: beta, centered around 70ish&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(health_base &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rbeta&lt;/span&gt;(n_people, shape1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;, shape2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;100&lt;/span&gt;,
         &lt;span style=&#34;color:#75715e&#34;&gt;# Health increases by 0.02 for every dollar in income&lt;/span&gt;
         health_income_effect &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; income &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.02&lt;/span&gt;,
         &lt;span style=&#34;color:#75715e&#34;&gt;# Make the final health score and add some noise&lt;/span&gt;
         health &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; health_base &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; health_income_effect &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rnorm&lt;/span&gt;(n_people, mean &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, sd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;),
         &lt;span style=&#34;color:#75715e&#34;&gt;# Rescale so it doesn&amp;#39;t go above 100&lt;/span&gt;
         health &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rescale&lt;/span&gt;(health, to &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;min&lt;/span&gt;(health), &lt;span style=&#34;color:#ae81ff&#34;&gt;100&lt;/span&gt;))) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Randomly assign people to use a net (this is nice and easy!)&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(net &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rbinom&lt;/span&gt;(n_people, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt;)) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Finally generate a malaria risk variable based on income, health, net use,&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# and random noise&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(malaria_risk_base &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rbeta&lt;/span&gt;(n_people, shape1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;, shape2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;100&lt;/span&gt;,
         &lt;span style=&#34;color:#75715e&#34;&gt;# Risk goes down by 10 when using a net. Because we rescale things,&lt;/span&gt;
         &lt;span style=&#34;color:#75715e&#34;&gt;# though, we have to make the effect a lot bigger here so it scales&lt;/span&gt;
         &lt;span style=&#34;color:#75715e&#34;&gt;# down to -10. Risk also decreases as health and income go up. I played&lt;/span&gt;
         &lt;span style=&#34;color:#75715e&#34;&gt;# with these numbers until they created reasonable coefficients.&lt;/span&gt;
         malaria_effect &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;-35&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; net) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;-1.9&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; health) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;-0.1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; income),
         &lt;span style=&#34;color:#75715e&#34;&gt;# Make the final malaria risk score and add some noise&lt;/span&gt;
         malaria_risk &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; malaria_risk_base &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; malaria_effect &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rnorm&lt;/span&gt;(n_people, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, sd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;),
         &lt;span style=&#34;color:#75715e&#34;&gt;# Rescale so it doesn&amp;#39;t go below 0,&lt;/span&gt;
         malaria_risk &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rescale&lt;/span&gt;(malaria_risk, to &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;)))
   
&lt;span style=&#34;color:#75715e&#34;&gt;# Look at all these columns!&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;head&lt;/span&gt;(rct_data)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 6 x 9&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##      id income health_base health_income_effect health   net malaria_risk_base malaria_effect malaria_risk&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;int&amp;gt;  &amp;lt;dbl&amp;gt;       &amp;lt;dbl&amp;gt;                &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt; &amp;lt;int&amp;gt;             &amp;lt;dbl&amp;gt;          &amp;lt;dbl&amp;gt;        &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1     1   409.        57.2                 8.19   61.3     1              37.4          -192.         35.1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2     2   521.        63.3                10.4    69.4     0              33.0          -184.         37.6&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3     3   581.        61.8                11.6    71.9     1              36.4          -230.         24.4&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4     4   324.        42.2                 6.48   45.5     1              52.7          -154.         52.8&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5     5   532.        72.1                10.6    78.5     1              41.9          -237.         23.6&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6     6   538.        82.0                10.8    89.1     0              46.6          -223.         29.9&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify all relationships with plots and models.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Income still looks like it&amp;rsquo;s associated with health (which isn&amp;rsquo;t surprising, since it&amp;rsquo;s the same code we used for the full DAG earlier):&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(net_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; income, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; health)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_point&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_smooth&lt;/span&gt;(method &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lm&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/synthetic-data_files/figure-html/check-income-health-rct-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;   
&lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(health &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; income, data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; net_data) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;()
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 2 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term        estimate std.error statistic  p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;          &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)  59.1      2.54        23.3  2.24e-98&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 income        0.0169   0.00504      3.36 8.15e- 4&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Try it out!&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Is the effect in there? With an RCT, all we really need to do is compare the outcome across treatment and control groups—because there&amp;rsquo;s no confounding, we don&amp;rsquo;t need to control for anything. Ordinarily we should check for balance across characteristics like health and income (and maybe generate other demographic columns) like &lt;a href=&#34;/example/rcts/&#34;&gt;we did in the RCT example&lt;/a&gt;, but we&amp;rsquo;ll skip all that here since we&amp;rsquo;re just checking to see if the effect is there.&lt;/p&gt;
&lt;p&gt;It looks like using nets &lt;em&gt;causes&lt;/em&gt; an average decrease of 10 risk points. Great!&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Correct RCT-based ATE&lt;/span&gt;
model_rct &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(malaria_risk &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; net, data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; rct_data)
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_rct)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 2 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term        estimate std.error statistic  p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;          &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)     40.8     0.463      88.0 0.      &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 net            -10.2     0.653     -15.7 2.22e-48&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Just for fun, if we control for health and income, we&amp;rsquo;ll get basically the same effect, since they don&amp;rsquo;t actualy confound the relationship and don&amp;rsquo;t really explain anything useful.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Controlling for stuff even though we don&amp;#39;t need to&lt;/span&gt;
model_rct_controls &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(malaria_risk &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; net &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; health &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; income, data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; rct_data)
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_rct_controls)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 4 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term        estimate std.error statistic   p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;          &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)  97.7      1.45         67.3 0.       &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 net         -10.8      0.344       -31.3 2.27e-140&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 health       -0.586    0.0140      -41.8 1.67e-202&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4 income       -0.0310   0.00230     -13.5 1.75e- 37&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Save the data.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The data works, so let&amp;rsquo;s get rid of the intermediate columns we don&amp;rsquo;t need and save it as a CSV file.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# In the end, all we need is id, income, health, net, and malaria risk:&lt;/span&gt;
rct_data_final &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; rct_data &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;select&lt;/span&gt;(id, income, health, net, malaria_risk)
&lt;span style=&#34;color:#a6e22e&#34;&gt;head&lt;/span&gt;(rct_data_final)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 6 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##      id income health   net malaria_risk&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;int&amp;gt;  &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt; &amp;lt;int&amp;gt;        &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1     1   409.   61.3     1         35.1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2     2   521.   69.4     0         37.6&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3     3   581.   71.9     1         24.4&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4     4   324.   45.5     1         52.8&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5     5   532.   78.5     1         23.6&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6     6   538.   89.1     0         29.9&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Save it as a CSV file&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;write_csv&lt;/span&gt;(rct_data_final, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;data/bed_nets_rct.csv&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;creating-an-effect-for-diff-in-diff&#34;&gt;Creating an effect for diff-in-diff&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Draw a DAG that maps out how all the columns you care about are related.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Difference-in-differences approaches to causal inference are not based on &lt;em&gt;models&lt;/em&gt; but on &lt;em&gt;context&lt;/em&gt; or research design. You need comparable treatment and control groups before and after some policy or program is implemented.&lt;/p&gt;
&lt;p&gt;We&amp;rsquo;ll keep with our mosquito net example and pretend that two cities in some country are dealing with malaria infections. City B rolls out a free net program in 2017; City A does not. Here&amp;rsquo;s what the DAG looks like:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;did_dag &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;dagify&lt;/span&gt;(mal &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; net &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; year &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; city,
                  net &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; year &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; city,
                  coords &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(mal &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, net &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, year &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, city &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;),
                                y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(mal &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, net &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, year &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, city &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)))
&lt;span style=&#34;color:#a6e22e&#34;&gt;ggdag&lt;/span&gt;(did_dag) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;theme_dag&lt;/span&gt;()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/synthetic-data_files/figure-html/did-dag-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Specify how those nodes are measured.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Here&amp;rsquo;s how we&amp;rsquo;ll measure these nodes:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Malaria risk&lt;/strong&gt;: scale from 0–100, mostly around 60, but ranging from 30ish to 90ish. Best to use a Beta distribution.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Net use&lt;/strong&gt;: binary 0/1, TRUE/FALSE variable. This is technically binomial, but we don&amp;rsquo;t need to simulate it since it will only happen for people who are in the treatment city after the universal net rollout.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Year&lt;/strong&gt;: year ranging from 2013 to 2020. Best to use a uniform distribution.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;City&lt;/strong&gt;: binary 0/1, City A/City B variable. Best to use a binomial distribution.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Specify the relationships between the nodes based on the DAG equations.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;There are two models in the DAG:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;net ~ year + city&lt;/code&gt;&lt;/strong&gt;: Net use is determined by being in City B &lt;em&gt;and&lt;/em&gt; being after 2017. We&amp;rsquo;ll assume perfect compliance here (but it&amp;rsquo;s fairly easy to simulate non-compliance and have some people in City A use nets after 2017, and some people in both cities use nets before 2017).&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;mal ~ net + year + city&lt;/code&gt;&lt;/strong&gt;: Malaria risk is determined by net use, year, and city. It&amp;rsquo;s determined by lots of other things too (like we saw in the previous DAGs), but since we&amp;rsquo;re assuming that the two cities are comparable treatment and control groups, we don&amp;rsquo;t need to worry about things like health, income, age, etc.&lt;/p&gt;
&lt;p&gt;We&amp;rsquo;ll pretend that in general, City B has historicallly had a problem with malaria and people there have had higher risk: being in City B increases malaria risk by 5 points, on average. Over time, both cities have worked on mosquito abatement, so average malaria risk has decreased by 2 points per year (in both cities, because we believe in parallel trends). Using a mosquito net causes a decrease of 10 points on average. That&amp;rsquo;s our causal effect.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Generate random columns that stand alone. Generate related columns using regression math. Consider adding random noise. This is an entirely trial and error process until you get numbers that look good. Rely &lt;em&gt;heavily&lt;/em&gt; on plots as you try different coefficients and parameters. Optionally rescale any columns that go out of reasonable bounds. If you rescale, you&amp;rsquo;ll need to tinker with the coefficients you used since the final effects will also get rescaled.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Generation time! Heavily annotated code below:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Make this randomness consistent&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)
   
&lt;span style=&#34;color:#75715e&#34;&gt;# Simulate 2567 people (just for fun)&lt;/span&gt;
n_people &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2567&lt;/span&gt;
   
did_data &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tibble&lt;/span&gt;(
  &lt;span style=&#34;color:#75715e&#34;&gt;# Make an ID column (not necessary, but nice to have)&lt;/span&gt;
  id &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;n_people,
  &lt;span style=&#34;color:#75715e&#34;&gt;# Generate year variable: uniform, between 2013 and 2020. Round so it&amp;#39;s whole.&lt;/span&gt;
  year &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;round&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;runif&lt;/span&gt;(n_people, min &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2013&lt;/span&gt;, max &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2020&lt;/span&gt;), &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;),
  &lt;span style=&#34;color:#75715e&#34;&gt;# Generate city variable: binomial, 50% chance of being in a city. We&amp;#39;ll use&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# sample() instead of rbinom()&lt;/span&gt;
  city &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sample&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;City A&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;City B&amp;#34;&lt;/span&gt;), n_people, replace &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;)
) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Generate net variable. We&amp;#39;re assuming perfect compliance, so this will only&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# be TRUE for people in City B after 2017&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(net &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ifelse&lt;/span&gt;(city &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;City B&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; year &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2017&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;)) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Generate a malaria risk variable based on year, city, net use, and random noise&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(malaria_risk_base &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rbeta&lt;/span&gt;(n_people, shape1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;, shape2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;100&lt;/span&gt;,
         &lt;span style=&#34;color:#75715e&#34;&gt;# Risk goes up if you&amp;#39;re in City B because they have a worse problem.&lt;/span&gt;
         &lt;span style=&#34;color:#75715e&#34;&gt;# We could just say &amp;#34;city_effect = 5&amp;#34; and give everyone in City A an&lt;/span&gt;
         &lt;span style=&#34;color:#75715e&#34;&gt;# exact 5-point boost, but to add some noise, we&amp;#39;ll give people an&lt;/span&gt;
         &lt;span style=&#34;color:#75715e&#34;&gt;# average boost using rnorm(). Some people might go up 7, some might go&lt;/span&gt;
         &lt;span style=&#34;color:#75715e&#34;&gt;# up 1, some might go down 2&lt;/span&gt;
         city_effect &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ifelse&lt;/span&gt;(city &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;City B&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;rnorm&lt;/span&gt;(n_people, mean &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;, sd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;), &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;),
         &lt;span style=&#34;color:#75715e&#34;&gt;# Risk goes down by 2 points on average every year. Creating this&lt;/span&gt;
         &lt;span style=&#34;color:#75715e&#34;&gt;# effect with regression would work fine (-2 * year), except the years&lt;/span&gt;
         &lt;span style=&#34;color:#75715e&#34;&gt;# are huge here (-2 * 2013 and -2 * 2020, etc.) So first we create a&lt;/span&gt;
         &lt;span style=&#34;color:#75715e&#34;&gt;# smaller year column where 2013 is year 1, 2014 is year 2, and so on,&lt;/span&gt;
         &lt;span style=&#34;color:#75715e&#34;&gt;# that way we can say -2 * 1 and -2 * 6, or whatever.&lt;/span&gt;
         &lt;span style=&#34;color:#75715e&#34;&gt;# Also, rather than make risk go down by *exactly* 2 every year, we&amp;#39;ll&lt;/span&gt;
         &lt;span style=&#34;color:#75715e&#34;&gt;# add some noise with rnorm(), so for some people it&amp;#39;ll go down by 1 or&lt;/span&gt;
         &lt;span style=&#34;color:#75715e&#34;&gt;# 4 or up by 1, and so on&lt;/span&gt;
         year_smaller &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; year &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2012&lt;/span&gt;,
         year_effect &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rnorm&lt;/span&gt;(n_people, mean &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;-2&lt;/span&gt;, sd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.1&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; year_smaller,
         &lt;span style=&#34;color:#75715e&#34;&gt;# Using a net causes a decrease of 10 points, on average. Again, rather&lt;/span&gt;
         &lt;span style=&#34;color:#75715e&#34;&gt;# than use exactly 10, we&amp;#39;ll use a distribution around 10. People only&lt;/span&gt;
         &lt;span style=&#34;color:#75715e&#34;&gt;# get a net boost if they&amp;#39;re in City B after 2017.&lt;/span&gt;
         net_effect &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ifelse&lt;/span&gt;(city &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;City B&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; year &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2017&lt;/span&gt;,
                             &lt;span style=&#34;color:#a6e22e&#34;&gt;rnorm&lt;/span&gt;(n_people, mean &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;-10&lt;/span&gt;, sd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1.5&lt;/span&gt;),
                             &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;),
         &lt;span style=&#34;color:#75715e&#34;&gt;# Finally combine all these effects to create the malaria risk variable&lt;/span&gt;
         malaria_risk &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; malaria_risk_base &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; city_effect &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; year_effect &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; net_effect,
         &lt;span style=&#34;color:#75715e&#34;&gt;# Rescale so it doesn&amp;#39;t go below 0 or above 100&lt;/span&gt;
         malaria_risk &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rescale&lt;/span&gt;(malaria_risk, to &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;100&lt;/span&gt;))) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Make an indicator variable showing if the row is after 2017&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(after &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; year &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2017&lt;/span&gt;)
   
&lt;span style=&#34;color:#a6e22e&#34;&gt;head&lt;/span&gt;(did_data)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 6 x 11&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##      id  year city   net   malaria_risk_base city_effect year_smaller year_effect net_effect malaria_risk after&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;int&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;chr&amp;gt;  &amp;lt;lgl&amp;gt;             &amp;lt;dbl&amp;gt;       &amp;lt;dbl&amp;gt;        &amp;lt;dbl&amp;gt;       &amp;lt;dbl&amp;gt;      &amp;lt;dbl&amp;gt;        &amp;lt;dbl&amp;gt; &amp;lt;lgl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1     1  2014 City B FALSE              53.0        6.25            2       -3.97          0         54.2 FALSE&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2     2  2017 City B FALSE              89.7        3.32            5       -9.17          0         84.1 FALSE&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3     3  2017 City A FALSE              49.5        0               5      -10.1           0         37.6 FALSE&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4     4  2017 City B FALSE              37.4        7.11            5       -9.44          0         33.1 FALSE&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5     5  2019 City A FALSE              76.6        0               7      -14.7           0         61.1 TRUE &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6     6  2017 City B FALSE              65.7        5.38            5      -10.4           0         59.9 FALSE&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify all relationships with plots and models.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Is risk higher in City B? Yep.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(did_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; city, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; malaria_risk, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; city)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;stat_summary&lt;/span&gt;(geom &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;pointrange&amp;#34;&lt;/span&gt;, fun.data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;mean_se&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;guides&lt;/span&gt;(color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/synthetic-data_files/figure-html/check-risk-increase-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Does risk decrease over time? And are the trends parallel? There was a weird random spike in City B in 2017 for whatever reason, but in general, the trends in the two cities are pretty parallel from 2013 to 2017.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;plot_data &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; did_data &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;group_by&lt;/span&gt;(year, city) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;summarize&lt;/span&gt;(mean_risk &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;mean&lt;/span&gt;(malaria_risk),
            se_risk &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sd&lt;/span&gt;(malaria_risk) &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sqrt&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;n&lt;/span&gt;()),
            upper &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; mean_risk &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;1.96&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; se_risk),
            lower &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; mean_risk &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;-1.96&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; se_risk))
   
&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(plot_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; year, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; mean_risk, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; city)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_vline&lt;/span&gt;(xintercept &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2017.5&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_ribbon&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(ymin &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; lower, ymax &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; upper, fill &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; city), alpha &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.3&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_line&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;theme&lt;/span&gt;(legend.position &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;bottom&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/synthetic-data_files/figure-html/check-parallel-trends-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Try it out!&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s see if it works! For diff-in-diff we need to use this model:&lt;/p&gt;
&lt;p&gt;$$
\text{Malaria risk} = \alpha + \beta\ \text{City B} + \gamma\ \text{After 2017} + \delta\ (\text{City B} \times \text{After 2017}) + \varepsilon
$$&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_did &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(malaria_risk &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; city &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; after &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; city &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; after, data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; did_data)
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_did)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 4 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term                 estimate std.error statistic  p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;                   &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)             59.2      0.549    108.   0.      &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 cityCity B               5.17     0.778      6.64 3.71e-11&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 afterTRUE               -7.47     0.939     -7.96 2.61e-15&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4 cityCity B:afterTRUE   -10.2      1.32      -7.79 9.67e-15&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;It works! Being in City B is associated with a 5-point higher risk on average; being after 2017 is associated with a 7.5-point lower risk on average, and being in City B after 2017 causes risk to drop by −10. The number isn&amp;rsquo;t exactly −10 here, since we rescaled the &lt;code&gt;malaria_risk&lt;/code&gt; column a little, but still, it&amp;rsquo;s close. It&amp;rsquo;d probably be a good idea to build in some more noise and noncompliance, since the p-values are really really tiny here, but this is good enough for now.&lt;/p&gt;
&lt;p&gt;Here&amp;rsquo;s an obligatory diff-in-diff visualization:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;plot_data &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; did_data &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;group_by&lt;/span&gt;(after, city) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;summarize&lt;/span&gt;(mean_risk &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;mean&lt;/span&gt;(malaria_risk),
            se_risk &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sd&lt;/span&gt;(malaria_risk) &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sqrt&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;n&lt;/span&gt;()),
            upper &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; mean_risk &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;1.96&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; se_risk),
            lower &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; mean_risk &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;-1.96&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; se_risk))
   
&lt;span style=&#34;color:#75715e&#34;&gt;# Extract parts of the model results for adding annotations&lt;/span&gt;
model_results &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_did)
before_treatment &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(model_results, term &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;(Intercept)&amp;#34;&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;estimate &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(model_results, term &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;cityCity B&amp;#34;&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;estimate
diff_diff &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(model_results, term &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;cityCity B:afterTRUE&amp;#34;&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;estimate
after_treatment &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; before_treatment &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; diff_diff &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(model_results, term &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;afterTRUE&amp;#34;&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;estimate
   
&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(plot_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; after, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; mean_risk, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; city, group &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; city)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_pointrange&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(ymin &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; lower, ymax &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; upper)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_line&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;annotate&lt;/span&gt;(geom &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;segment&amp;#34;&lt;/span&gt;, x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;, xend &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;,
           y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; before_treatment, yend &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; after_treatment &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; diff_diff,
           linetype &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;dashed&amp;#34;&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;grey50&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;annotate&lt;/span&gt;(geom &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;segment&amp;#34;&lt;/span&gt;, x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2.1&lt;/span&gt;, xend &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2.1&lt;/span&gt;,
           y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; after_treatment, yend &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; after_treatment &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; diff_diff,
           linetype &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;dotted&amp;#34;&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;blue&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;theme&lt;/span&gt;(legend.position &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;bottom&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/synthetic-data_files/figure-html/show-diff-diff-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Save the data.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The data works, so let&amp;rsquo;s get rid of the intermediate columns we don&amp;rsquo;t need and save it as a CSV file.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;did_data_final &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; did_data &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;select&lt;/span&gt;(id, year, city, net, malaria_risk)
&lt;span style=&#34;color:#a6e22e&#34;&gt;head&lt;/span&gt;(did_data_final)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 6 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##      id  year city   net   malaria_risk&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;int&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;chr&amp;gt;  &amp;lt;lgl&amp;gt;        &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1     1  2014 City B FALSE         54.2&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2     2  2017 City B FALSE         84.1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3     3  2017 City A FALSE         37.6&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4     4  2017 City B FALSE         33.1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5     5  2019 City A FALSE         61.1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6     6  2017 City B FALSE         59.9&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Save data&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;write_csv&lt;/span&gt;(did_data_final, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;data/diff_diff.csv&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;creating-an-effect-for-regression-discontinuity&#34;&gt;Creating an effect for regression discontinuity&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Draw a DAG that maps out how all the columns you care about are related.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Regression discontinuity designs are also based on context instead of models, so the DAG is pretty simple. We&amp;rsquo;ll keep with our mosquito net example and pretend that families that earn less than $450 a week qualify for a free net. Here&amp;rsquo;s the DAG:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;rdd_dag &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;dagify&lt;/span&gt;(mal &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; net &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; inc,
                  net &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; cut,
                  cut &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; inc,
                  coords &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(mal &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;, net &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, inc &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, cut &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;),
                                y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(mal &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, net &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, inc &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, cut &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1.75&lt;/span&gt;)))
&lt;span style=&#34;color:#a6e22e&#34;&gt;ggdag&lt;/span&gt;(rdd_dag) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;theme_dag&lt;/span&gt;()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/synthetic-data_files/figure-html/rdd-dag-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Specify how those nodes are measured.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Here&amp;rsquo;s how we&amp;rsquo;ll measure these nodes:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Malaria risk&lt;/strong&gt;: scale from 0–100, mostly around 60, but ranging from 30ish to 90ish. Best to use a Beta distribution.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Net use&lt;/strong&gt;: binary 0/1, TRUE/FALSE variable. This is technically binomial, but we don&amp;rsquo;t need to simulate it since it will only happen for people who below the cutoff.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Income&lt;/strong&gt;: weekly income, measured in dollars, mostly around 500 ± 300. Best to use a normal distribution.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Cutoff&lt;/strong&gt;: binary 0/1, below/above $450 variable. This is technically binomial, but we don&amp;rsquo;t need to simulate it since it is entirely based on income.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Specify the relationships between the nodes based on the DAG equations.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;There are three models in the DAG:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;cut ~ inc&lt;/code&gt;&lt;/strong&gt;: Being above or below the cutpoint is determined by income. We know the cutoff is 450, so we just make an indicator showing if people are below that.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;net ~ cut&lt;/code&gt;&lt;/strong&gt;: Net usage is determined by the cutpoint. If people are below the cutpoint, they&amp;rsquo;ll use a net; if not, they won&amp;rsquo;t. We can build in noncompliance here if we want and use fuzzy regression discontinuity. For the sake of this example, we&amp;rsquo;ll do it both ways, just so you can see both sharp and fuzzy synthetic data.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;mal ~ net + inc&lt;/code&gt;&lt;/strong&gt;: Malaria risk is determined by both net usage and income. It&amp;rsquo;s also determined by lots of other things (age, education, city, etc.), but we don&amp;rsquo;t need to include those in the DAG because we&amp;rsquo;re using RDD to say that we have good treatment and control groups right around the cutoff.&lt;/p&gt;
&lt;p&gt;We&amp;rsquo;ll pretend that a 1 dollar increase in income is associated with a drop in risk of 0.01, and that using a mosquito net causes a decrease of 10 points on average. That&amp;rsquo;s our causal effect.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Generate random columns that stand alone. Generate related columns using regression math. Consider adding random noise. This is an entirely trial and error process until you get numbers that look good. Rely &lt;em&gt;heavily&lt;/em&gt; on plots as you try different coefficients and parameters. Optionally rescale any columns that go out of reasonable bounds. If you rescale, you&amp;rsquo;ll need to tinker with the coefficients you used since the final effects will also get rescaled.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s fake some data! Heavily annotated code below:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Make this randomness consistent&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)
   
&lt;span style=&#34;color:#75715e&#34;&gt;# Simulate 5441 people (we need a lot bc we&amp;#39;re throwing most away)&lt;/span&gt;
n_people &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5441&lt;/span&gt;
   
rdd_data &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tibble&lt;/span&gt;(
  &lt;span style=&#34;color:#75715e&#34;&gt;# Make an ID column (not necessary, but nice to have)&lt;/span&gt;
  id &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;n_people,
  &lt;span style=&#34;color:#75715e&#34;&gt;# Generate income variable: normal, 500 ± 300&lt;/span&gt;
  income &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rnorm&lt;/span&gt;(n_people, mean &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;500&lt;/span&gt;, sd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt;)
) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Generate cutoff variable&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(below_cutoff &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ifelse&lt;/span&gt;(income &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;450&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;)) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Generate net variable. We&amp;#39;ll make two: one that&amp;#39;s sharp and has perfect&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# compliance, and one that&amp;#39;s fuzzy&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Here&amp;#39;s the sharp one. It&amp;#39;s easy. If you&amp;#39;re below the cutoff you use a net.&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(net_sharp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ifelse&lt;/span&gt;(below_cutoff &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;)) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Here&amp;#39;s the fuzzy one, which is a little trickier. If you&amp;#39;re far away from&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# the cutoff, you follow what you&amp;#39;re supposed to do (like if your income is&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# 800, you don&amp;#39;t use the program; if your income is 200, you definitely use&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# the program). But if you&amp;#39;re close to the cutoff, we&amp;#39;ll pretend that there&amp;#39;s&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# an 80% chance that you&amp;#39;ll do what you&amp;#39;re supposed to do.&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(net_fuzzy &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;case_when&lt;/span&gt;(
    &lt;span style=&#34;color:#75715e&#34;&gt;# If your income is between 450 and 500, there&amp;#39;s a 20% chance of using the program&lt;/span&gt;
    income &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;450&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; income &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;500&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sample&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;), n_people, replace &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;, prob &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;0.2&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.8&lt;/span&gt;)),
    &lt;span style=&#34;color:#75715e&#34;&gt;# If your income is above 500, you definitely don&amp;#39;t use the program&lt;/span&gt;
    income &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;500&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;,
    &lt;span style=&#34;color:#75715e&#34;&gt;# If your income is between 400 and 450, there&amp;#39;s an 80% chance of using the program&lt;/span&gt;
    income &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;450&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; income &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;400&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sample&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;), n_people, replace &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;, prob &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;0.8&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.2&lt;/span&gt;)),
    &lt;span style=&#34;color:#75715e&#34;&gt;# If your income is below 400, you definitely use the program&lt;/span&gt;
    income &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;400&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;
  )) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Finally we can make the malaria risk score, based on income, net use, and&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# random noise. We&amp;#39;ll make two outcomes: one using the sharp net use and one&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# using the fuzzy net use. They have the same effect built in, we just have to&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# use net_sharp and net_fuzzy separately.&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(malaria_risk_base &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rbeta&lt;/span&gt;(n_people, shape1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;, shape2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;100&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Make the sharp version. There&amp;#39;s really a 10 point decrease, but because of&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# rescaling, we use 15. I only chose 15 through lots of trial and error (i.e.&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# I used -11, ran the RDD model, and the effect was too small; I used -20, ran&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# the model, and the effect was too big; I kept changing numbers until landing&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# on -15). Risk also goes down as income increases.&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(malaria_effect_sharp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;-15&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; net_sharp) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;-0.01&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; income),
         malaria_risk_sharp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; malaria_risk_base &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; malaria_effect_sharp &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rnorm&lt;/span&gt;(n_people, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, sd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;),
         malaria_risk_sharp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rescale&lt;/span&gt;(malaria_risk_sharp, to &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;))) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Do the same thing, but with net_fuzzy&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(malaria_effect_fuzzy &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;-15&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; net_fuzzy) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;-0.01&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; income),
         malaria_risk_fuzzy &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; malaria_risk_base &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; malaria_effect_fuzzy &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rnorm&lt;/span&gt;(n_people, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, sd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;),
         malaria_risk_fuzzy &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rescale&lt;/span&gt;(malaria_risk_fuzzy, to &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;))) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Make a version of income that&amp;#39;s centered at the cutpoint&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(income_centered &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; income &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;450&lt;/span&gt;)
   
&lt;span style=&#34;color:#a6e22e&#34;&gt;head&lt;/span&gt;(rdd_data)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 6 x 11&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##      id income below_cutoff net_sharp net_fuzzy malaria_risk_base malaria_effect_sharp malaria_risk_sharp malaria_effect_fuzzy malaria_risk_fuzzy income_centered&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;int&amp;gt;  &amp;lt;dbl&amp;gt; &amp;lt;lgl&amp;gt;        &amp;lt;lgl&amp;gt;     &amp;lt;lgl&amp;gt;                 &amp;lt;dbl&amp;gt;                &amp;lt;dbl&amp;gt;              &amp;lt;dbl&amp;gt;                &amp;lt;dbl&amp;gt;              &amp;lt;dbl&amp;gt;           &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1     1   409. TRUE         TRUE      FALSE                  56.5               -19.1                38.0                -4.09               47.5           -40.5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2     2   521. FALSE        FALSE     FALSE                  26.1                -5.21               28.6                -5.21               27.6            70.8&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3     3   581. FALSE        FALSE     FALSE                  84.4                -5.81               64.7                -5.81               65.5           131. &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4     4   324. TRUE         TRUE      TRUE                   32.9               -18.2                25.9               -18.2                23.4          -126. &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5     5   532. FALSE        FALSE     FALSE                  53.1                -5.32               46.5                -5.32               44.3            82.2&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6     6   538. FALSE        FALSE     FALSE                  45.7                -5.38               43.2                -5.38               40.2            88.0&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify all relationships with plots and models.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Is there a cutoff in the running variable when we use the sharp net variable? Yep!&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(rdd_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; income, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; net_sharp, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; below_cutoff)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_vline&lt;/span&gt;(xintercept &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;450&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_point&lt;/span&gt;(alpha &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.3&lt;/span&gt;, position &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;position_jitter&lt;/span&gt;(width &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;NULL&lt;/span&gt;, height &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.2&lt;/span&gt;)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;guides&lt;/span&gt;(color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/synthetic-data_files/figure-html/sharp-running-var-cutoff-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Is there a cutoff in the running variable when we use the fuzzy net variable? Yep! There are some richer people using the program and some poorer people not using it.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(rdd_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; income, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; net_fuzzy, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; below_cutoff)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_vline&lt;/span&gt;(xintercept &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;450&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_point&lt;/span&gt;(alpha &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.3&lt;/span&gt;, position &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;position_jitter&lt;/span&gt;(width &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;NULL&lt;/span&gt;, height &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.2&lt;/span&gt;)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;guides&lt;/span&gt;(color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/synthetic-data_files/figure-html/fuzzy-running-var-cutoff-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Try it out!&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s test it! For sharp RDD we need to use this model:&lt;/p&gt;
&lt;p&gt;$$
\text{Malaria risk} = \beta_0 + \beta_1 \text{Income}_\text{centered} + \beta_2 \text{Net} + \varepsilon
$$&lt;/p&gt;
&lt;p&gt;We&amp;rsquo;ll use a bandwidth of ±$50, because why not. In real life you&amp;rsquo;d be more careful about bandwidth selection (or use &lt;code&gt;rdbwselect()&lt;/code&gt; from the &lt;strong&gt;rdrobust&lt;/strong&gt; package to find the optimal bandwidth)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(rdd_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; income, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; malaria_risk_sharp, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; net_sharp)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_vline&lt;/span&gt;(xintercept &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;450&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_point&lt;/span&gt;(alpha &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.2&lt;/span&gt;, size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Add lines for the full range&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_smooth&lt;/span&gt;(data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(rdd_data, income_centered &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;),
              method &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lm&amp;#34;&lt;/span&gt;, se &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;, size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, linetype &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;dashed&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_smooth&lt;/span&gt;(data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(rdd_data, income_centered &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;),
              method &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lm&amp;#34;&lt;/span&gt;, se &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;, size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, linetype &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;dashed&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Add lines for bandwidth = 50&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_smooth&lt;/span&gt;(data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(rdd_data, income_centered &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;-50&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; income_centered &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;),
              method &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lm&amp;#34;&lt;/span&gt;, se &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;, size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_smooth&lt;/span&gt;(data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(rdd_data, income_centered &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; income_centered &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;50&lt;/span&gt;),
              method &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lm&amp;#34;&lt;/span&gt;, se &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;, size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;theme&lt;/span&gt;(legend.position &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;bottom&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/synthetic-data_files/figure-html/sharp-results-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_sharp &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(malaria_risk_sharp &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; income_centered &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; net_sharp,
                  data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(rdd_data,
                                income_centered &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;-50&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; income_centered &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;50&lt;/span&gt;))
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_sharp)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 3 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term            estimate std.error statistic  p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;              &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)      40.7       0.462      88.1  0.      &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 income_centered  -0.0197    0.0144     -1.37 1.72e- 1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 net_sharpTRUE   -10.6       0.815     -13.0  1.67e-37&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;There&amp;rsquo;s an effect! For people in the bandwidth, the local average treatment effect of nets is a 10.6 point reduction in malaria risk.&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s check if it works with the fuzzy version where there are noncompliers:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(rdd_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; income, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; malaria_risk_fuzzy, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; net_fuzzy)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_vline&lt;/span&gt;(xintercept &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;450&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_point&lt;/span&gt;(alpha &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.2&lt;/span&gt;, size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Add lines for the full range&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_smooth&lt;/span&gt;(data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(rdd_data, income_centered &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;),
              method &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lm&amp;#34;&lt;/span&gt;, se &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;, size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, linetype &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;dashed&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_smooth&lt;/span&gt;(data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(rdd_data, income_centered &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;),
              method &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lm&amp;#34;&lt;/span&gt;, se &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;, size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, linetype &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;dashed&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Add lines for bandwidth = 50&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_smooth&lt;/span&gt;(data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(rdd_data, income_centered &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;-50&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; income_centered &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;),
              method &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lm&amp;#34;&lt;/span&gt;, se &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;, size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_smooth&lt;/span&gt;(data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(rdd_data, income_centered &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; income_centered &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;50&lt;/span&gt;),
              method &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lm&amp;#34;&lt;/span&gt;, se &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;, size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;theme&lt;/span&gt;(legend.position &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;bottom&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/synthetic-data_files/figure-html/fuzzy-results-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;There&amp;rsquo;s a gap, but it&amp;rsquo;s hard to measure since there are noncompliers on both sides. We can deal with the noncompliance if we use above/below the cutoff as an instrument (see the &lt;a href=&#34;/example/rdd-fuzzy/&#34;&gt;fuzzy regression discontinuity guide&lt;/a&gt; for a complete example). We should run this set of models:&lt;/p&gt;
&lt;p&gt;$$
\begin{aligned}
\widehat{\text{Net}} &amp;amp;= \gamma_0 + \gamma_1 \text{Income}_{\text{centered}} + \gamma_2 \text{Below 450} + \omega \\&lt;br&gt;
\text{Malaria risk} &amp;amp;= \beta_0 + \beta_1 \text{Income}_{\text{centered}} + \beta_2 \widehat{\text{Net}} + \epsilon
\end{aligned}
$$&lt;/p&gt;
&lt;p&gt;Instead of doing these two stages by hand (ugh), we&amp;rsquo;ll do the 2SLS regression with the &lt;code&gt;iv_robust()&lt;/code&gt; function from the &lt;strong&gt;estimatr&lt;/strong&gt; package:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(estimatr)
   
model_fuzzy &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;iv_robust&lt;/span&gt;(malaria_risk_fuzzy &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; income_centered &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; net_fuzzy &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;
                           income_centered &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; below_cutoff,
                         data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(rdd_data,
                                       income_centered &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;-50&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; income_centered &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;50&lt;/span&gt;))
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_fuzzy)
&lt;span style=&#34;color:#75715e&#34;&gt;##              term  estimate std.error statistic   p.value  conf.low conf.high   df            outcome&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1     (Intercept)  40.73241   0.69045    58.994 0.000e+00  39.37843 42.086402 2220 malaria_risk_fuzzy&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 income_centered  -0.01921   0.01423    -1.350 1.772e-01  -0.04711  0.008696 2220 malaria_risk_fuzzy&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3   net_fuzzyTRUE -11.21929   1.31033    -8.562 2.034e-17 -13.78889 -8.649700 2220 malaria_risk_fuzzy&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The effect is slightly larger now (−11.2), but that&amp;rsquo;s because we are looking at a doubly local ATE: compliers in the bandwidth. But still, it&amp;rsquo;s close to −10, so that&amp;rsquo;s good. And we could probably get it closer if we did other mathy shenanigans like adding squared and cubed terms or using nonparametric estimation with &lt;code&gt;rdrobust()&lt;/code&gt; in the &lt;strong&gt;rdrobust&lt;/strong&gt; package.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Save the data.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The data works, so let&amp;rsquo;s get rid of the intermediate columns we don&amp;rsquo;t need and save it as a CSV file. We&amp;rsquo;ll make two separate CSV files for fuzzy and sharp, just because.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;rdd_data_final_sharp &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; rdd_data &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;select&lt;/span&gt;(id, income, net &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; net_sharp, malaria_risk &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; malaria_risk_sharp)
&lt;span style=&#34;color:#a6e22e&#34;&gt;head&lt;/span&gt;(rdd_data_final_sharp)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 6 x 4&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##      id income net   malaria_risk&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;int&amp;gt;  &amp;lt;dbl&amp;gt; &amp;lt;lgl&amp;gt;        &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1     1   409. TRUE          38.0&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2     2   521. FALSE         28.6&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3     3   581. FALSE         64.7&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4     4   324. TRUE          25.9&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5     5   532. FALSE         46.5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6     6   538. FALSE         43.2&lt;/span&gt;
   
rdd_data_final_fuzzy &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; rdd_data &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;select&lt;/span&gt;(id, income, net &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; net_fuzzy, malaria_risk &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; malaria_risk_fuzzy)
&lt;span style=&#34;color:#a6e22e&#34;&gt;head&lt;/span&gt;(rdd_data_final_fuzzy)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 6 x 4&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##      id income net   malaria_risk&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;int&amp;gt;  &amp;lt;dbl&amp;gt; &amp;lt;lgl&amp;gt;        &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1     1   409. FALSE         47.5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2     2   521. FALSE         27.6&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3     3   581. FALSE         65.5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4     4   324. TRUE          23.4&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5     5   532. FALSE         44.3&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6     6   538. FALSE         40.2&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Save data&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;write_csv&lt;/span&gt;(rdd_data_final_sharp, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;data/rdd_sharp.csv&amp;#34;&lt;/span&gt;)
&lt;span style=&#34;color:#a6e22e&#34;&gt;write_csv&lt;/span&gt;(rdd_data_final_fuzzy, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;data/rdd_fuzzy.csv&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;creating-an-effect-for-instrumental-variables&#34;&gt;Creating an effect for instrumental variables&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Draw a DAG that maps out how all the columns you care about are related.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;As with diff-in-diff and regression discontinuity, instrumental variables are a design-based approach to causal inference and thus don&amp;rsquo;t require complicated models (but you can still add control variables!), so their DAGs are simpler. Once again we&amp;rsquo;ll look at the effect of mosquito nets on malaria risk, but this time we&amp;rsquo;ll say that we cannot possibly measure all the confounding factors between net use and malaria risk, so we&amp;rsquo;ll use an instrument to extract the exogeneity from net use.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;/content/11-content/&#34;&gt;As we talked about in Session 11&lt;/a&gt;, good plausible instruments are hard to find: they have to cause bed net use and &lt;em&gt;not&lt;/em&gt; be related to malaria risk &lt;em&gt;except through&lt;/em&gt; bed net use.&lt;/p&gt;
&lt;p&gt;For this example, we&amp;rsquo;ll pretend that free bed nets are distributed from town halls around the country. We&amp;rsquo;ll use &amp;ldquo;distance to town hall&amp;rdquo; as our instrument, since it could arguably maybe work perhaps. Being closer to a town hall makes you more likely to use a net, but being closer to a town halls doesn&amp;rsquo;t make put you at higher or lower risk for malaria on its own—it does that only because it changes your likelihood of getting a net.&lt;/p&gt;
&lt;p&gt;This is where the story for the instrument falls apart, actually; in real life, if you live far away from a town hall, you probably live further from health services and live in more rural places with worse mosquito abatement policies, so you&amp;rsquo;re probably at higher risk of malaria. It&amp;rsquo;s probably a bad instrument, but just go with it.&lt;/p&gt;
&lt;p&gt;Here&amp;rsquo;s the DAG:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;iv_dag &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;dagify&lt;/span&gt;(mal &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; net &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; U,
                 net &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; dist &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; U,
                 coords &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(mal &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;, net &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, U &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, dist &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;),
                               y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(mal &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, net &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, U &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, dist &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1.5&lt;/span&gt;)),
                 latent &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;U&amp;#34;&lt;/span&gt;)
   
&lt;span style=&#34;color:#a6e22e&#34;&gt;ggdag_status&lt;/span&gt;(iv_dag) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;guides&lt;/span&gt;(color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;theme_dag&lt;/span&gt;()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/synthetic-data_files/figure-html/iv-dag-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Specify how those nodes are measured.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Here&amp;rsquo;s how we&amp;rsquo;ll measure these nodes:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Malaria risk&lt;/strong&gt;: scale from 0–100, mostly around 60, but ranging from 30ish to 90ish. Best to use a Beta distribution.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Net use&lt;/strong&gt;: binary 0/1, TRUE/FALSE variable. However, since we want to use other variables that increase the likelihood of using a net, we&amp;rsquo;ll do some cool tricky stuff with a bed net score, like we did in the observational DAG example earlier.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Distance&lt;/strong&gt;: distance to nearest town hall, measured in kilometers, mostly around 3, with a left skewed long tail (i.e. most people live fairly close, some people live far away). Best to use a Beta distribution (to get the skewed shape) that we then rescale.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Unobserved&lt;/strong&gt;: who knows?! There are a lot of unknown confounders. We could generate columns like income, age, education, and health, make them mathematically related to malaria risk and net use, and then throw those columns away in the final data so they&amp;rsquo;re unobserved. That would be fairly easy and intuitive.&lt;/p&gt;
&lt;p&gt;For the sake of simplicity here, we&amp;rsquo;ll make a column called &amp;ldquo;risk factors,&amp;rdquo; kind of like we did with the &amp;ldquo;ability&amp;rdquo; column in &lt;a href=&#34;https://evalf20.classes.andrewheiss.com/example/iv/#education-wages-and-fathers-education-fake-data&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;the instrumental variables example&lt;/a&gt;—it&amp;rsquo;s a magical column that is unmeasurable, but it&amp;rsquo;ll open a backdoor path between net use and malaria risk and thus create endogeneity. It&amp;rsquo;ll be normally distributed around 50, with a standard deviation of 25.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Specify the relationships between the nodes based on the DAG equations.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;There are two models in the DAG:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;net ~ dist + U&lt;/code&gt;&lt;/strong&gt;: Net usage is determined by both distance and our magical unobserved risk factor column. Net use is technically binomial, but in order to change the likelihood of net use based on distance to town hall and unobserved stuff, we&amp;rsquo;ll do the fancy tricky stuff we did in the observational DAG section above: we&amp;rsquo;ll create a bed net score, increase or decrease that score based on risk factors and distance, scale that score to a 0-1 scale of probabilities, and then draw a binomial 0/1 outcome using those probabilities.&lt;/p&gt;
&lt;p&gt;We&amp;rsquo;ll say that a one kilometer increase in the distance to a town halls reduces the bed net score and a one point increase in risk factors reduces the bed net score.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;mal ~ net + U&lt;/code&gt;&lt;/strong&gt;: Malaria risk is determined by both net usage and unkown stuff, or the magical column we&amp;rsquo;re calling &amp;ldquo;risk factors.&amp;rdquo; We&amp;rsquo;ll say that a one point increase in risk factors increases malaria risk, and that using a mosquito net causes a decrease of 10 points on average. That&amp;rsquo;s our causal effect.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Generate random columns that stand alone. Generate related columns using regression math. Consider adding random noise. This is an entirely trial and error process until you get numbers that look good. Rely &lt;em&gt;heavily&lt;/em&gt; on plots as you try different coefficients and parameters. Optionally rescale any columns that go out of reasonable bounds. If you rescale, you&amp;rsquo;ll need to tinker with the coefficients you used since the final effects will also get rescaled.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Fake data time! Here&amp;rsquo;s some heavily annotated code:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Make this randomness consistent&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)
   
&lt;span style=&#34;color:#75715e&#34;&gt;# Simulate 1578 people (just for fun)&lt;/span&gt;
n_people &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1578&lt;/span&gt;
   
iv_data &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tibble&lt;/span&gt;(
  &lt;span style=&#34;color:#75715e&#34;&gt;# Make an ID column (not necessary, but nice to have)&lt;/span&gt;
  id &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;n_people,
  &lt;span style=&#34;color:#75715e&#34;&gt;# Generate magical unobserved risk factor variable: normal, 500 ± 300&lt;/span&gt;
  risk_factors &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rnorm&lt;/span&gt;(n_people, mean &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;100&lt;/span&gt;, sd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;25&lt;/span&gt;),
  &lt;span style=&#34;color:#75715e&#34;&gt;# Generate distance to town hall variable&lt;/span&gt;
  distance &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rbeta&lt;/span&gt;(n_people, shape1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, shape2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;)
) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Scale up distance to be 0.1-15 instead of 0-1&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(distance &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rescale&lt;/span&gt;(distance, to &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;0.1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;15&lt;/span&gt;))) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Generate net variable based on distance, risk factors, and random noise&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Note: These -40 and -2 effects are entirely made up and I got them through a&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# lot of trial and error and rerunning this stupid chunk dozens of times&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(net_score &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
           (&lt;span style=&#34;color:#ae81ff&#34;&gt;-40&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; distance) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;# Distance effect&lt;/span&gt;
           (&lt;span style=&#34;color:#ae81ff&#34;&gt;-2&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; risk_factors) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;# Risk factor effect&lt;/span&gt;
           &lt;span style=&#34;color:#a6e22e&#34;&gt;rnorm&lt;/span&gt;(n_people, mean &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, sd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;50&lt;/span&gt;),  &lt;span style=&#34;color:#75715e&#34;&gt;# Random noise&lt;/span&gt;
        net_probability &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rescale&lt;/span&gt;(net_score, to &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;0.15&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)),
        &lt;span style=&#34;color:#75715e&#34;&gt;# Randomly generate a 0/1 variable using that probability&lt;/span&gt;
        net &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rbinom&lt;/span&gt;(n_people, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, net_probability)) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Generate malaria risk variable based on net use, risk factors, and random noise&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(malaria_risk_base &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rbeta&lt;/span&gt;(n_people, shape1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;, shape2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;100&lt;/span&gt;,
         &lt;span style=&#34;color:#75715e&#34;&gt;# We&amp;#39;re aiming for a -10 net effect, but need to boost it because of rescaling&lt;/span&gt;
         malaria_effect &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;-20&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; net) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; risk_factors),
         &lt;span style=&#34;color:#75715e&#34;&gt;# Make the final malaria risk score&lt;/span&gt;
         malaria_risk &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; malaria_risk_base &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; malaria_effect,
         &lt;span style=&#34;color:#75715e&#34;&gt;# Rescale so it doesn&amp;#39;t go below 0&lt;/span&gt;
         malaria_risk &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rescale&lt;/span&gt;(malaria_risk, to &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;80&lt;/span&gt;)))
iv_data
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 1,578 x 9&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##       id risk_factors distance net_score net_probability   net malaria_risk_base malaria_effect malaria_risk&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##    &amp;lt;int&amp;gt;        &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;           &amp;lt;dbl&amp;gt; &amp;lt;int&amp;gt;             &amp;lt;dbl&amp;gt;          &amp;lt;dbl&amp;gt;        &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##  1     1         69.8    3.98      -202.           0.766     1              71.1           14.9         36.5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##  2     2        107.     2.14      -284.           0.686     1              75.4           33.5         49.5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##  3     3        127.     5.47      -469.           0.505     0              57.4           63.6         56.4&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##  4     4         41.4    9.61      -414.           0.558     0              37.2           20.7         20.4&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##  5     5        111.     4.66      -376.           0.596     0              38.5           55.4         40.9&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##  6     6        113.     2.29      -284.           0.686     1              75.7           36.3         51.3&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##  7     7         85.6    0.922     -215.           0.753     0              28.7           42.8         28.2&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##  8     8         86.3   12.5       -608.           0.368     1              50.6           23.2         29.4&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##  9     9         85.9    3.11      -267.           0.703     1              38.4           22.9         22.4&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 10    10         77.7    1.35      -157.           0.810     1              69.1           18.9         37.6&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## # … with 1,568 more rows&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify all relationships with plots and models.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Is there a relationship between unobserved risk factors and malaria risk? Yep.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(iv_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; risk_factors, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; malaria_risk)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_point&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;as.factor&lt;/span&gt;(net))) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_smooth&lt;/span&gt;(method &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lm&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/synthetic-data_files/figure-html/check-risk-malaria-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Is there a relationship between distance to town hall and net use? Yeah, those who live further away are less likely to use a net.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(iv_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; distance, fill &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;as.factor&lt;/span&gt;(net))) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_density&lt;/span&gt;(alpha &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.7&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/synthetic-data_files/figure-html/check-distance-net-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Is there a relationship between net use and malaria risk? Haha, yeah, that&amp;rsquo;s a huge highly significant effect. Probably too perfect. We could increase those error bars if we tinker with some of the numbers in the code, but for the sake of this example, we&amp;rsquo;ll leave them like this.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(iv_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;as.factor&lt;/span&gt;(net), y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; malaria_risk, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;as.factor&lt;/span&gt;(net))) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;stat_summary&lt;/span&gt;(geom &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;pointrange&amp;#34;&lt;/span&gt;, fun.data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;mean_se&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/synthetic-data_files/figure-html/check-net-risk-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Try it out!&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Cool, let&amp;rsquo;s see if this works. Remember, we can&amp;rsquo;t actually use the &lt;code&gt;risk_factors&lt;/code&gt; column in real life, but we will here just to make sure the effect we built in exists. Here&amp;rsquo;s the true effect, where using a net causes a decrease of 10.9 malaria risk points&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_forbidden &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(malaria_risk &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; net &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; risk_factors, data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; iv_data)
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_forbidden)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 3 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term         estimate std.error statistic   p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;           &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)    20.6     0.873        23.6 6.98e-106&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 net           -10.8     0.400       -27.1 3.93e-133&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 risk_factors    0.283   0.00788      35.9 1.16e-206&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Since we can&amp;rsquo;t actually use that column, we&amp;rsquo;ll use distance to town hall as an instrument. We should run this set of models:&lt;/p&gt;
&lt;p&gt;$$
\begin{aligned}
\widehat{\text{Net}} &amp;amp;= \gamma_0 + \gamma_1 \text{Distance to town hall} + \omega \\&lt;br&gt;
\text{Malaria risk} &amp;amp;= \beta_0 + \beta_1 \widehat{\text{Net}} + \epsilon
\end{aligned}
$$&lt;/p&gt;
&lt;p&gt;We&amp;rsquo;ll run this 2SLS model with the &lt;code&gt;iv_robust()&lt;/code&gt; function from the &lt;strong&gt;estimatr&lt;/strong&gt; package:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(estimatr)
   
model_iv &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;iv_robust&lt;/span&gt;(malaria_risk &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; net &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; distance, data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; iv_data)
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_iv)
&lt;span style=&#34;color:#75715e&#34;&gt;##          term estimate std.error statistic    p.value conf.low conf.high   df      outcome&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)   47.202     1.576     29.95 2.344e-156    44.11    50.294 1576 malaria_risk&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2         net   -8.236     2.474     -3.33  8.889e-04   -13.09    -3.385 1576 malaria_risk&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;…and it&amp;rsquo;s relatively close, I guess, at −8.2. Getting instrumental variables to find exact causal effects is tricky, but I&amp;rsquo;m fine with this for simulated data.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Save the data.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The data works well enough, so we&amp;rsquo;ll get rid of the extra intermediate columns and save it as a CSV file. We&amp;rsquo;ll keep the forbidden &lt;code&gt;risk_factors&lt;/code&gt; column just for fun.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;iv_data_final &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; iv_data &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;select&lt;/span&gt;(id, net, distance, malaria_risk, risk_factors)
   
&lt;span style=&#34;color:#a6e22e&#34;&gt;head&lt;/span&gt;(iv_data_final)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 6 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##      id   net distance malaria_risk risk_factors&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;    &amp;lt;dbl&amp;gt;        &amp;lt;dbl&amp;gt;        &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1     1     1     3.98         36.5         69.8&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2     2     1     2.14         49.5        107. &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3     3     0     5.47         56.4        127. &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4     4     0     9.61         20.4         41.4&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5     5     0     4.66         40.9        111. &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6     6     1     2.29         51.3        113.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Save data&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;write_csv&lt;/span&gt;(iv_data_final, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;data/bed_nets_iv.csv&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;use-synthetic-data-packages&#34;&gt;Use synthetic data packages&lt;/h2&gt;
&lt;p&gt;There are several R packages that let you generate synthetic data with built-in relationships in a more automatic way. They all work a little differently, and if you&amp;rsquo;re interested in trying them out, make sure you check the documentation for details.&lt;/p&gt;
&lt;h3 id=&#34;fabricatr&#34;&gt;fabricatr&lt;/h3&gt;
&lt;p&gt;The &lt;a href=&#34;https://declaredesign.org/r/fabricatr/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;strong&gt;fabricatr&lt;/strong&gt; package&lt;/a&gt; is a very powerful package for simulating data. It was invented specifically for using in preregistered studies, so it can handle a ton of different data structures like &lt;a href=&#34;https://declaredesign.org/r/fabricatr/articles/cross_classified.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;panel data&lt;/a&gt; and &lt;a href=&#34;https://declaredesign.org/r/fabricatr/articles/time_series.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;time series data&lt;/a&gt;. You can build in causal effects and force columns to be correlated with each other.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;fabricatr&lt;/strong&gt; has exceptionally well-written documentation with like a billion detailed examples (see &lt;a href=&#34;https://declaredesign.org/r/fabricatr/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;the right sidebar here&lt;/a&gt;). This is a gold standard package and you should most definitely check it out.&lt;/p&gt;
&lt;p&gt;Here&amp;rsquo;s a simple example of simulating a bunch of voters and making older ones more likely to vote:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(fabricatr)

&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)

fake_voters &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;fabricate&lt;/span&gt;(
  &lt;span style=&#34;color:#75715e&#34;&gt;# Make 100 people&lt;/span&gt;
  N &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;100&lt;/span&gt;,
  &lt;span style=&#34;color:#75715e&#34;&gt;# Age uniformly distributed between 18 and 85&lt;/span&gt;
  age &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;round&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;runif&lt;/span&gt;(N, &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;85&lt;/span&gt;)),
  &lt;span style=&#34;color:#75715e&#34;&gt;# Older people more likely to vote&lt;/span&gt;
  turnout &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;draw_binary&lt;/span&gt;(prob &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ifelse&lt;/span&gt;(age &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;40&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.4&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.7&lt;/span&gt;), N &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; N)
)

&lt;span style=&#34;color:#a6e22e&#34;&gt;head&lt;/span&gt;(fake_voters)
&lt;span style=&#34;color:#75715e&#34;&gt;##    ID age turnout&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 001  26       0&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 002  60       1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 003  59       1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4 004  60       1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5 005  76       1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6 006  61       1&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;And here&amp;rsquo;s an example of country-year panel data where there are country-specific and year-specific effects on GDP:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)

panel_global_data &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;fabricate&lt;/span&gt;(
  years &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;add_level&lt;/span&gt;(
    N &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;,
    ts_year &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;9&lt;/span&gt;,
    year_shock &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rnorm&lt;/span&gt;(N, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.3&lt;/span&gt;)
  ),
  countries &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;add_level&lt;/span&gt;(
    N &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;,
    base_gdp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;runif&lt;/span&gt;(N, &lt;span style=&#34;color:#ae81ff&#34;&gt;15&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;22&lt;/span&gt;),
    growth_units &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;runif&lt;/span&gt;(N, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.25&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt;),
    growth_error &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;runif&lt;/span&gt;(N, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.15&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt;),
    nest &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;
  ),
  country_years &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;cross_levels&lt;/span&gt;(
    by &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;join&lt;/span&gt;(years, countries),
    gdp_measure &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; base_gdp &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; year_shock &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; (ts_year &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; growth_units) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
      &lt;span style=&#34;color:#a6e22e&#34;&gt;rnorm&lt;/span&gt;(N, sd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; growth_error)
  )
) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Scale up the years to be actual years instead of 1, 2, 3, etc.&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(year &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ts_year &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2010&lt;/span&gt;)

&lt;span style=&#34;color:#a6e22e&#34;&gt;head&lt;/span&gt;(panel_global_data)
&lt;span style=&#34;color:#75715e&#34;&gt;##   years ts_year year_shock countries base_gdp growth_units growth_error country_years gdp_measure year&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1    01       0   -0.36212         1    17.22       0.4526       0.3096            01       17.07 2010&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2    02       1    0.08323         1    17.22       0.4526       0.3096            02       17.55 2011&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3    03       2    0.32533         1    17.22       0.4526       0.3096            03       18.72 2012&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4    04       3   -0.70371         1    17.22       0.4526       0.3096            04       17.99 2013&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5    05       4    0.12874         1    17.22       0.4526       0.3096            05       19.25 2014&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6    06       5    0.15182         1    17.22       0.4526       0.3096            06       19.63 2015&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(panel_global_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; year, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; gdp_measure, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; countries)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_line&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;labs&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Year&amp;#34;&lt;/span&gt;, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Log GDP&amp;#34;&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Countries&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/synthetic-data_files/figure-html/fake-panel-data-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;That all just scratches the surface of what &lt;strong&gt;fabricatr&lt;/strong&gt; can do. Again, check the examples and documentation and play around with it to see what else it can do.&lt;/p&gt;
&lt;h3 id=&#34;wakefield&#34;&gt;wakefield&lt;/h3&gt;
&lt;p&gt;The &lt;a href=&#34;https://github.com/trinker/wakefield&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;strong&gt;wakefield&lt;/strong&gt; package&lt;/a&gt; is jokingly named after &lt;a href=&#34;https://en.wikipedia.org/wiki/Andrew_Wakefield&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Andrew Wakefield&lt;/a&gt;, the British researcher who invented fake data to show that the MMR vaccine causes autism. This package lets you quickly generate random fake datasets. It has a bunch of pre-set column possibilities, like age, color, Likert scales, political parties, religion, and so on, and you can also use standard R functions like &lt;code&gt;rnorm()&lt;/code&gt;, &lt;code&gt;rbinom()&lt;/code&gt;, or &lt;code&gt;rbeta()&lt;/code&gt;. It also lets you create repeated measures (1st grade score, 2nd grade score, 3rd grade score, etc.) and build correlations between variables.&lt;/p&gt;
&lt;p&gt;You should &lt;em&gt;definitely&lt;/em&gt; &lt;a href=&#34;https://github.com/trinker/wakefield&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;look at the documentation&lt;/a&gt; to see a ton of examples of how it all works. Here&amp;rsquo;s a basic example:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(wakefield)

&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)

wakefield_data &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;r_data_frame&lt;/span&gt;(
  n &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;500&lt;/span&gt;,
  id,
  treatment &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rbinom&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.3&lt;/span&gt;),  &lt;span style=&#34;color:#75715e&#34;&gt;# 30% chance of being in treatment&lt;/span&gt;
  outcome &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rnorm&lt;/span&gt;(mean &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;500&lt;/span&gt;, sd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;100&lt;/span&gt;),
  race,
  age &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;age&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;45&lt;/span&gt;),
  sex &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sex_inclusive&lt;/span&gt;(),
  survey_question_1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;likert&lt;/span&gt;(),
  survey_question_2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;likert&lt;/span&gt;()
)
&lt;span style=&#34;color:#a6e22e&#34;&gt;head&lt;/span&gt;(wakefield_data)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 6 x 8&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   ID    treatment outcome Race       age sex      survey_question_1 survey_question_2&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;     &amp;lt;int&amp;gt;   &amp;lt;dbl&amp;gt; &amp;lt;fct&amp;gt;    &amp;lt;int&amp;gt; &amp;lt;fct&amp;gt;    &amp;lt;ord&amp;gt;             &amp;lt;ord&amp;gt;            &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 001           0    544. White       35 Intersex Disagree          Agree            &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 002           0    606. White       38 Male     Disagree          Strongly Disagree&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 003           0    545. White       38 Female   Neutral           Strongly Agree   &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4 004           0    566. Black       45 Female   Strongly Agree    Disagree         &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5 005           1    386. Black       41 Male     Disagree          Agree            &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6 006           0    463. Hispanic    20 Female   Disagree          Agree&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;faux&#34;&gt;faux&lt;/h3&gt;
&lt;p&gt;The &lt;a href=&#34;https://debruine.github.io/faux/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;strong&gt;faux&lt;/strong&gt; package&lt;/a&gt; does some really neat things. We can create data that has built-in correlations without going through all the math. For instance, let&amp;rsquo;s say we have 3 variables A, B, and C that are normally distributed with these parameters:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;A&lt;/strong&gt;: mean = 10, sd = 2&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;B&lt;/strong&gt;: mean = 5, sd = 1&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;C&lt;/strong&gt;: mean = 20, sd = 5&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We want A to correlate with B at r = 0.8 (highly correlated), A to correlate with C at r = 0.3 (less correlated), and B to correlate with C at r = 0.4 (moderately correlated). Here&amp;rsquo;s how to create that data with &lt;strong&gt;faux&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(faux)

&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)

faux_data &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rnorm_multi&lt;/span&gt;(n &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;100&lt;/span&gt;,
                         mu &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;20&lt;/span&gt;),
                         sd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;),
                         r &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;0.8&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.3&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.4&lt;/span&gt;),
                         varnames &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;A&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;B&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;C&amp;#34;&lt;/span&gt;),
                         empirical &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;)
&lt;span style=&#34;color:#a6e22e&#34;&gt;head&lt;/span&gt;(faux_data)
&lt;span style=&#34;color:#75715e&#34;&gt;##        A     B     C&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 11.742 5.612 25.89&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2  9.060 4.177 18.79&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3  9.373 4.466 14.57&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4 10.913 5.341 31.88&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5  8.221 4.039 18.14&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6 10.095 4.517 17.43&lt;/span&gt;

&lt;span style=&#34;color:#75715e&#34;&gt;# Check averages and standard deviations&lt;/span&gt;
faux_data &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Convert to long/tidy so we can group and summarize&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;pivot_longer&lt;/span&gt;(cols &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;everything&lt;/span&gt;(), names_to &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;variable&amp;#34;&lt;/span&gt;, values_to &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;value&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;group_by&lt;/span&gt;(variable) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;summarize&lt;/span&gt;(mean &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;mean&lt;/span&gt;(value),
            sd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sd&lt;/span&gt;(value))
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 3 x 3&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   variable  mean    sd&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;    &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 A        10.2   2.08&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 B         5.02  1.00&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 C        20.8   5.01&lt;/span&gt;

&lt;span style=&#34;color:#75715e&#34;&gt;# Check correlations&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;cor&lt;/span&gt;(faux_data&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;A, faux_data&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;B)
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] 0.808&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;cor&lt;/span&gt;(faux_data&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;A, faux_data&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;C)
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] 0.301&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;cor&lt;/span&gt;(faux_data&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;B, faux_data&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;C)
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] 0.4598&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;faux&lt;/strong&gt; can do a ton of other things too, so make sure you check out &lt;a href=&#34;https://debruine.github.io/faux/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;the documentation and all the articles with examples here&lt;/a&gt;.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Fuzzy regression discontinuity</title>
      <link>/example/rdd-fuzzy/</link>
      <pubDate>Wed, 28 Oct 2020 00:00:00 +0000</pubDate>
      <guid>/example/rdd-fuzzy/</guid>
      <description>&lt;script src=&#34;/rmarkdown-libs/kePrint-0.0.1/kePrint.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;/rmarkdown-libs/lightable-0.0.1/lightable.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;h2 id=&#34;program-background&#34;&gt;Program background&lt;/h2&gt;
&lt;p&gt;In this example, we&amp;rsquo;ll use the same situation that we used in the &lt;a href=&#34;/example/rdd/&#34;&gt;the example for regression discontinuity&lt;/a&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Students take an entrance exam at the beginning of the school year&lt;/li&gt;
&lt;li&gt;If they score 70 or below, they are enrolled in a free tutoring program&lt;/li&gt;
&lt;li&gt;Students take an exit exam at the end of the year&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;If you want to follow along, download this dataset and put it in a folder named &lt;code&gt;data&lt;/code&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/data/tutoring_program_fuzzy.csv&#34;&gt;&lt;i class=&#34;fas fa-table&#34;&gt;&lt;/i&gt; &lt;code&gt;tutoring_program_fuzzy.csv&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(tidyverse)  &lt;span style=&#34;color:#75715e&#34;&gt;# ggplot(), %&amp;gt;%, mutate(), and friends&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(broom)  &lt;span style=&#34;color:#75715e&#34;&gt;# Convert models to data frames&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(rdrobust)  &lt;span style=&#34;color:#75715e&#34;&gt;# For robust nonparametric regression discontinuity&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(estimatr)  &lt;span style=&#34;color:#75715e&#34;&gt;# Run 2SLS models in one step with iv_robust()&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(modelsummary)  &lt;span style=&#34;color:#75715e&#34;&gt;# Create side-by-side regression tables&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(kableExtra)  &lt;span style=&#34;color:#75715e&#34;&gt;# Fancy table formatting&lt;/span&gt;

tutoring &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;read_csv&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;data/tutoring_program_fuzzy.csv&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;noncompliance-around-a-cutoff&#34;&gt;Noncompliance around a cutoff&lt;/h2&gt;
&lt;p&gt;In &lt;a href=&#34;/example/rdd/&#34;&gt;the example for regression discontinuity&lt;/a&gt;, it was fairly easy to measure the size of the jump at the cutoff because compliance was perfect. No people who scored above the threshold used the tutoring program, and nobody who qualified for the program didn&amp;rsquo;t use it. It was a &lt;em&gt;sharp&lt;/em&gt; design, since program usage looked like this:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/example/rdd_files/figure-html/check-fuzzy-sharp-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;However, seeing a cutoff this sharp and this perfect is fairly rare. It is possible that some people scored higher on the entrace exam and somehow used tutoring, or that some people scored below the threshold but didn&amp;rsquo;t participate in the program, either because they&amp;rsquo;re never-takers, or because they fell through bureaucratic cracks.&lt;/p&gt;
&lt;p&gt;More often, you&amp;rsquo;ll see compliance that looks like this:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(tutoring, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; entrance_exam, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tutoring_text, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; entrance_exam &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Make points small and semi-transparent since there are lots of them&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_point&lt;/span&gt;(size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1.5&lt;/span&gt;, alpha &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt;,
             position &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;position_jitter&lt;/span&gt;(width &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, height &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.25&lt;/span&gt;, seed &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Add vertical line&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_vline&lt;/span&gt;(xintercept &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Add labels&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;labs&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Entrance exam score&amp;#34;&lt;/span&gt;, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Participated in tutoring program&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Turn off the color legend, since it&amp;#39;s redundant&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;guides&lt;/span&gt;(color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/rdd-fuzzy_files/figure-html/fuzzy-compliance-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;We can see the count and percentages of compliance with &lt;code&gt;group_by()&lt;/code&gt; and &lt;code&gt;summarize()&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;tutoring &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;group_by&lt;/span&gt;(tutoring, entrance_exam &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;summarize&lt;/span&gt;(count &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;n&lt;/span&gt;()) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;group_by&lt;/span&gt;(tutoring) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(prop &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; count &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sum&lt;/span&gt;(count))
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 4 x 4&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## # Groups:   tutoring [2]&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   tutoring `entrance_exam &amp;lt;= 70` count   prop&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;lgl&amp;gt;    &amp;lt;lgl&amp;gt;                 &amp;lt;int&amp;gt;  &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 FALSE    FALSE                   646 0.947 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 FALSE    TRUE                     36 0.0528&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 TRUE     FALSE                   116 0.365 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4 TRUE     TRUE                    202 0.635&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Here we have 36 people who should have used tutoring who didn&amp;rsquo;t (either because they&amp;rsquo;re never-takers and are anti-program, or because the system failed them), and we have 116 people (!!!) who somehow snuck into the program. That should probably be a big red flag for the program administrators. That means that 36.5% of people in the tutoring program shouldn&amp;rsquo;t have been there. Big yikes.&lt;/p&gt;
&lt;p&gt;This is definitely not a sharp design. This is a fuzzy regression discontinuity.&lt;/p&gt;
&lt;h2 id=&#34;visualizing-a-fuzzy-gap&#34;&gt;Visualizing a fuzzy gap&lt;/h2&gt;
&lt;p&gt;With regular sharp RD, our goal is to measure the size of the gap or discontinuity in outcome right at the cutoff. &lt;a href=&#34;/example/rdd/#step-4-check-for-discontinuity-in-outcome-across-running-variabl&#34;&gt;In our sharp example&lt;/a&gt; we did this with different parametric regression models, as well as with the &lt;code&gt;rdrobust()&lt;/code&gt; function for nonparametric measurement.&lt;/p&gt;
&lt;p&gt;Regular parametric regression won&amp;rsquo;t really work here because we have strange compliance issues:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(tutoring, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; entrance_exam, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; exit_exam, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tutoring)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_point&lt;/span&gt;(size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, alpha &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Add a line based on a linear model for the people scoring less than 70&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_smooth&lt;/span&gt;(data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(tutoring, entrance_exam &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;), method &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lm&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Add a line based on a linear model for the people scoring 70 or more&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_smooth&lt;/span&gt;(data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(tutoring, entrance_exam &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;), method &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lm&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_vline&lt;/span&gt;(xintercept &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;labs&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Entrance exam score&amp;#34;&lt;/span&gt;, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Exit exam score&amp;#34;&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Used tutoring&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/rdd-fuzzy_files/figure-html/check-outcome-fuzzy-discontinuity-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;There&amp;rsquo;s still a visible gap at 70, but there are people who did and did not use the program on both sides of the cutoff.&lt;/p&gt;
&lt;p&gt;Another way to look at this is to make a sort of histogram that shows the probability of being in the tutoring program at different entrance exam scores. 100% of people who score between 25 and 50 on the exam used tutoring, so that&amp;rsquo;s good, but then the probability of tutoring drops to ≈80ish% up until the cutpoint at 70. After 70, there&amp;rsquo;s a 10–15% chance of using tutoring if you&amp;rsquo;re above the threshold.&lt;/p&gt;
&lt;p&gt;If this were a sharp design, every single bar to the left of the cutpoint would be 100% and every single bar to the right would be 0%, but that&amp;rsquo;s not the case here. The probability of tutoring changes at the cutpoint, but it&amp;rsquo;s not 100% perfect.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# This fun code uses cut() to split the entrance exam column into distinct&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# categories (0-5, 5-10, 10-15, etc.). You&amp;#39;ll see some strange syntax in the&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# categories it creates: (70, 75]. These ranges start with ( and end with ] for&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# a reason: ( means the range *does not* include the number, while ] means that&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# the range *does* include the number. (70, 75] thus means 71-75. You can&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# reverse that with an argument to cut() so taht it would do [70, 75), which&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# means 70-74.&lt;/span&gt;
tutoring_with_bins &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; tutoring &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(exam_binned &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;cut&lt;/span&gt;(entrance_exam, breaks &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;seq&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;100&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;))) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Group by each of the new bins and tutoring status&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;group_by&lt;/span&gt;(exam_binned, tutoring) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Count how many people are in each test bin + used/didn&amp;#39;t use tutoring&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;summarize&lt;/span&gt;(n &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;n&lt;/span&gt;()) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Make this summarized data wider so that there&amp;#39;s a column for tutoring and no tutoring&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;pivot_wider&lt;/span&gt;(names_from &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;tutoring&amp;#34;&lt;/span&gt;, values_from &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;n&amp;#34;&lt;/span&gt;, values_fill &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;rename&lt;/span&gt;(tutor_yes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; `TRUE`, tutor_no &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; `FALSE`) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Find the probability of tutoring in each bin by taking&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# the count of yes / count of yes + count of no&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(prob_tutoring &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tutor_yes &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; (tutor_yes &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; tutor_no))

&lt;span style=&#34;color:#75715e&#34;&gt;# Plot this puppy&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(tutoring_with_bins, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; exam_binned, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; prob_tutoring)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_col&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_vline&lt;/span&gt;(xintercept &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;8.5&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;labs&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Entrance exam score&amp;#34;&lt;/span&gt;, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Proportion of people participating in program&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/rdd-fuzzy_files/figure-html/fuzzy-binned-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;h2 id=&#34;measuring-a-fuzzy-gap&#34;&gt;Measuring a fuzzy gap&lt;/h2&gt;
&lt;p&gt;So how do we actually measure this gap, given all the compliance issues? Recall from Session 12 that &lt;em&gt;instruments&lt;/em&gt; let us isolate causal effects for just compliers: they let us find &lt;a href=&#34;/example/cace/&#34;&gt;the complier average causal effect, or CACE&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;But what should we use as an instrument? Do we use something weird like &lt;a href=&#34;http://ftp.iza.org/dp7725.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;the Scrabble score of people&amp;rsquo;s names&lt;/a&gt;? Something &lt;a href=&#34;https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3715610&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;overused like rainfall&lt;/a&gt;?&lt;/p&gt;
&lt;p&gt;No! In this case, the instrument is fairly easy and straightforward: we create a variable that indicates if someone is above or below the threshold. That&amp;rsquo;s all. This variable essentially measures &lt;em&gt;what should have happened&lt;/em&gt; rather than what actually happened.&lt;/p&gt;
&lt;p&gt;Surprisingly, it meets all the qualifications of an instrument too:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Relevance&lt;/strong&gt; ($Z \rightarrow X$ and &lt;code&gt;\(\operatorname{Cor}(Z, X) \neq 0\)&lt;/code&gt;): The cutoff causes access to the tutoring program.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Exclusion&lt;/strong&gt; ($Z \rightarrow X \rightarrow Y$ and &lt;code&gt;\(Z \nrightarrow Y\)&lt;/code&gt; and &lt;code&gt;\(\operatorname{Cor}(Z, Y | X) = 0\)&lt;/code&gt;): The cutoff causes exit exam scores &lt;em&gt;only through&lt;/em&gt; the tutoring program.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Exogeneity&lt;/strong&gt; ($U \nrightarrow Z$ and &lt;code&gt;\(\operatorname{Cor}(Z, U) = 0\)&lt;/code&gt;): Unobserved confounders between the tutoring program and exit exam scores are unrelated to the cutoff.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;fuzzy-parametric-estimation&#34;&gt;Fuzzy parametric estimation&lt;/h3&gt;
&lt;p&gt;Let&amp;rsquo;s make an instrument! We&amp;rsquo;ll also center the running variable just like we did with sharp regression discontinuity:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;tutoring_centered &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; tutoring &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(entrance_centered &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; entrance_exam &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;,
         below_cutoff &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; entrance_exam &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;)
tutoring_centered
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 1,000 x 7&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##       id entrance_exam tutoring tutoring_text exit_exam entrance_centered below_cutoff&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##    &amp;lt;dbl&amp;gt;         &amp;lt;dbl&amp;gt; &amp;lt;lgl&amp;gt;    &amp;lt;chr&amp;gt;             &amp;lt;dbl&amp;gt;             &amp;lt;dbl&amp;gt; &amp;lt;lgl&amp;gt;       &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##  1     1          92.4 FALSE    No tutor           78.1            22.4   FALSE       &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##  2     2          72.8 FALSE    No tutor           58.2             2.77  FALSE       &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##  3     3          53.7 TRUE     Tutor              62.0           -16.3   TRUE        &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##  4     4          98.3 FALSE    No tutor           67.5            28.3   FALSE       &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##  5     5          69.7 TRUE     Tutor              54.1            -0.288 TRUE        &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##  6     6          68.1 TRUE     Tutor              60.1            -1.93  TRUE        &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##  7     7          86.0 FALSE    No tutor           73.1            16.0   FALSE       &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##  8     8          85.7 TRUE     Tutor              76.7            15.7   FALSE       &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##  9     9          85.9 FALSE    No tutor           57.8            15.9   FALSE       &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 10    10          89.5 FALSE    No tutor           79.9            19.5   FALSE       &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## # … with 990 more rows&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now we have a new column named &lt;code&gt;below_cutoff&lt;/code&gt; that we&amp;rsquo;ll use as an instrument. Most of the time this will be the same as the &lt;code&gt;tutoring&lt;/code&gt; column, since most people are compliers. But some people didn&amp;rsquo;t comply, like person 8 here who was &lt;em&gt;not&lt;/em&gt; below the cutoff but still used the tutoring program.&lt;/p&gt;
&lt;p&gt;Before using the instrument, let&amp;rsquo;s first run a model that assumes the cutoff is sharp. As we did with &lt;a href=&#34;https://evalf20.classes.andrewheiss.com/example/rdd/#parametric-estimation&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;the sharp parametric analysis&lt;/a&gt;, we&amp;rsquo;ll include two explanatory variables:&lt;/p&gt;
&lt;p&gt;$$
\text{Exit exam} = \beta_0 + \beta_1 \text{Entrance exam score}_\text{centered} + \beta_2 \text{Tutoring program} + \epsilon
$$&lt;/p&gt;
&lt;p&gt;We&amp;rsquo;ll use a bandwidth of 10:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Bandwidth ±10&lt;/span&gt;
model_sans_instrument &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(exit_exam &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; entrance_centered &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; tutoring,
                            data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(tutoring_centered,
                                          entrance_centered &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;-10&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;
                                            entrance_centered &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;))
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_sans_instrument)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 3 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term              estimate std.error statistic   p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;                &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)         59.3      0.503     118.   9.75e-313&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 entrance_centered    0.511    0.0665      7.69 1.17e- 13&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 tutoringTRUE        11.5      0.744      15.4  1.77e- 42&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Here, the coefficient for &lt;code&gt;tutoringTRUE&lt;/code&gt; shows the size of the jump, which is 11.5. This means that participating in the tutoring program &lt;em&gt;causes&lt;/em&gt; an increase of 11.5 points on the final exam for people in the bandwidth.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;BUT THIS IS WRONG.&lt;/strong&gt; This is &lt;em&gt;not&lt;/em&gt; a sharp discontinuity, so we can&amp;rsquo;t actually do this. Instead, we need to run a 2SLS model that includes our instrument in the first stage, which will then remove the endogeneity built into participation in the program. We&amp;rsquo;ll estimate this set of models:&lt;/p&gt;
&lt;p&gt;$$
&lt;code&gt;\begin{aligned} \widehat{\text{Tutoring program}} &amp;amp;= \gamma_0 + \gamma_1 \text{Entrance exam score}_\text{centered} + \gamma_2 \text{Below cutoff} + \omega \\ \text{Exit exam} &amp;amp;= \beta_0 + \beta_1 \text{Entrance exam score}_\text{centered} + \beta_2 \widehat{\text{Tutoring program}} + \epsilon \end{aligned}&lt;/code&gt;
$$&lt;/p&gt;
&lt;p&gt;We could manually run the first stage model, generate predicted &lt;code&gt;tutoring&lt;/code&gt; and then use those predicted values in the second stage model &lt;a href=&#34;/example/iv/&#34;&gt;like we did in the instrumental variables example&lt;/a&gt;, but that&amp;rsquo;s tedious and nobody wants to do all that work. We&amp;rsquo;ll use &lt;code&gt;iv_robust()&lt;/code&gt; from the &lt;strong&gt;estimatr&lt;/strong&gt; package instead.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_fuzzy &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;iv_robust&lt;/span&gt;(
  exit_exam &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; entrance_centered &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; tutoring &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; entrance_centered &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; below_cutoff,
  data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(tutoring_centered, entrance_centered &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;-10&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; entrance_centered &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;)
)
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_fuzzy)
&lt;span style=&#34;color:#75715e&#34;&gt;##                term estimate std.error statistic  p.value conf.low conf.high  df   outcome&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1       (Intercept)    60.14     1.018      59.1 9.7e-200    58.14     62.14 400 exit_exam&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 entrance_centered     0.44     0.099       4.4  1.4e-05     0.24      0.63 400 exit_exam&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3      tutoringTRUE     9.74     1.912       5.1  5.4e-07     5.98     13.50 400 exit_exam&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Based on this model, using &lt;code&gt;below_cutoff&lt;/code&gt; as an instrument, we can see that the coefficient for &lt;code&gt;tutoringTRUE&lt;/code&gt; is different now! It&amp;rsquo;s 9.74, which means that the tutoring program &lt;em&gt;causes&lt;/em&gt; an average increase of 9.74 points on the final exam &lt;strong&gt;for compliers in the bandwidth&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Notice that last caveat. Because we&amp;rsquo;re working with regression discontinuity, we&amp;rsquo;re estimating a local average treatment effect (LATE) for people in the bandwidth. Because we&amp;rsquo;re working with instrumental variables, we&amp;rsquo;re estimating the LATE for compliers only. That means our fuzzy regression discontinuity result here is &lt;em&gt;doubly robust&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;If we compare this fuzzy result to the sharp result, we can see a sizable difference:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# gof_omit here will omit goodness-of-fit rows that match any of the text. This&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# means &amp;#39;contains &amp;#34;IC&amp;#34; OR contains &amp;#34;Low&amp;#34; OR contains &amp;#34;Adj&amp;#34; OR contains &amp;#34;p.value&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# OR contains &amp;#34;statistic&amp;#34; OR contains &amp;#34;se_type&amp;#34;&amp;#39;. Basically we&amp;#39;re getting rid of&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# all the extra diagnostic information at the bottom&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;modelsummary&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;No instrument (wrong)&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; model_sans_instrument,
                  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Fuzzy RD (bw = 10)&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; model_fuzzy),
             gof_omit &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;IC|Log|Adj|p\\.value|statistic|se_type&amp;#34;&lt;/span&gt;,
             stars &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Add a background color to row 5&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;row_spec&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;, background &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;#F5ABEA&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table class=&#34;table&#34; style=&#34;width: auto !important; margin-left: auto; margin-right: auto;&#34;&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt;   &lt;/th&gt;
   &lt;th style=&#34;text-align:center;&#34;&gt; No instrument (wrong) &lt;/th&gt;
   &lt;th style=&#34;text-align:center;&#34;&gt; Fuzzy RD (bw = 10) &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; (Intercept) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 59.274*** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 60.141*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.503) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (1.018) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; entrance_centered &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.511*** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.437*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.067) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.099) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;background-color: #F5ABEA !important;&#34;&gt; tutoringTRUE &lt;/td&gt;
   &lt;td style=&#34;text-align:center;background-color: #F5ABEA !important;&#34;&gt; 11.484*** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;background-color: #F5ABEA !important;&#34;&gt; 9.741*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.744) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (1.912) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Num.Obs. &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 403 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; R2 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.373 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.365 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; F &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 119.103 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; N &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 403 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;
&lt;tr&gt;
&lt;td style=&#34;padding: 0; border:0;&#34; colspan=&#34;100%&#34;&gt;
&lt;sup&gt;&lt;/sup&gt; * p &amp;lt; 0.1, ** p &amp;lt; 0.05, *** p &amp;lt; 0.01&lt;/td&gt;
&lt;/tr&gt;
&lt;/tfoot&gt;
&lt;/table&gt;
&lt;p&gt;We can (and should!) &lt;a href=&#34;https://evalf20.classes.andrewheiss.com/example/rdd/#parametric-estimation&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;do all the other things that we talked about in the regression discontinuity example&lt;/a&gt;, like modifying the bandwidth, adding polynomial terms, and so forth to see how robust the finding is. But we won&amp;rsquo;t do any of that here.&lt;/p&gt;
&lt;h3 id=&#34;fuzzy-nonparametric-estimation&#34;&gt;Fuzzy nonparametric estimation&lt;/h3&gt;
&lt;p&gt;We can also use nonparametric methods to measure the size of the fuzzy gap at the cutoff. We&amp;rsquo;ll use &lt;code&gt;rdrobust()&lt;/code&gt; just like we &lt;a href=&#34;https://evalf20.classes.andrewheiss.com/example/rdd/#nonparametric-estimation-1&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;did in the sharp example&lt;/a&gt;. The only difference is that we have to add one extra argument. That&amp;rsquo;s it!&lt;/p&gt;
&lt;p&gt;To do fuzzy estimation with &lt;code&gt;rdrobust()&lt;/code&gt;, use the &lt;code&gt;fuzzy&lt;/code&gt; argument to specify the treatment column (or &lt;code&gt;tutoring&lt;/code&gt; in our case). &lt;strong&gt;Importantly&lt;/strong&gt; (and confusingly! this took me waaaaay too long to figure out!), you &lt;em&gt;&lt;strong&gt;do not&lt;/strong&gt;&lt;/em&gt; need to specify an instrument (or even create one!). All you need to specify is the column that indicates treatment status—&lt;code&gt;rdrobust()&lt;/code&gt; will do all the above/below-the-cutoff instrument stuff behind the scenes for you.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;rdrobust&lt;/span&gt;(y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tutoring&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;exit_exam, x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tutoring&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;entrance_exam,
         c &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;, fuzzy &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tutoring&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;tutoring) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;summary&lt;/span&gt;()
&lt;span style=&#34;color:#75715e&#34;&gt;## Call: rdrobust&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Number of Obs.                 1000&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## BW type                       mserd&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Kernel                   Triangular&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## VCE method                       NN&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Number of Obs.                 238         762&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Eff. Number of Obs.            170         347&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Order est. (p)                   1           1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Order bias  (q)                  2           2&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## BW est. (h)                 12.985      12.985&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## BW bias (b)                 19.733      19.733&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## rho (h/b)                    0.658       0.658&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Unique Obs.                    238         762&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## =============================================================================&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##         Method     Coef. Std. Err.         z     P&amp;gt;|z|      [ 95% C.I. ]       &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## =============================================================================&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   Conventional     9.683     1.893     5.116     0.000     [5.973 , 13.393]    &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##         Robust         -         -     4.258     0.000     [5.210 , 14.095]    &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## =============================================================================&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;That&amp;rsquo;s all! Using nonparametric methods, with a triangular kernel and a bandwidth of ±12.96, the causal effect of the tutoring program for compliers in the bandwidth is 9.683.&lt;/p&gt;
&lt;p&gt;We can (and should!) &lt;a href=&#34;https://evalf20.classes.andrewheiss.com/example/rdd/#nonparametric-estimation&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;do all the other nonparametric robustness checks that we talked about in the regression discontinuity example&lt;/a&gt;, like modifying the bandwidth (ideal, half, double) and messing with the kernel (uniform, triangular, Epanechnikov) to see how robust the finding is. But again, we won&amp;rsquo;t do any of that here.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Complier average treatment effects</title>
      <link>/example/cace/</link>
      <pubDate>Wed, 28 Oct 2020 00:00:00 +0000</pubDate>
      <guid>/example/cace/</guid>
      <description>&lt;h2 id=&#34;compliance-and-treatment-effects&#34;&gt;Compliance and treatment effects&lt;/h2&gt;
&lt;p&gt;Throughout this course, we&amp;rsquo;ve talked about the difference between the average treatment effect (ATE), or the average effect of a program for &lt;em&gt;an entire population&lt;/em&gt;, and conditional average treatment effect (CATE), or the average effect of a program for some segment of the population. There are all sorts of CATEs: you can find the CATE for men vs. women, for people who are treated with the program (the average treatment on the treated, or ATT or TOT), for people who are not treated with the program (the average treatment on the untreated, or ATU), and so on.&lt;/p&gt;
&lt;p&gt;One important type of CATE is the effect of a program on just those who &lt;em&gt;comply&lt;/em&gt; with the program. We can call this the complier average treatment effect, but the acronym would be the same as conditional average treatment effect, so we&amp;rsquo;ll call it the &lt;strong&gt;complier average causal effect&lt;/strong&gt; or CACE.&lt;/p&gt;
&lt;p&gt;Thinking about compliance is important. You might randomly assign people to receive treatment or a program, but people might not do what you tell them. Additionally, people might do the program if assigned to do it, but they would have done it anyway. We can split the population into four types of people:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Compliers&lt;/strong&gt;: People who follow whatever their assignment is (if assigned to treatment, they do the program; if assigned to control, they don&amp;rsquo;t)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Always takers&lt;/strong&gt;: People who will receive or seek out the program regardless of assignment (if assigned to treatment, they do the program; if assigned to control, they still do the program)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Never takers&lt;/strong&gt;: People who will not receive or seek out the program regardless of assignment (if assigned to treatment, they don&amp;rsquo;t do the program; if assigned to control, they also don&amp;rsquo;t do it)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Defiers&lt;/strong&gt;: People who will do the opposite of whatever their assignment is (if assigned to treatment, they don&amp;rsquo;t do the program; if assigned to control, they do the program)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;To simplify things, evaluators and econometricians assume that defiers don&amp;rsquo;t exist based on the idea of &lt;em&gt;monotonicity&lt;/em&gt;, which means that we can assume that the effect of being assigned to treatment only increases the likelihood of participating in the program (and doesn&amp;rsquo;t make it more likely).&lt;/p&gt;
&lt;p&gt;The tricky part about trying to find who the compliers are in a sample is that we can&amp;rsquo;t know what people would have done in the absence of treatment. If we see that someone in the experiment was assigned to be in the treatment group and they then participated in the program, they could be a complier (since they did what they were assigned to do), or they could be an always taker (they did what they were assigned to do, but they would have done it anyway). Due to the fundamental problem of causal inference, we cannot know what each person would have done in a parallel world.&lt;/p&gt;
&lt;p&gt;We can use data from a hypothetical program to see how these three types of compliers distort our outcomes, and more importantly, how we can disentangle compliers from their always- and never-taker counterparts.&lt;/p&gt;
&lt;p&gt;If you want to follow along with this example, you can download these two datasets:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/data/bed_nets_time_machine.csv&#34;&gt;&lt;i class=&#34;fas fa-table&#34;&gt;&lt;/i&gt; &lt;code&gt;bed_nets_time_machine.csv&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/data/bed_nets_observed.csv&#34;&gt;&lt;i class=&#34;fas fa-table&#34;&gt;&lt;/i&gt; &lt;code&gt;bed_nets_observed.csv&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;finding-compliers-with-a-mind-reading-time-machine&#34;&gt;Finding compliers with a mind-reading time machine&lt;/h2&gt;
&lt;p&gt;First let&amp;rsquo;s load the data and reorder some of the categories:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(tidyverse)  &lt;span style=&#34;color:#75715e&#34;&gt;# ggplot(), %&amp;gt;%, mutate(), and friends&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(broom)  &lt;span style=&#34;color:#75715e&#34;&gt;# Convert models to data frames&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(estimatr)  &lt;span style=&#34;color:#75715e&#34;&gt;# Run 2SLS models in one step with iv_robust()&lt;/span&gt;

bed_nets &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;read_csv&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;data/bed_nets_observed.csv&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Make &amp;#34;No bed net&amp;#34; (control) come first&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(bed_net &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;fct_relevel&lt;/span&gt;(bed_net, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;No bed net&amp;#34;&lt;/span&gt;))

bed_nets_time_machine &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;read_csv&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;data/bed_nets_time_machine.csv&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Make &amp;#34;No bed net&amp;#34; come first and &amp;#34;Complier&amp;#34; come first&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(bed_net &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;fct_relevel&lt;/span&gt;(bed_net, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;No bed net&amp;#34;&lt;/span&gt;),
         status &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;fct_relevel&lt;/span&gt;(status, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Complier&amp;#34;&lt;/span&gt;))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This is what we would be able to see if we could read everyone&amp;rsquo;s minds. There are always takers who will use a bed net regardless of the program, and they&amp;rsquo;ll have higher health outcomes. However, those better outcomes are because of something endogenous—there&amp;rsquo;s something else that makes these people always pursue bed nets, and that&amp;rsquo;s likely related to health. We probably want to not consider them when looking for the program effect. There are never takers who won&amp;rsquo;t ever use a bed net, and they have worse health outcomes. Again, there&amp;rsquo;s endogeneity here—something is causing them to not use the bed nets, and it likely also causes their health level. We don&amp;rsquo;t want to look at them either.&lt;/p&gt;
&lt;p&gt;The first group—the compliers—are the people we want to focus on. Here we see that the program had an effect when compared to a control group.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)  &lt;span style=&#34;color:#75715e&#34;&gt;# Make the jittering the same every time&lt;/span&gt;

&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(bed_nets_time_machine, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; health, x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; treatment)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_point&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(shape &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; bed_net, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; status),
             position &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;position_jitter&lt;/span&gt;(height &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;NULL&lt;/span&gt;, width &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.25&lt;/span&gt;)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;facet_wrap&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;vars&lt;/span&gt;(status)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;labs&lt;/span&gt;(color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Type of person&amp;#34;&lt;/span&gt;, shape &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Compliance&amp;#34;&lt;/span&gt;,
       x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;NULL&lt;/span&gt;, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Health status&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;scale_color_viridis_d&lt;/span&gt;(option &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;plasma&amp;#34;&lt;/span&gt;, end &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.85&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;theme_bw&lt;/span&gt;()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/cace_files/figure-html/mind-reading-groups-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;h2 id=&#34;finding-compliers-in-actual-data&#34;&gt;Finding compliers in actual data&lt;/h2&gt;
&lt;p&gt;This is what we actually see in the data, though. You can tell who some of the always takers are (those who used bed nets after being assigned to the control group) and who some of the never takers are (those who did not use a bed net after being assigned to the treatment group), but compliers are mixed up with the always and never takers. We have to somehow disentangle them!&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)
&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(bed_nets_time_machine, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; health, x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; bed_net)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_point&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(shape &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; bed_net, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; status),
             position &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;position_jitter&lt;/span&gt;(height &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;NULL&lt;/span&gt;, width &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.25&lt;/span&gt;)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;facet_wrap&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;vars&lt;/span&gt;(treatment)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;labs&lt;/span&gt;(color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Type of person&amp;#34;&lt;/span&gt;, shape &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Compliance&amp;#34;&lt;/span&gt;,
       x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;NULL&lt;/span&gt;, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Health status&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;scale_color_viridis_d&lt;/span&gt;(option &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;plasma&amp;#34;&lt;/span&gt;, end &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.85&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;theme_bw&lt;/span&gt;()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/cace_files/figure-html/compliers-actual-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;We can do this by assuming the proportion of compliers, never takers, and always takers are equally spread across treatment and control (which we can assume through the magic of randomization). If that&amp;rsquo;s the case, we can calculate the intent to treat (ITT) effect, which is the CATE of being assigned treatment (or the effect of being assigned treatment on health status, regardless of actual compliance).&lt;/p&gt;
&lt;p&gt;The ITT is actually composed of three different causal effects: the complier average causal effect (CACE), the always taker average causal effect (ATACE), and the never taker average causal effect (NTACE). In the formula below, &lt;code&gt;\(\pi\)&lt;/code&gt; stands for the proportion of people in each group. Formally, the ITT can be defined like this:&lt;/p&gt;
&lt;p&gt;$$
&lt;code&gt;\begin{aligned} \text{ITT}\ =\ &amp;amp; \color{#0D0887}{\pi_\text{compliers} \times (\text{T} - \text{C})_\text{compliers}} + \\ &amp;amp;\color{#B7318A}{\pi_\text{always takers} \times (\text{T} - \text{C})_\text{always takers}} + \\ &amp;amp;\color{#FEBA2C}{\pi_\text{never takers} \times (\text{T} - \text{C})_\text{never takers}} \end{aligned}&lt;/code&gt;
$$&lt;/p&gt;
&lt;p&gt;We can simplify this to this acronymized version:&lt;/p&gt;
&lt;p&gt;$$
\text{ITT}\ =\ \color{#0D0887}{\pi_\text{C} \text{CACE}} + \color{#B7318A}{\pi_\text{A} \text{ATACE}} + \color{#FEBA2C}{\pi_\text{N} \text{NTACE}}
$$&lt;/p&gt;
&lt;p&gt;The number we care about the most here is the CACE, which is stuck in the middle of the equation. But we can rescue it with some fun logical and algebraic trickery!&lt;/p&gt;
&lt;p&gt;If we assume that assignment to treatment doesn&amp;rsquo;t make someone more likely to be an always taker or a never taker, we can set the ATACE and NTACE to zero, leaving us with just three variables to worry about: ITT, &lt;code&gt;\(\pi_\text{c}\)&lt;/code&gt;, and CACE:&lt;/p&gt;
&lt;p&gt;$$
&lt;code&gt;\begin{aligned} \text{ITT}\ =\ &amp;amp; \color{#0D0887}{\pi_\text{C} \text{CACE}} + \color{#B7318A}{\pi_\text{A} \text{ATACE}} + \color{#FEBA2C}{\pi_\text{N} \text{NTACE}} \\[6pt] =\ &amp;amp; \color{#0D0887}{\pi_\text{C} \text{CACE}} + \color{#B7318A}{\pi_\text{A} \times 0} + \color{#FEBA2C}{\pi_\text{N} \times 0}\\[6pt] \text{ITT}\ =\ &amp;amp; \color{#0D0887}{\pi_\text{C} \text{CACE}} \end{aligned}&lt;/code&gt;
$$&lt;/p&gt;
&lt;p&gt;We can use algebra to rearrange this formula so that we&amp;rsquo;re left with an equation that starts with CACE (since that&amp;rsquo;s the value we care about):&lt;/p&gt;
&lt;p&gt;$$
\text{CACE} = \frac{\text{ITT}}{\pi_\text{C}}
$$&lt;/p&gt;
&lt;p&gt;If we can find the ITT and the proportion of compliers, we can find the complier average causal effect (CACE). Fortunately, both those pieces—ITT and &lt;code&gt;\(\pi_\text{C}\)&lt;/code&gt;—are findable in the data we have!&lt;/p&gt;
&lt;h2 id=&#34;finding-the-itt&#34;&gt;Finding the ITT&lt;/h2&gt;
&lt;p&gt;The ITT is easy to find with a simple OLS model:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;itt_model &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(health &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; treatment, data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; bed_nets)

&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(itt_model)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 2 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term               estimate std.error statistic  p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;                 &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)           40.9      0.444     92.1  0.      &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 treatmentTreatment     5.99     0.630      9.51 5.36e-21&lt;/span&gt;

ITT &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(itt_model) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(term &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;treatmentTreatment&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;pull&lt;/span&gt;(estimate)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The ITT here is ≈6—being assigned treatment increases average health status by 5.99 health points.&lt;/p&gt;
&lt;h2 id=&#34;finding-the-proportion-of-compliers&#34;&gt;Finding the proportion of compliers&lt;/h2&gt;
&lt;p&gt;The proportion of compliers is a little trickier, but doable with some algebraic trickery. Recall from the graph above that the people who were in the treatment group and who complied are a combination of always takers and compliers. This means we can say:&lt;/p&gt;
&lt;p&gt;$$
&lt;code&gt;\begin{aligned} \pi_\text{A} + \pi_\text{C} =&amp;amp; \text{% yes in treatment; or} \\ \pi_\text{C} =&amp;amp; \text{% yes in treatment} - \pi_\text{A} \end{aligned}&lt;/code&gt;
$$&lt;/p&gt;
&lt;p&gt;We actually know &lt;code&gt;\(\pi_\text{A}\)&lt;/code&gt;—remember in the graph above that the people who were in the control group and who used bed nets are guaranteed to be always takers (none of them are compliers or never takers). If we assume that the proportion of always takers is the same in both treatment and control, we can use that percent here, giving us this final equation for &lt;code&gt;\(\pi_\text{C}\)&lt;/code&gt;:&lt;/p&gt;
&lt;p&gt;$$
&lt;code&gt;\begin{aligned} \pi_\text{C} =&amp;amp; \text{% yes in treatment} - \pi_\text{A} \\ =&amp;amp; \text{% yes in treatment} - \text{% yes in control} \end{aligned}&lt;/code&gt;
$$&lt;/p&gt;
&lt;p&gt;So, if we can find the percent of people assigned to treatment who used bed nets, find the percent of people assigned to control and used bed nets, and subtract the two percentages, we&amp;rsquo;ll have the proportion of compliers, or &lt;code&gt;\(\pi_\text{C}\)&lt;/code&gt;. We can do that with the data we have (61% - 19.5% = 41.5% compliers):&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;bed_nets &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;group_by&lt;/span&gt;(treatment, bed_net) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;summarize&lt;/span&gt;(n &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;n&lt;/span&gt;()) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(prop &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; n &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sum&lt;/span&gt;(n))
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 4 x 4&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## # Groups:   treatment [2]&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   treatment bed_net        n  prop&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;     &amp;lt;fct&amp;gt;      &amp;lt;int&amp;gt; &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 Control   No bed net   808 0.805&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 Control   Bed net      196 0.195&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 Treatment No bed net   388 0.390&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4 Treatment Bed net      608 0.610&lt;/span&gt;

&lt;span style=&#34;color:#75715e&#34;&gt;# pi_c = prop yes in treatment - prop yes in control&lt;/span&gt;
pi_c &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.6104418&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.1952191&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Finally, now that we know both the ITT and &lt;code&gt;\(\pi_\text{C}\)&lt;/code&gt;, we can find the CACE (or the LATE):&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;CACE &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; ITT &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; pi_c
CACE
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] 14.42&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;It&amp;rsquo;s 14.4, which means that using bed nets increased health by 14 health points &lt;em&gt;for compliers&lt;/em&gt; (which is a lot bigger than the 6 that we found before). We successfully filtered out the always takers and the never takers, and we have our complier-specific causal effect.&lt;/p&gt;
&lt;h2 id=&#34;finding-the-cacelate-with-iv2sls&#34;&gt;Finding the CACE/LATE with IV/2SLS&lt;/h2&gt;
&lt;p&gt;Doing that is super tedious though! What if there was an easier way to find the effect of the bed net program for just the compliers? We can do this with IV/2SLS regression by using assignment to treatment as an instrument.&lt;/p&gt;
&lt;p&gt;Assignment to treatment works as an instrument because it&amp;rsquo;s (1) relevant, since being told to use bed nets is probably highly correlated with using bed nets, (2) exclusive, since the only way that being told to use bed nets can cause changes in health is through the actual use of the bed nets, and (3) exogenous, since being told to use bed nets probably isn&amp;rsquo;t related to other things that cause health.&lt;/p&gt;
&lt;p&gt;Here&amp;rsquo;s a 2SLS regression with assignment to treatment as the instrument:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_2sls &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;iv_robust&lt;/span&gt;(health &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; bed_net &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; treatment, data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; bed_nets)
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_2sls)
&lt;span style=&#34;color:#75715e&#34;&gt;##             term estimate std.error statistic   p.value conf.low conf.high   df outcome&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1    (Intercept)    38.12    0.5151     74.01 0.000e+00    37.11     39.13 1998  health&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 bed_netBed net    14.42    1.2538     11.50 1.087e-29    11.96     16.88 1998  health&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The coefficient for &lt;code&gt;bed_net&lt;/code&gt; is identical to the CACE that we found manually! Instrumental variables are helpful for isolated program effects to only compliers when you&amp;rsquo;re dealing with noncompliance.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Regression discontinuity</title>
      <link>/example/rdd/</link>
      <pubDate>Tue, 20 Oct 2020 00:00:00 +0000</pubDate>
      <guid>/example/rdd/</guid>
      <description>&lt;script src=&#34;/rmarkdown-libs/kePrint/kePrint.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;/rmarkdown-libs/lightable/lightable.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;h2 id=&#34;video-walk-through&#34;&gt;Video walk-through&lt;/h2&gt;
&lt;p&gt;If you want to follow along with this example, you can download the data below:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/data/tutoring_program.csv&#34;&gt;&lt;i class=&#34;fas fa-table&#34;&gt;&lt;/i&gt; &lt;code&gt;tutoring_program.csv&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;warning&#34;&gt;
&lt;strong&gt;Important&lt;/strong&gt;: The results will be slightly different here than they were in the video. That&amp;rsquo;s because in the data I used in the video, I didn&amp;rsquo;t round any values, so people could score a 71.8392403 on the entrance exam, which is kind of an excessive number of decimals. In this data, I rounded everything to one decimal point (e.g. 71.8), so the gaps and lines will be a tiny bit different here.
&lt;/div&gt;

&lt;p&gt;There&amp;rsquo;s a set of videos that walks through each section below. To make it easier for you to jump around the video examples, I cut the long video into smaller pieces and included them all in &lt;a href=&#34;https://www.youtube.com/playlist?list=PLS6tnpTr39sFCr8amjT2Ld_FE34i26a3S&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;one YouTube playlist&lt;/a&gt;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=8CayGMcJoLY&amp;amp;list=PLS6tnpTr39sFCr8amjT2Ld_FE34i26a3S&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Getting started&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=ViDChprm2IY&amp;amp;list=PLS6tnpTr39sFCr8amjT2Ld_FE34i26a3S&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Sharp or fuzzy?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=hqPVIt-72fY&amp;amp;list=PLS6tnpTr39sFCr8amjT2Ld_FE34i26a3S&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Checking for manipulation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=yYqO22l_jgc&amp;amp;list=PLS6tnpTr39sFCr8amjT2Ld_FE34i26a3S&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Finding discontinuity in outcome&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=Por8Rd9QuBk&amp;amp;list=PLS6tnpTr39sFCr8amjT2Ld_FE34i26a3S&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Measuring the gap parametrically&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=lfBkAZLX_Z4&amp;amp;list=PLS6tnpTr39sFCr8amjT2Ld_FE34i26a3S&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Measuring the gap nonparametrically&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;You can also watch the playlist (and skip around to different sections) here:&lt;/p&gt;
&lt;div class=&#34;embed-responsive embed-responsive-16by9&#34;&gt;
&lt;iframe class=&#34;embed-responsive-item&#34; src=&#34;https://www.youtube.com/embed/playlist?list=PLS6tnpTr39sFCr8amjT2Ld_FE34i26a3S&#34; frameborder=&#34;0&#34; allow=&#34;accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture&#34; allowfullscreen&gt;&lt;/iframe&gt;
&lt;/div&gt;
&lt;h2 id=&#34;program-background&#34;&gt;Program background&lt;/h2&gt;
&lt;p&gt;In this hypothetical example, students take an entrance exam at the beginning of a school year. Those who score 70 or below are automatically enrolled in a free tutoring program and receive assistance throughout the year. At the end of the school year, students take a final test, or exit exam (with a maximum of 100 points) to measure how much they learned overall. Remember, this is a hypothetical example and tests like this don&amp;rsquo;t really exist, but just go with it.&lt;/p&gt;
&lt;p&gt;You have a dataset with four columns in it:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;id&lt;/code&gt;: The ID of the student&lt;/li&gt;
&lt;li&gt;&lt;code&gt;entrance_exam&lt;/code&gt;: The student&amp;rsquo;s entrance exam score (out of 100)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;exit_exam&lt;/code&gt;: The student&amp;rsquo;s exit exam score (out of 100)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;tutoring&lt;/code&gt;: An indicator variable showing if the student was enrolled in the tutoring program&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;load-and-clean-data&#34;&gt;Load and clean data&lt;/h2&gt;
&lt;p&gt;First, let&amp;rsquo;s download the dataset (if you haven&amp;rsquo;t already), put in a folder named &lt;code&gt;data&lt;/code&gt;, and load it:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/data/tutoring_program.csv&#34;&gt;&lt;i class=&#34;fas fa-table&#34;&gt;&lt;/i&gt; &lt;code&gt;tutoring_program.csv&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(tidyverse)  &lt;span style=&#34;color:#75715e&#34;&gt;# ggplot(), %&amp;gt;%, mutate(), and friends&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(broom)  &lt;span style=&#34;color:#75715e&#34;&gt;# Convert models to data frames&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(rdrobust)  &lt;span style=&#34;color:#75715e&#34;&gt;# For robust nonparametric regression discontinuity&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(rddensity)  &lt;span style=&#34;color:#75715e&#34;&gt;# For nonparametric regression discontinuity density tests&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(modelsummary)  &lt;span style=&#34;color:#75715e&#34;&gt;# Create side-by-side regression tables&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Load the data.&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# It&amp;#39;d be a good idea to click on the &amp;#34;tutoring&amp;#34; object in the Environment&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# panel in RStudio to see what the data looks like after you load it&lt;/span&gt;
tutoring &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;read_csv&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;data/tutoring_program.csv&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;step-1-determine-if-process-of-assigning-treatment-is-rule-based&#34;&gt;Step 1: Determine if process of assigning treatment is rule-based&lt;/h2&gt;
&lt;p&gt;In order to join the tutoring program, students have to score 70 points or lower on the entrance exam. Students who score higher than 70 are not eligible for the program. Since we have a clear 70-point rule, we can assume that the process of participating in the tutoring program is rule-based.&lt;/p&gt;
&lt;h2 id=&#34;step-2-determine-if-the-design-is-fuzzy-or-sharp&#34;&gt;Step 2: Determine if the design is fuzzy or sharp&lt;/h2&gt;
&lt;p&gt;Since we know that the program was applied based on a rule, we next want to figure out how strictly the rule was applied. The threshold was 70 points on the test—did people who scored 68 slip through bureaucratic cracks and not participate, or did people who scored 73 sneak into the program? The easiest way to check this is with a graph, and we can get exact numbers with a table.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(tutoring, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; entrance_exam, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tutoring, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tutoring)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Make points small and semi-transparent since there are lots of them&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_point&lt;/span&gt;(size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt;, alpha &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt;,
             position &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;position_jitter&lt;/span&gt;(width &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, height &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.25&lt;/span&gt;, seed &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Add vertical line&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_vline&lt;/span&gt;(xintercept &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Add labels&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;labs&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Entrance exam score&amp;#34;&lt;/span&gt;, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Participated in tutoring program&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Turn off the color legend, since it&amp;#39;s redundant&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;guides&lt;/span&gt;(color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/rdd_files/figure-html/check-fuzzy-sharp-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;This looks pretty sharp—it doesn&amp;rsquo;t look like people who scored under 70 participated in the program. We can verify this with a table. There are no people where &lt;code&gt;entrance_exam&lt;/code&gt; is greater than 70 and &lt;code&gt;tutoring&lt;/code&gt; is false, and no people where &lt;code&gt;entrance_exam&lt;/code&gt; is less than 70 and &lt;code&gt;tutoring&lt;/code&gt; is true.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;tutoring &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;group_by&lt;/span&gt;(tutoring, entrance_exam &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;summarize&lt;/span&gt;(count &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;n&lt;/span&gt;())
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 2 x 3&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## # Groups:   tutoring [2]&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   tutoring `entrance_exam &amp;lt;= 70` count&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;lgl&amp;gt;    &amp;lt;lgl&amp;gt;                 &amp;lt;int&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 FALSE    FALSE                   759&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 TRUE     TRUE                    241&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This is thus a sharp design.&lt;/p&gt;
&lt;h2 id=&#34;step-3-check-for-discontinuity-in-running-variable-around-cutpoint&#34;&gt;Step 3: Check for discontinuity in running variable around cutpoint&lt;/h2&gt;
&lt;p&gt;Next we need to see if there was any manipulation in the running variable—maybe lots of people bunched up around 70 because of how the test was graded (i.e. students wanted to get into the program, so they purposely did poorly on the exam to get under 70). We can do this a couple different ways. First, we&amp;rsquo;ll make a histogram of the running variable (test scores) and see if there are any big jumps around the threshold:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(tutoring, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; entrance_exam, fill &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tutoring)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_histogram&lt;/span&gt;(binwidth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;, boundary &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_vline&lt;/span&gt;(xintercept &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;labs&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Entrance exam score&amp;#34;&lt;/span&gt;, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Count&amp;#34;&lt;/span&gt;, fill &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;In program&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/rdd_files/figure-html/check-running-discontinuity-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Here it doesn&amp;rsquo;t look like there&amp;rsquo;s a jump around the cutoff—there&amp;rsquo;s a tiny visible difference between the height of the bars right before and right after the 70-point threshold, but it seems to follow the general shape of the overall distribution. We can check to see if that jump is statistically significant with a McCrary density test (explained in &lt;a href=&#34;https://mixtape.scunning.com/ch5.html#mccrarys-density-test&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;section 6.3.1 of &lt;em&gt;Causal Inference: The Mixtape&lt;/em&gt;&lt;/a&gt;). This puts data into bins like a histogram, and then plots the averages and confidence intervals of those bins. If the confidence intervals of the density lines don&amp;rsquo;t overlap, then there&amp;rsquo;s likely something systematically wrong with how the test was scored (i.e. too many people getting 69 vs 71). If the confidence intervals overlap, there&amp;rsquo;s not any significant difference around the threshold and we&amp;rsquo;re fine.&lt;/p&gt;
&lt;p&gt;First we use &lt;code&gt;rddensity()&lt;/code&gt; to do the actual statistical test. You need to feed it two things: the running variable and the cutoff.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Notice this tutoring$entrance_exam syntax. This is one way for R to access&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# columns in data frames---it means &amp;#34;use the entrance_exam column in the&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# tutoring data frame&amp;#34;. The general syntax for it is data_frame$column_name&lt;/span&gt;
test_density &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rddensity&lt;/span&gt;(tutoring&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;entrance_exam, c &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;)
&lt;span style=&#34;color:#a6e22e&#34;&gt;summary&lt;/span&gt;(test_density)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;## Manipulation testing using local polynomial density estimation.
## 
## Number of obs =       1000
## Model =               unrestricted
## Kernel =              triangular
## BW method =           estimated
## VCE method =          jackknife
## 
## c = 70                Left of c           Right of c          
## Number of obs         237                 763                 
## Eff. Number of obs    208                 577                 
## Order est. (p)        2                   2                   
## Order bias (q)        3                   3                   
## BW est. (h)           22.444              19.966              
## 
## Method                T                   P &amp;gt; |T|             
## Robust                -0.5521             0.5809
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We can then plot that density test:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# The syntax for rdplotdensity is kinda wonky here. You have to feed it the&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# rddensity() test, and then you have to specify x, which is your running&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# variable (again!). The type argument tells the plot to show both points and&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# lines---without it, it&amp;#39;ll only show lines.&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# Finally, notice how I assigned the output of rdplotdensity to a variable named&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# plot_density_test. In theory, this should make it show nothing---all the&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# output should go to that object. Because of a bug in rdplotdensity, though, it&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# will show a plot automatically even if assigning it to a variable. If we don&amp;#39;t&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# assign it to a variable you&amp;#39;ll see two identical plots when knitting, which is&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# annoying. So we save it as a variable to hide the output, but get the output&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# for a single plot anyway. Ugh.&lt;/span&gt;
plot_density_test &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rdplotdensity&lt;/span&gt;(rdd &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; test_density,
                                   X &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tutoring&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;entrance_exam,
                                   type &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;both&amp;#34;&lt;/span&gt;)  &lt;span style=&#34;color:#75715e&#34;&gt;# This adds both points and lines&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/rdd_files/figure-html/plot-running-discontinuity-mcrary-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;There&amp;rsquo;s a lot of output here, but what we care about is the line that starts with &amp;ldquo;Robust&amp;rdquo;, which shows the t-test for the difference in the two points on either side of the cutpoint in the plot. Notice in the plot that the confidence intervals overlap substantially. The p-value for the size of that overlap is 0.5809, which is a lot larger than 0.05, so we don&amp;rsquo;t have good evidence that there&amp;rsquo;s a significant difference between the two lines. Based on this plot and the t-statistic, we&amp;rsquo;re probably safe in saying that there&amp;rsquo;s no manipulation or bunching.&lt;/p&gt;
&lt;h2 id=&#34;step-4-check-for-discontinuity-in-outcome-across-running-variable&#34;&gt;Step 4: Check for discontinuity in outcome across running variable&lt;/h2&gt;
&lt;p&gt;Now that we know this is a sharp design and that there&amp;rsquo;s no bunching of test scores around the 70-point threshold, we can finally see if there&amp;rsquo;s a discontinuity in final scores based on participation in the tutoring program. Plot the running variable on the x-axis, the outcome variable on the y-axis, and color the points by whether they participated in the program.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(tutoring, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; entrance_exam, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; exit_exam, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tutoring)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_point&lt;/span&gt;(size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt;, alpha &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Add a line based on a linear model for the people scoring 70 or less&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_smooth&lt;/span&gt;(data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(tutoring, entrance_exam &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;), method &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lm&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Add a line based on a linear model for the people scoring more than 70&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_smooth&lt;/span&gt;(data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(tutoring, entrance_exam &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;), method &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lm&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_vline&lt;/span&gt;(xintercept &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;labs&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Entrance exam score&amp;#34;&lt;/span&gt;, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Exit exam score&amp;#34;&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Used tutoring&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/rdd_files/figure-html/check-outcome-discontinuity-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Based on this graph, there&amp;rsquo;s a clear discontinuity! It looks like participation in the tutoring program boosted final test scores.&lt;/p&gt;
&lt;h2 id=&#34;step-5-measure-the-size-of-the-effect&#34;&gt;Step 5: Measure the size of the effect&lt;/h2&gt;
&lt;p&gt;There&amp;rsquo;s a discontinuity, but how big is it? And is it statistically significant?&lt;/p&gt;
&lt;p&gt;We can check the size two different ways: parametrically (i.e. using &lt;code&gt;lm()&lt;/code&gt; with specific parameters and coefficients), and nonparametrically (i.e. not using &lt;code&gt;lm()&lt;/code&gt; or any kind of straight line and instead drawing lines that fit the data more precisely). We&amp;rsquo;ll do it both ways.&lt;/p&gt;
&lt;h3 id=&#34;parametric-estimation&#34;&gt;Parametric estimation&lt;/h3&gt;
&lt;p&gt;First we&amp;rsquo;ll do it parametrically by using linear regression. Here we want to explain the variation in final scores based on the entrance exam score and participation in the tutoring program:&lt;/p&gt;
&lt;p&gt;$$
\text{Exit exam} = \beta_0 + \beta_1 \text{Entrance exam score}_\text{centered} + \beta_2 \text{Tutoring program} + \epsilon
$$&lt;/p&gt;
&lt;p&gt;To make it easier to interpret coefficients, we can center the entrance exam column so that instead of showing the actual test score, it shows how many points above or below 70 the student scored. That way we can use the coefficient for &lt;code&gt;tutoring&lt;/code&gt; for the causal effect.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;tutoring_centered &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; tutoring &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(entrance_centered &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; entrance_exam &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;)

model_simple &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(exit_exam &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; entrance_centered &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; tutoring,
                   data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tutoring_centered)
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_simple)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 3 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term              estimate std.error statistic  p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;                &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)         59.4      0.442      134.  0.      &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 entrance_centered    0.510    0.0269      18.9 1.40e-68&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 tutoringTRUE        10.8      0.800       13.5 3.12e-38&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Here&amp;rsquo;s what these coefficients mean:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;\(\beta_0\)&lt;/code&gt;: This is the intercept. Because we centered entrance exam scores, it shows the average exit exam score at the 70-point threshold. People who scored 70.001 points on the entrance exam score an average of 59.4 points on the exit exam. (Another way to think about this is that it shows the predicted exit exam score when &lt;code&gt;entrance_centered&lt;/code&gt; is 0 (i.e. 70) and when &lt;code&gt;tutoring&lt;/code&gt; is &lt;code&gt;FALSE&lt;/code&gt;.)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;\(\beta_1\)&lt;/code&gt;: This is the coefficient for &lt;code&gt;entrance_centered&lt;/code&gt;. For every point above 70 that people score on the entrance exam, they score 0.51 points higher on the exit exam. We don&amp;rsquo;t really care that much about this number.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;\(\beta_2\)&lt;/code&gt;: This is the coefficient for the tutoring program, and &lt;em&gt;this is the one we care about the most&lt;/em&gt;. This is the shift in intercept when &lt;code&gt;tutoring&lt;/code&gt; is true, or the difference between scores at the threshold. Participating in the tutoring program increases exit exam scores by 10.8 points.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;One advantage to using a parametric approach is that you can include other covariates like demographics. You can also use polynomial regression and include terms like &lt;code&gt;entrance_centered²&lt;/code&gt; or &lt;code&gt;entrance_centered³&lt;/code&gt; or even &lt;code&gt;entrance_centered⁴&lt;/code&gt; to make the line fit the data as close as possible.&lt;/p&gt;
&lt;p&gt;Here we fit the model to the entire data, but in real life, we care most about the observations right around the threshold, which means this model is actually &lt;em&gt;&lt;strong&gt;wrong&lt;/strong&gt;&lt;/em&gt;. Scores that are super high or super low shouldn&amp;rsquo;t really influence our effect size, since we only care about the people who score just barely under and just barely over 70.&lt;/p&gt;
&lt;p&gt;We can fit the same model but restrict it to people within a smaller window, or bandwidth, like ±10 points, or ±5 points:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_bw_10 &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(exit_exam &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; entrance_centered &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; tutoring,
                  data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(tutoring_centered,
                                entrance_centered &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;-10&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;
                                  entrance_centered &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;))
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_bw_10)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 3 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term              estimate std.error statistic   p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;                &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)         60.4       0.752     80.3  2.99e-249&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 entrance_centered    0.388     0.114      3.40 7.45e-  4&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 tutoringTRUE         9.27      1.31       7.09 6.27e- 12&lt;/span&gt;

model_bw_5 &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(exit_exam &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; entrance_centered &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; tutoring,
                  data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(tutoring_centered,
                                entrance_centered &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;-5&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;
                                  entrance_centered &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;))
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_bw_5)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 3 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term              estimate std.error statistic   p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;                &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)         60.6       1.12      54.3  4.78e-118&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 entrance_centered    0.380     0.331      1.15 2.53e-  1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 tutoringTRUE         9.12      1.91       4.77 3.66e-  6&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We can compare all these models simultaneously with &lt;code&gt;modelsummary()&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;modelsummary&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Full data&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; model_simple,
                  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Bandwidth = 10&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; model_bw_10,
                  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Bandwidth = 5&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; model_bw_5))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table class=&#34;table&#34; style=&#34;width: auto !important; margin-left: auto; margin-right: auto;&#34;&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt;   &lt;/th&gt;
   &lt;th style=&#34;text-align:center;&#34;&gt; Full data &lt;/th&gt;
   &lt;th style=&#34;text-align:center;&#34;&gt; Bandwidth = 10 &lt;/th&gt;
   &lt;th style=&#34;text-align:center;&#34;&gt; Bandwidth = 5 &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; (Intercept) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 59.411*** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 60.377*** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 60.631*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.442) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.752) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (1.117) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; entrance_centered &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.510*** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.388*** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.380 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.027) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.114) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.331) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;background-color: #F6D645 !important;&#34;&gt; tutoringTRUE &lt;/td&gt;
   &lt;td style=&#34;text-align:center;background-color: #F6D645 !important;&#34;&gt; 10.800*** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;background-color: #F6D645 !important;&#34;&gt; 9.273*** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;background-color: #F6D645 !important;&#34;&gt; 9.122*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;box-shadow: 0px 1pxborder-bottom: 1px solid&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;box-shadow: 0px 1pxborder-bottom: 1px solid&#34;&gt; (0.800) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;box-shadow: 0px 1pxborder-bottom: 1px solid&#34;&gt; (1.309) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;box-shadow: 0px 1pxborder-bottom: 1px solid&#34;&gt; (1.912) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Num.Obs. &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1000 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 404 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 194 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; R2 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.268 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.162 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.222 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; R2 Adj. &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.267 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.158 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.214 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; AIC &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 6595.3 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 2663.5 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1303.1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; BIC &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 6615.0 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 2679.5 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1316.2 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Log.Lik. &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; -3293.663 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; -1327.755 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; -647.567 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; F &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 182.971 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 38.891 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 27.310 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Deviance &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 42497.66 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 16925.61 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 9008.56 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; DF Resid &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 997 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 401 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 191 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Sigma &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 6.529 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 6.497 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 6.868 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Statistics &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 182.971 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 38.891 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 27.310 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; p &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.000 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.000 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; DF &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 2 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 2 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 2 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;
&lt;tr&gt;
&lt;td style=&#34;padding: 0; border:0;&#34; colspan=&#34;100%&#34;&gt;
&lt;sup&gt;&lt;/sup&gt; * p &amp;lt; 0.1, ** p &amp;lt; 0.05, *** p &amp;lt; 0.01&lt;/td&gt;
&lt;/tr&gt;
&lt;/tfoot&gt;
&lt;/table&gt;
&lt;p&gt;The effect of &lt;code&gt;tutoring&lt;/code&gt; differs a lot across these different models, from 9.1 to 10.8. Which one is right? I don&amp;rsquo;t know. Definitely not the full data one.&lt;/p&gt;
&lt;p&gt;Also notice how much the sample size (N) changes across the models. As you narrow the bandwidth, you look at fewer and fewer observations.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(tutoring, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; entrance_exam, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; exit_exam, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tutoring)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_point&lt;/span&gt;(size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt;, alpha &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.2&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Add lines for the full model (model_simple)&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_smooth&lt;/span&gt;(data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(tutoring, entrance_exam &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;),
              method &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lm&amp;#34;&lt;/span&gt;, se &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;, linetype &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;dotted&amp;#34;&lt;/span&gt;, size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_smooth&lt;/span&gt;(data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(tutoring, entrance_exam &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;),
              method &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lm&amp;#34;&lt;/span&gt;, se &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;, linetype &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;dotted&amp;#34;&lt;/span&gt;, size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Add lines for bandwidth = 10&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_smooth&lt;/span&gt;(data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(tutoring, entrance_exam &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;, entrance_exam &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;60&lt;/span&gt;),
              method &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lm&amp;#34;&lt;/span&gt;, se &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;, linetype &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;dashed&amp;#34;&lt;/span&gt;, size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_smooth&lt;/span&gt;(data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(tutoring, entrance_exam &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;, entrance_exam &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;80&lt;/span&gt;),
              method &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lm&amp;#34;&lt;/span&gt;, se &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;, linetype &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;dashed&amp;#34;&lt;/span&gt;, size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Add lines for bandwidth = 5&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_smooth&lt;/span&gt;(data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(tutoring, entrance_exam &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;, entrance_exam &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;65&lt;/span&gt;),
              method &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lm&amp;#34;&lt;/span&gt;, se &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;, size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_smooth&lt;/span&gt;(data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(tutoring, entrance_exam &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;, entrance_exam &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt;),
              method &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lm&amp;#34;&lt;/span&gt;, se &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;, size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_vline&lt;/span&gt;(xintercept &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Zoom in&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;coord_cartesian&lt;/span&gt;(xlim &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;50&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;90&lt;/span&gt;), ylim &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;55&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt;)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;labs&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Entrance exam score&amp;#34;&lt;/span&gt;, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Exit exam score&amp;#34;&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Used tutoring&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/rdd_files/figure-html/different-lm-bandwidths-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;h3 id=&#34;nonparametric-estimation&#34;&gt;Nonparametric estimation&lt;/h3&gt;
&lt;p&gt;Instead of using linear regression to measure the size of the discontinuity, we can use nonparametric methods. Essentially this means that R will not try to fit a straight line to the data—instead it&amp;rsquo;ll curve around the points and try to fit everything as smoothly as possible.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;rdrobust()&lt;/code&gt; function makes it really easy to measure the gap at the cutoff with nonparametric estimation. Here&amp;rsquo;s the simplest version:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Notice how we have to use the tutoring$exit_exam syntax here. Also make sure&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# you set the cutoff with c&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;rdrobust&lt;/span&gt;(y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tutoring&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;exit_exam, x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tutoring&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;entrance_exam, c &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;summary&lt;/span&gt;()
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] &amp;#34;Mass points detected in the running variable.&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Call: rdrobust&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Number of Obs.                 1000&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## BW type                       mserd&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Kernel                   Triangular&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## VCE method                       NN&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Number of Obs.                 237         763&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Eff. Number of Obs.            144         256&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Order est. (p)                   1           1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Order bias  (q)                  2           2&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## BW est. (h)                  9.969       9.969&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## BW bias (b)                 14.661      14.661&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## rho (h/b)                    0.680       0.680&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Unique Obs.                    155         262&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## =============================================================================&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##         Method     Coef. Std. Err.         z     P&amp;gt;|z|      [ 95% C.I. ]       &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## =============================================================================&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   Conventional    -8.578     1.601    -5.359     0.000   [-11.715 , -5.441]    &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##         Robust         -         -    -4.352     0.000   [-12.101 , -4.587]    &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## =============================================================================&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;There are a few important pieces of information to look at in this output:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The thing you care about the most is the actual effect size. This is the coefficient in the table at the bottom, indicated with the &amp;ldquo;Conventional&amp;rdquo; method. Here it&amp;rsquo;s -8.578, which means the tutoring program causes an 8-point change in exit exam scores. The table at the bottom also includes standard errors, p-values, and confidence intervals for the coefficient, both normal estimates (conventional) and robust estimates (robust). According to both types of estimates, this 8 point bump is statistically significant (p &amp;lt; 0.001; the 95% confidence interval definitely doesn&amp;rsquo;t ever include 0).&lt;/li&gt;
&lt;li&gt;Importantly, notice that the coefficient here is actually negative (-8.578), while our previous parametric estimates were all positive. That does &lt;em&gt;not&lt;/em&gt; mean that the program causes a drop in test scores. That negative value is just a side effect of how &lt;code&gt;rdrobust()&lt;/code&gt; measures the gap. It looks at the value of the treatment group right before the threshold and then shows that test scores drop when shifting to the control group (while before we talked about the opposite story: test scores increase as you move from the control group to the treatment group). There&amp;rsquo;s no way to flip the sign within &lt;code&gt;rdrobust()&lt;/code&gt;, so you need to look at the plot and see what the gap is really doing.&lt;/li&gt;
&lt;li&gt;The model used a bandwidth of 9.969 (&lt;code&gt;BW est. (h)&lt;/code&gt; in the output), which means it only looked at people with test scores of 70 ± 10. It decided on this bandwidth automatically, but you can change it to whatever you want.&lt;/li&gt;
&lt;li&gt;The model used a triangular kernel. This is the most esoteric part of the model—the kernel decides how much weight to give to observations around the cutoff. Test scores like 69.99 or 70.01 are extremely close to 70, so they get the most weight. Scores like 67 or 73 are a little further away so they matter less. Scores like 64 or 76 matter even less, so they get even less weight. You can use different kernels too, and &lt;a href=&#34;https://en.wikipedia.org/wiki/Kernel_%28statistics%29#Kernel_functions_in_common_use&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Wikipedia has a nice graphic showing the shapes of these different kernels&lt;/a&gt; and how they give different weights to observations at different distances.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We can plot this nonparametric model with &lt;code&gt;rdplot()&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;rdplot&lt;/span&gt;(y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tutoring&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;exit_exam, x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tutoring&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;entrance_exam, c &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;)
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] &amp;#34;Mass points detected in the running variable.&amp;#34;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/rdd_files/figure-html/rdplot-basic-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Look at that 8.5 point jump at 70! Neat!&lt;/p&gt;
&lt;p&gt;Notice that the points here aren&amp;rsquo;t actually the observations in the dataset. The &lt;code&gt;rdplot()&lt;/code&gt; function makes bins of points (like a histogram) and then shows the average outcome within each bin. You can control how many bins are used in the x-axis with the &lt;code&gt;nbins&lt;/code&gt; or &lt;code&gt;binselect&lt;/code&gt; arguments in &lt;code&gt;rdplot()&lt;/code&gt; (run &lt;code&gt;?rdplot&lt;/code&gt; in your console to see all the possible options for plotting nonparametric discontinuities).&lt;/p&gt;
&lt;div class=&#34;fyi&#34;&gt;
&lt;p&gt;&lt;strong&gt;Side note&lt;/strong&gt;: &lt;code&gt;rdplot()&lt;/code&gt; uses the same plotting system as &lt;code&gt;ggplot()&lt;/code&gt;, so you can add layers like &lt;code&gt;labs()&lt;/code&gt; or &lt;code&gt;geom_point()&lt;/code&gt; or anything else, which is cool, but getting to that underlying &lt;code&gt;ggplot()&lt;/code&gt; object is weird. To do it, store the results of &lt;code&gt;rdplot&lt;/code&gt; as an object, like &lt;code&gt;asdf&lt;/code&gt;, then use &lt;code&gt;asdf$rdplot&lt;/code&gt; to access the plot:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;asdf &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rdplot&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;...&lt;/span&gt;)
asdf&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;rdplot &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;labs&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Running variable&amp;#34;&lt;/span&gt;, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Outcome variable&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;You don&amp;rsquo;t need to worry about all that for showing simple plots though!&lt;/p&gt;

&lt;/div&gt;

&lt;p&gt;By default, &lt;code&gt;rdrobust()&lt;/code&gt; chooses the bandwidth size automatically based on fancy algorithms that economists have developed. You can use &lt;code&gt;rdbwselect()&lt;/code&gt; to see what that bandwidth is, and if you include the &lt;code&gt;all = TRUE&lt;/code&gt; argument, you can see a bunch of different potential bandwidths based on a bunch of different algorithms:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# This says to use the mserd version, which according to the help file for&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# rdbwselect means &amp;#34;the mean squared error-optimal bandwidth selector for RD&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# treatment effects&amp;#34;. Sounds great.&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;rdbwselect&lt;/span&gt;(y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tutoring&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;exit_exam, x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tutoring&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;entrance_exam, c &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;summary&lt;/span&gt;()
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] &amp;#34;Mass points detected in the running variable.&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Call: rdbwselect&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Number of Obs.                 1000&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## BW type                       mserd&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Kernel                   Triangular&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## VCE method                       NN&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Number of Obs.                 237         763&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Order est. (p)                   1           1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Order bias  (q)                  2           2&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Unique Obs.                    155         262&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## =======================================================&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##                   BW est. (h)    BW bias (b)&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##             Left of c Right of c  Left of c Right of c&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## =======================================================&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##      mserd     9.969      9.969     14.661     14.661&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## =======================================================&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;What are the different possible bandwidths we could use?&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;rdbwselect&lt;/span&gt;(y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tutoring&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;exit_exam, x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tutoring&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;entrance_exam, c &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;, all &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;summary&lt;/span&gt;()
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] &amp;#34;Mass points detected in the running variable.&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Call: rdbwselect&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Number of Obs.                 1000&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## BW type                         All&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Kernel                   Triangular&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## VCE method                       NN&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Number of Obs.                 237         763&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Order est. (p)                   1           1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Order bias  (q)                  2           2&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Unique Obs.                    155         262&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## =======================================================&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##                   BW est. (h)    BW bias (b)&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##             Left of c Right of c  Left of c Right of c&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## =======================================================&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##      mserd     9.969      9.969     14.661     14.661&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##     msetwo    11.521     10.054     17.067     14.907&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##     msesum    12.044     12.044     17.631     17.631&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   msecomb1     9.969      9.969     14.661     14.661&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   msecomb2    11.521     10.054     17.067     14.907&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##      cerrd     7.058      7.058     14.661     14.661&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##     certwo     8.156      7.118     17.067     14.907&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##     cersum     8.526      8.526     17.631     17.631&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   cercomb1     7.058      7.058     14.661     14.661&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   cercomb2     8.156      7.118     17.067     14.907&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## =======================================================&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Phew. There are a lot here. The best one was &lt;code&gt;mserd&lt;/code&gt;, or ±9.69. Some say ±7, others ±12, other are asymmetric and say -11.5 before and +10 after. Try a bunch of different bandwidths as part of your sensitivity analysis and see if your effect size changes substantially as a result.&lt;/p&gt;
&lt;p&gt;Another common approach to sensitivity analysis is to use the ideal bandwidth, twice the ideal, and half the ideal (so in our case 10, 20, and 5) and see if the estimate changes substantially. Use the &lt;code&gt;h&lt;/code&gt; argument to specify your own bandwidth&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;rdrobust&lt;/span&gt;(y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tutoring&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;exit_exam, x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tutoring&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;entrance_exam, c &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;, h &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;9.969&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;summary&lt;/span&gt;()
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] &amp;#34;Mass points detected in the running variable.&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Call: rdrobust&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Number of Obs.                 1000&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## BW type                      Manual&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Kernel                   Triangular&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## VCE method                       NN&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Number of Obs.                 237         763&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Eff. Number of Obs.            144         256&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Order est. (p)                   1           1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Order bias  (q)                  2           2&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## BW est. (h)                  9.969       9.969&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## BW bias (b)                  9.969       9.969&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## rho (h/b)                    1.000       1.000&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Unique Obs.                    155         262&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## =============================================================================&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##         Method     Coef. Std. Err.         z     P&amp;gt;|z|      [ 95% C.I. ]       &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## =============================================================================&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   Conventional    -8.578     1.601    -5.359     0.000   [-11.715 , -5.441]    &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##         Robust         -         -    -3.276     0.001   [-12.483 , -3.138]    &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## =============================================================================&lt;/span&gt;

&lt;span style=&#34;color:#a6e22e&#34;&gt;rdrobust&lt;/span&gt;(y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tutoring&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;exit_exam, x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tutoring&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;entrance_exam, c &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;, h &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;9.969&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;summary&lt;/span&gt;()
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] &amp;#34;Mass points detected in the running variable.&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Call: rdrobust&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Number of Obs.                 1000&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## BW type                      Manual&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Kernel                   Triangular&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## VCE method                       NN&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Number of Obs.                 237         763&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Eff. Number of Obs.            206         577&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Order est. (p)                   1           1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Order bias  (q)                  2           2&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## BW est. (h)                 19.938      19.938&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## BW bias (b)                 19.938      19.938&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## rho (h/b)                    1.000       1.000&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Unique Obs.                    155         262&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## =============================================================================&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##         Method     Coef. Std. Err.         z     P&amp;gt;|z|      [ 95% C.I. ]       &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## =============================================================================&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   Conventional    -9.151     1.130    -8.100     0.000   [-11.365 , -6.937]    &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##         Robust         -         -    -4.980     0.000   [-11.670 , -5.078]    &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## =============================================================================&lt;/span&gt;

&lt;span style=&#34;color:#a6e22e&#34;&gt;rdrobust&lt;/span&gt;(y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tutoring&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;exit_exam, x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tutoring&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;entrance_exam, c &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;, h &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;9.969&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;summary&lt;/span&gt;()
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] &amp;#34;Mass points detected in the running variable.&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Call: rdrobust&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Number of Obs.                 1000&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## BW type                      Manual&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Kernel                   Triangular&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## VCE method                       NN&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Number of Obs.                 237         763&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Eff. Number of Obs.             82         109&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Order est. (p)                   1           1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Order bias  (q)                  2           2&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## BW est. (h)                  4.984       4.984&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## BW bias (b)                  4.984       4.984&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## rho (h/b)                    1.000       1.000&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Unique Obs.                    155         262&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## =============================================================================&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##         Method     Coef. Std. Err.         z     P&amp;gt;|z|      [ 95% C.I. ]       &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## =============================================================================&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   Conventional    -8.201     2.348    -3.493     0.000   [-12.803 , -3.600]    &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##         Robust         -         -    -2.032     0.042   [-13.618 , -0.246]    &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## =============================================================================&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Here the coefficients change slightly:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Bandwidth&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Effect size&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;9.969 (ideal)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;8.578&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;19.938 (twice)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;9.151&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;4.984 (half)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;8.201&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;You can also adjust the kernel. By default &lt;code&gt;rd_robust&lt;/code&gt; uses a triangular kernel (more distant observations have less weight linearly), but you can switch it to Epanechnikov (more distant observations have less weight following a curve) or uniform (more distant observations have the same weight as closer observations; this is unweighted).&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Non-parametric RD with different kernels&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;rdrobust&lt;/span&gt;(y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tutoring&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;exit_exam, x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tutoring&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;entrance_exam,
         c &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;, kernel &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;triangular&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;summary&lt;/span&gt;()  &lt;span style=&#34;color:#75715e&#34;&gt;# Default&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] &amp;#34;Mass points detected in the running variable.&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Call: rdrobust&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Number of Obs.                 1000&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## BW type                       mserd&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Kernel                   Triangular&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## VCE method                       NN&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Number of Obs.                 237         763&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Eff. Number of Obs.            144         256&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Order est. (p)                   1           1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Order bias  (q)                  2           2&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## BW est. (h)                  9.969       9.969&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## BW bias (b)                 14.661      14.661&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## rho (h/b)                    0.680       0.680&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Unique Obs.                    155         262&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## =============================================================================&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##         Method     Coef. Std. Err.         z     P&amp;gt;|z|      [ 95% C.I. ]       &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## =============================================================================&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   Conventional    -8.578     1.601    -5.359     0.000   [-11.715 , -5.441]    &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##         Robust         -         -    -4.352     0.000   [-12.101 , -4.587]    &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## =============================================================================&lt;/span&gt;

&lt;span style=&#34;color:#a6e22e&#34;&gt;rdrobust&lt;/span&gt;(y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tutoring&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;exit_exam, x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tutoring&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;entrance_exam,
         c &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;, kernel &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;epanechnikov&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;summary&lt;/span&gt;()
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] &amp;#34;Mass points detected in the running variable.&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Call: rdrobust&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Number of Obs.                 1000&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## BW type                       mserd&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Kernel                   Epanechnikov&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## VCE method                       NN&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Number of Obs.                 237         763&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Eff. Number of Obs.            130         204&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Order est. (p)                   1           1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Order bias  (q)                  2           2&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## BW est. (h)                  8.201       8.201&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## BW bias (b)                 12.807      12.807&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## rho (h/b)                    0.640       0.640&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Unique Obs.                    155         262&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## =============================================================================&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##         Method     Coef. Std. Err.         z     P&amp;gt;|z|      [ 95% C.I. ]       &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## =============================================================================&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   Conventional    -8.389     1.677    -5.001     0.000   [-11.677 , -5.101]    &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##         Robust         -         -    -4.085     0.000   [-12.116 , -4.260]    &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## =============================================================================&lt;/span&gt;

&lt;span style=&#34;color:#a6e22e&#34;&gt;rdrobust&lt;/span&gt;(y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tutoring&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;exit_exam, x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tutoring&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;entrance_exam,
         c &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;70&lt;/span&gt;, kernel &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;uniform&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;summary&lt;/span&gt;()
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] &amp;#34;Mass points detected in the running variable.&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Call: rdrobust&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Number of Obs.                 1000&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## BW type                       mserd&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Kernel                      Uniform&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## VCE method                       NN&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Number of Obs.                 237         763&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Eff. Number of Obs.            119         176&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Order est. (p)                   1           1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Order bias  (q)                  2           2&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## BW est. (h)                  7.346       7.346&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## BW bias (b)                 12.561      12.561&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## rho (h/b)                    0.585       0.585&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Unique Obs.                    155         262&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## =============================================================================&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##         Method     Coef. Std. Err.         z     P&amp;gt;|z|      [ 95% C.I. ]       &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## =============================================================================&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   Conventional    -8.175     1.651    -4.952     0.000   [-11.411 , -4.939]    &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##         Robust         -         -    -4.085     0.000   [-11.704 , -4.115]    &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## =============================================================================&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Again, the coefficients change slightly:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Kernel&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Effect size&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Triangular&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;8.578&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Epanechnikov&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;8.389&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Uniform&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;8.175&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Which one is best? ¯\_(ツ)_/¯. All that really matters is that the size and direction of the effect doesn&amp;rsquo;t change. It&amp;rsquo;s still positive and it&amp;rsquo;s still in the 8–9ish point range.&lt;/p&gt;
&lt;h2 id=&#34;step-6-compare-all-the-effects&#34;&gt;Step 6: Compare all the effects&lt;/h2&gt;
&lt;p&gt;We just estimated a ton of effect sizes. In real life you&amp;rsquo;d generally just report one of these as your final effect, but you&amp;rsquo;d run the different parametric and nonparametric models to check how reliable and robust your findings are. Here&amp;rsquo;s everything we just found:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Method&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Bandwidth&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Kernel&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Estimate&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Parametric&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Full data&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Unweighted&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;10.8&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Parametric&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;10&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Unweighted&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;9.273&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Parametric&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;5&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Unweighted&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;9.122&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Nonparametric&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;9.969&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Triangular&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;8.578&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Nonparametric&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;19.938&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Triangular&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;9.151&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Nonparametric&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;4.984&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Triangular&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;8.201&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Nonparametric&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;8.201&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Epanechnikov&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;8.389&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Nonparametric&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;7.346&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Uniform (unweighted)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;8.175&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;In real life, I&amp;rsquo;d likely report the simplest one (row 4: nonparametric, automatic bandwidth, triangular kernel), but knowing how much the effect varies across model specifications is helpful.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Matching and inverse probability weighting</title>
      <link>/example/matching-ipw/</link>
      <pubDate>Fri, 02 Oct 2020 00:00:00 +0000</pubDate>
      <guid>/example/matching-ipw/</guid>
      <description>&lt;script src=&#34;/rmarkdown-libs/kePrint/kePrint.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;/rmarkdown-libs/lightable/lightable.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;h2 id=&#34;video-walk-through&#34;&gt;Video walk-through&lt;/h2&gt;
&lt;p&gt;If you want to follow along with this example, you can download the data below:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/data/mosquito_nets.csv&#34;&gt;&lt;i class=&#34;fas fa-table&#34;&gt;&lt;/i&gt; &lt;code&gt;mosquito_nets.csv&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;There&amp;rsquo;s a set of videos that walks through each section below. To make it easier for you to jump around the video examples, I cut the long video into smaller pieces and included them all in &lt;a href=&#34;https://www.youtube.com/playlist?list=PLS6tnpTr39sGv7RPHEZy8CDSdCliQOW8K&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;one YouTube playlist&lt;/a&gt;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=OoYgOwxUQgI&amp;amp;list=PLS6tnpTr39sGv7RPHEZy8CDSdCliQOW8K&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Drawing a DAG&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=_FNrfFe99R0&amp;amp;list=PLS6tnpTr39sGv7RPHEZy8CDSdCliQOW8K&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Creating an RStudio project&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=7NW7GbO44BY&amp;amp;list=PLS6tnpTr39sGv7RPHEZy8CDSdCliQOW8K&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Naive (and wrong!) estimate&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=uGwSRnET8Sg&amp;amp;list=PLS6tnpTr39sGv7RPHEZy8CDSdCliQOW8K&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Matching&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=CKm1rZlAwuA&amp;amp;list=PLS6tnpTr39sGv7RPHEZy8CDSdCliQOW8K&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Inverse probability weighting&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;You can also watch the playlist (and skip around to different sections) here:&lt;/p&gt;
&lt;div class=&#34;embed-responsive embed-responsive-16by9&#34;&gt;
&lt;iframe class=&#34;embed-responsive-item&#34; src=&#34;https://www.youtube.com/embed/playlist?list=PLS6tnpTr39sGv7RPHEZy8CDSdCliQOW8K&#34; frameborder=&#34;0&#34; allow=&#34;accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture&#34; allowfullscreen&gt;&lt;/iframe&gt;
&lt;/div&gt;
&lt;h2 id=&#34;program-background&#34;&gt;Program background&lt;/h2&gt;
&lt;p&gt;Let&amp;rsquo;s revisit the mosquito net program we used in &lt;a href=&#34;/example/dags/&#34;&gt;the DAG example&lt;/a&gt;. Here, researchers are interested in whether using mosquito nets decreases an individual&amp;rsquo;s risk of contracting malaria. They have collected data from 1,752 households in an unnamed country and have variables related to environmental factors, individual health, and household characteristics. The data is &lt;strong&gt;not experimental&lt;/strong&gt;—researchers have no control over who uses mosquito nets, and individual households make their own choices over whether to apply for free nets or buy their own nets, as well as whether they use the nets if they have them.&lt;/p&gt;
&lt;p&gt;The CSV file contains the following columns:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Malaria risk (&lt;code&gt;malaria_risk&lt;/code&gt;): The likelihood that someone in the household will be infected with malaria. Measured on a scale of 0–100, with higher values indicating higher risk.&lt;/li&gt;
&lt;li&gt;Mosquito net (&lt;code&gt;net&lt;/code&gt; and &lt;code&gt;net_num&lt;/code&gt;): A binary variable indicating if the household used mosquito nets.&lt;/li&gt;
&lt;li&gt;Eligible for program (&lt;code&gt;eligible&lt;/code&gt;): A binary variable indicating if the household is eligible for the free net program.&lt;/li&gt;
&lt;li&gt;Income (&lt;code&gt;income&lt;/code&gt;): The household&amp;rsquo;s monthly income, in US dollars.&lt;/li&gt;
&lt;li&gt;Nighttime temperatures (&lt;code&gt;temperature&lt;/code&gt;): The average temperature at night, in Celsius.&lt;/li&gt;
&lt;li&gt;Health (&lt;code&gt;health&lt;/code&gt;): Self-reported healthiness in the household. Measured on a scale of 0–100, with higher values indicating better health.&lt;/li&gt;
&lt;li&gt;Number in household (&lt;code&gt;household&lt;/code&gt;): Number of people living in the household.&lt;/li&gt;
&lt;li&gt;Insecticide resistance (&lt;code&gt;resistance&lt;/code&gt;): Some strains of mosquitoes are more resistant to insecticide and thus pose a higher risk of infecting people with malaria. This is measured on a scale of 0–100, with higher values indicating higher resistance.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;our-goal&#34;&gt;Our goal&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Our goal in this example is to estimate the &lt;em&gt;causal&lt;/em&gt; effect of bed net usage on malaria risk using &lt;em&gt;only&lt;/em&gt; observational data.&lt;/strong&gt; This was not an RCT, so it might seem a little sketchy to make claims of causality. But if we can draw a correct DAG and adjust for the correct nodes, we can isolate the net → malaria relationship and talk about causality.&lt;/p&gt;
&lt;p&gt;Because this is simulated data, we know the true causal effect of the net program because I built it into the data. &lt;strong&gt;The true average treatment effect (ATE) is -10.&lt;/strong&gt; Using a mosquito net &lt;em&gt;causes&lt;/em&gt; the risk of malaria to decrease by 10 points, on average.&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s see if we can find that 10 point effect!&lt;/p&gt;
&lt;h2 id=&#34;load-data-and-libraries&#34;&gt;Load data and libraries&lt;/h2&gt;
&lt;p&gt;First, let&amp;rsquo;s download the dataset (if you haven&amp;rsquo;t already), put in a folder named &lt;code&gt;data&lt;/code&gt;, and load it:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/data/mosquito_nets.csv&#34;&gt;&lt;i class=&#34;fas fa-table&#34;&gt;&lt;/i&gt; &lt;code&gt;mosquito_nets.csv&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(tidyverse)  &lt;span style=&#34;color:#75715e&#34;&gt;# ggplot(), %&amp;gt;%, mutate(), and friends&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(ggdag)  &lt;span style=&#34;color:#75715e&#34;&gt;# Make DAGs&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(dagitty)  &lt;span style=&#34;color:#75715e&#34;&gt;# Do DAG logic with R&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(broom)  &lt;span style=&#34;color:#75715e&#34;&gt;# Convert models to data frames&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(MatchIt)  &lt;span style=&#34;color:#75715e&#34;&gt;# Match things&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(modelsummary)  &lt;span style=&#34;color:#75715e&#34;&gt;# Make side-by-side regression tables&lt;/span&gt;

&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)   &lt;span style=&#34;color:#75715e&#34;&gt;# Make all random draws reproducible&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Load the data.&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# It&amp;#39;d be a good idea to click on the &amp;#34;nets&amp;#34; object in the Environment panel in&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# RStudio to see what the data looks like after you load it&lt;/span&gt;
nets &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;read_csv&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;data/mosquito_nets.csv&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;dag-and-adjustment-sets&#34;&gt;DAG and adjustment sets&lt;/h2&gt;
&lt;p&gt;Before running any models, we need to find what we need to adjust for. Recall from &lt;a href=&#34;/example/dags/&#34;&gt;the DAG example&lt;/a&gt; that we built this causal model to show the data generating process behind the relationship between mosquito net usage and malaria risk:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;mosquito_dag &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;dagify&lt;/span&gt;(
  malaria_risk &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; net &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; income &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; health &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; temperature &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; resistance,
  net &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; income &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; health &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; temperature &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; eligible &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; household,
  eligible &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; income &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; household,
  health &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; income,
  exposure &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;net&amp;#34;&lt;/span&gt;,
  outcome &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;malaria_risk&amp;#34;&lt;/span&gt;,
  coords &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(malaria_risk &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;, net &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, income &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;, health &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;,
                      temperature &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;, resistance &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;8.5&lt;/span&gt;, eligible &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, household &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;),
                y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(malaria_risk &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, net &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, income &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, health &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,
                      temperature &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, resistance &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, eligible &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, household &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;)),
  labels &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(malaria_risk &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Risk of malaria&amp;#34;&lt;/span&gt;, net &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Mosquito net&amp;#34;&lt;/span&gt;, income &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Income&amp;#34;&lt;/span&gt;,
             health &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Health&amp;#34;&lt;/span&gt;, temperature &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Nighttime temperatures&amp;#34;&lt;/span&gt;,
             resistance &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Insecticide resistance&amp;#34;&lt;/span&gt;,
             eligible &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Eligible for program&amp;#34;&lt;/span&gt;, household &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Number in household&amp;#34;&lt;/span&gt;)
)

&lt;span style=&#34;color:#a6e22e&#34;&gt;ggdag_status&lt;/span&gt;(mosquito_dag, use_labels &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;label&amp;#34;&lt;/span&gt;, text &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;guides&lt;/span&gt;(fill &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;# Disable the legend&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;theme_dag&lt;/span&gt;()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/matching-ipw_files/figure-html/build-mosquito-dag-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Following the logic of &lt;em&gt;do&lt;/em&gt;-calculus, we can find all the nodes that confound the relationship between net usage and malaria risk, since those nodes open up backdoor paths and distort the causal effect we care about. We can either do this graphically by looking for any node that points to both net and malaria risk, or we can use R:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;adjustmentSets&lt;/span&gt;(mosquito_dag)
&lt;span style=&#34;color:#75715e&#34;&gt;## { health, income, temperature }&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Based on the relationships between all the nodes in the DAG, adjusting for health, income, and temperature is enough to close all backdoors and identify the relationship between net use and malaria risk.&lt;/p&gt;
&lt;h2 id=&#34;naive-correlation-isnt-causation-estimate&#34;&gt;Naive correlation-isn&amp;rsquo;t-causation estimate&lt;/h2&gt;
&lt;p&gt;For fun, we can calculate the difference in average malaria risk for those who did/didn&amp;rsquo;t use mosquito nets. This is most definitely &lt;em&gt;not&lt;/em&gt; the actual causal effect—this is the &amp;ldquo;correlation is not causation&amp;rdquo; effect that doesn&amp;rsquo;t account for any of the backdoors in the DAG.&lt;/p&gt;
&lt;p&gt;We can do this with a table (but then we have to do manual math to subtract the &lt;code&gt;FALSE&lt;/code&gt; average from the &lt;code&gt;TRUE&lt;/code&gt; average):&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;nets &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;group_by&lt;/span&gt;(net) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;summarize&lt;/span&gt;(number &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;n&lt;/span&gt;(),
            avg &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;mean&lt;/span&gt;(malaria_risk))
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 2 x 3&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   net   number   avg&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;lgl&amp;gt;  &amp;lt;int&amp;gt; &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 FALSE   1071  41.9&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 TRUE     681  25.6&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Or we can do it with regression:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_wrong &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(malaria_risk &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; net, data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nets)

&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_wrong)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 2 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term        estimate std.error statistic   p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;          &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)     41.9     0.405     104.  0.       &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 netTRUE        -16.3     0.649     -25.1 2.25e-119&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;According to this estimate, using a mosquito net is associated with a 16.33 point decrease in malaria risk, on average. We can&amp;rsquo;t legally talk about this as a causal effect though—there are confounding variables to deal with.&lt;/p&gt;
&lt;h2 id=&#34;matching&#34;&gt;Matching&lt;/h2&gt;
&lt;p&gt;We can use matching techniques to pair up similar observations and make the unconfoundedness assumption—that if we see two observations that are pretty much identical, and one used a net and one didn&amp;rsquo;t, the choice to use a net was random.&lt;/p&gt;
&lt;p&gt;Because we know from the DAG that income, nighttime temperatures, and health help cause both net use and malaria risk (and confound that relationship!), we&amp;rsquo;ll try to find observations with similar values of income, temperatures, and health that both used and didn&amp;rsquo;t use nets.&lt;/p&gt;
&lt;p&gt;We can use the &lt;code&gt;matchit()&lt;/code&gt; function from the &lt;strong&gt;MatchIt&lt;/strong&gt; R package to match points based on Mahalanobis distance. There are lots of other options available—see &lt;a href=&#34;http://gking.harvard.edu/matchit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;the online documentation&lt;/a&gt; for details.&lt;/p&gt;
&lt;p&gt;We can include the &lt;code&gt;replace = TRUE&lt;/code&gt; option to make it so that points that have been matched already can be matched again (that is, we&amp;rsquo;re not forcing a one-to-one matching; we have one-to-many matching instead).&lt;/p&gt;
&lt;h3 id=&#34;step-1-preprocess&#34;&gt;Step 1: Preprocess&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;matched_data &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;matchit&lt;/span&gt;(net &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; income &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; temperature &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; health,
                        data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nets,
                        method &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;nearest&amp;#34;&lt;/span&gt;,
                        distance &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;mahalanobis&amp;#34;&lt;/span&gt;,
                        replace &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;)
&lt;span style=&#34;color:#a6e22e&#34;&gt;summary&lt;/span&gt;(matched_data)
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Call:&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## matchit(formula = net ~ income + temperature + health, data = nets, &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##     method = &amp;#34;nearest&amp;#34;, distance = &amp;#34;mahalanobis&amp;#34;, replace = TRUE)&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Summary of Balance for All Data:&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##             Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean eCDF Max&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## income                955           873            0.41        1.4     0.104    0.198&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## temperature            23            24           -0.17        1.1     0.042    0.097&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## health                 55            48            0.36        1.2     0.071    0.168&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Summary of Balance for Matched Data:&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##             Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean eCDF Max Std. Pair Dist.&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## income                955           950           0.026        1.1     0.010    0.048            0.12&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## temperature            23            23          -0.006        1.0     0.007    0.028            0.12&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## health                 55            55           0.020        1.1     0.007    0.028            0.12&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Percent Balance Improvement:&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##             Std. Mean Diff. Var. Ratio eCDF Mean eCDF Max&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## income                   94         66        91       76&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## temperature              96         61        84       71&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## health                   94         61        90       83&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Sample Sizes:&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##               Control Treated&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## All              1071     681&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Matched (ESS)     323     681&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Matched           439     681&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Unmatched         632       0&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Discarded           0       0&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Here we can see that all 681 of the net users were paired with similar-looking non-users (439 of them). 632 people weren&amp;rsquo;t matched and will get discarded. If you&amp;rsquo;re curious, you can see which treated rows got matched to which control rows by running &lt;code&gt;matched_data$match.matrix&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;We can create a new data frame of those matches with &lt;code&gt;match.data()&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;matched_data_for_real &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;match.data&lt;/span&gt;(matched_data)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;step-2-estimation&#34;&gt;Step 2: Estimation&lt;/h3&gt;
&lt;p&gt;Now that the data has been matched, it should work better for modeling. Also, because we used income, temperatures, and health in the matching process, we&amp;rsquo;ve adjusted for those DAG nodes and have closed those backdoors, so our model can be pretty simple here:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_matched &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(malaria_risk &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; net,
                    data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; matched_data_for_real)
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_matched)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 2 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term        estimate std.error statistic  p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;          &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)     38.5     0.600      64.2 0.      &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 netTRUE        -12.9     0.769     -16.8 2.31e-56&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The 12.88 point decrease here is better than the naive estimate, but it&amp;rsquo;s not the true 10 point causal effect (that I built in to the data). Perhaps that&amp;rsquo;s because the matches aren&amp;rsquo;t great, or maybe we threw away too much data. There are a host of diagnostics you can look at to see how well things are matched (check &lt;a href=&#34;http://gking.harvard.edu/matchit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;the documentation for &lt;strong&gt;MatchIt&lt;/strong&gt;&lt;/a&gt; for examples.)&lt;/p&gt;
&lt;p&gt;Actually, the most likely culprit for the incorrect estimate is that there&amp;rsquo;s some imbalance in the data. Because we set &lt;code&gt;replace = TRUE&lt;/code&gt;, we did &lt;em&gt;not&lt;/em&gt; do 1:1 matching—untreated observations were paired with more than one treated observation. As a result, the multiply-matched observations are getting overcounted and have too much importance in the model. Fortunately, &lt;code&gt;matchit()&lt;/code&gt; provides us with a column called &lt;code&gt;weights&lt;/code&gt; that allows us to scale down the overmatched observations when running the model. &lt;strong&gt;Importantly,&lt;/strong&gt; these weights have nothing to do with causal inference or backdoors or inverse probability weighting—their only purpose is to help scale down the imbalance arising from overmatching. If you use &lt;code&gt;replace = FALSE&lt;/code&gt; and enforce 1:1 matching, the whole &lt;code&gt;weights&lt;/code&gt; column will just be 1.&lt;/p&gt;
&lt;p&gt;We can incorporate those weights into the model and get a more accurate estimate:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_matched_wts &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(malaria_risk &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; net,
                        data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; matched_data_for_real,
                        weights &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; weights)
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_matched_wts)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 2 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term        estimate std.error statistic  p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;          &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)     36.1     0.595      60.6 0.      &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 netTRUE        -10.5     0.763     -13.7 7.98e-40&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;After weighting to account for under- and over-matching, we find a -10.49 point causal effect. That&amp;rsquo;s much better than any of the other estimates we&amp;rsquo;ve tried so far! The reason it&amp;rsquo;s accurate is because we&amp;rsquo;ve closed the confounding backdoors and isolated the arrow between net use and malaria risk.&lt;/p&gt;
&lt;h2 id=&#34;inverse-probability-weighting&#34;&gt;Inverse probability weighting&lt;/h2&gt;
&lt;p&gt;One potential downside to matching is that you generally have to throw away a sizable chunk of your data—anything that&amp;rsquo;s unmatched doesn&amp;rsquo;t get included in the final matched data.&lt;/p&gt;
&lt;p&gt;An alternative approach to matching is to assign every observation some probability of receiving treatment, and then weight each observation by its inverse probability—observations that are predicted to get treatment and then don&amp;rsquo;t, or observations that are predicted to not get treatment and then do will receive more weight than the observations that get/don&amp;rsquo;t get treatment as predicted.&lt;/p&gt;
&lt;p&gt;Generating these inverse probability weights requires a two step process: (1) we first generate propensity scores, or the probability of receiving treatment, and then (2) we use a special formula to convert those propensity scores into weights. Once we have inverse probability weights weights, we can incorporate them into our regression model.&lt;/p&gt;
&lt;h3 id=&#34;oversimplified-crash-course-in-logistic-regression&#34;&gt;Oversimplified crash course in logistic regression&lt;/h3&gt;
&lt;p&gt;There are many ways to generate propensity scores (like logistic regression, probit regression, and even machine learning techniques like random forests and neural networks), but logistic regression is probably the most common method.&lt;/p&gt;
&lt;p&gt;The complete technical details of logistic regression are beyond the scope of this class, but if you&amp;rsquo;re curious you should check out &lt;a href=&#34;https://uc-r.github.io/logistic_regression&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;this highly accessible tutorial&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;All you really need to know is that the outcome variable in logistic regression models must be binary, and the explanatory variables you include in the model help explain the variation in the likelihood of your binary outcome. The Y (or outcome) in logistic regression is a logged ratio of probabilities, which forces the model&amp;rsquo;s output to be in a 0-1 range:&lt;/p&gt;
&lt;p&gt;$$
\log \frac{p_y}{p_{1-y}} = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + \dots + \beta_n x_n + \epsilon
$$&lt;/p&gt;
&lt;p&gt;Here&amp;rsquo;s what it looks like visually. Because net usage is a binary outcome, there are lines of observations at 0 and 1 along the y axis. The blue curvy line here shows the output of a logistic regression model—people with low income have a low likelihood of using a net, while those with high income are far more likely to do so.&lt;/p&gt;
&lt;p&gt;I also included a red line showing the results from a regular old &lt;code&gt;lm()&lt;/code&gt; OLS model. It follows the blue line fairly well for a while, but predicts negative probabilities if you use lower values of income, like less than 250. For strange historical and mathy reasons, many economists like using OLS on binary outcomes (they even have a fancy name for it: linear probability models (LPMs)), but I&amp;rsquo;m partial to logistic regression since it doesn&amp;rsquo;t generate probabilities greater than 100% or less than 0%. (BUT DON&amp;rsquo;T EVER COMPLAIN ABOUT LPMs ONLINE. You&amp;rsquo;ll start battles between economists and other social scientists. 🤣)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(nets, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; income, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; net_num)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_point&lt;/span&gt;(alpha &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.1&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_smooth&lt;/span&gt;(method &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lm&amp;#34;&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;red&amp;#34;&lt;/span&gt;, size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_smooth&lt;/span&gt;(method &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;glm&amp;#34;&lt;/span&gt;, method.args &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(family &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;binomial&lt;/span&gt;(link &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;logit&amp;#34;&lt;/span&gt;))) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;labs&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Income&amp;#34;&lt;/span&gt;, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Probability of using a net&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/matching-ipw_files/figure-html/net-income-logit-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;The coefficients from a logistic regression model are interpreted differently than you&amp;rsquo;re used to (and their interpretations can be controversial!). Here&amp;rsquo;s an example for the model in the graph above:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Notice how we use glm() instead of lm(). The &amp;#34;g&amp;#34; stands for &amp;#34;generalized&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# linear model. We have to specify a family in any glm() model. You can&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# technically run a regular OLS model (like you do with lm()) if you use&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# glm(y ~ x1 + x2, family = gaussian(link = &amp;#34;identity&amp;#34;)), but people rarely do that.&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# To use logistic regression, you have to specify a binomial/logit family like so:&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# family = binomial(link = &amp;#34;logit&amp;#34;)&lt;/span&gt;
model_logit &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;glm&lt;/span&gt;(net &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; income &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; temperature &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; health,
                   data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nets,
                   family &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;binomial&lt;/span&gt;(link &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;logit&amp;#34;&lt;/span&gt;))

&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_logit)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 4 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term        estimate std.error statistic     p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;          &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;       &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept) -1.32     0.376        -3.50 0.000464   &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 income       0.00209  0.000421      4.95 0.000000727&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 temperature -0.0589   0.0125       -4.70 0.00000264 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4 health       0.00688  0.00430       1.60 0.109&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The coefficients here aren&amp;rsquo;t normal numbers—they&amp;rsquo;re called &amp;ldquo;log odds&amp;rdquo; and represent the change in the logged odds as you move explanatory variables up. For instance, here the logged odds of using a net increase by 0.00688 for every one point increase in your health score. But what do logged odds even mean?! Nobody knows.&lt;/p&gt;
&lt;p&gt;You can make these coefficients slightly more interpretable by unlogging them and creating something called an &amp;ldquo;odds ratio.&amp;rdquo; These coefficients were logged with a natural log, so you unlog them by raising &lt;code&gt;\(e\)&lt;/code&gt; to the power of the coefficient. The odds ratio for temperature is &lt;code&gt;\(e^{-0.0589}\)&lt;/code&gt;, or 0.94. Odds ratios get interpreted a little differently than regular model coefficients. Odds ratios are all centered around 1—values above 1 mean that there&amp;rsquo;s an increase in the likelihood of the outcome, while values below 1 mean that there&amp;rsquo;s a decrease in the likelihood of the outcome.&lt;/p&gt;
&lt;p&gt;Our nighttime temperature odds ratio here is 0.94, which is 0.06 below 1, which means we can say that for every one point increase in nighttime temperatures, a person is 6% less likely to use a net. If the coefficient was something like 1.34, we could say that they&amp;rsquo;d be &lt;em&gt;34% more likely&lt;/em&gt; to use a net; if it was something like 5.02 we could say that they&amp;rsquo;d be &lt;em&gt;5 times more&lt;/em&gt; likely to use a net; if it was something like 0.1, we could say that they&amp;rsquo;re &lt;em&gt;90% less likely&lt;/em&gt; to use a net.&lt;/p&gt;
&lt;p&gt;You can make R exponentiate the coefficients automatically by including &lt;code&gt;exponentiate = TRUE&lt;/code&gt; in &lt;code&gt;tidy()&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_logit, exponentiate &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 4 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term        estimate std.error statistic     p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;          &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;       &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)    0.268  0.376        -3.50 0.000464   &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 income         1.00   0.000421      4.95 0.000000727&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 temperature    0.943  0.0125       -4.70 0.00000264 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4 health         1.01   0.00430       1.60 0.109&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;BUT AGAIN&lt;/strong&gt; this goes beyond the scope of this class! Just know that when you build a logistic regression model, you&amp;rsquo;re using explanatory variables to predict the probability of an outcome.&lt;/p&gt;
&lt;p&gt;Just one last little explanation for why we have to use weird log odds things. When working with binary outcomes, we&amp;rsquo;re dealing with probabilities, and we can create something called &amp;ldquo;odds&amp;rdquo; with probabilities. If there&amp;rsquo;s a 70% chance of something happening, there&amp;rsquo;s a 30% chance of it not happening. The ratio of those two probabilities is called &amp;ldquo;odds&amp;rdquo;: &lt;code&gt;\(\frac{p}{1 - p} = \frac{0.7}{1 - 0.7} = \frac{0.7}{0.3} = 2.333\)&lt;/code&gt;. Odds typically follow a curvy relationship—as you move up to higher levels of your explanatory variable, the odds get bigger faster. If you log these odds, though ($\log \frac{p}{1 - p}$), the relationship becomes linear, which means we can use regular old linear regression on probabilities. Magic!&lt;/p&gt;
&lt;p&gt;You can see the relationship between log odds and odds ratios in the first two panels here (this is fake data where X ranges between -5 and 5, and Y is either 0 or 1; you can see the data points in the final panel as dots):&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/example/matching-ipw_files/figure-html/odds-probs-1.png&#34; width=&#34;80%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;The coefficients from logistic regression are log odds because they come from model that creates that nice straight line in the first panel. Log odds are impossible to interpret, so we can unlog them ($e^\beta$) to turn them into odds ratios.&lt;/p&gt;
&lt;p&gt;The bottom panel shows predicted probabilities. You can do one more mathematical transformation with the odds ($\frac{p}{1 - p}$) to generate a probability instead of odds: &lt;code&gt;\(\frac{\text{odds}}{1 + \text{odds}}\)&lt;/code&gt;. &lt;em&gt;&lt;strong&gt;That&lt;/strong&gt;&lt;/em&gt; is what a propensity score is.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;BUT AGAIN I cannot stress enough how much you don&amp;rsquo;t need to worry about the inner mechanics of logistic regression for this class!&lt;/strong&gt; If that went over your head, don&amp;rsquo;t worry! All we&amp;rsquo;re doing for IPW is using logistic regression to create propensity scores, and the code below shows how to do that. Behind the scenes you&amp;rsquo;re moving from log odds (they&amp;rsquo;re linear!) to odds (they&amp;rsquo;re interpretable-ish) to probabilities (they&amp;rsquo;re super interpretable!), but you don&amp;rsquo;t need to worry about that.&lt;/p&gt;
&lt;p&gt;If you&amp;rsquo;re confused, &lt;a href=&#34;https://twitter.com/ChelseaParlett/status/1304436259926896640&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;watch this TikTok for consolation&lt;/a&gt;.&lt;/p&gt;
&lt;h3 id=&#34;step-1-generate-propensity-scores&#34;&gt;Step 1: Generate propensity scores&lt;/h3&gt;
&lt;p&gt;PHEW. With that little tangent into logistic regression done, we can now build a model to generate propensity scores (or predicted probabilities).&lt;/p&gt;
&lt;p&gt;When we include variables in the model that generates propensity scores, we&amp;rsquo;re making adjustments and closing backdoors in the DAG, just like we did with matching. But unlike matching, we&amp;rsquo;re not throwing any data away! We&amp;rsquo;re just making some observations more important and others less important.&lt;/p&gt;
&lt;p&gt;First we build a model that predicts net usage based on income, nighttime temperatures, and health (since those nodes are our confounders from the DAG):&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_net &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;glm&lt;/span&gt;(net &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; income &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; temperature &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; health,
                 data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nets,
                 family &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;binomial&lt;/span&gt;(link &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;logit&amp;#34;&lt;/span&gt;))

&lt;span style=&#34;color:#75715e&#34;&gt;# We could look at these results if we wanted, but we don&amp;#39;t need to for this class&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# tidy(model_net, exponentiate = TRUE)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We can then plug in the income, temperatures, and health for every row in our dataset and generate a predicted probability using this model:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# augment_columns() handles the plugging in of values. You need to feed it the&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# name of the model and the name of the dataset you want to add the predictions&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# to. The type.predict = &amp;#34;response&amp;#34; argument makes it so the predictions are in&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# the 0-1 scale. If you don&amp;#39;t include that, you&amp;#39;ll get predictions in an&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# uninterpretable log odds scale.&lt;/span&gt;
net_probabilities &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;augment_columns&lt;/span&gt;(model_net,
                                     nets,
                                     type.predict &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;response&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# The predictions are in a column named &amp;#34;.fitted&amp;#34;, so we rename it here&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;rename&lt;/span&gt;(propensity &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; .fitted)

&lt;span style=&#34;color:#75715e&#34;&gt;# Look at the first few rows of a few columns&lt;/span&gt;
net_probabilities &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;select&lt;/span&gt;(id, net, income, temperature, health, propensity) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;head&lt;/span&gt;()
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 6 x 6&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##      id net   income temperature health propensity&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;dbl&amp;gt; &amp;lt;lgl&amp;gt;  &amp;lt;dbl&amp;gt;       &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt;      &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1     1 TRUE     781        21.1     56      0.367&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2     2 FALSE    974        26.5     57      0.389&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3     3 FALSE    502        25.6     15      0.158&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4     4 TRUE     671        21.3     20      0.263&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5     5 FALSE    728        19.2     17      0.308&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6     6 FALSE   1050        25.3     48      0.429&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The propensity scores are in the &lt;code&gt;propensity&lt;/code&gt; column. Some people, like person 3, are unlikely to use nets (only a 15.8% chance) given their levels of income, temperature, and health. Others like person 6 have a higher probability (42.9%) since their income and health are higher. Neat.&lt;/p&gt;
&lt;p&gt;Next we need to convert those propensity scores into inverse probability weights, which makes weird observations more important (i.e. people who had a high probability of using a net but didn&amp;rsquo;t, and vice versa). To do this, we follow this equation:&lt;/p&gt;
&lt;p&gt;$$
\frac{\text{Treatment}}{\text{Propensity}} - \frac{1 - \text{Treatment}}{1 - \text{Propensity}}
$$&lt;/p&gt;
&lt;p&gt;This equation will create weights that provide the average treatment effect (ATE), but there are other versions that let you find the average treatment effect on the treated (ATT), average treatment effect on the controls (ATC), and a bunch of others. &lt;a href=&#34;https://livefreeordichotomize.com/2019/01/17/understanding-propensity-score-weighting/#how-do-we-incorporate-a-propensity-score-in-a-weight&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;You can find those equations here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We&amp;rsquo;ll use &lt;code&gt;mutate()&lt;/code&gt; to create a column for the inverse probability weight:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;net_ipw &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; net_probabilities &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(ipw &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (net_num &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; propensity) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; ((&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; net_num) &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; propensity)))

&lt;span style=&#34;color:#75715e&#34;&gt;# Look at the first few rows of a few columns&lt;/span&gt;
net_ipw &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;select&lt;/span&gt;(id, net, income, temperature, health, propensity, ipw) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;head&lt;/span&gt;()
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 6 x 7&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##      id net   income temperature health propensity   ipw&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;dbl&amp;gt; &amp;lt;lgl&amp;gt;  &amp;lt;dbl&amp;gt;       &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt;      &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1     1 TRUE     781        21.1     56      0.367  2.72&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2     2 FALSE    974        26.5     57      0.389  1.64&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3     3 FALSE    502        25.6     15      0.158  1.19&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4     4 TRUE     671        21.3     20      0.263  3.81&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5     5 FALSE    728        19.2     17      0.308  1.44&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6     6 FALSE   1050        25.3     48      0.429  1.75&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;These first few rows have fairly low weights—those with low probabilities of using nets didn&amp;rsquo;t, while those with high probabilities did. But look at person 4! They only had a 26% chance of using a net and they &lt;em&gt;did&lt;/em&gt;! That&amp;rsquo;s weird! They therefore have a higher inverse probability weight (3.81).&lt;/p&gt;
&lt;h3 id=&#34;step-2-estimation-1&#34;&gt;Step 2: Estimation&lt;/h3&gt;
&lt;p&gt;Now that we&amp;rsquo;ve generated inverse probability weights based on our confounders, we can run a model to find the causal effect of mosquito net usage on malaria risk. Again, we don&amp;rsquo;t need to include income, temperatures, or health in the model since we already used them when we created the propensity scores and weights:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_ipw &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(malaria_risk &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; net,
                data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; net_ipw,
                weights &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ipw)

&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_ipw)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 2 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term        estimate std.error statistic  p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;          &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)     39.7     0.468      84.7 0.      &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 netTRUE        -10.1     0.658     -15.4 3.21e-50&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Cool! After using the inverse probability weights, we find a -10.13 point causal effect. That&amp;rsquo;s a tiiiny bit off from the true value of 10, but not bad at all!&lt;/p&gt;
&lt;p&gt;It&amp;rsquo;s important to check the values of your inverse probability weights. Sometimes they can get too big, like if someone had an income of 0 and the lowest possible health and lived in a snow field &lt;em&gt;and yet&lt;/em&gt; still used a net. Having really really high IPW values can throw off estimation. To fix this, we can truncate weights at some lower level. There&amp;rsquo;s no universal rule of thumb for a good maximum weight—I&amp;rsquo;ve often seen 10 used. In our mosquito net data, no IPWs are higher than 10 (the max is exactly 10 with person 877), so we don&amp;rsquo;t need to worry about truncation.&lt;/p&gt;
&lt;p&gt;If you did want to truncate, you&amp;rsquo;d do something like this (here we&amp;rsquo;re truncating at 8 instead of 10 so truncation actually does something):&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;net_ipw &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; net_ipw &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# If the IPW is larger than 8, make it 8, otherwise use the current IPW&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(ipw_truncated &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ifelse&lt;/span&gt;(ipw &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;, ipw))

model_ipw_truncated &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(malaria_risk &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; net,
                          data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; net_ipw,
                          weights &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ipw_truncated)

&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_ipw_truncated)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 2 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term        estimate std.error statistic  p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;          &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)     39.7     0.467      85.1 0.      &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 netTRUE        -10.2     0.656     -15.5 4.32e-51&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now the causal effect is -10.19, which is slightly lower and probably less accurate since we don&amp;rsquo;t really have any exceptional cases messing up our original IPW estimate.&lt;/p&gt;
&lt;h2 id=&#34;results-from-all-the-models&#34;&gt;Results from all the models&lt;/h2&gt;
&lt;p&gt;All done! We just used observational data to estimate causal effects. Causation without RCTs! Do you know how neat that is?!&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s compare all the ATEs that we just calculated:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;modelsummary&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Naive&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; model_wrong,
                  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Matched&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; model_matched, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Matched + weights&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; model_matched_wts,
                  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;IPW&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; model_ipw, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;IPW truncated at 8&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; model_ipw_truncated))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table class=&#34;table&#34; style=&#34;width: auto !important; margin-left: auto; margin-right: auto;&#34;&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt;   &lt;/th&gt;
   &lt;th style=&#34;text-align:center;&#34;&gt; Naive &lt;/th&gt;
   &lt;th style=&#34;text-align:center;&#34;&gt; Matched &lt;/th&gt;
   &lt;th style=&#34;text-align:center;&#34;&gt; Matched + weights &lt;/th&gt;
   &lt;th style=&#34;text-align:center;&#34;&gt; IPW &lt;/th&gt;
   &lt;th style=&#34;text-align:center;&#34;&gt; IPW truncated at 8 &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; (Intercept) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 41.937*** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 38.487*** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 36.094*** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 39.679*** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 39.679*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.405) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.600) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.595) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.468) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.467) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;background-color: #F6D645 !important;&#34;&gt; netTRUE &lt;/td&gt;
   &lt;td style=&#34;text-align:center;background-color: #F6D645 !important;&#34;&gt; -16.332*** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;background-color: #F6D645 !important;&#34;&gt; -12.882*** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;background-color: #F6D645 !important;&#34;&gt; -10.489*** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;background-color: #F6D645 !important;&#34;&gt; -10.131*** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;background-color: #F6D645 !important;&#34;&gt; -10.190*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;box-shadow: 0px 1pxborder-bottom: 1px solid&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;box-shadow: 0px 1pxborder-bottom: 1px solid&#34;&gt; (0.649) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;box-shadow: 0px 1pxborder-bottom: 1px solid&#34;&gt; (0.769) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;box-shadow: 0px 1pxborder-bottom: 1px solid&#34;&gt; (0.763) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;box-shadow: 0px 1pxborder-bottom: 1px solid&#34;&gt; (0.658) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;box-shadow: 0px 1pxborder-bottom: 1px solid&#34;&gt; (0.656) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Num.Obs. &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1752 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1120 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1120 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1752 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1752 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; R2 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.265 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.201 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.145 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.119 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.121 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; R2 Adj. &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.265 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.200 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.144 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.119 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.121 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; AIC &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 14030.7 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 8851.7 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 8890.0 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 14274.3 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 14260.5 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; BIC &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 14047.1 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 8866.8 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 8905.0 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 14290.7 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 14276.9 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Log.Lik. &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; -7012.326 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; -4422.846 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; -4441.978 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; -7134.172 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; -7127.255 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; F &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 632.315 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 280.581 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 188.862 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 236.841 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 241.379 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Deviance &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 307298.43 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 176512.42 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 173842.84 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 668442.23 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 663098.21 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; DF Resid &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1750 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1118 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1118 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1750 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1750 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Sigma &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 13.251 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 12.565 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 12.470 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 19.544 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 19.466 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Statistics &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 632.315 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 280.581 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 188.862 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 236.841 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 241.379 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; p &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.000 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.000 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.000 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.000 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; DF &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;
&lt;tr&gt;
&lt;td style=&#34;padding: 0; border:0;&#34; colspan=&#34;100%&#34;&gt;
&lt;sup&gt;&lt;/sup&gt; * p &amp;lt; 0.1, ** p &amp;lt; 0.05, *** p &amp;lt; 0.01&lt;/td&gt;
&lt;/tr&gt;
&lt;/tfoot&gt;
&lt;/table&gt;
&lt;p&gt;Which one is right? In this case, because this is fake simulated data where I built in a 10 point effect, we can see which of these models gets the closest: here, the non-truncated IPW model wins. But that won&amp;rsquo;t always be the case. Both matching and IPW work well for closing backdoors and adjusting for confounders. In real life, you won&amp;rsquo;t know the true value, so try multiple ways.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Randomized controlled trials (RCTs)</title>
      <link>/example/rcts/</link>
      <pubDate>Fri, 02 Oct 2020 00:00:00 +0000</pubDate>
      <guid>/example/rcts/</guid>
      <description>&lt;p&gt;There&amp;rsquo;s no video for this example, since the R code is fairly straightforward, and since &lt;a href=&#34;https://www.youtube.com/watch?v=W0NyALrjLA4&amp;amp;list=PLS6tnpTr39sGJURMOwN9tf9MNDN4t0JMz&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;I talked about it in the lecture&lt;/a&gt; (&lt;a href=&#34;/slides/07-slides.html#26&#34;&gt;see the slides&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;If you want to follow along with this example, you can download the data below:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/data/village_randomized.csv&#34;&gt;&lt;i class=&#34;fas fa-table&#34;&gt;&lt;/i&gt; &lt;code&gt;village_randomized.csv&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(tidyverse)  &lt;span style=&#34;color:#75715e&#34;&gt;# ggplot(), %&amp;gt;%, mutate(), and friends&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(ggdag)  &lt;span style=&#34;color:#75715e&#34;&gt;# Make DAGs&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(scales)  &lt;span style=&#34;color:#75715e&#34;&gt;# Format numbers with functions like comma(), percent(), and dollar()&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(broom)  &lt;span style=&#34;color:#75715e&#34;&gt;# Convert models to data frames&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(patchwork)  &lt;span style=&#34;color:#75715e&#34;&gt;# Combine ggplots into single composite plots&lt;/span&gt;

&lt;span style=&#34;color:#a6e22e&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;)   &lt;span style=&#34;color:#75715e&#34;&gt;# Make all random draws reproducible&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;village_randomized &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;read_csv&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;data/village_randomized.csv&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;program-details&#34;&gt;Program details&lt;/h2&gt;
&lt;p&gt;In this hypothetical situation, an NGO is planning on launching a training program designed to boost incomes. Based on their experiences in running pilot programs in other countries, they&amp;rsquo;ve found that older, richer men tend to self-select into the training program. The NGO&amp;rsquo;s evaluation consultant (you!) drew this causal model explaining the effect of the program on participant incomes, given the confounding caused by age, sex, and prior income:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;income_dag &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;dagify&lt;/span&gt;(post_income &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; program &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; age &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; sex &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; pre_income,
                     program &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; age &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; sex &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; pre_income,
                     exposure &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;program&amp;#34;&lt;/span&gt;,
                     outcome &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;post_income&amp;#34;&lt;/span&gt;,
                     labels &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(post_income &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Post income&amp;#34;&lt;/span&gt;,
                                program &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Program&amp;#34;&lt;/span&gt;,
                                age &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Age&amp;#34;&lt;/span&gt;,
                                sex &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Sex&amp;#34;&lt;/span&gt;,
                                pre_income &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Pre income&amp;#34;&lt;/span&gt;),
                     coords &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(program &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, post_income &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;, age &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;,
                                         sex &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;, pre_income &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;),
                                   y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(program &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, post_income &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, age &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,
                                         sex &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, pre_income &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;)))

&lt;span style=&#34;color:#a6e22e&#34;&gt;ggdag_status&lt;/span&gt;(income_dag, use_labels &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;label&amp;#34;&lt;/span&gt;, text &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;, seed &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;guides&lt;/span&gt;(color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;theme_dag&lt;/span&gt;()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/rcts_files/figure-html/income-dag-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;The NGO just received funding to run a randomized controlled trial (RCT) in a village, and you&amp;rsquo;re excited because you can finally manipulate access to the program—you can calculate &lt;code&gt;\(E(\text{Post-income} | do(\text{Program})\)&lt;/code&gt;. Following the rules of causal diagrams, you get to delete all the arrows going into the program node:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;income_dag_rct &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;dagify&lt;/span&gt;(post_income &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; program &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; age &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; sex &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; pre_income,
                         exposure &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;program&amp;#34;&lt;/span&gt;,
                         outcome &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;post_income&amp;#34;&lt;/span&gt;,
                         labels &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(post_income &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Post income&amp;#34;&lt;/span&gt;,
                                    program &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Program&amp;#34;&lt;/span&gt;,
                                    age &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Age&amp;#34;&lt;/span&gt;,
                                    sex &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Sex&amp;#34;&lt;/span&gt;,
                                    pre_income &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Pre income&amp;#34;&lt;/span&gt;),
                         coords &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(program &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, post_income &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;, age &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;,
                                             sex &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;, pre_income &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;),
                                       y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(program &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, post_income &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, age &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,
                                             sex &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, pre_income &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;)))

&lt;span style=&#34;color:#a6e22e&#34;&gt;ggdag_status&lt;/span&gt;(income_dag_rct, use_labels &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;label&amp;#34;&lt;/span&gt;, text &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;, seed &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1234&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;guides&lt;/span&gt;(color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;theme_dag&lt;/span&gt;()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/rcts_files/figure-html/income-dag-rct-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;h2 id=&#34;1-check-balance&#34;&gt;1. Check balance&lt;/h2&gt;
&lt;p&gt;You ran the study on 1,000 participants over the course of 6 months and you just got your data back.&lt;/p&gt;
&lt;p&gt;Before calculating the effect of the program, you first check to see how well balanced assignment was, and you find that assignment to the program was pretty much split 50/50, which is good:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;village_randomized &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;count&lt;/span&gt;(program) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(prop &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; n &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sum&lt;/span&gt;(n))
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 2 x 3&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   program        n  prop&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;      &amp;lt;int&amp;gt; &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 No program   503 0.503&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 Program      497 0.497&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;You then check to see how well balanced the treatment and control groups were in participants&#39; pre-treatment characteristics:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;village_randomized &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;group_by&lt;/span&gt;(program) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;summarize&lt;/span&gt;(prop_male &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;mean&lt;/span&gt;(sex_num),
            avg_age &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;mean&lt;/span&gt;(age),
            avg_pre_income &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;mean&lt;/span&gt;(pre_income))
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 2 x 4&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   program    prop_male avg_age avg_pre_income&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;          &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;          &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 No program     0.584    34.9           803.&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 Program        0.604    34.9           801.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;These variables appear fairly well balanced. To check that there aren&amp;rsquo;t any statistically significant differences between the groups, you make some graphs (you could run t-tests too, but graphs are easier for your non-statistical audience to read later).&lt;/p&gt;
&lt;p&gt;There were more men in both the treatment and control groups, but the proportion is the same in both, and there&amp;rsquo;s no substantial difference in sex proportion:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Here we save each plot as an object so that we can combine the two plots with&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# + (which comes from the patchwork package). If you want to see what an&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# individual plot looks like, you can run `plot_diff_sex`, or whatever the plot&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# object is named.&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# stat_summary() here is a little different from the geom_*() layers you&amp;#39;ve seen&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# in the past. stat_summary() takes a function (here mean_se()) and runs it on&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# each of the program groups to get the average and standard error. It then&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# plots those with geom_pointrange. The fun.args part of this lets us pass an&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# argument to mean_se() so that we can multiply the standard error by 1.96,&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# giving us the 95% confidence interval.&lt;/span&gt;
plot_diff_sex &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(village_randomized, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; program, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sex_num, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; program)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;stat_summary&lt;/span&gt;(geom &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;pointrange&amp;#34;&lt;/span&gt;, fun.data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;mean_se&amp;#34;&lt;/span&gt;, fun.args &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(mult &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1.96&lt;/span&gt;)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;guides&lt;/span&gt;(color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;labs&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;NULL&lt;/span&gt;, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Proportion male&amp;#34;&lt;/span&gt;)
&lt;span style=&#34;color:#75715e&#34;&gt;# plot_diff_sex  # Uncomment this if you want to see this plot by itself&lt;/span&gt;

plot_prop_sex &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(village_randomized, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; program, fill &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sex)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Using position = &amp;#34;fill&amp;#34; makes the bars range from 0-1 and show the proportion&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_bar&lt;/span&gt;(position &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fill&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;labs&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;NULL&lt;/span&gt;, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Proportion&amp;#34;&lt;/span&gt;, fill &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;NULL&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;scale_fill_manual&lt;/span&gt;(values &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;darkblue&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;darkred&amp;#34;&lt;/span&gt;))

&lt;span style=&#34;color:#75715e&#34;&gt;# Show the plots side-by-side&lt;/span&gt;
plot_diff_sex &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; plot_prop_sex
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/rcts_files/figure-html/balance-sex-1.png&#34; width=&#34;100%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;The distribution of ages looks basically the same in the treatment and control groups, and there&amp;rsquo;s no substantial difference in the average age across groups:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;plot_diff_age &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(village_randomized, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; program, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; age, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; program)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;stat_summary&lt;/span&gt;(geom &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;pointrange&amp;#34;&lt;/span&gt;, fun.data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;mean_se&amp;#34;&lt;/span&gt;, fun.args &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(mult &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1.96&lt;/span&gt;)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;guides&lt;/span&gt;(color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;labs&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;NULL&lt;/span&gt;, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Age&amp;#34;&lt;/span&gt;)

plot_hist_age &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(village_randomized, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; age, fill &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; program)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_histogram&lt;/span&gt;(binwidth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;guides&lt;/span&gt;(fill &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;labs&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Age&amp;#34;&lt;/span&gt;, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Count&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;facet_wrap&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;vars&lt;/span&gt;(program), ncol &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)

plot_diff_age &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; plot_hist_age
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/rcts_files/figure-html/balance-age-1.png&#34; width=&#34;100%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Pre-program income is also distributed the same—and has no substantial difference in averages—across treatment and control groups:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;plot_diff_income &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(village_randomized, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; program, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; pre_income, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; program)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;stat_summary&lt;/span&gt;(geom &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;pointrange&amp;#34;&lt;/span&gt;, fun.data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;mean_se&amp;#34;&lt;/span&gt;, fun.args &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(mult &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1.96&lt;/span&gt;)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;guides&lt;/span&gt;(color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;labs&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;NULL&lt;/span&gt;, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Pre income&amp;#34;&lt;/span&gt;)

plot_hist_income &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(village_randomized, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; pre_income, fill &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; program)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_histogram&lt;/span&gt;(binwidth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;20&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;guides&lt;/span&gt;(fill &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;labs&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Pre income&amp;#34;&lt;/span&gt;, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Count&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;facet_wrap&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;vars&lt;/span&gt;(program), ncol &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)

plot_diff_income &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; plot_hist_income
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/rcts_files/figure-html/balance-income-1.png&#34; width=&#34;100%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;All our pre-treatment covariates look good and balanced! You can now estimate the causal effect of the program.&lt;/p&gt;
&lt;h2 id=&#34;2-estimate-difference&#34;&gt;2. Estimate difference&lt;/h2&gt;
&lt;p&gt;You are interested in the causal effect of the program, or&lt;/p&gt;
&lt;p&gt;$$
E[\text{Post income}\ |\ do(\text{Program})]
$$&lt;/p&gt;
&lt;p&gt;You can find this causal effect by calculating the average treatment effect:&lt;/p&gt;
&lt;p&gt;$$
\text{ATE} = E(\overline{\text{Post income }} | \text{ Program} = 1) - E(\overline{\text{Post income }} | \text{ Program} = 0)
$$&lt;/p&gt;
&lt;p&gt;This is simply the average outcome for people in the program minus the average outcome for people not in the program. You calculate the group averages:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;village_randomized &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;group_by&lt;/span&gt;(program) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;summarize&lt;/span&gt;(avg_post &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;mean&lt;/span&gt;(post_income))
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 2 x 2&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   program    avg_post&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;         &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 No program    1180.&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 Program       1279.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;That&amp;rsquo;s 1279 − 1180, or 99, which means that the program caused an increase of $99 in incomes, on average.&lt;/p&gt;
&lt;p&gt;Finding that difference required some manual math, so as a shortcut, you run a regression model with post-program income as the outcome variable and the program indicator variable as the explanatory variable. The coefficient for &lt;code&gt;program&lt;/code&gt; is the causal effect (and it includes information about standard errors and significance). You find the same result:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_rct &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(post_income &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; program, data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; village_randomized)
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_rct)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 2 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term           estimate std.error statistic  p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;             &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)      1180.       4.27     276.  0.      &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 programProgram     99.2      6.06      16.4 1.23e-53&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Based on your RCT, you conclude that the program causes an average increase of $99.25 in income.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(village_randomized, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; program, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; post_income, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; program)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;stat_summary&lt;/span&gt;(geom &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;pointrange&amp;#34;&lt;/span&gt;, fun.data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;mean_se&amp;#34;&lt;/span&gt;, fun.args &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(mult &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1.96&lt;/span&gt;)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;guides&lt;/span&gt;(color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;labs&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;NULL&lt;/span&gt;, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Post income&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/rcts_files/figure-html/rct-finding-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Potential outcomes, ATEs, and CATEs</title>
      <link>/example/po-ate-cate/</link>
      <pubDate>Sat, 19 Sep 2020 00:00:00 +0000</pubDate>
      <guid>/example/po-ate-cate/</guid>
      <description>&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(tidyverse)     &lt;span style=&#34;color:#75715e&#34;&gt;# ggplot, dplyr, and friends&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(broom)         &lt;span style=&#34;color:#75715e&#34;&gt;# Convert models to data frames&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(scales)        &lt;span style=&#34;color:#75715e&#34;&gt;# This makes it easy to format numbers with dollar(), comma(), etc.&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(ggdag)         &lt;span style=&#34;color:#75715e&#34;&gt;# Draw causal diagrams with R&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(modelsummary)  &lt;span style=&#34;color:#75715e&#34;&gt;# Fancy regression tables&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;theory&#34;&gt;Theory&lt;/h2&gt;
&lt;p&gt;According to the theory explained in chapter 2 of &lt;em&gt;Mastering &amp;lsquo;Metrics&lt;/em&gt;, attending a private university should be causally linked to earnings and income&amp;mdash;that is, going to a private school should make you earn more money. The type of education you receive, however, is not the only factor that influences earnings. People self-select into different types of universities and choose where to apply and which offers to accept. They also choose to not apply to some schools and are also rejected from other schools. Unmeasured characteristics help determine both acceptance to schools and earnings.&lt;/p&gt;
&lt;p&gt;We can draw a simplified version of this causal story with a directed acyclic graph (DAG) or causal model:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;dag &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;dagify&lt;/span&gt;(Y &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; P &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; G,
              P &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; G,
              exposure &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;P&amp;#34;&lt;/span&gt;,
              outcome &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Y&amp;#34;&lt;/span&gt;,
              labels &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(Y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Earnings&amp;#34;&lt;/span&gt;, P &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Private university&amp;#34;&lt;/span&gt;,
                         G &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Student characteristics (group)&amp;#34;&lt;/span&gt;),
              coords &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(Y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, P &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, G &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;),
                            y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(Y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, P &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, G &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;)))

&lt;span style=&#34;color:#a6e22e&#34;&gt;ggdag_status&lt;/span&gt;(dag, use_labels &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;label&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;guides&lt;/span&gt;(color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;# Remove legend&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;theme_dag&lt;/span&gt;()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/po-ate-cate_files/figure-html/earnings-dag-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;h2 id=&#34;effect-of-private-school-on-earnings-no-controls&#34;&gt;Effect of private school on earnings, no controls&lt;/h2&gt;
&lt;p&gt;Because we don&amp;rsquo;t have a time machine, we can&amp;rsquo;t look at individual-level counterfactuals&amp;mdash;we can&amp;rsquo;t send Person 1 to a private school, watch them for 40 years after, and then go back and send Person 1 to a public school and watch them for 40 years. To get around this, we can instead calculated the &lt;em&gt;average&lt;/em&gt; treatment effect, or ATE, and find the average of all individual-level causal effects. We can use the information from our theory&amp;rsquo;s DAG to calculate a (hopefully!) accurate ATE.&lt;/p&gt;
&lt;p&gt;First we load the data from this CSV file (typed from the table in &lt;em&gt;Mastering &amp;lsquo;Metrics&lt;/em&gt;):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/data/public_private_earnings.csv&#34;&gt;&lt;i class=&#34;fas fa-table&#34;&gt;&lt;/i&gt; &lt;code&gt;public_private_earnings.csv&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# The data doesn&amp;#39;t come with an indicator variable marking if students went to a&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# private school, so we create one here. If the string &amp;#34;ivy&amp;#34; is found in the&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# enrolled column, mark it as true, otherwise mark it as false.&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# We also create a variable that indicates if someone is in group A or not that&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# we&amp;#39;ll use in the regression models. We could technically just include the&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# group variable in the model, where it would be treated as a dummy variable,&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# but the reference category would be A, not B, so this is a little trick to&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# force it to show results for group A.&lt;/span&gt;
schools &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;read_csv&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;data/public_private_earnings.csv&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(private &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ifelse&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;str_detect&lt;/span&gt;(enrolled, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ivy&amp;#34;&lt;/span&gt;), &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;)) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(group_A &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ifelse&lt;/span&gt;(group &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;A&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;))

&lt;span style=&#34;color:#75715e&#34;&gt;# Only look at groups A and B, since C and D don&amp;#39;t have people in both public&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# and private schools. | means &amp;#34;or&amp;#34;&lt;/span&gt;
schools_small &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; schools &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(group &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;A&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; group &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;B&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;It&amp;rsquo;s really tempting to just find the average income for private school and subtract it from public school, like so:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;schools_small &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;group_by&lt;/span&gt;(private) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;summarize&lt;/span&gt;(avg_earnings &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;mean&lt;/span&gt;(earnings))
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 2 x 2&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   private avg_earnings&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;lgl&amp;gt;          &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 FALSE          70000&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 TRUE           90000&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;It looks like those who went to private school have $20,000 more in earnings! That&amp;rsquo;s a ton! It&amp;rsquo;s also &lt;em&gt;&lt;strong&gt;incredibly wrong&lt;/strong&gt;&lt;/em&gt;. &lt;em&gt;&lt;strong&gt;Don&amp;rsquo;t do this!&lt;/strong&gt;&lt;/em&gt; This does not account for any confounding or selection bias. According to our DAG, student characteristics are a huge confounder. We need to account for those.&lt;/p&gt;
&lt;p&gt;Following the potential outcomes framework, we can find the ATE by combining the conditional ATEs (or CATEs) for subgroups that are likely to predict outcomes or that bunch up similar observations. Let&amp;rsquo;s use the Group A and B distinction as our subgroups here.&lt;/p&gt;
&lt;p&gt;First we can look at the average income for people in each group, divided by whether they went to a private or public school:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;avg_earnings &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; schools_small &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;group_by&lt;/span&gt;(group, private) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;summarize&lt;/span&gt;(avg_earnings &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;mean&lt;/span&gt;(earnings))

avg_earnings
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 4 x 3&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## # Groups:   group [2]&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   group private avg_earnings&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt; &amp;lt;lgl&amp;gt;          &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 A     FALSE         110000&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 A     TRUE          105000&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 B     FALSE          30000&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4 B     TRUE           60000&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Here we see that group A has higher income on average than group B, regardless of whether they went to a private school. Everyone in group A earns roughly $100,000, while those in group B earn a lot less.&lt;/p&gt;
&lt;p&gt;We can find the exact differences in earnings for public vs. private within each group by pulling the values out of the table and taking their differences&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Pulling out each of the numbers is tedious and a good example of why we use&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# regression instead. filter() selects rows that match the specified conditions&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# (here where group and private both equal something) and pull extracts a column&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# from the dataset. Because we&amp;#39;re filtering this data in a way that makes it&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# only have one row, pull() will extract a single number.&lt;/span&gt;

&lt;span style=&#34;color:#75715e&#34;&gt;# Group A&lt;/span&gt;
income_private_A &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; avg_earnings &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(group &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;A&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; private &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;pull&lt;/span&gt;(avg_earnings)

income_public_A &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; avg_earnings &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(group &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;A&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; private &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;pull&lt;/span&gt;(avg_earnings)

cate_a &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; income_private_A &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; income_public_A
cate_a
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] -5000&lt;/span&gt;

&lt;span style=&#34;color:#75715e&#34;&gt;# Group B&lt;/span&gt;
income_private_B &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; avg_earnings &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(group &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;B&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; private &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;pull&lt;/span&gt;(avg_earnings)

income_public_B &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; avg_earnings &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(group &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;B&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; private &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;pull&lt;/span&gt;(avg_earnings)

cate_b &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; income_private_B &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; income_public_B
cate_b
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] 30000&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The private-public earnings gap for people in Group A (or &lt;code&gt;\(\text{CATE}_\text{Group A}\)&lt;/code&gt;) is −\$5,000, while for Group B (or &lt;code&gt;\(\text{CATE}_\text{Group B}\)&lt;/code&gt;) it is \$30,000. It seems that there&amp;rsquo;s a big effect for Group B, but a small reversed effect for A.&lt;/p&gt;
&lt;p&gt;We want to account for how many people are in each group, though, since A has more people than B, so we calculate the proportion of each group in the same and multiply the group differences by those proportions.&lt;/p&gt;
&lt;p&gt;$$
\text{ATE} = \pi_\text{Group A} \text{CATE}_\text{Group A} + \pi_\text{Group B} \text{CATE}_\text{Group B}
$$&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# We need to find the proportion of people in each group&lt;/span&gt;
prop_in_groups &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; schools_small &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;group_by&lt;/span&gt;(group) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;summarize&lt;/span&gt;(n &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;n&lt;/span&gt;()) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(prop &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; n &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;nrow&lt;/span&gt;(schools_small))
prop_in_groups
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 2 x 3&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   group     n  prop&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt; &amp;lt;int&amp;gt; &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 A         3   0.6&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 B         2   0.4&lt;/span&gt;

prop_A &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; prop_in_groups &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(group &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;A&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;pull&lt;/span&gt;(prop)
prop_B &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; prop_in_groups &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(group &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;B&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;pull&lt;/span&gt;(prop)

&lt;span style=&#34;color:#75715e&#34;&gt;# With those proportions, we can weight the differences in groups correctly&lt;/span&gt;
weighted_effect &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; (cate_a &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; prop_A) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; (cate_b &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; prop_B)
weighted_effect
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] 9000&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;From this it looks like attending a private university causes a bump in earnings of $9,000. This is the average treatment effect (ATE).&lt;/p&gt;
&lt;h2 id=&#34;effect-of-private-school-on-earnings-with-regression-and-controls&#34;&gt;Effect of private school on earnings, with regression and controls&lt;/h2&gt;
&lt;p&gt;Instead of looking at weighted averages (since that&amp;rsquo;s tedious with just two groups—imagine doing all that with 3+ groups!), we can use a regression model that accounts for differences between groups A and B, since something about group A made them way wealthier than group B regardless of school type.&lt;/p&gt;
&lt;p&gt;We do that by predicting earnings based on private/public school attendance while also controlling for group:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_earnings &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(earnings &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; private &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; group_A, data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; schools_small)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_earnings)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 3 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term        estimate std.error statistic p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;          &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)   40000.    11952.     3.35   0.0789&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 privateTRUE   10000.    13093.     0.764  0.525 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 group_ATRUE   60000.    13093.     4.58   0.0445&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;There are three important numbers here. The intercept (or &lt;code&gt;\(\alpha\)&lt;/code&gt; in &lt;em&gt;Mastering &amp;lsquo;Metrics&lt;/em&gt;, or &lt;code&gt;\(\beta_0\)&lt;/code&gt;) is $40,000. This represents the earnings for someone with all the switches and sliders in the model set to 0 or turned off—in this case, someone who went to a public school in group B.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;group_A&lt;/code&gt; coefficient shows the effect of just being in that group. For whatever reason, Group A earns an average of $60,000 more than Group B—&lt;em&gt;for reasons other than education&lt;/em&gt;. This allows us to control for the effect of selection.&lt;/p&gt;
&lt;p&gt;The coefficient for &lt;code&gt;private&lt;/code&gt; is the one we care about the most—this is the causal effect of private schools on earnings (assuming we can justify all the controls and the matching into groups). It is &lt;span&gt;$&lt;/span&gt;10,000, which means that attending a private school gives you that much of a bump in income. This is larger than the &lt;span&gt;$&lt;/span&gt;9,000 we found earlier, but is probably more accurate since we&amp;rsquo;re accounting for other weighted differences between groups.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>DAGs</title>
      <link>/example/dags/</link>
      <pubDate>Fri, 11 Sep 2020 00:00:00 +0000</pubDate>
      <guid>/example/dags/</guid>
      <description>&lt;h2 id=&#34;dags-with-dagittynet&#34;&gt;DAGs with dagitty.net&lt;/h2&gt;
&lt;p&gt;The easiest way to quickly build DAGs and find adjustment sets and testable implications is to use &lt;a href=&#34;http://dagitty.net/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;dagitty.net&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;This video shows how to use it:&lt;/p&gt;
&lt;div class=&#34;embed-responsive embed-responsive-16by9&#34;&gt;
&lt;iframe class=&#34;embed-responsive-item&#34; src=&#34;https://www.youtube.com/embed/3euqrnD9w7c&#34; frameborder=&#34;0&#34; allow=&#34;accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture&#34; allowfullscreen&gt;&lt;/iframe&gt;
&lt;/div&gt;
&lt;h2 id=&#34;dags-with-r-ggdag-and-dagitty&#34;&gt;DAGs with R, ggdag, and dagitty&lt;/h2&gt;
&lt;p&gt;You can use the &lt;a href=&#34;https://ggdag.malco.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;strong&gt;ggdag&lt;/strong&gt;&lt;/a&gt; and &lt;a href=&#34;http://dagitty.net/primer/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;strong&gt;dagitty&lt;/strong&gt;&lt;/a&gt; packages in R to build and work with DAGs too. I typically draw an initial DAG in my browser with dagitty.net and then I rewrite it in code in R so that it&amp;rsquo;s more official and formal and reproducible.&lt;/p&gt;
&lt;h3 id=&#34;live-coding-example&#34;&gt;Live coding example&lt;/h3&gt;
&lt;div class=&#34;embed-responsive embed-responsive-16by9&#34;&gt;
&lt;iframe class=&#34;embed-responsive-item&#34; src=&#34;https://www.youtube.com/embed/uoAjyyToUTE&#34; frameborder=&#34;0&#34; allow=&#34;accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture&#34; allowfullscreen&gt;&lt;/iframe&gt;
&lt;/div&gt;
&lt;h3 id=&#34;basic-dags&#34;&gt;Basic DAGs&lt;/h3&gt;
&lt;p&gt;&lt;em&gt;(This is a heavily cleaned up and annotated version of the code from the video.)&lt;/em&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Load packages&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(tidyverse)  &lt;span style=&#34;color:#75715e&#34;&gt;# For dplyr, ggplot, and friends&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(ggdag)      &lt;span style=&#34;color:#75715e&#34;&gt;# For plotting DAGs&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(dagitty)    &lt;span style=&#34;color:#75715e&#34;&gt;# For working with DAG logic&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The general process for making and working with DAGs in R is to create a DAG object with &lt;code&gt;dagify()&lt;/code&gt; and then plot it with &lt;code&gt;ggdag()&lt;/code&gt;. The documentation for &lt;strong&gt;ggdag&lt;/strong&gt; is really good and helpful and full of examples. Check these pages for all sorts of additional details:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://ggdag.malco.io/articles/intro-to-ggdag.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&amp;ldquo;An introduction to ggdag&amp;rdquo;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://ggdag.malco.io/articles/intro-to-dags.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&amp;ldquo;An introduction to directed acyclic graphs&amp;rdquo;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://ggdag.malco.io/reference/index.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;List of all ggdag-related functions&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The syntax for &lt;code&gt;dagify()&lt;/code&gt; is similar to the formula syntax you&amp;rsquo;ve been using for building regression models with &lt;code&gt;lm()&lt;/code&gt;. The formulas you use in &lt;code&gt;dagify()&lt;/code&gt; indicate the relationships between nodes.&lt;/p&gt;
&lt;p&gt;For instance, in this DAG, &lt;code&gt;y&lt;/code&gt; is caused by &lt;code&gt;x&lt;/code&gt;, &lt;code&gt;a&lt;/code&gt;, and &lt;code&gt;b&lt;/code&gt; (&lt;code&gt;y ~ x + a + b&lt;/code&gt;), and &lt;code&gt;x&lt;/code&gt; is caused by &lt;code&gt;a&lt;/code&gt; and &lt;code&gt;b&lt;/code&gt; (&lt;code&gt;x ~ a + b&lt;/code&gt;). This means that &lt;code&gt;a&lt;/code&gt; and &lt;code&gt;b&lt;/code&gt; are confounders. Use the &lt;code&gt;exposure&lt;/code&gt; and &lt;code&gt;outcome&lt;/code&gt; arguments to specify which nodes are the exposure (or treatment/intervention/program) and the outcome.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Create super basic DAG&lt;/span&gt;
simple_dag &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;dagify&lt;/span&gt;(
  y &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; x &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; a &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; b,
  x &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; a &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; b,
  exposure &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;x&amp;#34;&lt;/span&gt;,
  outcome &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;y&amp;#34;&lt;/span&gt;
)

&lt;span style=&#34;color:#75715e&#34;&gt;# Adding a theme_dag() layer to the plot makes it have a white background with no axis labels&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;ggdag&lt;/span&gt;(simple_dag) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;theme_dag&lt;/span&gt;()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/dags_files/figure-html/super-basic-dag-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;If you want to plot which nodes are the exposure and outcome, use &lt;code&gt;ggdag_status()&lt;/code&gt; instead:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggdag_status&lt;/span&gt;(simple_dag) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;theme_dag&lt;/span&gt;()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/dags_files/figure-html/simple-status-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;h3 id=&#34;layouts-and-manual-coordinates&#34;&gt;Layouts and manual coordinates&lt;/h3&gt;
&lt;p&gt;Notice how the layout is different in both of those graphs. By default, &lt;code&gt;ggdag()&lt;/code&gt; positions the nodes randomly every time using a network algorithm. You can change the algorithm by using the &lt;code&gt;layout&lt;/code&gt; argument: &lt;code&gt;ggdag(simple_dag, layout = &amp;quot;nicely&amp;quot;)&lt;/code&gt;. You can see a full list of possible algorithms by running &lt;code&gt;?layout_tbl_graph_igraph&lt;/code&gt; in the console.&lt;/p&gt;
&lt;p&gt;Alternatively, you can specify your own coordinates so that the nodes are positioned in the same place every time. Do this with the &lt;code&gt;coords&lt;/code&gt; argument in &lt;code&gt;dagify()&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The best way to figure out what these numbers should be is to draw the DAG on paper or on a whiteboard and add a grid to it and then figure out the coordinates. For instance, in this DAG there are three rows and three columns: &lt;code&gt;x&lt;/code&gt; and &lt;code&gt;y&lt;/code&gt; go in the middle row (row 2) while &lt;code&gt;a&lt;/code&gt; and &lt;code&gt;b&lt;/code&gt; go in the middle column (column 2). It can also be helpful to not include &lt;code&gt;theme_dag()&lt;/code&gt; at first so you can see the numbers for the underlying grid. Once you have everything positioned correctly, add &lt;code&gt;theme_dag()&lt;/code&gt; to clean it up.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;simple_dag_with_coords &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;dagify&lt;/span&gt;(
  y &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; x &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; a &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; b,
  x &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; a &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; b,
  exposure &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;x&amp;#34;&lt;/span&gt;,
  outcome &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;y&amp;#34;&lt;/span&gt;,
  coords &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, a &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, b &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;),
                y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, a &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, b &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;))
)

&lt;span style=&#34;color:#a6e22e&#34;&gt;ggdag_status&lt;/span&gt;(simple_dag_with_coords) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;theme_dag&lt;/span&gt;()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/dags_files/figure-html/dag-with-coords-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;h3 id=&#34;node-names-and-labels&#34;&gt;Node names and labels&lt;/h3&gt;
&lt;p&gt;The variable names you use do not have to be limited to just &lt;code&gt;x&lt;/code&gt;, &lt;code&gt;y&lt;/code&gt;, and other lowercase letters. You can any names you want, as long as there are no spaces.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;dag_with_var_names &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;dagify&lt;/span&gt;(
  outcome &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; treatment &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; confounder1 &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; confounder2,
  treatment &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; confounder1 &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; confounder2,
  exposure &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;treatment&amp;#34;&lt;/span&gt;,
  outcome &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;outcome&amp;#34;&lt;/span&gt;
)

&lt;span style=&#34;color:#a6e22e&#34;&gt;ggdag_status&lt;/span&gt;(dag_with_var_names) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;theme_dag&lt;/span&gt;()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/dags_files/figure-html/dag-with-names-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;However, unless you use very short names, it is likely that the text will not fit inside the nodes. To get around this, you can add labels to the nodes using the &lt;code&gt;labels&lt;/code&gt; argument in &lt;code&gt;dagify()&lt;/code&gt;. Plot the labels by setting &lt;code&gt;use_labels = &amp;quot;label&amp;quot;&lt;/code&gt; in &lt;code&gt;ggdag()&lt;/code&gt;. You can turn off the text in the nodes with &lt;code&gt;text = FALSE&lt;/code&gt; in &lt;code&gt;ggdag()&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;simple_dag_with_coords_and_labels &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;dagify&lt;/span&gt;(
  y &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; x &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; a &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; b,
  x &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; a &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; b,
  exposure &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;x&amp;#34;&lt;/span&gt;,
  outcome &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;y&amp;#34;&lt;/span&gt;,
  labels &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Outcome&amp;#34;&lt;/span&gt;, x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Treatment&amp;#34;&lt;/span&gt;,
             a &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Confounder 1&amp;#34;&lt;/span&gt;, b &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Confounder 2&amp;#34;&lt;/span&gt;),
  coords &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, a &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, b &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;),
                y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, a &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, b &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;))
)

&lt;span style=&#34;color:#a6e22e&#34;&gt;ggdag_status&lt;/span&gt;(simple_dag_with_coords_and_labels,
             use_labels &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;label&amp;#34;&lt;/span&gt;, text &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;guides&lt;/span&gt;(fill &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;# Disable the legend&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;theme_dag&lt;/span&gt;()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/dags_files/figure-html/dag-with-labels-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;h3 id=&#34;paths-and-adjustment-sets&#34;&gt;Paths and adjustment sets&lt;/h3&gt;
&lt;p&gt;R can also perform analysis on DAG objects. For example, we can find all the testable implications from the DAG using the &lt;code&gt;impliedConditionalIndependencies()&lt;/code&gt; function from the &lt;strong&gt;dagitty&lt;/strong&gt; package. For this simple DAG, there is only one: &lt;code&gt;a&lt;/code&gt; should be independent of &lt;code&gt;b&lt;/code&gt;. If we had a dataset with columns for each of these variables, we could check if this is true by running &lt;code&gt;cor(a, b)&lt;/code&gt; to see if the two are related.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;impliedConditionalIndependencies&lt;/span&gt;(simple_dag)
&lt;span style=&#34;color:#75715e&#34;&gt;## a _||_ b&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We can also find all the paths between &lt;code&gt;x&lt;/code&gt; and &lt;code&gt;y&lt;/code&gt; using the &lt;code&gt;paths()&lt;/code&gt; function from the &lt;strong&gt;dagitty&lt;/strong&gt; package. We can see that there are three open paths between &lt;code&gt;x&lt;/code&gt; and &lt;code&gt;y&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;paths&lt;/span&gt;(simple_dag)
&lt;span style=&#34;color:#75715e&#34;&gt;## $paths&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] &amp;#34;x -&amp;gt; y&amp;#34;      &amp;#34;x &amp;lt;- a -&amp;gt; y&amp;#34; &amp;#34;x &amp;lt;- b -&amp;gt; y&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## $open&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] TRUE TRUE TRUE&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The first open path is fine—we want a single &lt;em&gt;d&lt;/em&gt;-connected relationship between treatment and outcome—but the other two indicate that there is confounding from &lt;code&gt;a&lt;/code&gt; and &lt;code&gt;b&lt;/code&gt;. We can see what each of these paths are with the &lt;code&gt;ggdag_paths()&lt;/code&gt; function from the &lt;strong&gt;ggdag&lt;/strong&gt; package:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggdag_paths&lt;/span&gt;(simple_dag_with_coords) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;theme_dag&lt;/span&gt;()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/dags_files/figure-html/plot-dag-paths-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Instead of listing out all the possible paths and identifying backdoors by hand, you can use the &lt;code&gt;adjustmentSets()&lt;/code&gt; function in the &lt;strong&gt;dagitty&lt;/strong&gt; package to programmatically find all the nodes that need to be adjusted. Here we see that both &lt;code&gt;a&lt;/code&gt; and &lt;code&gt;b&lt;/code&gt; need to be controlled for to isolate the &lt;code&gt;x -&amp;gt; y&lt;/code&gt; relationship.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;adjustmentSets&lt;/span&gt;(simple_dag)
&lt;span style=&#34;color:#75715e&#34;&gt;## { a, b }&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;You can also visualize the adjustment sets with &lt;code&gt;ggdag_adjustment_set()&lt;/code&gt; in the &lt;strong&gt;ggdag&lt;/strong&gt; package. Make sure you set &lt;code&gt;shadow = TRUE&lt;/code&gt; to draw the arrows coming out of the adjusted nodes—by default, those are not included.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggdag_adjustment_set&lt;/span&gt;(simple_dag_with_coords, shadow &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;theme_dag&lt;/span&gt;()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/dags_files/figure-html/plot-adjustment-sets-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;R will find minimally sufficient adjustment sets, which includes the fewest number of adjustments needed to close all backdoors between &lt;code&gt;x&lt;/code&gt; and &lt;code&gt;y&lt;/code&gt;. In this example DAG there was only one set of variables (&lt;code&gt;a&lt;/code&gt; and &lt;code&gt;b&lt;/code&gt;), but in other situations there could be many possible sets, or none if the causal effect is not identifiable.&lt;/p&gt;
&lt;h3 id=&#34;plot-dag-from-dagittynet-with-ggdag&#34;&gt;Plot DAG from dagitty.net with &lt;code&gt;ggdag()&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;If you use &lt;a href=&#34;http://dagitty.net/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;dagitty.net&lt;/a&gt; to draw a DAG, you&amp;rsquo;ll notice that it generates some code for you in the model code section:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/img/example/dagitty-code.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;You can copy that &lt;code&gt;dag{ ... }&lt;/code&gt; code and paste it into R to define a DAG object rather than use the &lt;code&gt;dagify()&lt;/code&gt; function. To do this, use the &lt;code&gt;dagitty()&lt;/code&gt; function from the &lt;strong&gt;dagitty&lt;/strong&gt; library and include the whole generated model code in single quotes (&lt;code&gt;&#39;&#39;&lt;/code&gt;):&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_from_dagitty &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;dagitty&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;dag {
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;bb=&amp;#34;0,0,1,1&amp;#34;
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;A confounder&amp;#34; [pos=&amp;#34;0.809,0.306&amp;#34;]
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Another confounder&amp;#34; [pos=&amp;#34;0.810,0.529&amp;#34;]
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Some outcome&amp;#34; [outcome,pos=&amp;#34;0.918,0.432&amp;#34;]
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Some treatment&amp;#34; [exposure,pos=&amp;#34;0.681,0.426&amp;#34;]
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;A confounder&amp;#34; -&amp;gt; &amp;#34;Some outcome&amp;#34;
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;A confounder&amp;#34; -&amp;gt; &amp;#34;Some treatment&amp;#34;
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Another confounder&amp;#34; -&amp;gt; &amp;#34;Some outcome&amp;#34;
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Another confounder&amp;#34; -&amp;gt; &amp;#34;Some treatment&amp;#34;
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Some treatment&amp;#34; -&amp;gt; &amp;#34;Some outcome&amp;#34;
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;}
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;)

&lt;span style=&#34;color:#a6e22e&#34;&gt;ggdag&lt;/span&gt;(model_from_dagitty) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;theme_dag&lt;/span&gt;()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/dags_files/figure-html/code-from-dagitty-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;By default it&amp;rsquo;s going to look ugly because (1) the node labels don&amp;rsquo;t fit, and (2) slight differences in the coordinates make it so the nodes don&amp;rsquo;t perfectly align with each other. To fix coordinate alignment, you can modify the numbers in the generated DAG code. Here I rounded the numbers so that they&amp;rsquo;re all 0.3, 0.8, etc.&lt;/p&gt;
&lt;p&gt;To fix the label issue, you can add the &lt;code&gt;use_labels&lt;/code&gt; argument like normally. Only here, you can&amp;rsquo;t specify &lt;code&gt;use_labels = &amp;quot;label&amp;quot;&lt;/code&gt;. Instead, when you specify a DAG using dagitty&amp;rsquo;s code like this, the column in the underlying dataset that contains the labels is named &lt;code&gt;name&lt;/code&gt;, so you need to use &lt;code&gt;use_labels = &amp;quot;name&amp;quot;&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Other &lt;code&gt;ggdag()&lt;/code&gt; variations like &lt;code&gt;ggdag_status()&lt;/code&gt; will still work fine.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_from_dagitty_rounded &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;dagitty&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;dag {
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;bb=&amp;#34;0,0,1,1&amp;#34;
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;A confounder&amp;#34; [pos=&amp;#34;0.8,0.3&amp;#34;]
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Another confounder&amp;#34; [pos=&amp;#34;0.8,0.5&amp;#34;]
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Some outcome&amp;#34; [outcome,pos=&amp;#34;0.9,0.4&amp;#34;]
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Some treatment&amp;#34; [exposure,pos=&amp;#34;0.7,0.4&amp;#34;]
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;A confounder&amp;#34; -&amp;gt; &amp;#34;Some outcome&amp;#34;
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;A confounder&amp;#34; -&amp;gt; &amp;#34;Some treatment&amp;#34;
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Another confounder&amp;#34; -&amp;gt; &amp;#34;Some outcome&amp;#34;
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Another confounder&amp;#34; -&amp;gt; &amp;#34;Some treatment&amp;#34;
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Some treatment&amp;#34; -&amp;gt; &amp;#34;Some outcome&amp;#34;
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;}
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;)

&lt;span style=&#34;color:#a6e22e&#34;&gt;ggdag_status&lt;/span&gt;(model_from_dagitty_rounded, text &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;, use_labels &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;guides&lt;/span&gt;(color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;# Turn off legend&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;theme_dag&lt;/span&gt;()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/dags_files/figure-html/code-from-dagitty-better-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;h2 id=&#34;mosquito-net-example&#34;&gt;Mosquito net example&lt;/h2&gt;
&lt;h3 id=&#34;conditional-independencies&#34;&gt;Conditional independencies&lt;/h3&gt;
&lt;p&gt;You can test if your stated relationships are correct by looking at the conditional independencies that are implied by the DAG. In dagitty.net, these appear in the sidebar in the &amp;ldquo;Testable implications&amp;rdquo; section. To show how this works, we&amp;rsquo;ll use a simulated dataset that I generated about a fictional mosquito net program. Download the data here if you want to follow along:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/data/mosquito_nets.csv&#34;&gt;&lt;i class=&#34;fas fa-table&#34;&gt;&lt;/i&gt; &lt;code&gt;mosquito_nets.csv&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Researchers are interested in whether using mosquito nets decreases an individual&amp;rsquo;s risk of contracting malaria. They have collected data from 1,752 households in an unnamed country and have variables related to environmental factors, individual health, and household characteristics. Additionally, this country has a special government program that provides free mosquito nets to households that meet specific requirements: to qualify for the program, there must be more than 4 members of the household, and the household&amp;rsquo;s monthly income must be lower than $700 a month. Households are not automatically enrolled in the program, and many do not use it. The data is not experimental—researchers have no control over who uses mosquito nets, and individual households make their own choices over whether to apply for free nets or buy their own nets, as well as whether they use the nets if they have them.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;mosquito_dag &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;dagify&lt;/span&gt;(
  malaria_risk &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; net &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; income &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; health &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; temperature &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; resistance,
  net &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; income &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; health &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; temperature &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; eligible &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; household,
  eligible &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; income &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; household,
  health &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; income,
  exposure &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;net&amp;#34;&lt;/span&gt;,
  outcome &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;malaria_risk&amp;#34;&lt;/span&gt;,
  coords &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(malaria_risk &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;, net &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, income &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;, health &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;,
                      temperature &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;, resistance &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;8.5&lt;/span&gt;, eligible &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, household &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;),
                y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(malaria_risk &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, net &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, income &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, health &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,
                      temperature &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, resistance &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, eligible &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, household &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;)),
  labels &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(malaria_risk &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Risk of malaria&amp;#34;&lt;/span&gt;, net &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Mosquito net&amp;#34;&lt;/span&gt;, income &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Income&amp;#34;&lt;/span&gt;,
             health &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Health&amp;#34;&lt;/span&gt;, temperature &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Nighttime temperatures&amp;#34;&lt;/span&gt;,
             resistance &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Insecticide resistance&amp;#34;&lt;/span&gt;,
             eligible &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Eligible for program&amp;#34;&lt;/span&gt;, household &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Number in household&amp;#34;&lt;/span&gt;)
)

&lt;span style=&#34;color:#a6e22e&#34;&gt;ggdag_status&lt;/span&gt;(mosquito_dag, use_labels &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;label&amp;#34;&lt;/span&gt;, text &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;guides&lt;/span&gt;(fill &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;# Disable the legend&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;theme_dag&lt;/span&gt;()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/dags_files/figure-html/build-mosquito-dag-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;The causal graph above  outlines the complete relationship between mosquito net use and risk of malaria. Each node in the DAG is a column in the dataset collected by the researchers, and includes the following:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Malaria risk (&lt;code&gt;malaria_risk&lt;/code&gt;): The likelihood that someone in the household will be infected with malaria. Measured on a scale of 0–100, with higher values indicating higher risk.&lt;/li&gt;
&lt;li&gt;Mosquito net (&lt;code&gt;net&lt;/code&gt; and &lt;code&gt;net_num&lt;/code&gt;): A binary variable indicating if the household used mosquito nets.&lt;/li&gt;
&lt;li&gt;Eligible for program (&lt;code&gt;eligible&lt;/code&gt;): A binary variable indicating if the household is eligible for the free net program.&lt;/li&gt;
&lt;li&gt;Income (&lt;code&gt;income&lt;/code&gt;): The household&amp;rsquo;s monthly income, in US dollars.&lt;/li&gt;
&lt;li&gt;Nighttime temperatures (&lt;code&gt;temperature&lt;/code&gt;): The average temperature at night, in Celsius.&lt;/li&gt;
&lt;li&gt;Health (&lt;code&gt;health&lt;/code&gt;): Self-reported healthiness in the household. Measured on a scale of 0–100, with higher values indicating better health.&lt;/li&gt;
&lt;li&gt;Number in household (&lt;code&gt;household&lt;/code&gt;): Number of people living in the household.&lt;/li&gt;
&lt;li&gt;Insecticide resistance (&lt;code&gt;resistance&lt;/code&gt;): Some strains of mosquitoes are more resistant to insecticide and thus pose a higher risk of infecting people with malaria. This is measured on a scale of 0–100, with higher values indicating higher resistance.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;According to the DAG, malaria risk is caused by income, temperatures, health, insecticide resistance, and mosquito net use. People who live in hotter regions, have lower incomes, have worse health, are surrounded by mosquitoes with high resistance to insecticide, and who do not use mosquito nets are at higher risk of contracting malaria than those who do not. Mosquito net use is caused by income, nighttime temperatures, health, the number of people living in the house, and eligibility for the free net program. People who live in areas that are cooler at night, have higher incomes, have better health, have more people in the home, and are eligible for free government nets are more likely to regularly use nets than those who do not. The DAG also shows that eligibility for the free net program is caused by income and household size, since households must meet specific thresholds to qualify.&lt;/p&gt;
&lt;p&gt;First, let&amp;rsquo;s download the dataset, put in a folder named &lt;code&gt;data&lt;/code&gt;, and load it:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/data/mosquito_nets.csv&#34;&gt;&lt;i class=&#34;fas fa-table&#34;&gt;&lt;/i&gt; &lt;code&gt;mosquito_nets.csv&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Load the data.&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# It&amp;#39;d be a good idea to click on the &amp;#34;mosquito_nets.csv&amp;#34; object in the&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# Environment panel in RStudio to see what the data looks like after you load it&lt;/span&gt;
mosquito_nets &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;read_csv&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;data/mosquito_nets.csv&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We can use this data to check if the relationships defined by our DAG reflect reality. Recall that &lt;em&gt;d&lt;/em&gt;-separation implies that nodes are statistically independent of each other and do not transfer associational information. If you draw the mosquito net DAG with dagitty.net, or if you run &lt;code&gt;impliedConditionalIndependencies()&lt;/code&gt; in R, you can see a list of all the implied conditional independencies.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;impliedConditionalIndependencies&lt;/span&gt;(mosquito_dag)
&lt;span style=&#34;color:#75715e&#34;&gt;## elgb _||_ hlth | incm&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## elgb _||_ mlr_ | hlth, incm, net, tmpr&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## elgb _||_ rsst&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## elgb _||_ tmpr&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## hlth _||_ hshl&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## hlth _||_ rsst&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## hlth _||_ tmpr&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## hshl _||_ incm&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## hshl _||_ mlr_ | hlth, incm, net, tmpr&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## hshl _||_ rsst&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## hshl _||_ tmpr&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## incm _||_ rsst&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## incm _||_ tmpr&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## net _||_ rsst&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## rsst _||_ tmpr&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The &lt;code&gt;_||_&lt;/code&gt; symbol in the output here is the &lt;code&gt;\(\perp\)&lt;/code&gt; symbol, which means &amp;ldquo;independent of&amp;rdquo;. The &lt;code&gt;|&lt;/code&gt; in the output means &amp;ldquo;given&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;In the interest of space, we will not verify all these implied independencies, but we can test a few of them:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;\(\text{Health} \perp \text{Household members}\)&lt;/code&gt;: (Read as &lt;em&gt;&amp;ldquo;Health is independent of household member count&amp;rdquo;&lt;/em&gt;.) Health should be independent of the number of people in each household. In the data, the two variables should not be correlated. This is indeed the case:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;cor&lt;/span&gt;(mosquito_nets&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;health, mosquito_nets&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;household)
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] 9.8e-05&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;\(\text{Income} \perp \text{Insecticide resistance}\)&lt;/code&gt;: (Read as &lt;em&gt;&amp;ldquo;Income is independent of insecticide resistance&amp;rdquo;&lt;/em&gt;.) Income should be independent of insecticide resistance. This is again true:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;cor&lt;/span&gt;(mosquito_nets&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;income, mosquito_nets&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;resistance)
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] 0.014&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;\(\text{Malaria risk} \perp \text{Household members}\ |\ \text{Health, Income, Bed net use, Temperature}\)&lt;/code&gt;: (Read as &lt;em&gt;&amp;ldquo;Malaria risk is independent of house member count given health, income, bed net use, and temperature&amp;rdquo;&lt;/em&gt;.) Malaria risk should be independent of the number of household members given similar levels of health, income, mosquito net use, and nighttime temperatures. We cannot use &lt;code&gt;cor()&lt;/code&gt; to test this implication, since there are many variables involved, but we can use a regression model to check if the number of household members is significantly related to malaria risk. It is not significant ($t = -0.17$, &lt;code&gt;\(p = 0.863\)&lt;/code&gt;), which means the two are independent, as expected.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(malaria_risk &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; household &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; health &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; income &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; net &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; temperature,
   data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; mosquito_nets) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  broom&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;()
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 6 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term        estimate std.error statistic   p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;          &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)  76.2      0.966      78.9   0.       &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 household    -0.0155   0.0893     -0.173 8.63e-  1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 health        0.148    0.0107     13.9   9.75e- 42&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4 income       -0.0751   0.00104   -72.6   0.       &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5 netTRUE     -10.4      0.266     -39.2   2.63e-241&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6 temperature   1.01     0.0310     32.5   1.88e-181&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We can check all the other conditional independencies to see if the DAG captures the reality of the full system of factors that influence mosquito net use and malaria risk. If there are substantial and significant correlations between nodes that should be independent, there is likely an issue with the specification of the DAG. Return to the theory of how the phenomena are generated and refine the DAG more.&lt;/p&gt;
&lt;h3 id=&#34;mosquito-net-adjustment-sets&#34;&gt;Mosquito net adjustment sets&lt;/h3&gt;
&lt;p&gt;There is a direct path between mosquito net use and the risk of malaria, but the effect is not causally identified due to several other open paths. We can either list out all the paths and find which open paths have arrows pointing backwards into the mosquito net node (run &lt;code&gt;paths(mosquito_dag)&lt;/code&gt; to see these results), or we can let R find the appropriate adjustment sets automatically:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;adjustmentSets&lt;/span&gt;(mosquito_dag)
&lt;span style=&#34;color:#75715e&#34;&gt;## { health, income, temperature }&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Based on the relationships between all the nodes in the DAG, adjusting for health, income, and temperature is enough to close all backdoors and identify the relationship between net use and malaria risk. Importantly, we do not need to worry about any of the nodes related to the government program for free nets, since those nodes are not &lt;em&gt;d&lt;/em&gt;-connected to malaria risk. We only need to worry about confounding relationships.&lt;/p&gt;
&lt;p&gt;We can confirm this graphically with &lt;code&gt;ggdag_adjustment_set()&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggdag_adjustment_set&lt;/span&gt;(mosquito_dag, shadow &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;,
                     use_labels &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;label&amp;#34;&lt;/span&gt;, text &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;theme_dag&lt;/span&gt;()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/dags_files/figure-html/plot-mosquito-adjustment-fake-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Regression</title>
      <link>/example/regression/</link>
      <pubDate>Wed, 26 Aug 2020 00:00:00 +0000</pubDate>
      <guid>/example/regression/</guid>
      <description>&lt;script src=&#34;/rmarkdown-libs/kePrint-0.0.1/kePrint.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;/rmarkdown-libs/lightable-0.0.1/lightable.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;p&gt;If you want to follow along with this example, you can download the data below:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/projects/regression-example/data/sat_gpa.csv&#34;&gt;&lt;i class=&#34;fas fa-table&#34;&gt;&lt;/i&gt; &lt;code&gt;sat_gpa.csv&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;You can also download a complete &lt;code&gt;.zip&lt;/code&gt; file with a finished R Markdown file that you can knit and play with on your own:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/projects/regression-example.zip&#34;&gt;&lt;i class=&#34;fas fa-file-archive&#34;&gt;&lt;/i&gt; &lt;code&gt;regression-example.zip&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;live-coding-example&#34;&gt;Live coding example&lt;/h2&gt;
&lt;div class=&#34;embed-responsive embed-responsive-16by9&#34;&gt;
&lt;iframe class=&#34;embed-responsive-item&#34; src=&#34;https://www.youtube.com/embed/E-Zz5S5NOUo&#34; frameborder=&#34;0&#34; allow=&#34;accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture&#34; allowfullscreen&gt;&lt;/iframe&gt;
&lt;/div&gt;
&lt;h2 id=&#34;complete-code&#34;&gt;Complete code&lt;/h2&gt;
&lt;p&gt;&lt;em&gt;(This is a heavily cleaned up and annotated version of the code from the video.)&lt;/em&gt;&lt;/p&gt;
&lt;h3 id=&#34;introduction&#34;&gt;Introduction&lt;/h3&gt;
&lt;p&gt;SAT scores have long been a major factor in college admissions, under the assumption that students with higher test scores will perform better in college and receive a higher GPA. The SAT&amp;rsquo;s popularity &lt;a href=&#34;https://www.washingtonpost.com/news/answer-sheet/wp/2017/04/12/the-list-of-test-optional-colleges-and-universities-keeps-growing-despite-college-boards-latest-jab/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;has dropped in recent years&lt;/a&gt;, though, and this summer, the &lt;a href=&#34;http://www.chicagotribune.com/news/local/breaking/ct-university-chicago-sat-act-20180614-story.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;University of Chicago announced that it would stop requiring SAT scores for all prospective undergraduates&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Educational Testing Service (ETS), the creator of the SAT, collected SAT scores, high school GPAs, and freshman-year-college GPAs for 1,000 students at an unnamed university.&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;p&gt;You are a university admissions officer and you are curious if SAT scores really do predict college performance. You&amp;rsquo;re also interested in other factors that could influence student performance.&lt;/p&gt;
&lt;p&gt;The data contains 6 variables:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;sex&lt;/code&gt;: The sex of the student (male or female; female is the base case)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;sat_verbal&lt;/code&gt;: The student&amp;rsquo;s &lt;em&gt;percentile&lt;/em&gt; score in the verbal section of the SAT&lt;/li&gt;
&lt;li&gt;&lt;code&gt;sat_math&lt;/code&gt;: The student&amp;rsquo;s &lt;em&gt;percentile&lt;/em&gt; score in the math section of the SAT&lt;/li&gt;
&lt;li&gt;&lt;code&gt;sat_total&lt;/code&gt;: &lt;code&gt;sat_verbal&lt;/code&gt; + &lt;code&gt;sat_math&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;gpa_hs&lt;/code&gt;: The student&amp;rsquo;s GPA in high school at graduation&lt;/li&gt;
&lt;li&gt;&lt;code&gt;gpa_fy&lt;/code&gt;: The student&amp;rsquo;s GPA at the end of their freshman year&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# First we load the libraries and data&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(tidyverse)     &lt;span style=&#34;color:#75715e&#34;&gt;# This lets you create plots with ggplot, manipulate data, etc.&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(broom)         &lt;span style=&#34;color:#75715e&#34;&gt;# This lets you convert regression models into nice tables&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(modelsummary)  &lt;span style=&#34;color:#75715e&#34;&gt;# This lets you combine multiple regression models into a single table&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Load the data.&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# It&amp;#39;d be a good idea to click on the &amp;#34;sat_gpa&amp;#34; object in the Environment panel&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# in RStudio to see what the data looks like after you load it.&lt;/span&gt;
sat_gpa &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;read_csv&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;data/sat_gpa.csv&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;exploratory-questions&#34;&gt;Exploratory questions&lt;/h3&gt;
&lt;h4 id=&#34;how-well-do-sat-scores-correlate-with-freshman-gpa&#34;&gt;How well do SAT scores correlate with freshman GPA?&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Note the syntax here with the $. That lets you access columns. The general&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# pattern is name_of_data_set$name_of_column&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;cor&lt;/span&gt;(sat_gpa&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;gpa_fy, sat_gpa&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;sat_total)
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] 0.46&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;SAT scores and first-year college GPA are moderately positively correlated (r = 0.46). As one goes up, the other also tends to go up.&lt;/p&gt;
&lt;p&gt;Here&amp;rsquo;s what that relationship looks like:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(sat_gpa, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sat_total, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; gpa_fy)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_point&lt;/span&gt;(size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_smooth&lt;/span&gt;(method &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lm&amp;#34;&lt;/span&gt;, se &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;labs&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Total SAT score&amp;#34;&lt;/span&gt;, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Freshman GPA&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/regression_files/figure-html/plot-sat-gpa-correlation-1.png&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;h4 id=&#34;how-well-does-high-school-gpa-correlate-with-freshman-gpa&#34;&gt;How well does high school GPA correlate with freshman GPA?&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;cor&lt;/span&gt;(sat_gpa&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;gpa_fy, sat_gpa&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;gpa_hs)
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] 0.54&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;High school and freshman GPAs are also moderately correlated (r = 0.54), but with a slightly stronger relationship.&lt;/p&gt;
&lt;p&gt;Here&amp;rsquo;s what that relationship looks like:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(sat_gpa, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; gpa_hs, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; gpa_fy)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_point&lt;/span&gt;(size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_smooth&lt;/span&gt;(method &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lm&amp;#34;&lt;/span&gt;, se &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;labs&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;High school GPA&amp;#34;&lt;/span&gt;, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Freshman GPA&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/regression_files/figure-html/plot-hs-gpa-correlation-1.png&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;h4 id=&#34;is-the-correlation-between-sat-scores-and-freshman-gpa-stronger-for-men-or-for-women&#34;&gt;Is the correlation between SAT scores and freshman GPA stronger for men or for women?&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# We can calculate the correlation for subgroups within the data with slightly&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# different syntax. Notice how this uses the pipe (%&amp;gt;%), which makes it read&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# like English. We can say &amp;#34;Take the sat_gpa data set, split it into groups&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# based on sex, and calculate the correlation between sat_total and gpa_fy in&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# each of the groups&lt;/span&gt;
sat_gpa &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;group_by&lt;/span&gt;(sex) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;summarize&lt;/span&gt;(correlation &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;cor&lt;/span&gt;(sat_total, gpa_fy))
&lt;span style=&#34;color:#75715e&#34;&gt;## `summarise()` ungrouping output (override with `.groups` argument)&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 2 x 2&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   sex    correlation&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;        &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 Female       0.493&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 Male         0.481&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We can calculate the correlation between SAT scores and freshman GPA for both sexes to see if there are any differences. The correlation is slightly stronger for women, but it&amp;rsquo;s hardly noticeable (r = 0.49 for females, r = 0.48 for males)&lt;/p&gt;
&lt;p&gt;This is apparent visually if we include a trendline for each sex. The lines are essentially parallel:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# The only difference between this graph and the earlier two is that it is&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# coloring by sex&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(sat_gpa, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; gpa_hs, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; gpa_fy, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sex)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_point&lt;/span&gt;(size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_smooth&lt;/span&gt;(method &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lm&amp;#34;&lt;/span&gt;, se &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;FALSE&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;labs&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;High school GPA&amp;#34;&lt;/span&gt;, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Freshman GPA&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/regression_files/figure-html/plot-sat-gpa-correlation-sex-1.png&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;h4 id=&#34;is-the-correlation-between-high-school-gpa-and-freshman-gpa-stronger-for-men-or-for-women&#34;&gt;Is the correlation between high school GPA and freshman GPA stronger for men or for women?&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;sat_gpa &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;group_by&lt;/span&gt;(sex) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;summarize&lt;/span&gt;(correlation &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;cor&lt;/span&gt;(gpa_hs, gpa_fy))
&lt;span style=&#34;color:#75715e&#34;&gt;## `summarise()` ungrouping output (override with `.groups` argument)&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 2 x 2&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   sex    correlation&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;        &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 Female       0.597&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 Male         0.483&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;There is a noticeable difference between men and women in the correlation between high school and college GPA. For men, the two are moderately correlated (r = 0.48), while for women the relationship is much stronger (r = 0.60). High school grades might be a better predictor of college grades for women than for men.&lt;/p&gt;
&lt;h3 id=&#34;models&#34;&gt;Models&lt;/h3&gt;
&lt;h4 id=&#34;do-sat-scores-predict-freshman-gpas&#34;&gt;Do SAT scores predict freshman GPAs?&lt;/h4&gt;
&lt;p&gt;We can build a model that predicts college GPAs (our outcome variable, or dependent variable) using SAT scores (our main explanatory variable):&lt;/p&gt;
&lt;p&gt;$$
\text{freshman GPA} = \beta_0 + \beta_1 \text{SAT total} + \epsilon
$$&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_sat_gpa &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(gpa_fy &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; sat_total, data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sat_gpa)

&lt;span style=&#34;color:#75715e&#34;&gt;# Look at the model results and include confidence intervals for the coefficients&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_sat_gpa, conf.int &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 2 x 7&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term        estimate std.error statistic  p.value conf.low conf.high&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;          &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)  0.00193   0.152      0.0127 9.90e- 1  -0.296     0.300 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 sat_total    0.0239    0.00146   16.4    1.39e-53   0.0210    0.0267&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Here&amp;rsquo;s what these coefficients mean:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The intercept (or &lt;code&gt;\(\beta_0\)&lt;/code&gt;) is 0.002, which means that the average freshman GPA will be 0.002 when the total SAT percentile score is 0. This is a pretty nonsensical number (nobody has a score that low), so we can ignore it.&lt;/li&gt;
&lt;li&gt;The slope of &lt;code&gt;sat_total&lt;/code&gt; (or &lt;code&gt;\(\beta_1\)&lt;/code&gt;) is 0.024, which means that a 1 percentile increase in SAT score is associated with a 0.024 point increase in GPA, on average.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We can look at the summary table of the regression to check the &lt;code&gt;\(R^2\)&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;glance&lt;/span&gt;(model_sat_gpa)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 1 x 12&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   r.squared adj.r.squared sigma statistic  p.value    df logLik   AIC   BIC deviance df.residual  nobs&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##       &amp;lt;dbl&amp;gt;         &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;       &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1     0.212         0.211 0.658      268. 1.39e-53     1  -999. 2005. 2019.     432.         998  1000&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The &lt;code&gt;\(R^2\)&lt;/code&gt; here is 0.212, which means that SAT scores explain 21% of the variation in freshman GPA. It&amp;rsquo;s not a fantastic model, but it explains some stuff.&lt;/p&gt;
&lt;h4 id=&#34;does-a-certain-type-of-sat-score-have-a-larger-effect-on-freshman-gpas&#34;&gt;Does a certain type of SAT score have a larger effect on freshman GPAs?&lt;/h4&gt;
&lt;p&gt;The &lt;code&gt;sat_total&lt;/code&gt; variable combines both &lt;code&gt;sat_math&lt;/code&gt; and &lt;code&gt;sat_verbal&lt;/code&gt;. We can disaggregate the total score to see the effect of each portion of the test on freshman GPA, using the following model:&lt;/p&gt;
&lt;p&gt;$$
\text{freshman GPA} = \beta_0 + \beta_1 \text{SAT verbal} + \beta_2 \text{SAT math} + \epsilon
$$&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_sat_gpa_types &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(gpa_fy &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; sat_verbal &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; sat_math, data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sat_gpa)

&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_sat_gpa_types, conf.int &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 3 x 7&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term        estimate std.error statistic  p.value conf.low conf.high&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;          &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)  0.00737   0.152      0.0484 9.61e- 1  -0.291     0.306 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 sat_verbal   0.0254    0.00286    8.88   3.07e-18   0.0198    0.0310&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 sat_math     0.0224    0.00279    8.04   2.58e-15   0.0169    0.0279&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Again, the intercept is meaningless since no student has a zero on both the verbal and the math test. The slope for &lt;code&gt;sat_verbal&lt;/code&gt; (or &lt;code&gt;\(\beta_1\)&lt;/code&gt;) is 0.025, so a one percentile point increase in the verbal SAT is associated with a 0.025 point increase in GPA, on average, controlling for math scores. Meanwhile, a one percentile point increase in the math SAT ($\beta_2$) is associated with a 0.022 point increase in GPA, on average, controlling for verbal scores. These are essentially the same, so at first glance, it doesn&amp;rsquo;t seem like the type of test has substantial bearing on college GPAs.&lt;/p&gt;
&lt;p&gt;The adjusted &lt;code&gt;\(R^2\)&lt;/code&gt; (which we need to look at because we&amp;rsquo;re using more than one explanatory variable) is 0.211, which means that this model explains 21% of the variation in college GPA. Like before, this isn&amp;rsquo;t great, but it tells us a little bit about the importance of SAT scores.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;glance&lt;/span&gt;(model_sat_gpa_types)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 1 x 12&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   r.squared adj.r.squared sigma statistic  p.value    df logLik   AIC   BIC deviance df.residual  nobs&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##       &amp;lt;dbl&amp;gt;         &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;       &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1     0.212         0.211 0.658      134. 2.36e-52     2  -999. 2006. 2026.     432.         997  1000&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;do-high-school-gpas-predict-freshman-gpas&#34;&gt;Do high school GPAs predict freshman GPAs?&lt;/h4&gt;
&lt;p&gt;We can also use high school GPA to predict freshman GPA, using the following model:&lt;/p&gt;
&lt;p&gt;$$
\text{freshman GPA} = \beta_0 + \beta_1 \text{high school GPA} + \epsilon
$$&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_sat_gpa_hs &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(gpa_fy &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; gpa_hs, data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sat_gpa)

&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_sat_gpa_hs)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 2 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term        estimate std.error statistic  p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;          &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)   0.0913    0.118      0.775 4.39e- 1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 gpa_hs        0.743     0.0363    20.4   6.93e-78&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The intercept here ($\beta_0$) is 0.091, which means that a student with a high school GPA of zero would have a predicted freshman GPA of 0.091, on average. This is nonsensical, so we can ignore it. The slope for &lt;code&gt;gpa_hs&lt;/code&gt; ($\beta_1$), on the other hand, is helpful. For every 1 point increase in GPA (i.e. moving from 2.0 to 3.0, or 3.0 to 4.0), there&amp;rsquo;s an associated increase in college GPA of 0.743 points, on average.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;\(R^2\)&lt;/code&gt; value is 0.295, which means that nearly 30% of the variation in college GPA can be explained by high school GPA. Neat.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;glance&lt;/span&gt;(model_sat_gpa_hs)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 1 x 12&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   r.squared adj.r.squared sigma statistic  p.value    df logLik   AIC   BIC deviance df.residual  nobs&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##       &amp;lt;dbl&amp;gt;         &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;       &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1     0.295         0.295 0.622      418. 6.93e-78     1  -943. 1893. 1908.     386.         998  1000&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;college-gpa--sat--sex&#34;&gt;College GPA ~ SAT + sex&lt;/h4&gt;
&lt;p&gt;Next, we can see how both SAT scores and sex affect variation in college GPA with the following model:&lt;/p&gt;
&lt;p&gt;$$
\text{freshman GPA} = \beta_0 + \beta_1 \text{SAT total} + \beta_2 \text{sex} + \epsilon
$$&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_sat_sex &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(gpa_fy &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; sat_total &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; sex, data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sat_gpa)

&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_sat_sex, conf.int &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 3 x 7&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term        estimate std.error statistic  p.value conf.low conf.high&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;          &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)  -0.0269   0.149      -0.181 8.57e- 1  -0.319     0.265 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 sat_total     0.0255   0.00145    17.6   1.14e-60   0.0227    0.0284&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 sexMale      -0.274    0.0414     -6.62  6.05e-11  -0.355    -0.193&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Here, stuff gets interesting. The intercept ($\beta_0$) is once again nonsensical—females with a 0 score on their SAT would have a -0.027 college GPA on average. There&amp;rsquo;s a positive effect with our &lt;code&gt;\(\beta_1\)&lt;/code&gt; (or &lt;code&gt;sat_total&lt;/code&gt;), since controlling for sex, a one percentile point increase in SAT scores is associated with a 0.026 point increase in freshman GPA, on average. If we control for SAT scores, males see an average drop of 0.274 points ($\beta_2$) in their college GPAs.&lt;/p&gt;
&lt;p&gt;The combination of these two variables, however, doesn&amp;rsquo;t boost the model&amp;rsquo;s explanatory power that much. The adjusted &lt;code&gt;\(R^2\)&lt;/code&gt; (which we must look at because we&amp;rsquo;re using more than one explanatory variable) is 0.243, meaning that the model explains a little over 24% of the variation in college GPAs.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;glance&lt;/span&gt;(model_sat_sex)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 1 x 12&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   r.squared adj.r.squared sigma statistic  p.value    df logLik   AIC   BIC deviance df.residual  nobs&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##       &amp;lt;dbl&amp;gt;         &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;       &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1     0.245         0.243 0.644      162. 1.44e-61     2  -978. 1964. 1983.     414.         997  1000&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;college-gpa--sat--high-school-gpa--sex&#34;&gt;College GPA ~ SAT + high school GPA + sex&lt;/h4&gt;
&lt;p&gt;Finally we can see what the effect of SAT scores, high school GPA, and sex is on college GPAs all at the same time, using the following model:&lt;/p&gt;
&lt;p&gt;$$
\text{freshman GPA} = \beta_0 + \beta_1 \text{SAT total} + \beta_2 \text{high school GPA} + \beta_3 \text{sex} + \epsilon
$$&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_sat_hs_sex &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(gpa_fy &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; sat_total &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; gpa_hs &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; sex, data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; sat_gpa)

&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_sat_hs_sex, conf.int &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 4 x 7&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term        estimate std.error statistic  p.value conf.low conf.high&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;          &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)  -0.836    0.148       -5.63 2.35e- 8  -1.13     -0.544 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 sat_total     0.0158   0.00150     10.5  9.72e-25   0.0129    0.0188&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 gpa_hs        0.545    0.0394      13.8  6.61e-40   0.467     0.622 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4 sexMale      -0.143    0.0391      -3.66 2.66e- 4  -0.220    -0.0664&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We can say the following things about these results:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Yet again, the intercept ($\beta_0$) can be safely ignored. Here it means that a female with a 0.0 high school GPA and an SAT score of 0 would have a college GPA of -0.84, on average. That&amp;rsquo;s pretty impossible.&lt;/li&gt;
&lt;li&gt;The &lt;code&gt;\(\beta_1\)&lt;/code&gt; coefficient for &lt;code&gt;sat_total&lt;/code&gt; indicates that taking into account high school GPA and sex, a one percentile point increase in a student&amp;rsquo;s SAT score is associated with a 0.016 point increase in their college GPA, on average.&lt;/li&gt;
&lt;li&gt;Controlling for SAT scores and sex, a one point increase in high school GPA is associated with a 0.545 point (this is &lt;code&gt;\(\beta_2\)&lt;/code&gt;) increase in college GPA, on average. This coefficient is lower than the 0.74 point coefficient we found previously. That&amp;rsquo;s because SAT scores and sex soaked up some of high school GPA&amp;rsquo;s explanatory power.&lt;/li&gt;
&lt;li&gt;Taking SAT scores and high school GPAs into account, males have a 0.143 point lower GPA in college, on average (this is &lt;code&gt;\(\beta_3\)&lt;/code&gt;)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;As always, the adjusted &lt;code&gt;\(R^2\)&lt;/code&gt; shows us how well the model fits overall (again, we have to look at the adjusted &lt;code&gt;\(R^2\)&lt;/code&gt; because we have more than one explanatory variable). In this case, the model explains 36.5% of the variation in college GPA, which is higher than any of the previous models (but not phenomenal, in the end).&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;glance&lt;/span&gt;(model_sat_hs_sex)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 1 x 12&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   r.squared adj.r.squared sigma statistic  p.value    df logLik   AIC   BIC deviance df.residual  nobs&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##       &amp;lt;dbl&amp;gt;         &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;       &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1     0.367         0.365 0.590      192. 2.67e-98     3  -890. 1790. 1815.     347.         996  1000&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;which-model-best-predicts-freshman-gpa-how-do-you-know&#34;&gt;Which model best predicts freshman GPA? How do you know?&lt;/h4&gt;
&lt;p&gt;As you&amp;rsquo;ve learned in previous stats classes, adjusted &lt;code&gt;\(R^2\)&lt;/code&gt; generally shows the strength of a model&amp;rsquo;s fit, or how well the model will predict future values of the outcome variable. If we compare the adjusted &lt;code&gt;\(R^2\)&lt;/code&gt; for each of the models, we see that the &amp;ldquo;best&amp;rdquo; model is the last one.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# The modelsummary() function takes a bunch of different regression models and&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# puts them in a neat side-by-side table. In a normal report or analysis, you&amp;#39;d&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# include all of these once instead of going one by one like we did above.&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;modelsummary&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(model_sat_gpa, model_sat_gpa_types, model_sat_gpa_hs,
                  model_sat_sex, model_sat_hs_sex))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table class=&#34;table&#34; style=&#34;width: auto !important; margin-left: auto; margin-right: auto;&#34;&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt;   &lt;/th&gt;
   &lt;th style=&#34;text-align:center;&#34;&gt; Model 1 &lt;/th&gt;
   &lt;th style=&#34;text-align:center;&#34;&gt; Model 2 &lt;/th&gt;
   &lt;th style=&#34;text-align:center;&#34;&gt; Model 3 &lt;/th&gt;
   &lt;th style=&#34;text-align:center;&#34;&gt; Model 4 &lt;/th&gt;
   &lt;th style=&#34;text-align:center;&#34;&gt; Model 5 &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; (Intercept) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.002 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.007 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.091 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; -0.027 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; -0.836 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.152) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.152) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.118) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.149) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.148) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; sat_total &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.024 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.026 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.016 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.001) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.001) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.002) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; sat_verbal &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.025 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.003) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; sat_math &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.022 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.003) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; gpa_hs &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.743 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.545 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.036) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.039) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; sexMale &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; -0.274 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; -0.143 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.041) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.039) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Num.Obs. &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1000 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1000 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1000 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1000 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; R2 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.212 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.212 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.295 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.245 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.367 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; R2 Adj. &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.211 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.211 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.295 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.243 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.365 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; AIC &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 2004.8 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 2006.4 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1893.0 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1963.8 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1790.2 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; BIC &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 2019.5 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 2026.0 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1907.7 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1983.4 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1814.8 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Log.Lik. &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; -999.382 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; -999.189 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; -943.477 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; -977.904 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; -890.108 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; F &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 268.270 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 134.244 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 418.071 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 161.762 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 192.141 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;section class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;This is real data about real students, &lt;a href=&#34;https://www.dartmouth.edu/~chance/course/Syllabi/Princeton96/Class12.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;compiled and cleaned by a professor at Dartmouth.&lt;/a&gt; &lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;
</description>
    </item>
    
    <item>
      <title>Welcome to R, RStudio, and the tidyverse!</title>
      <link>/example/rstudio-tidyverse/</link>
      <pubDate>Mon, 24 Aug 2020 00:00:00 +0000</pubDate>
      <guid>/example/rstudio-tidyverse/</guid>
      <description>&lt;h2 id=&#34;part-1-the-basics-of-r-and-dplyr&#34;&gt;Part 1: The basics of R and dplyr&lt;/h2&gt;
&lt;p&gt;For this week&amp;rsquo;s problem set, you need to work through a few of RStudio&amp;rsquo;s introductory primers. You&amp;rsquo;ll do these in your browser and type code and see results there.&lt;/p&gt;
&lt;p&gt;You&amp;rsquo;ll learn some of the basics of R, as well as some powerful methods for manipulating data with the &lt;strong&gt;dplyr&lt;/strong&gt; package.&lt;/p&gt;
&lt;p&gt;Complete these primers. It seems like there are a lot, but they&amp;rsquo;re short and go fairly quickly (especially as you get the hang of the syntax). Also, &lt;strong&gt;I have no way of seeing what you do or what you get wrong or right&lt;/strong&gt;, and that&amp;rsquo;s totally fine! If you get stuck and want to skip some (or if it gets too easy), go right ahead and skip them!&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;The Basics&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://rstudio.cloud/learn/primers/1.1&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Visualization Basics&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://rstudio.cloud/learn/primers/1.2&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Programming Basics&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Work with Data&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://rstudio.cloud/learn/primers/2.1&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Working with Tibbles&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://rstudio.cloud/learn/primers/2.2&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Isolating Data with dplyr&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://rstudio.cloud/learn/primers/2.3&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Deriving Information with dplyr&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Visualize Data&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://rstudio.cloud/learn/primers/3.1&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Exploratory Data Analysis&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://rstudio.cloud/learn/primers/3.2&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Bar Charts&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://rstudio.cloud/learn/primers/3.3&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Histograms&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://rstudio.cloud/learn/primers/3.4&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Boxplots and Counts&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://rstudio.cloud/learn/primers/3.5&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Scatterplots&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://rstudio.cloud/learn/primers/3.6&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Line plots&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://rstudio.cloud/learn/primers/3.7&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Overplotting and Big Data&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://rstudio.cloud/learn/primers/3.8&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Customize Your Plots&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Tidy Your Data&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://rstudio.cloud/learn/primers/4.1&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Reshape Data&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;note&#34;&gt;
Recent versions of &lt;strong&gt;tidyr&lt;/strong&gt; have renamed these core functions: &lt;code&gt;gather()&lt;/code&gt; is now &lt;code&gt;pivot_longer()&lt;/code&gt; and &lt;code&gt;spread()&lt;/code&gt; is now &lt;code&gt;pivot_wider()&lt;/code&gt;. The syntax for these &lt;code&gt;pivot_*()&lt;/code&gt; functions is &lt;em&gt;slightly&lt;/em&gt; different from what it was in &lt;code&gt;gather()&lt;/code&gt; and &lt;code&gt;spread()&lt;/code&gt;, so you can&amp;rsquo;t just replace the names. Fortunately, both &lt;code&gt;gather()&lt;/code&gt; and &lt;code&gt;spread()&lt;/code&gt; still work and won&amp;rsquo;t go away for a while, so you can still use them as you learn about reshaping and tidying data. It would be worth learning how the newer &lt;code&gt;pivot_*()&lt;/code&gt; functions work, eventually, though (&lt;a href=&#34;https://tidyr.tidyverse.org/articles/pivot.html&#34;&gt;see here for examples&lt;/a&gt;).
&lt;/div&gt;

&lt;p&gt;The content from these primers comes from the (free and online!) book &lt;a href=&#34;https://r4ds.had.co.nz/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;em&gt;R for Data Science&lt;/em&gt; by Garrett Grolemund and Hadley Wickham&lt;/a&gt;. I highly recommend the book as a reference and for continuing to learn and use R in the future.&lt;/p&gt;
&lt;h2 id=&#34;part-2-getting-familiar-with-rstudio&#34;&gt;Part 2: Getting familiar with RStudio&lt;/h2&gt;
&lt;p&gt;The RStudio primers you just worked through are a great introduction to writing and running R code, but you typically won&amp;rsquo;t type code in a browser when you work with R. Instead, you&amp;rsquo;ll use a nicer programming environment like RStudio, which lets you type and save code in scripts, run code from those scripts, and see the output of that code, all in the same program.&lt;/p&gt;
&lt;p&gt;To get familiar with RStudio, watch this video (it&amp;rsquo;s from PMAP 8921, but the content still applies here):&lt;/p&gt;
&lt;div class=&#34;embed-responsive embed-responsive-16by9&#34;&gt;
&lt;iframe class=&#34;embed-responsive-item&#34; src=&#34;https://www.youtube.com/embed/cnQ-v1UUWyE&#34; frameborder=&#34;0&#34; allow=&#34;accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture&#34; allowfullscreen&gt;&lt;/iframe&gt;
&lt;/div&gt;
&lt;h2 id=&#34;part-3-rstudio-projects&#34;&gt;Part 3: RStudio Projects&lt;/h2&gt;
&lt;p&gt;One of the most powerful and useful aspects of RStudio is its ability to manage projects.&lt;/p&gt;
&lt;p&gt;When you first open R, it is &amp;ldquo;pointed&amp;rdquo; at some folder on your computer, and anything you do will be relative to that folder. The technical term for this is a &amp;ldquo;working directory.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;When you first open RStudio, look in the area right at the top of the Console pane to see your current working directory. Most likely you&amp;rsquo;ll see something cryptic: &lt;code&gt;~/&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/img/example/working-directory.png&#34; width=&#34;50%&#34; /&gt;&lt;/p&gt;
&lt;p&gt;That tilde sign (&lt;code&gt;~&lt;/code&gt;) is a shortcut that stands for your user directory. On Windows this is &lt;code&gt;C:\Users\your_user_name\&lt;/code&gt;; on macOS this is &lt;code&gt;/Users/your_user_name/&lt;/code&gt;. With the working directory set to &lt;code&gt;~/&lt;/code&gt;, R is &amp;ldquo;pointed&amp;rdquo; at that folder, and anything you save will end up in that folder, and R will expect any data that you load to be there too.&lt;/p&gt;
&lt;p&gt;It&amp;rsquo;s always best to point R at some other directory. If you don&amp;rsquo;t use RStudio, you need to manually set the working directory to where you want it with &lt;code&gt;setwd()&lt;/code&gt;, and many R scripts in the wild include something like &lt;code&gt;setwd(&amp;quot;C:\\Users\\bill\\Desktop\\Important research project&amp;quot;)&lt;/code&gt; at the beginning to change the directory. &lt;strong&gt;THIS IS BAD THOUGH&lt;/strong&gt; (&lt;a href=&#34;https://www.tidyverse.org/blog/2017/12/workflow-vs-script/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;see here for an explanation&lt;/a&gt;). If you ever move that directory somewhere else, or run the script on a different computer, or share the project with someone, the path will be wrong and nothing will run and you will be sad.&lt;/p&gt;
&lt;p&gt;The best way to deal with working directories with RStudio is to use RStudio Projects. These are special files that RStudio creates for you that end in a &lt;code&gt;.Rproj&lt;/code&gt; extension. When you open one of these special files, a new RStudio instance will open up and be pointed at the correct directory automatically. If you move the folder later or open it on a different computer, it will work just fine and you will not be sad.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://r4ds.had.co.nz/workflow-projects.html#rstudio-projects&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Read this super short chapter on RStudio projects to learn how to create and use them&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;In general, you can create a new project by going to File &amp;gt; New Project &amp;gt; New Directory &amp;gt; Empty Project, which will create a new folder on your computer that is empty except for a single &lt;code&gt;.Rproj&lt;/code&gt; file. Double click on that file to open an RStudio instance that is pointed at the correct folder.&lt;/p&gt;
&lt;h2 id=&#34;part-4-getting-familiar-with-r-markdown&#34;&gt;Part 4: Getting familiar with R Markdown&lt;/h2&gt;
&lt;p&gt;To ensure that the analysis and graphics you make are reproducible, you&amp;rsquo;ll do the majority of your work in this class using &lt;strong&gt;R Markdown&lt;/strong&gt; files.&lt;/p&gt;
&lt;p&gt;Do the following things:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Watch this video:&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;embed-responsive embed-responsive-16by9&#34;&gt;
&lt;iframe class=&#34;embed-responsive-item&#34; src=&#34;https://player.vimeo.com/video/178485416?color=428bca&#34; frameborder=&#34;0&#34;  allow=&#34;autoplay; fullscreen&#34; allowfullscreen&gt;&lt;/iframe&gt;
&lt;/div&gt;
&lt;p&gt; &lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;
&lt;p&gt;Skim through the content at these pages:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/resource/markdown/&#34;&gt;Using Markdown&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/resource/rmarkdown/&#34;&gt;Using R Markdown&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://rmarkdown.rstudio.com/lesson-2.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;How it Works&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://rmarkdown.rstudio.com/lesson-3.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Code Chunks&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://rmarkdown.rstudio.com/lesson-4.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Inline Code&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://rmarkdown.rstudio.com/lesson-8.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Markdown Basics&lt;/a&gt; (The &lt;a href=&#34;https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;R Markdown Reference Guide&lt;/a&gt; is super useful here.)&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://rmarkdown.rstudio.com/lesson-9.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Output Formats&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Watch this video (again, it&amp;rsquo;s from PMAP 8921, but the content works for this class):&lt;/p&gt;
 &lt;div class=&#34;embed-responsive embed-responsive-16by9&#34;&gt;
 &lt;iframe class=&#34;embed-responsive-item&#34; src=&#34;https://www.youtube.com/embed/fT5xI1cmE2c&#34; frameborder=&#34;0&#34; allow=&#34;accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture&#34; allowfullscreen&gt;&lt;/iframe&gt;
 &lt;/div&gt;
&lt;/li&gt;
&lt;/ol&gt;
</description>
    </item>
    
    <item>
      <title>Instrumental variables</title>
      <link>/example/iv/</link>
      <pubDate>Wed, 08 Apr 2020 00:00:00 +0000</pubDate>
      <guid>/example/iv/</guid>
      <description>&lt;script src=&#34;/rmarkdown-libs/kePrint/kePrint.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;/rmarkdown-libs/lightable/lightable.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;/rmarkdown-libs/kePrint/kePrint.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;/rmarkdown-libs/lightable/lightable.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;/rmarkdown-libs/kePrint/kePrint.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;/rmarkdown-libs/lightable/lightable.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;h2 id=&#34;video-walk-through&#34;&gt;Video walk-through&lt;/h2&gt;
&lt;p&gt;If you want to follow along with this example, you can download these three datasets:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/data/father_education.csv&#34;&gt;&lt;i class=&#34;fas fa-table&#34;&gt;&lt;/i&gt; &lt;code&gt;father_education.csv&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/data/wage2.csv&#34;&gt;&lt;i class=&#34;fas fa-table&#34;&gt;&lt;/i&gt; &lt;code&gt;wage2.csv&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/data/card.csv&#34;&gt;&lt;i class=&#34;fas fa-table&#34;&gt;&lt;/i&gt; &lt;code&gt;card.csv&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;There&amp;rsquo;s a set of videos that walks through each section below. To make it easier for you to jump around the video examples, I cut the long video into smaller pieces and included them all in &lt;a href=&#34;https://www.youtube.com/playlist?list=PLS6tnpTr39sF97TfofFZ1O-bOQtB4ygZQ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;one YouTube playlist&lt;/a&gt;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=h-rx-dXo74Y&amp;amp;list=PLS6tnpTr39sF97TfofFZ1O-bOQtB4ygZQ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Getting started&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=wHTiAbGwKe4&amp;amp;list=PLS6tnpTr39sF97TfofFZ1O-bOQtB4ygZQ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Checking instrument validity&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=tnerIh0uMxU&amp;amp;list=PLS6tnpTr39sF97TfofFZ1O-bOQtB4ygZQ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Manual 2SLS&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=EI-knWTbH-s&amp;amp;list=PLS6tnpTr39sF97TfofFZ1O-bOQtB4ygZQ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;One-step 2SLS&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=W8Up5OOPtEY&amp;amp;list=PLS6tnpTr39sF97TfofFZ1O-bOQtB4ygZQ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Checking instrument validity (real data)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=6sp8sYrRv5c&amp;amp;list=PLS6tnpTr39sF97TfofFZ1O-bOQtB4ygZQ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2SLS (real data)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=uDr4nsWkG2c&amp;amp;list=PLS6tnpTr39sF97TfofFZ1O-bOQtB4ygZQ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Validity + 2SLS (real data)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;You can also watch the playlist (and skip around to different sections) here:&lt;/p&gt;
&lt;div class=&#34;embed-responsive embed-responsive-16by9&#34;&gt;
&lt;iframe class=&#34;embed-responsive-item&#34; src=&#34;https://www.youtube.com/embed/playlist?list=PLS6tnpTr39sF97TfofFZ1O-bOQtB4ygZQ&#34; frameborder=&#34;0&#34; allow=&#34;accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture&#34; allowfullscreen&gt;&lt;/iframe&gt;
&lt;/div&gt;
&lt;h2 id=&#34;background&#34;&gt;Background&lt;/h2&gt;
&lt;p&gt;For all these examples, we&amp;rsquo;re interested in the perennial econometrics question of whether an extra year of education causes increased wages. Economists love this stuff.&lt;/p&gt;
&lt;p&gt;We&amp;rsquo;ll explore the question with three different datasets: a fake one I made up and two real ones from published research.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/data/father_education.csv&#34;&gt;&lt;i class=&#34;fas fa-table&#34;&gt;&lt;/i&gt; &lt;code&gt;father_education.csv&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/data/wage2.csv&#34;&gt;&lt;i class=&#34;fas fa-table&#34;&gt;&lt;/i&gt; &lt;code&gt;wage2.csv&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/data/card.csv&#34;&gt;&lt;i class=&#34;fas fa-table&#34;&gt;&lt;/i&gt; &lt;code&gt;card.csv&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Make sure you load all these libraries before getting started:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(tidyverse)  &lt;span style=&#34;color:#75715e&#34;&gt;# ggplot(), %&amp;gt;%, mutate(), and friends&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(broom)  &lt;span style=&#34;color:#75715e&#34;&gt;# Convert models to data frames&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(modelsummary)  &lt;span style=&#34;color:#75715e&#34;&gt;# Create side-by-side regression tables&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(kableExtra)  &lt;span style=&#34;color:#75715e&#34;&gt;# Add fancier formatting to tables&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(estimatr)  &lt;span style=&#34;color:#75715e&#34;&gt;# Run 2SLS models in one step with iv_robust()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;education-wages-and-fathers-education-fake-data&#34;&gt;Education, wages, and father&amp;rsquo;s education (fake data)&lt;/h2&gt;
&lt;p&gt;First let&amp;rsquo;s use some fake data to see if education causes additional wages.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;ed_fake &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;read_csv&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;data/father_education.csv&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The &lt;code&gt;father_education.csv&lt;/code&gt; file contains four variables:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Variable name&lt;/th&gt;
&lt;th&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;wage&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Weekly wage&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;educ&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Years of education&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;ability&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Magical column that measures your ability to work and go to school (omitted variable)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;fathereduc&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Years of education for father&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;naive-model&#34;&gt;Naive model&lt;/h3&gt;
&lt;p&gt;If we could actually measure ability, we could estimate this model, which closes the confounding backdoor posed by ability and isolates just the effect of education on wages:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_forbidden &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(wage &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; educ &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; ability, data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ed_fake)
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_forbidden)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 3 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term        estimate std.error statistic   p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;          &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)  -85.6      7.20       -11.9 1.42e- 30&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 educ           7.77     0.456       17.1 2.08e- 57&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 ability        0.344    0.0104      33.2 2.14e-163&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;However, in real life we don&amp;rsquo;t have &lt;code&gt;ability&lt;/code&gt;, so we&amp;rsquo;re stuck with a naive model:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_naive &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(wage &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; educ, data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ed_fake)
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_naive)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 2 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term        estimate std.error statistic  p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;          &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)    -59.4    10.4       -5.72 1.39e- 8&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 educ            13.1     0.618     21.2  6.47e-83&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The naive model overestimates the effect of education on wages (12.2 vs. 9.24) because of omitted variable bias. Education suffers from endogeneity&amp;mdash;there are things in the model (like ability, hidden in the error term) that are correlated with it. Any estimate we calculate will be wrong and biased because of selection effects or omitted variable bias (all different names for endogeneity).&lt;/p&gt;
&lt;h3 id=&#34;check-instrument-validity&#34;&gt;Check instrument validity&lt;/h3&gt;
&lt;p&gt;To fix the endogeneity problem, we can use an instrument to remove the endogeneity from education and instead use a special exogeneity-only version of education. Perhaps someone&amp;rsquo;s father&amp;rsquo;s education can be an instrument for education (it&amp;rsquo;s not the greatest instrument, but we&amp;rsquo;ll go with it).&lt;/p&gt;
&lt;p&gt;For an instrument to be valid, it must meet three criteria:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Relevance&lt;/strong&gt;: Instrument is correlated with policy variable&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Exclusion&lt;/strong&gt;: Instrument is correlated with outcome &lt;em&gt;only through&lt;/em&gt; the policy variable&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Exogeneity&lt;/strong&gt;: Instrument isn&amp;rsquo;t correlated with anything else in the model (i.e. omitted variables)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;Relevance&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;We can first test relevance by making a scatterplot and running a model of &lt;code&gt;policy ~ instrument&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(ed_fake, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; fathereduc, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; educ)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_point&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_smooth&lt;/span&gt;(method &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lm&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/iv_files/figure-html/unnamed-chunk-3-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;
check_relevance &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(educ &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; fathereduc, data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ed_fake)
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(check_relevance)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 2 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term        estimate std.error statistic  p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;          &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)    2.25     0.172       13.1 3.67e-36&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 fathereduc     0.916    0.0108      84.5 0.&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;glance&lt;/span&gt;(check_relevance)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 1 x 12&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   r.squared adj.r.squared sigma statistic p.value    df logLik   AIC   BIC deviance df.residual  nobs&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##       &amp;lt;dbl&amp;gt;         &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;       &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1     0.877         0.877 0.703     7136.       0     1 -1066. 2137. 2152.     493.         998  1000&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This looks pretty good! The F-statistic is definitely above 10 (it&amp;rsquo;s 7,136!), and there&amp;rsquo;s a significant relationship between the instrument and policy. I&amp;rsquo;d say that this is relevant.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Exclusion&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;To check for exclusion, we need to see if there&amp;rsquo;s a relationship between father&amp;rsquo;s education and wages that occurs &lt;em&gt;only&lt;/em&gt; because of education. If we plot it, we&amp;rsquo;ll see a relationship:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(ed_fake, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; fathereduc, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; wage)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_point&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_smooth&lt;/span&gt;(method &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lm&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/iv_files/figure-html/unnamed-chunk-4-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;That&amp;rsquo;s to be expected, since in our model, father&amp;rsquo;s education causes education which causes wages&amp;mdash;they should be correlated. But we have to use a convincing story + theory to justify the idea that a father&amp;rsquo;s education increases the hourly wage &lt;em&gt;only because it increases one&amp;rsquo;s education&lt;/em&gt;, and there&amp;rsquo;s no real statistical test for that. Good luck.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Exogeneity&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;There&amp;rsquo;s not really a test for exogeneity either, since there&amp;rsquo;s no way to measure other endogenous variables in the model (that&amp;rsquo;s the whole reason we&amp;rsquo;re using IVs in the first place!). Because we have the magical &lt;code&gt;ability&lt;/code&gt; column in this fake data, we can test it. Father&amp;rsquo;s education shouldn&amp;rsquo;t be related to ability:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(ed_fake, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ability, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; fathereduc)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_point&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_smooth&lt;/span&gt;(method &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lm&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/iv_files/figure-html/unnamed-chunk-5-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;And it&amp;rsquo;s not! We can safely say that it meets the exogeneity assumption.&lt;/p&gt;
&lt;p&gt;In real life, though there&amp;rsquo;s no statistical test for exogeneity. We just have to tell a theory-based story that the number of years of education one&amp;rsquo;s father has is not correlated with anything else in the model (including any omitted variables). Good luck with that&amp;mdash;it&amp;rsquo;s probably not a good instrument. This relates to Scott Cunningham&amp;rsquo;s argument that instruments have to be weird. &lt;a href=&#34;https://twitter.com/causalinf/status/1194069373935337473&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;According to Scott&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The reason I think this is because an instrument doesn’t belong in the structural error term and the structural error term is all the intuitive things that determine your outcome. So it &lt;em&gt;must&lt;/em&gt; be weird, otherwise it’s probably in the error term.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Let&amp;rsquo;s just pretend that father&amp;rsquo;s education &lt;em&gt;is&lt;/em&gt; a valid instrument and move on :)&lt;/p&gt;
&lt;h3 id=&#34;2sls-manually&#34;&gt;2SLS manually&lt;/h3&gt;
&lt;p&gt;Now we can do two-stage least squares (2SLS) regression and use the instrument to filter out the endogenous part of education. The first stage predicts education based on the instrument (we already ran this model earlier when checking for relevance, but we&amp;rsquo;ll do it again just for fun):&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;first_stage &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(educ &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; fathereduc, data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ed_fake)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now we want to add a column of predicted education to our original dataset. The easiest way to do that is with the &lt;code&gt;augment_columns()&lt;/code&gt; function from the &lt;strong&gt;broom&lt;/strong&gt; library, which plugs values from a dataset into a model to generate predictions:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;ed_fake_with_prediction &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;augment_columns&lt;/span&gt;(first_stage, ed_fake)
&lt;span style=&#34;color:#a6e22e&#34;&gt;head&lt;/span&gt;(ed_fake_with_prediction)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 6 x 11&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##    wage  educ ability fathereduc .fitted .se.fit  .resid    .hat .sigma    .cooksd .std.resid&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;      &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt;      &amp;lt;dbl&amp;gt;      &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1  180.  18.5    408.       17.2    18.0  0.0270  0.576  0.00147  0.703 0.000496       0.820 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2  100.  16.2    310.       15.5    16.4  0.0224 -0.203  0.00102  0.703 0.0000424     -0.289 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3  125.  18.2    303.       17.7    18.4  0.0306 -0.259  0.00189  0.703 0.000129      -0.369 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4  178.  16.6    342.       15.6    16.5  0.0223  0.0522 0.00101  0.703 0.00000278     0.0743&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5  265.  17.3    534.       14.7    15.8  0.0248  1.58   0.00124  0.702 0.00316        2.25  &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6  187.  17.5    409.       16.0    16.9  0.0224  0.577  0.00101  0.703 0.000342       0.822&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Note a couple of these new columns. &lt;code&gt;.fitted&lt;/code&gt; is the fitted/predicted value of education, and it&amp;rsquo;s the version of education with endogeneity arguably removed. &lt;code&gt;.resid&lt;/code&gt; shows how far off the prediction is from &lt;code&gt;educ&lt;/code&gt;. The other columns don&amp;rsquo;t matter so much.&lt;/p&gt;
&lt;p&gt;Instead of dealing with weird names like &lt;code&gt;.fitted&lt;/code&gt;, I like to rename the fitted variable to something more understandable after I use &lt;code&gt;augment_columns&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;ed_fake_with_prediction &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;augment_columns&lt;/span&gt;(first_stage, ed_fake) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;rename&lt;/span&gt;(educ_hat &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; .fitted)

&lt;span style=&#34;color:#a6e22e&#34;&gt;head&lt;/span&gt;(ed_fake_with_prediction)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 6 x 11&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##    wage  educ ability fathereduc educ_hat .se.fit  .resid    .hat .sigma    .cooksd .std.resid&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;      &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt;      &amp;lt;dbl&amp;gt;      &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1  180.  18.5    408.       17.2     18.0  0.0270  0.576  0.00147  0.703 0.000496       0.820 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2  100.  16.2    310.       15.5     16.4  0.0224 -0.203  0.00102  0.703 0.0000424     -0.289 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3  125.  18.2    303.       17.7     18.4  0.0306 -0.259  0.00189  0.703 0.000129      -0.369 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4  178.  16.6    342.       15.6     16.5  0.0223  0.0522 0.00101  0.703 0.00000278     0.0743&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5  265.  17.3    534.       14.7     15.8  0.0248  1.58   0.00124  0.702 0.00316        2.25  &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6  187.  17.5    409.       16.0     16.9  0.0224  0.577  0.00101  0.703 0.000342       0.822&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We can now use the new &lt;code&gt;educ_hat&lt;/code&gt; variable in our second stage model:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;second_stage &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(wage &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; educ_hat, data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ed_fake_with_prediction)
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(second_stage)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 2 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term        estimate std.error statistic  p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;          &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)    28.8     12.7        2.27 2.32e- 2&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 educ_hat        7.83     0.755     10.4  5.10e-24&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The estimate for &lt;code&gt;educ_hat&lt;/code&gt; is arguably more accurate now because we&amp;rsquo;ve used the instrument to remove the endogenous part of education and should only have the exogenous part.&lt;/p&gt;
&lt;h3 id=&#34;2sls-in-one-step&#34;&gt;2SLS in one step&lt;/h3&gt;
&lt;p&gt;Doing all that two-stage work is neat and it helps with the intuition of instrumental variables, but it&amp;rsquo;s tedious. More importntly, the standard errors for &lt;code&gt;educ_hat&lt;/code&gt; are wrong and the &lt;code&gt;\(R^2\)&lt;/code&gt; and other diagnostics for the second stage model are wrong too. You can use fancy math to adjust these things in the second stage, but we&amp;rsquo;re not going to do that. Instead, we&amp;rsquo;ll use a function that does both stages of the 2SLS model at the same time!&lt;/p&gt;
&lt;p&gt;There are several functions from different R packages that let you do 2SLS, and they all work a little differently and have different benefits:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://declaredesign.org/r/estimatr/articles/getting-started.html#iv_robust&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;iv_robust()&lt;/code&gt; from &lt;strong&gt;estimatr&lt;/strong&gt;&lt;/a&gt;:
&lt;ul&gt;
&lt;li&gt;Syntax: &lt;code&gt;outcome ~ treatment | instrument&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Benefits: Handles robust and clustered standard errors&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/john-d-fox/ivreg/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;ivreg()&lt;/code&gt; from &lt;strong&gt;ivreg&lt;/strong&gt;&lt;/a&gt;:
&lt;ul&gt;
&lt;li&gt;Syntax: &lt;code&gt;outcome ~ treatment | instrument&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Benefits: Includes a ton of fancy diagnostics&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://raw.githack.com/uo-ec607/lectures/master/08-regression/08-regression.html#Option_1:_AER::ivreg%28%29&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;ivreg()&lt;/code&gt; from &lt;strong&gt;AER&lt;/strong&gt;&lt;/a&gt;:
&lt;ul&gt;
&lt;li&gt;Syntax: &lt;code&gt;outcome ~ treatment | instrument&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Benefits: Includes special tests for weak instruments (that are better than the standard &amp;ldquo;check if F &amp;gt; 10&amp;rdquo;), like Anderson-Rubin confidence intervals&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://raw.githack.com/uo-ec607/lectures/master/08-regression/08-regression.html#Option_3:_felm::lfe%28%29&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;lfe()&lt;/code&gt; from &lt;strong&gt;felm&lt;/strong&gt;&lt;/a&gt;:
&lt;ul&gt;
&lt;li&gt;Syntax: &lt;code&gt;outcome ~ treatment | fixed effects | instrument&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Benefits: Handles fixed effects really quickly (kind of like &lt;code&gt;feols()&lt;/code&gt; that you used in Problem Set 5)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cran.r-project.org/web/packages/plm/vignettes/plmPackage.html#instrumental-variable-estimators&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;plm()&lt;/code&gt; from &lt;strong&gt;plm&lt;/strong&gt;&lt;/a&gt;:
&lt;ul&gt;
&lt;li&gt;Syntax: &lt;code&gt;outcome ~ treatment | instrument&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Benefits: Handles panel data (country/year, state/year, etc.)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&#34;https://raw.githack.com/uo-ec607/lectures/master/08-regression/08-regression.html#Instrumental_variables&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;This page here has more detailed examples of the main three&lt;/a&gt;: &lt;code&gt;iv_robust()&lt;/code&gt;, &lt;code&gt;ivreg()&lt;/code&gt;, and &lt;code&gt;lfe()&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;I typically like using &lt;code&gt;iv_robust()&lt;/code&gt;, so we&amp;rsquo;ll do that here. Instead of running a first stage, generating predictions, and running a second stage, we can do it all at once like this:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_2sls &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;iv_robust&lt;/span&gt;(wage &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; educ &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; fathereduc,
                        data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ed_fake)
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_2sls)
&lt;span style=&#34;color:#75715e&#34;&gt;##          term estimate std.error statistic p.value conf.low conf.high  df outcome&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)     28.8     11.16       2.6 1.0e-02      6.9      50.7 998    wage&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2        educ      7.8      0.66      11.8 3.3e-30      6.5       9.1 998    wage&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The coefficient for &lt;code&gt;educ&lt;/code&gt; here is the same as &lt;code&gt;educ_hat&lt;/code&gt; from the manual 2SLS model, but here we found it in one line of code! Also, the model&amp;rsquo;s standard errors and diagnostics are all correct now.&lt;/p&gt;
&lt;h3 id=&#34;compare-results&#34;&gt;Compare results&lt;/h3&gt;
&lt;p&gt;We can put all the models side-by-side to compare them:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# gof_omit here will omit goodness-of-fit rows that match any of the text. This&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# means &amp;#39;contains &amp;#34;IC&amp;#34; OR contains &amp;#34;Low&amp;#34; OR contains &amp;#34;Adj&amp;#34; OR contains &amp;#34;p.value&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# OR contains &amp;#34;statistic&amp;#34; OR contains &amp;#34;se_type&amp;#34;&amp;#39;. Basically we&amp;#39;re getting rid of&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# all the extra diagnostic information at the bottom&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;modelsummary&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Forbidden&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; model_forbidden, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;OLS&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; model_naive,
                  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;2SLS (by hand)&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; second_stage, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;2SLS (automatic)&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; model_2sls),
             gof_omit &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;IC|Log|Adj|p\\.value|statistic|se_type&amp;#34;&lt;/span&gt;,
             stars &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Add a background color to rows 3 and 7&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;row_spec&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;), background &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;#F5ABEA&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table class=&#34;table&#34; style=&#34;width: auto !important; margin-left: auto; margin-right: auto;&#34;&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt;   &lt;/th&gt;
   &lt;th style=&#34;text-align:center;&#34;&gt; Forbidden &lt;/th&gt;
   &lt;th style=&#34;text-align:center;&#34;&gt; OLS &lt;/th&gt;
   &lt;th style=&#34;text-align:center;&#34;&gt; 2SLS (by hand) &lt;/th&gt;
   &lt;th style=&#34;text-align:center;&#34;&gt; 2SLS (automatic) &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; (Intercept) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; -85.571*** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; -59.378*** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 28.819** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 28.819*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (7.198) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (10.376) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (12.672) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (11.165) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;background-color: #F5ABEA !important;&#34;&gt; educ &lt;/td&gt;
   &lt;td style=&#34;text-align:center;background-color: #F5ABEA !important;&#34;&gt; 7.767*** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;background-color: #F5ABEA !important;&#34;&gt; 13.124*** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;background-color: #F5ABEA !important;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;background-color: #F5ABEA !important;&#34;&gt; 7.835*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.456) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.618) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.664) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; ability &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.344*** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.010) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;background-color: #F5ABEA !important;&#34;&gt; educ_hat &lt;/td&gt;
   &lt;td style=&#34;text-align:center;background-color: #F5ABEA !important;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;background-color: #F5ABEA !important;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;background-color: #F5ABEA !important;&#34;&gt; 7.835*** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;background-color: #F5ABEA !important;&#34;&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;box-shadow: 0px 1px&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;box-shadow: 0px 1px&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;box-shadow: 0px 1px&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;box-shadow: 0px 1px&#34;&gt; (0.755) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;box-shadow: 0px 1px&#34;&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Num.Obs. &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1000 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1000 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1000 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; R2 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.673 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.311 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.097 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.261 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; F &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1025.794 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 451.244 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 107.639 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;
&lt;tr&gt;
&lt;td style=&#34;padding: 0; border:0;&#34; colspan=&#34;100%&#34;&gt;
&lt;sup&gt;&lt;/sup&gt; * p &amp;lt; 0.1, ** p &amp;lt; 0.05, *** p &amp;lt; 0.01&lt;/td&gt;
&lt;/tr&gt;
&lt;/tfoot&gt;
&lt;/table&gt;
&lt;p&gt;Note how the coefficients for &lt;code&gt;educ_hat&lt;/code&gt; and &lt;code&gt;educ&lt;/code&gt; in the 2SLS models are close to the coefficient for &lt;code&gt;educ&lt;/code&gt; in the forbidden model that accounts for ability. That&amp;rsquo;s the magic of instrumental variables!&lt;/p&gt;
&lt;h2 id=&#34;education-wages-and-parents-education-multiple-instruments-real-data&#34;&gt;Education, wages, and parent&amp;rsquo;s education (multiple instruments) (real data)&lt;/h2&gt;
&lt;p&gt;This data comes from the &lt;code&gt;wage2&lt;/code&gt; dataset in the &lt;strong&gt;wooldridge&lt;/strong&gt; R package (and it&amp;rsquo;s real!). The data was used in this paper:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;M. Blackburn and D. Neumark (1992), &amp;ldquo;Unobserved Ability, Efficiency Wages, and Interindustry Wage Differentials,&amp;rdquo; &lt;em&gt;Quarterly Journal of Economics&lt;/em&gt; 107, 1421-1436. &lt;a href=&#34;https://doi.org/10.3386/w3857&#34;&gt;https://doi.org/10.3386/w3857&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;wage2 &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;read_csv&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;data/wage2.csv&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This dataset includes a bunch of different variables. If you run &lt;code&gt;library(wooldridge)&lt;/code&gt; and then run &lt;code&gt;?wage&lt;/code&gt; you can see the documentation for the data. These are the variables we care about for this example:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Variable name&lt;/th&gt;
&lt;th&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;wage&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Monthly wage (1980 dollars)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;educ&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Years of education&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;feduc&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Years of education for father&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;meduc&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Years of education for mother&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;To make life easier, we&amp;rsquo;ll rename some of the columns and get rid of rows with missing data:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;ed_real &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; wage2 &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;rename&lt;/span&gt;(education &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; educ, education_dad &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; feduc, education_mom &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; meduc) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;na.omit&lt;/span&gt;()  &lt;span style=&#34;color:#75715e&#34;&gt;# Get rid of rows with missing values&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;naive-model-1&#34;&gt;Naive model&lt;/h3&gt;
&lt;p&gt;We want to again estimate the effect of education on wages, but this time we&amp;rsquo;ll use both one&amp;rsquo;s father&amp;rsquo;s education and one&amp;rsquo;s mother&amp;rsquo;s education as instruments. Here&amp;rsquo;s the naive estimate of the relationship, which suffers from endogeneity:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_naive &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(wage &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; education, data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ed_real)
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_naive)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 2 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term        estimate std.error statistic  p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;          &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)    175.      92.8       1.89 5.96e- 2&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 education       59.5      6.70      8.88 6.45e-18&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This is wrong though! Education is endogenous to unmeasured things in the model (like ability, which lives in the error term). We can isolate the exogenous part of education with an instrument.&lt;/p&gt;
&lt;h3 id=&#34;check-instrument-validity-1&#34;&gt;Check instrument validity&lt;/h3&gt;
&lt;p&gt;Before doing any 2SLS models, we want to check the validity of the instruments. Remember, for an instrument to be valid, it should meet these criteria:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Relevance&lt;/strong&gt;: Instrument is correlated with policy variable&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Exclusion&lt;/strong&gt;: Instrument is correlated with outcome &lt;em&gt;only through&lt;/em&gt; the policy variable&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Exogeneity&lt;/strong&gt;: Instrument isn&amp;rsquo;t correlated with anything else in the model (i.e. omitted variables)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;Relevance&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;We can check for relevance by looking at the relationship between the instruments and education:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Combine father&amp;#39;s and mother&amp;#39;s education into one column so we can plot both at the same time&lt;/span&gt;
ed_real_long &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; ed_real &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;pivot_longer&lt;/span&gt;(cols &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(education_dad, education_mom),
               names_to &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;instrument&amp;#34;&lt;/span&gt;, values_to &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;instrument_value&amp;#34;&lt;/span&gt;)

&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(ed_real_long, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; instrument_value, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; education)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Make points semi-transparent because of overplotting&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_point&lt;/span&gt;(alpha &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.2&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_smooth&lt;/span&gt;(method &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lm&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;facet_wrap&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;vars&lt;/span&gt;(instrument))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/iv_files/figure-html/unnamed-chunk-16-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_check_instruments &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(education &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; education_dad &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; education_mom,
                              data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ed_real)
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_check_instruments)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 3 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term          estimate std.error statistic   p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;            &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)      9.91     0.320      31.0  5.29e-131&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 education_dad    0.219    0.0289      7.58 1.19e- 13&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 education_mom    0.140    0.0337      4.17 3.52e-  5&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;glance&lt;/span&gt;(model_check_instruments)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 1 x 12&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   r.squared adj.r.squared sigma statistic  p.value    df logLik   AIC   BIC deviance df.residual  nobs&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##       &amp;lt;dbl&amp;gt;         &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;       &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1     0.202         0.199  2.00      83.3 5.55e-33     2 -1398. 2804. 2822.    2632.         660   663&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;There&amp;rsquo;s a clear relationship between both of the instruments and education, and the coefficients for each are significant. The F-statistic for the model is 83, which is higher than 10, which might be a good sign of a strong instrument. However, it&amp;rsquo;s less than 104, which, &lt;a href=&#34;https://arxiv.org/abs/2010.05058&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;according to this paper&lt;/a&gt;, is a better threshold for F statistics. So maybe it&amp;rsquo;s not so relevant in the end. Who knows.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Exclusion&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;We can check for exclusion in part by looking at the relationship between the instruments and the outcome, or wages. We should see some relationship:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(ed_real_long, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; instrument_value, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; wage)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_point&lt;/span&gt;(alpha &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_smooth&lt;/span&gt;(method &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lm&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;facet_wrap&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; instrument)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/iv_files/figure-html/unnamed-chunk-18-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;And we do! Now we just have to make the case that the only reason there&amp;rsquo;s a relationship is that parental education only influences wages through education. Good luck with that.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Exogeneity&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The last step is to prove exogeneity&amp;mdash;that parental education is not correlated with education or wages. Good luck with that too.&lt;/p&gt;
&lt;h3 id=&#34;2sls-manually-1&#34;&gt;2SLS manually&lt;/h3&gt;
&lt;p&gt;Now that we&amp;rsquo;ve maybe found some okay-ish instruments perhaps, we can use them in a two-stage least squares model. I&amp;rsquo;ll show you how to do it by hand, just to help with the intuition, but then we&amp;rsquo;ll do it automatically with &lt;code&gt;iv_robust()&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Assuming that parental education is a good instrument, we can use it to remove the endogenous part of education using 2SLS. In the first stage, we predict education using our instruments:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;first_stage &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(education &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; education_dad &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; education_mom, data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ed_real)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We can then extract the predicted education and add it to our main dataset, renaming the &lt;code&gt;.fitted&lt;/code&gt; variable to something more useful along the way:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;ed_real_with_predicted &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;augment_columns&lt;/span&gt;(first_stage, ed_real) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;rename&lt;/span&gt;(education_hat &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; .fitted)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Finally, we can use predicted education to estimate the exogenous effect of education on wages:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;second_stage &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(wage &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; education_hat,
                   data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ed_real_with_predicted)
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(second_stage)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 2 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term          estimate std.error statistic  p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;            &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)      -538.     208.      -2.58 1.00e- 2&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 education_hat     112.      15.2      7.35 5.82e-13&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The coefficient for &lt;code&gt;education_hat&lt;/code&gt; here should arguably be our actual effect!&lt;/p&gt;
&lt;h3 id=&#34;2sls-in-one-step-1&#34;&gt;2SLS in one step&lt;/h3&gt;
&lt;p&gt;Again, in real life, you won&amp;rsquo;t want to do all that. It&amp;rsquo;s tedious and your standard errors are wrong. Here&amp;rsquo;s how to do it all in one step:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_2sls &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;iv_robust&lt;/span&gt;(wage &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; education &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; education_dad &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; education_mom,
                        data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ed_real)
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_2sls)
&lt;span style=&#34;color:#75715e&#34;&gt;##          term estimate std.error statistic p.value conf.low conf.high  df outcome&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)     -538       214      -2.5 1.2e-02     -959      -117 661    wage&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2   education      112        16       7.0 5.7e-12       80       143 661    wage&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The coefficient for &lt;code&gt;education&lt;/code&gt; is the same that we found in the manual 2SLS process, but now the errors are correct.&lt;/p&gt;
&lt;h3 id=&#34;compare-results-1&#34;&gt;Compare results&lt;/h3&gt;
&lt;p&gt;Let&amp;rsquo;s compare all the findings and interpret the results!&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;modelsummary&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;OLS&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; model_naive, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;2SLS (by hand)&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; second_stage,
                  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;2SLS (automatic)&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; model_2sls),
             gof_omit &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;IC|Log|Adj|p\\.value|statistic|se_type&amp;#34;&lt;/span&gt;,
             stars &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Add a background color to rows 3 and 5&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;row_spec&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;), background &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;#F5ABEA&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table class=&#34;table&#34; style=&#34;width: auto !important; margin-left: auto; margin-right: auto;&#34;&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt;   &lt;/th&gt;
   &lt;th style=&#34;text-align:center;&#34;&gt; OLS &lt;/th&gt;
   &lt;th style=&#34;text-align:center;&#34;&gt; 2SLS (by hand) &lt;/th&gt;
   &lt;th style=&#34;text-align:center;&#34;&gt; 2SLS (automatic) &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; (Intercept) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 175.160* &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; -537.712** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; -537.712** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (92.839) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (208.164) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (214.431) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;background-color: #F5ABEA !important;&#34;&gt; education &lt;/td&gt;
   &lt;td style=&#34;text-align:center;background-color: #F5ABEA !important;&#34;&gt; 59.452*** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;background-color: #F5ABEA !important;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;background-color: #F5ABEA !important;&#34;&gt; 111.561*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (6.698) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (15.901) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;background-color: #F5ABEA !important;&#34;&gt; education_hat &lt;/td&gt;
   &lt;td style=&#34;text-align:center;background-color: #F5ABEA !important;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;background-color: #F5ABEA !important;&#34;&gt; 111.561*** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;background-color: #F5ABEA !important;&#34;&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;box-shadow: 0px 1px&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;box-shadow: 0px 1px&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;box-shadow: 0px 1px&#34;&gt; (15.176) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;box-shadow: 0px 1px&#34;&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Num.Obs. &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 663 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 663 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 663 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; R2 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.106 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.076 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.025 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; F &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 78.786 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 54.041 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;
&lt;tr&gt;
&lt;td style=&#34;padding: 0; border:0;&#34; colspan=&#34;100%&#34;&gt;
&lt;sup&gt;&lt;/sup&gt; * p &amp;lt; 0.1, ** p &amp;lt; 0.05, *** p &amp;lt; 0.01&lt;/td&gt;
&lt;/tr&gt;
&lt;/tfoot&gt;
&lt;/table&gt;
&lt;p&gt;The 2SLS effect is roughly twice as large and is arguably more accurate, since it has removed the endogeneity from education. An extra year of school leads to an extra $111.56 dollars a month in income (in 1980 dollars).&lt;/p&gt;
&lt;h3 id=&#34;check-for-weak-instruments&#34;&gt;Check for weak instruments&lt;/h3&gt;
&lt;p&gt;The F-statistic in the first stage was 83.3, which is bigger than 10, but not huge. Again, &lt;a href=&#34;https://arxiv.org/abs/2010.05058&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;this newer paper&lt;/a&gt; argues that relying on 10 as a threshold isn&amp;rsquo;t great. They provide a new, more powerful test called the tF procedure, but nobody&amp;rsquo;s written an R function to do that yet, so we can&amp;rsquo;t use it yet.&lt;/p&gt;
&lt;p&gt;We &lt;em&gt;can&lt;/em&gt;, however, do a couple other tests for instrument strength. First, if you include the &lt;code&gt;diagnostics = TRUE&lt;/code&gt; argument when running &lt;code&gt;iv_robust()&lt;/code&gt;, you can get a few extra diagnostic statistics. (See &lt;a href=&#34;https://www.rdocumentation.org/packages/estimatr/versions/0.26.0/topics/iv_robust#l_details&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;the &amp;ldquo;Details&amp;rdquo; section in the documentation for &lt;code&gt;iv_robust&lt;/code&gt;&lt;/a&gt; for more details about what these are.)&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s re-run the 2SLS model with &lt;code&gt;iv_robust&lt;/code&gt; with diagnostics on. To see diagnostic details, you can&amp;rsquo;t use &lt;code&gt;tidy()&lt;/code&gt; (since that just shows the coefficients), so you have to use &lt;code&gt;summary()&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_2sls &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;iv_robust&lt;/span&gt;(wage &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; education &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; education_dad &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; education_mom,
                        data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ed_real, diagnostics &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;)
&lt;span style=&#34;color:#a6e22e&#34;&gt;summary&lt;/span&gt;(model_2sls)
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Call:&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## iv_robust(formula = wage ~ education | education_dad + education_mom, &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##     data = ed_real, diagnostics = TRUE)&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Standard error type:  HC2 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Coefficients:&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##             Estimate Std. Error t value Pr(&amp;gt;|t|) CI Lower CI Upper  DF&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## (Intercept)     -538      214.4   -2.51 1.24e-02   -958.8     -117 661&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## education        112       15.9    7.02 5.66e-12     80.3      143 661&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Multiple R-squared:  0.0247 ,	Adjusted R-squared:  0.0232 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## F-statistic: 49.2 on 1 and 661 DF,  p-value: 5.66e-12&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Diagnostics:&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##                  numdf dendf value p.value    &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Weak instruments     2   660  96.2 &amp;lt; 2e-16 ***&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Wu-Hausman           1   660  16.5 5.5e-05 ***&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Overidentifying      1    NA   0.4    0.53    &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## ---&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The main diagnostic we care about here is the first one: &amp;ldquo;Weak instruments&amp;rdquo;. This is a slightly fancier version of just looking at the first-stage F statistic. The null hypothesis for this test is that the instruments we have specified are weak, so we&amp;rsquo;d like to reject that null hypothesis. Here, the p-value is tiny, so we can safely reject the null and say the instruments likely aren&amp;rsquo;t weak. (In general, you want a statistically significant weak instruments test).&lt;/p&gt;
&lt;p&gt;Another approach for checking for weak instruments is to calculate something called the Anderson-Rubin confidence set, which is essentially a 95% confidence interval for your coefficient that shows the stability of the coefficient based on how weak or strong the instrument is. This test was invented in like 1949 and it&amp;rsquo;s arguably more robust than checking F statistics, but for whatever reason, &lt;em&gt;nobody really teaches it or uses it!&lt;/em&gt;. It&amp;rsquo;s not in any of the textbooks for this class, and it&amp;rsquo;s really kind of rare. Even if you google &amp;ldquo;anderson rubin test weak instruments&amp;rdquo;, you&amp;rsquo;ll only find a bunch of lecture notes from fancy econometrics classes (like &lt;a href=&#34;https://economics.yale.edu/sites/default/files/files/Workshops-Seminars/Econometrics/andrews1-051012.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;p. 10 here&lt;/a&gt;, or &lt;a href=&#34;https://www.ssc.wisc.edu/~xshi/econ715/Lecture_11_WeakIV.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;p. 4 here&lt;/a&gt;, or &lt;a href=&#34;https://ocw.mit.edu/courses/economics/14-384-time-series-analysis-fall-2013/lecture-notes/MIT14_384F13_lec7and8.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;p. 4 here&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;Additionally, most of the automatic 2SLS R packages don&amp;rsquo;t provide an easy way to do this test! The only one I&amp;rsquo;ve found is in the &lt;strong&gt;AER&lt;/strong&gt; package. Basically, create a 2SLS model with AER&amp;rsquo;s &lt;code&gt;ivreg()&lt;/code&gt; and then feed that model to the &lt;code&gt;anderson.rubin.ci()&lt;/code&gt; function from the &lt;strong&gt;ivpack&lt;/strong&gt; function. This doesn&amp;rsquo;t work with models you make with &lt;code&gt;iv_robust()&lt;/code&gt; or any of the other packages that do 2SLS—only with AER&amp;rsquo;s &lt;code&gt;ivreg()&lt;/code&gt;. It&amp;rsquo;s a hassle.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(AER)  &lt;span style=&#34;color:#75715e&#34;&gt;# For ivreg()&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(ivpack)  &lt;span style=&#34;color:#75715e&#34;&gt;# For IV diagnostics like Anderson-Rubin causal effects&lt;/span&gt;

&lt;span style=&#34;color:#75715e&#34;&gt;# You have to include x = TRUE so that this works with diagnostic functions&lt;/span&gt;
model &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ivreg&lt;/span&gt;(wage &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; education &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; education_dad &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; education_mom,
               data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ed_real, x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;)

&lt;span style=&#34;color:#75715e&#34;&gt;# AR 95% confidence interval&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;anderson.rubin.ci&lt;/span&gt;(model)
&lt;span style=&#34;color:#75715e&#34;&gt;## $confidence.interval&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] &amp;#34;[ 75.9391400848449 , 152.076319769297 ]&amp;#34;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Based on this confidence interval, given the strength (or weakness) of the instruments, the IV estimate could be as low as 75.9 and as high as 152, which is a fairly big range around the $112 effect we found. Neat.&lt;/p&gt;
&lt;p&gt;There&amp;rsquo;s no magic threshold to look for in these confidence intervals—you&amp;rsquo;re mostly concerned with how much potential variability there is. If you&amp;rsquo;re fine with a causal effect that could be between 76 and 152, great. If you want that range to be narrower, find some better instruments.&lt;/p&gt;
&lt;h2 id=&#34;education-wages-and-distance-to-college-control-variables-real-data&#34;&gt;Education, wages, and distance to college (control variables) (real data)&lt;/h2&gt;
&lt;p&gt;For this last example we&amp;rsquo;ll estimate the effect of education on wages using a different instrument—geographic proximity to colleges. This data comes from David Card&amp;rsquo;s 1995 study where he did the same thing, and it&amp;rsquo;s available in the &lt;strong&gt;wooldridge&lt;/strong&gt; library as &lt;code&gt;card&lt;/code&gt;. You can find a description of all variables &lt;a href=&#34;http://fmwww.bc.edu/ec-p/data/wooldridge/card.des&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;here&lt;/a&gt;; we&amp;rsquo;ll use these:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Variable name&lt;/th&gt;
&lt;th&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;lwage&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Annual wage (log form)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;educ&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Years of education&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;nearc4&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Living close to college (=1) or far from college (=0)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;smsa&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Living in metropolitan area (=1) or not (=0)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;exper&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Years of experience&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;expersq&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Years of experience (squared term)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;black&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Black (=1), not black (=0)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;south&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Living in the south (=1) or not (=0)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;card &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;read_csv&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;data/card.csv&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Once again, Card wants to estimate the effect of education on wage. But to remove the endogeneity that comes from ability, he uses a different instrumental variable: &lt;strong&gt;proximity to college&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;He also uses control variables to help explain additional variation in wages: &lt;code&gt;smsa66 + exper + expersq + black + south66&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;IMPORTANT NOTE&lt;/strong&gt;: When you include controls, &lt;a href=&#34;https://stats.stackexchange.com/a/177752/3025&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;every control variable needs to go in &lt;em&gt;both stages&lt;/em&gt;&lt;/a&gt;. The only things from the first stage that don&amp;rsquo;t carry over to the second stage are the instruments—notice how &lt;code&gt;nearc4&lt;/code&gt; is only in the first stage, since it&amp;rsquo;s the instrument, but it&amp;rsquo;s not in the second stage. The other controls are all in both stages.&lt;/p&gt;
&lt;p&gt;He thus estimates a model where:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;First stage:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;$$
\widehat{\text{educ}} = \beta_0 + \beta_1\text{nearc4} + \beta_{2-6}\text{Control variables}
$$&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Second stage:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;$$
\text{lwage} = \beta_0 + \beta_1 \widehat{\text{educ}} + \beta_{2-6}\text{Control variables}
$$&lt;/p&gt;
&lt;h3 id=&#34;check-instrument-validity-2&#34;&gt;Check instrument validity&lt;/h3&gt;
&lt;p&gt;Card provides arguments to support each of three main characteristics of a good instrumental variable:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Relevancy&lt;/strong&gt;: People who live close to a 4-year college have easier access to education at a lower costs (no commuting costs and time nor accommodation costs), so they have greater incentives to pursue education.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Exclusion&lt;/strong&gt;: Proximity to a college has no effect on your annual income, unless you decide to pursue further education because of the nearby college.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Exogeneity&lt;/strong&gt;: Individual ability does not depend on proximity to a college.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Let&amp;rsquo;s see if these assumptions hold up:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Relevancy&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;There should be a strong relationship between the instrument (distance to college) and education:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;first_stage &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(educ &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; nearc4 &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; smsa66 &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; exper &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; expersq &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; black &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; south66,
                  data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; card)
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(first_stage)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 7 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term         estimate std.error statistic  p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;           &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept) 16.8        0.173      96.9   0.      &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 nearc4       0.334      0.0870      3.84  1.27e- 4&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 smsa66       0.255      0.0849      3.00  2.72e- 3&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4 exper       -0.409      0.0337    -12.1   4.74e-33&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5 expersq      0.000461   0.00165     0.279 7.80e- 1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6 black       -0.924      0.0934     -9.90  9.41e-23&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 7 south66     -0.348      0.0832     -4.18  3.00e- 5&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;glance&lt;/span&gt;(first_stage)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 1 x 12&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   r.squared adj.r.squared sigma statistic p.value    df logLik    AIC    BIC deviance df.residual  nobs&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##       &amp;lt;dbl&amp;gt;         &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;       &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1     0.473         0.472  1.95      449.       0     6 -6271. 12558. 12606.   11369.        3003  3010&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Based on this first stage model, &lt;code&gt;nearc4&lt;/code&gt; has a significant relationship to &lt;code&gt;educ&lt;/code&gt;, and the model&amp;rsquo;s joint F statistic is 449, which is definitely bigger than both 10 and 104. Good. We&amp;rsquo;ll call it relevant.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Exclusion&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;For distance to college to work as an instrument and meet the exclusion restriction, we have to prove that distance to college causes wages &lt;em&gt;only through&lt;/em&gt; getting more education. Think about other possible pathways between living close to a college and increased wages—there could be other paths that don&amp;rsquo;t go through education. Good luck.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Exogeneity&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;For distance to college to work as an exogenous instrument, we have to prove that none of the unobserved confounders between education and earnings are connected to distance. Also good luck.&lt;/p&gt;
&lt;h3 id=&#34;2sls-estimation&#34;&gt;2SLS estimation&lt;/h3&gt;
&lt;p&gt;Assuming distance to education is a valid instrument (sure), we can use it in a 2SLS model. Remember that control variables have to go in both stages, so specify them accordingly in the model formula:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_2sls &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;iv_robust&lt;/span&gt;(lwage &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; educ &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; smsa66 &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; exper &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; expersq &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; black &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; south66 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;
                          nearc4 &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; smsa66 &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; exper &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; expersq &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; black &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; south66,
                        data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; card, diagnostics &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;)
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_2sls)
&lt;span style=&#34;color:#75715e&#34;&gt;##          term estimate std.error statistic p.value conf.low conf.high   df outcome&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)   3.3572   0.93042       3.6 3.1e-04   1.5329   5.18155 3003   lwage&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2        educ   0.1572   0.05481       2.9 4.2e-03   0.0498   0.26468 3003   lwage&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3      smsa66   0.0810   0.02686       3.0 2.6e-03   0.0283   0.13363 3003   lwage&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4       exper   0.1184   0.02365       5.0 5.9e-07   0.0720   0.16472 3003   lwage&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5     expersq  -0.0024   0.00037      -6.6 5.0e-11  -0.0031  -0.00170 3003   lwage&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6       black  -0.1036   0.05245      -2.0 4.8e-02  -0.2064  -0.00074 3003   lwage&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 7     south66  -0.0637   0.02798      -2.3 2.3e-02  -0.1186  -0.00885 3003   lwage&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Cool cool. Based on the coefficient for &lt;code&gt;educ&lt;/code&gt;, a year of education &lt;em&gt;causes&lt;/em&gt; a 15.7% increase in annual wages, on average.&lt;/p&gt;
&lt;p&gt;Is that an improvement over a naive model where we don&amp;rsquo;t account for any of the endogeneity?&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_naive &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(lwage &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; educ &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; smsa66 &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; exper &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; expersq &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; black &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; south66,
                  data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; card)
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_naive)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 7 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term        estimate std.error statistic  p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;          &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)  4.73     0.0686       68.9  0.      &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 educ         0.0762   0.00355      21.5  3.68e-95&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 smsa66       0.113    0.0151        7.47 1.06e-13&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4 exper        0.0852   0.00674      12.6  1.02e-35&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 5 expersq     -0.00238  0.000322     -7.39 1.92e-13&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 6 black       -0.177    0.0185       -9.58 1.99e-21&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 7 south66     -0.0960   0.0161       -5.97 2.64e- 9&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Yep! Without removing endogeneity from education, an additional year of education is only associated with a 7.6% increase in annual wages, on average.&lt;/p&gt;
&lt;h3 id=&#34;compare-results-2&#34;&gt;Compare results&lt;/h3&gt;
&lt;p&gt;For fun, we can look at the results side-by-side:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;modelsummary&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Naive OLS&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; model_naive, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;2SLS&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; model_2sls),
             gof_omit &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;IC|Log|Adj|p\\.value|statistic|se_type&amp;#34;&lt;/span&gt;,
             stars &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Add a background color to row 3&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;row_spec&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, background &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;#F5ABEA&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table class=&#34;table&#34; style=&#34;width: auto !important; margin-left: auto; margin-right: auto;&#34;&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt;   &lt;/th&gt;
   &lt;th style=&#34;text-align:center;&#34;&gt; Naive OLS &lt;/th&gt;
   &lt;th style=&#34;text-align:center;&#34;&gt; 2SLS &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; (Intercept) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 4.731*** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 3.357*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.069) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.930) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;background-color: #F5ABEA !important;&#34;&gt; educ &lt;/td&gt;
   &lt;td style=&#34;text-align:center;background-color: #F5ABEA !important;&#34;&gt; 0.076*** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;background-color: #F5ABEA !important;&#34;&gt; 0.157*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.004) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.055) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; smsa66 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.113*** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.081*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.015) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.027) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; exper &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.085*** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.118*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.007) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.024) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; expersq &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; -0.002*** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; -0.002*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.000) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.000) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; black &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; -0.177*** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; -0.104** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.018) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.052) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; south66 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; -0.096*** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; -0.064** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;box-shadow: 0px 1px&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;box-shadow: 0px 1px&#34;&gt; (0.016) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;box-shadow: 0px 1px&#34;&gt; (0.028) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Num.Obs. &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 3010 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 3010 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; R2 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.269 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.143 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; F &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 184.606 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;
&lt;tr&gt;
&lt;td style=&#34;padding: 0; border:0;&#34; colspan=&#34;100%&#34;&gt;
&lt;sup&gt;&lt;/sup&gt; * p &amp;lt; 0.1, ** p &amp;lt; 0.05, *** p &amp;lt; 0.01&lt;/td&gt;
&lt;/tr&gt;
&lt;/tfoot&gt;
&lt;/table&gt;
&lt;h3 id=&#34;extra-diagnostics&#34;&gt;Extra diagnostics&lt;/h3&gt;
&lt;p&gt;Finally, we can check for weak instruments issues. The F statistic we found in the first stage was pretty big, so that&amp;rsquo;s a good sign, but we can look at the first stage&amp;rsquo;s weak instrument statistic, as well as the Anderson-Rubin confidence interval.&lt;/p&gt;
&lt;p&gt;Because we included &lt;code&gt;diagnostics = TRUE&lt;/code&gt; in the model, we can just use &lt;code&gt;summary()&lt;/code&gt; to check weak instruments diagnostics:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;summary&lt;/span&gt;(model_2sls)
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Call:&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## iv_robust(formula = lwage ~ educ + smsa66 + exper + expersq + &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##     black + south66 | nearc4 + smsa66 + exper + expersq + black + &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##     south66, data = card, diagnostics = TRUE)&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Standard error type:  HC2 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Coefficients:&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##             Estimate Std. Error t value Pr(&amp;gt;|t|) CI Lower CI Upper   DF&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## (Intercept)  3.35723   0.930415    3.61 3.13e-04  1.53292  5.18155 3003&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## educ         0.15722   0.054807    2.87 4.15e-03  0.04976  0.26468 3003&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## smsa66       0.08097   0.026858    3.01 2.59e-03  0.02831  0.13363 3003&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## exper        0.11835   0.023649    5.00 5.93e-07  0.07198  0.16472 3003&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## expersq     -0.00241   0.000366   -6.60 5.00e-11 -0.00313 -0.00170 3003&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## black       -0.10358   0.052451   -1.97 4.84e-02 -0.20643 -0.00074 3003&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## south66     -0.06371   0.027979   -2.28 2.28e-02 -0.11857 -0.00885 3003&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Multiple R-squared:  0.143 ,	Adjusted R-squared:  0.141 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## F-statistic: 96.7 on 6 and 3003 DF,  p-value: &amp;lt;2e-16&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Diagnostics:&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##                  numdf dendf value p.value    &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Weak instruments     1  3003 15.31 9.3e-05 ***&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Wu-Hausman           1  3002  2.61    0.11    &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Overidentifying      0    NA    NA      NA    &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## ---&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The p-value for the &amp;ldquo;Weak instruments&amp;rdquo; test is tiny, which means we can safely reject the null hypothesis that the near college instrument is weak. Neat.&lt;/p&gt;
&lt;p&gt;To calculate Anderson-Rubin confidence intervals, we need to rerun the model with the &lt;code&gt;ivreg()&lt;/code&gt; function (ugh) and feed those results to &lt;code&gt;anderson.rubin.ci()&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_again &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ivreg&lt;/span&gt;(lwage &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; educ &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; smsa66 &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; exper &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; expersq &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; black &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; south66 &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;
                       nearc4 &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; smsa66 &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; exper &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; expersq &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; black &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; south66,
                     data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; card, x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;)
&lt;span style=&#34;color:#a6e22e&#34;&gt;anderson.rubin.ci&lt;/span&gt;(model_again)
&lt;span style=&#34;color:#75715e&#34;&gt;## $confidence.interval&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] &amp;#34;[ 0.0570787017353594 , 0.314883971035808 ]&amp;#34;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Phew. That&amp;rsquo;s a pretty wide interval, ranging from 5.7% to 31.5%. It&amp;rsquo;s still positive, but it could sometimes be fairly small.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Difference-in-differences</title>
      <link>/example/diff-in-diff/</link>
      <pubDate>Wed, 04 Mar 2020 00:00:00 +0000</pubDate>
      <guid>/example/diff-in-diff/</guid>
      <description>&lt;script src=&#34;/rmarkdown-libs/kePrint/kePrint.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;/rmarkdown-libs/lightable/lightable.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;h2 id=&#34;video-walk-through&#34;&gt;Video walk-through&lt;/h2&gt;
&lt;p&gt;If you want to follow along with this example, you can download the data below:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/data/injury.csv&#34;&gt;&lt;i class=&#34;fas fa-table&#34;&gt;&lt;/i&gt; &lt;code&gt;injury.csv&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;There&amp;rsquo;s a set of videos that walks through each section below. To make it easier for you to jump around the video examples, I cut the long video into smaller pieces and included them all in &lt;a href=&#34;https://www.youtube.com/playlist?list=PLS6tnpTr39sHw3FevrihLn2Ly8pSCUUag&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;one YouTube playlist&lt;/a&gt;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=u5iEtpITL3s&amp;amp;list=PLS6tnpTr39sHw3FevrihLn2Ly8pSCUUag&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Getting started&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=15BprphMT1g&amp;amp;list=PLS6tnpTr39sHw3FevrihLn2Ly8pSCUUag&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Load and clean data&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=SkPLMBkB06o&amp;amp;list=PLS6tnpTr39sHw3FevrihLn2Ly8pSCUUag&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Exploratory data analysis&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=56KPL2_nSxQ&amp;amp;list=PLS6tnpTr39sHw3FevrihLn2Ly8pSCUUag&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Diff-in-diff manually&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=2JctZFGIYWw&amp;amp;list=PLS6tnpTr39sHw3FevrihLn2Ly8pSCUUag&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Diff-in-diff with regression&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;You can also watch the playlist (and skip around to different sections) here:&lt;/p&gt;
&lt;div class=&#34;embed-responsive embed-responsive-16by9&#34;&gt;
&lt;iframe class=&#34;embed-responsive-item&#34; src=&#34;https://www.youtube.com/embed/playlist?list=PLS6tnpTr39sHw3FevrihLn2Ly8pSCUUag&#34; frameborder=&#34;0&#34; allow=&#34;accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture&#34; allowfullscreen&gt;&lt;/iframe&gt;
&lt;/div&gt;
&lt;h2 id=&#34;program-background&#34;&gt;Program background&lt;/h2&gt;
&lt;p&gt;In 1980, Kentucky raised its cap on weekly earnings that were covered by worker&amp;rsquo;s compensation. We want to know if this new policy caused workers to spend more time unemployed. If benefits are not generous enough, then workers could sue companies for on-the-job injuries, while overly generous benefits could cause moral hazard issues and induce workers to be more reckless on the job, or to claim that off-the-job injuries were incurred while at work.&lt;/p&gt;
&lt;p&gt;The main outcome variable we care about is &lt;code&gt;log_duration&lt;/code&gt; (in the original data as &lt;code&gt;ldurat&lt;/code&gt;, but we rename it to be more human readable), or the logged duration (in weeks) of worker&amp;rsquo;s compensation benefits. We log it because the variable is fairly skewed&amp;mdash;most people are unemployed for a few weeks, with some unemployed for a long time. The policy was designed so that the cap increase did not affect low-earnings workers, but did affect high-earnings workers, so we use low-earnings workers as our control group and high-earnings workers as our treatment group.&lt;/p&gt;
&lt;p&gt;The data is included in the &lt;strong&gt;wooldridge&lt;/strong&gt; R package as the &lt;code&gt;injury&lt;/code&gt; dataset, and if you install the package, load it with &lt;code&gt;library(wooldridge)&lt;/code&gt;, and run &lt;code&gt;?injury&lt;/code&gt; in the console, you can see complete details about what&amp;rsquo;s in it. To give you more practice with loading data from external files, I exported the injury data as a CSV file (using &lt;code&gt;write_csv(injury, &amp;quot;injury.csv&amp;quot;)&lt;/code&gt;) and included it here.&lt;/p&gt;
&lt;p&gt;These are the main columns we&amp;rsquo;ll worry about for now:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;durat&lt;/code&gt; (which we&amp;rsquo;ll rename to &lt;code&gt;duration&lt;/code&gt;): Duration of unemployment benefits, measured in weeks&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ldurat&lt;/code&gt; (which we&amp;rsquo;ll rename to &lt;code&gt;log_duration&lt;/code&gt;): Logged version of &lt;code&gt;durat&lt;/code&gt; (&lt;code&gt;log(durat)&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;after_1980&lt;/code&gt; (which we&amp;rsquo;ll rename to &lt;code&gt;after_1980&lt;/code&gt;): Indicator variable marking if the observation happened before (0) or after (1) the policy change in 1980. This is our &lt;strong&gt;time&lt;/strong&gt; (or &lt;em&gt;before/after&lt;/em&gt; variable)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;highearn&lt;/code&gt;: Indicator variable marking if the observation is a low (0) or high (1) earner. This is our &lt;strong&gt;group&lt;/strong&gt; (or &lt;em&gt;treatment/control&lt;/em&gt;) variable&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;load-and-clean-data&#34;&gt;Load and clean data&lt;/h2&gt;
&lt;p&gt;First, let&amp;rsquo;s download the dataset (if you haven&amp;rsquo;t already), put in a folder named &lt;code&gt;data&lt;/code&gt;, and load it:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/data/injury.csv&#34;&gt;&lt;i class=&#34;fas fa-table&#34;&gt;&lt;/i&gt; &lt;code&gt;injury.csv&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(tidyverse)  &lt;span style=&#34;color:#75715e&#34;&gt;# ggplot(), %&amp;gt;%, mutate(), and friends&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(broom)  &lt;span style=&#34;color:#75715e&#34;&gt;# Convert models to data frames&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(scales)  &lt;span style=&#34;color:#75715e&#34;&gt;# Format numbers with functions like comma(), percent(), and dollar()&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(modelsummary)  &lt;span style=&#34;color:#75715e&#34;&gt;# Create side-by-side regression tables&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Load the data.&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# It&amp;#39;d be a good idea to click on the &amp;#34;injury_raw&amp;#34; object in the Environment&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# panel in RStudio to see what the data looks like after you load it&lt;/span&gt;
injury_raw &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;read_csv&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;data/injury.csv&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Next we&amp;rsquo;ll clean up the &lt;code&gt;injury_raw&lt;/code&gt; data a little to limit the data to just observations from Kentucky. we&amp;rsquo;ll also rename some awkwardly-named columns:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;injury &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; injury_raw &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(ky &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# The syntax for rename is `new_name = original_name`&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;rename&lt;/span&gt;(duration &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; durat, log_duration &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ldurat,
         after_1980 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; afchnge)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;exploratory-data-analysis&#34;&gt;Exploratory data analysis&lt;/h2&gt;
&lt;p&gt;First we can look at the distribution of unemployment benefits across high and low earners (our control and treatment groups):&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; injury, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; duration)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# binwidth = 8 makes each column represent 2 months (8 weeks)&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# boundary = 0 make it so the 0-8 bar starts at 0 and isn&amp;#39;t -4 to 4&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_histogram&lt;/span&gt;(binwidth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;, boundary &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;facet_wrap&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;vars&lt;/span&gt;(highearn))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/diff-in-diff_files/figure-html/duration-histogram-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;The distribution is really skewed, with most people in both groups getting between 0-8 weeks of benefits (and a handful with more than 180 weeks! that&amp;rsquo;s 3.5 years!)&lt;/p&gt;
&lt;p&gt;If we use the log of duration, we can get a less skewed distribution that works better with regression models:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; injury, mapping &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; log_duration)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_histogram&lt;/span&gt;(binwidth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;, boundary &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Uncomment this line if you want to exponentiate the logged values on the&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# x-axis. Instead of showing 1, 2, 3, etc., it&amp;#39;ll show e^1, e^2, e^3, etc. and&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# make the labels more human readable&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# scale_x_continuous(labels = trans_format(&amp;#34;exp&amp;#34;, format = round)) +&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;facet_wrap&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;vars&lt;/span&gt;(highearn))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/diff-in-diff_files/figure-html/log-duration-histogram-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;We should also check the distribution of unemployment before and after the policy change. Copy/paste one of the histogram chunks and change the faceting:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; injury, mapping &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; log_duration)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_histogram&lt;/span&gt;(binwidth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;, boundary &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;facet_wrap&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;vars&lt;/span&gt;(after_1980))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/diff-in-diff_files/figure-html/log-duration-before-after-histogram-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;The distributions look normal-ish, but we can&amp;rsquo;t really easily see anything different between the before/after and treatment/control groups. We can plot the averages, though. There are a few different ways we can do this.&lt;/p&gt;
&lt;p&gt;You can use a &lt;code&gt;stat_summary()&lt;/code&gt; layer to have ggplot calculate summary statistics like averages. Here we just calculate the mean:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(injury, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;factor&lt;/span&gt;(highearn), y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; log_duration)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_point&lt;/span&gt;(size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt;, alpha &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.2&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;stat_summary&lt;/span&gt;(geom &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;point&amp;#34;&lt;/span&gt;, fun &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;mean&amp;#34;&lt;/span&gt;, size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;red&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;facet_wrap&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;vars&lt;/span&gt;(after_1980))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/diff-in-diff_files/figure-html/plot-means-with-points-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;But we can also calculate the mean and 95% confidence interval:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(injury, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;factor&lt;/span&gt;(highearn), y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; log_duration)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;stat_summary&lt;/span&gt;(geom &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;pointrange&amp;#34;&lt;/span&gt;, size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;red&amp;#34;&lt;/span&gt;,
               fun.data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;mean_se&amp;#34;&lt;/span&gt;, fun.args &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(mult &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1.96&lt;/span&gt;)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;facet_wrap&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;vars&lt;/span&gt;(after_1980))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/diff-in-diff_files/figure-html/plot-means-with-pointrange-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;We can already start to see the classical diff-in-diff plot! It looks like high earners after 1980 had longer unemployment on average.&lt;/p&gt;
&lt;p&gt;We can also use &lt;code&gt;group_by()&lt;/code&gt; and &lt;code&gt;summarize()&lt;/code&gt; to figure out group means before sending the data to ggplot. I prefer doing this because it gives me more control over the data that I&amp;rsquo;m plotting:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;plot_data &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; injury &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# Make these categories instead of 0/1 numbers so they look nicer in the plot&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(highearn &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;factor&lt;/span&gt;(highearn, labels &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Low earner&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;High earner&amp;#34;&lt;/span&gt;)),
         after_1980 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;factor&lt;/span&gt;(after_1980, labels &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Before 1980&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;After 1980&amp;#34;&lt;/span&gt;))) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;group_by&lt;/span&gt;(highearn, after_1980) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;summarize&lt;/span&gt;(mean_duration &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;mean&lt;/span&gt;(log_duration),
            se_duration &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sd&lt;/span&gt;(log_duration) &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sqrt&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;n&lt;/span&gt;()),
            upper &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; mean_duration &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;1.96&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; se_duration),
            lower &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; mean_duration &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;-1.96&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; se_duration))

&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(plot_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; highearn, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; mean_duration)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_pointrange&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(ymin &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; lower, ymax &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; upper),
                  color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;darkgreen&amp;#34;&lt;/span&gt;, size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;facet_wrap&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;vars&lt;/span&gt;(after_1980))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/diff-in-diff_files/figure-html/plot-pointrange-manual-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Or, plotted in the more standard diff-in-diff format:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(plot_data, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; after_1980, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; mean_duration, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; highearn)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_pointrange&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(ymin &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; lower, ymax &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; upper), size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# The group = highearn here makes it so the lines go across categories&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_line&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(group &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; highearn))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/diff-in-diff_files/figure-html/plot-pointrange-manual-no-facet-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;h2 id=&#34;diff-in-diff-by-hand&#34;&gt;Diff-in-diff by hand&lt;/h2&gt;
&lt;p&gt;We can find that exact difference by filling out the 2x2 before/after treatment/control table:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Before 1980&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;After 1980&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;∆&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Low earners&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;A&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;B&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;B − A&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;High earners&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;C&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;D&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;D − C&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;∆&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;C − A&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;D − B&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;(D − C) − (B − A)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;A combination of &lt;code&gt;group_by()&lt;/code&gt; and &lt;code&gt;summarize()&lt;/code&gt; makes this really easy:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;diffs &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; injury &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;group_by&lt;/span&gt;(after_1980, highearn) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;summarize&lt;/span&gt;(mean_duration &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;mean&lt;/span&gt;(log_duration),
            &lt;span style=&#34;color:#75715e&#34;&gt;# Calculate average with regular duration too, just for fun&lt;/span&gt;
            mean_duration_for_humans &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;mean&lt;/span&gt;(duration))
diffs
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 4 x 4&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## # Groups:   after_1980 [2]&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   after_1980 highearn mean_duration mean_duration_for_humans&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##        &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;         &amp;lt;dbl&amp;gt;                    &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1          0        0          1.13                     6.27&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2          0        1          1.38                    11.2 &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3          1        0          1.13                     7.04&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4          1        1          1.58                    12.9&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We can pull each of these numbers out of the table with some &lt;code&gt;filter()&lt;/code&gt;s and &lt;code&gt;pull()&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;before_treatment &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; diffs &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(after_1980 &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, highearn &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;pull&lt;/span&gt;(mean_duration)

before_control &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; diffs &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(after_1980 &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, highearn &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;pull&lt;/span&gt;(mean_duration)

after_treatment &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; diffs &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(after_1980 &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, highearn &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;pull&lt;/span&gt;(mean_duration)

after_control &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; diffs &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(after_1980 &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, highearn &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;pull&lt;/span&gt;(mean_duration)

diff_treatment_before_after &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; after_treatment &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; before_treatment
diff_treatment_before_after
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] 0.2&lt;/span&gt;

diff_control_before_after &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; after_control &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; before_control
diff_control_before_after
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] 0.0077&lt;/span&gt;

diff_diff &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; diff_treatment_before_after &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; diff_control_before_after
diff_diff
&lt;span style=&#34;color:#75715e&#34;&gt;## [1] 0.19&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The diff-in-diff estimate is 0.19, which means that the program causes an increase in unemployment duration of 0.19 logged weeks. Logged weeks is nonsensical, though, so we have to interpret it with percentages (&lt;a href=&#34;https://stats.stackexchange.com/a/18639/3025&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;here&amp;rsquo;s a handy guide!&lt;/a&gt;; this is Example B, where the dependent/outcome variable is logged). Receiving the treatment (i.e. being a high earner after the change in policy) causes a 19% increase in the length of unemployment.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ggplot&lt;/span&gt;(diffs, &lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;as.factor&lt;/span&gt;(after_1980),
                  y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; mean_duration,
                  color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;as.factor&lt;/span&gt;(highearn))) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_point&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;geom_line&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;aes&lt;/span&gt;(group &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;as.factor&lt;/span&gt;(highearn))) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# If you use these lines you&amp;#39;ll get some extra annotation lines and&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# labels. The annotate() function lets you put stuff on a ggplot that&amp;#39;s not&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# part of a dataset. Normally with geom_line, geom_point, etc., you have to&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# plot data that is in columns. With annotate() you can specify your own x and&lt;/span&gt;
  &lt;span style=&#34;color:#75715e&#34;&gt;# y values.&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;annotate&lt;/span&gt;(geom &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;segment&amp;#34;&lt;/span&gt;, x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0&amp;#34;&lt;/span&gt;, xend &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;1&amp;#34;&lt;/span&gt;,
           y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; before_treatment, yend &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; after_treatment &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; diff_diff,
           linetype &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;dashed&amp;#34;&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;grey50&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;annotate&lt;/span&gt;(geom &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;segment&amp;#34;&lt;/span&gt;, x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;1&amp;#34;&lt;/span&gt;, xend &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;1&amp;#34;&lt;/span&gt;,
           y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; after_treatment, yend &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; after_treatment &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; diff_diff,
           linetype &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;dotted&amp;#34;&lt;/span&gt;, color &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;blue&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;annotate&lt;/span&gt;(geom &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;label&amp;#34;&lt;/span&gt;, x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;1&amp;#34;&lt;/span&gt;, y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; after_treatment &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; (diff_diff &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;),
           label &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Program effect&amp;#34;&lt;/span&gt;, size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;/example/diff-in-diff_files/figure-html/nice-diff-diff-plot-1.png&#34; width=&#34;75%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# Here, all the as.factor changes are directly in the ggplot code. I generally&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# don&amp;#39;t like doing this and prefer to do that separately so there&amp;#39;s less typing&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# in the ggplot code, like this:&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# diffs &amp;lt;- diffs %&amp;gt;%&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#   mutate(after_1980 = as.factor(after_1980), highearn = as.factor(highearn))&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# ggplot(diffs, aes(x = after_1980, y = avg_durat, color = highearn)) +&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#   geom_line(aes(group = highearn))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;diff-in-diff-with-regression&#34;&gt;Diff-in-diff with regression&lt;/h2&gt;
&lt;p&gt;Calculating all the pieces by hand like that is tedious, so we can use regression to do it instead! Remember that we need to include indicator variables for treatment/control and for before/after, as well as the interaction of the two. Here&amp;rsquo;s what the math equation looks like:&lt;/p&gt;
&lt;p&gt;$$
&lt;code&gt;\begin{aligned} \log(\text{duration}) = &amp;amp;\alpha + \beta \ \text{highearn} + \gamma \ \text{after_1980} + \\ &amp;amp; \delta \ (\text{highearn} \times \text{after_1980}) + \epsilon \end{aligned}&lt;/code&gt;
$$&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;\(\delta\)&lt;/code&gt; coefficient is the effect we care about in the end&amp;mdash;that&amp;rsquo;s the diff-in-diff estimator.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_small &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(log_duration &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; highearn &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; after_1980 &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; highearn &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; after_1980,
                  data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; injury)
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_small)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 4 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   term                estimate std.error statistic   p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##   &amp;lt;chr&amp;gt;                  &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 1 (Intercept)          1.13       0.0307    36.6   1.62e-263&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 2 highearn             0.256      0.0474     5.41  6.72e-  8&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 3 after_1980           0.00766    0.0447     0.171 8.64e-  1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 4 highearn:after_1980  0.191      0.0685     2.78  5.42e-  3&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The coefficient for &lt;code&gt;highearn:after_1980&lt;/code&gt; is the same as what we found by hand, as it should be! It is statistically significant, so we can be fairly confident that it is not 0.&lt;/p&gt;
&lt;h2 id=&#34;diff-in-diff-with-regression--controls&#34;&gt;Diff-in-diff with regression + controls&lt;/h2&gt;
&lt;p&gt;One advantage to using regression for diff-in-diff is that we can include control variables to help isolate the effect. For example, perhaps claims made by construction or manufacturing workers tend to have longer duration than claims made workers in other industries. Or maybe those claiming back injuries tend to have longer claims than those claiming head injuries. We might also want to control for worker demographics such as gender, marital status, and age.&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s estimate an expanded version of the basic regression model with the following additional variables:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;male&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;married&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;age&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;hosp&lt;/code&gt; (1 = hospitalized)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;indust&lt;/code&gt; (1 = manuf, 2 = construc, 3 = other)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;injtype&lt;/code&gt; (1-8; categories for different types of injury)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;lprewage&lt;/code&gt; (log of wage prior to filing a claim)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;em&gt;Important&lt;/em&gt;: &lt;code&gt;indust&lt;/code&gt; and &lt;code&gt;injtype&lt;/code&gt; are in the dataset as numbers (1-3 and 1-8), but they&amp;rsquo;re actually categories. We have to tell R to treat them as categories (or factors), otherwise it&amp;rsquo;ll assume that you can have an injury type of 3.46 or something impossible.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Convert industry and injury type to categories/factors&lt;/span&gt;
injury_fixed &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; injury &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;mutate&lt;/span&gt;(indust &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;as.factor&lt;/span&gt;(indust),
         injtype &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;as.factor&lt;/span&gt;(injtype))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;model_big &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lm&lt;/span&gt;(log_duration &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; highearn &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; after_1980 &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; highearn &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; after_1980 &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;
                  male &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; married &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; age &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; hosp &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; indust &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; injtype &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; lprewage,
                data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; injury_fixed)
&lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_big)
&lt;span style=&#34;color:#75715e&#34;&gt;## # A tibble: 18 x 5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##    term                estimate std.error statistic   p.value&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##    &amp;lt;chr&amp;gt;                  &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##  1 (Intercept)         -1.53      0.422       -3.62 2.98e-  4&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##  2 highearn            -0.152     0.0891      -1.70 8.86e-  2&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##  3 after_1980           0.0495    0.0413       1.20 2.31e-  1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##  4 male                -0.0843    0.0423      -1.99 4.64e-  2&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##  5 married              0.0567    0.0373       1.52 1.29e-  1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##  6 age                  0.00651   0.00134      4.86 1.19e-  6&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##  7 hosp                 1.13      0.0370      30.5  5.20e-189&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##  8 indust2              0.184     0.0541       3.40 6.87e-  4&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;##  9 indust3              0.163     0.0379       4.32 1.60e-  5&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 10 injtype2             0.935     0.144        6.51 8.29e- 11&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 11 injtype3             0.635     0.0854       7.44 1.19e- 13&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 12 injtype4             0.555     0.0928       5.97 2.49e-  9&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 13 injtype5             0.641     0.0854       7.51 7.15e- 14&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 14 injtype6             0.615     0.0863       7.13 1.17e- 12&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 15 injtype7             0.991     0.191        5.20 2.03e-  7&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 16 injtype8             0.434     0.119        3.65 2.64e-  4&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 17 lprewage             0.284     0.0801       3.55 3.83e-  4&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## 18 highearn:after_1980  0.169     0.0640       2.64 8.38e-  3&lt;/span&gt;

&lt;span style=&#34;color:#75715e&#34;&gt;# Extract just the diff-in-diff estimate&lt;/span&gt;
diff_diff_controls &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tidy&lt;/span&gt;(model_big) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;(term &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;highearn:after_1980&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt;
  &lt;span style=&#34;color:#a6e22e&#34;&gt;pull&lt;/span&gt;(estimate)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;After controlling for a host of demographic controls, the diff-in-diff estimate is smaller (0.17), indicating that the policy caused a 17% increase in the duration of weeks unemployed following a workplace injury. It is smaller because the other independent variables now explain some of the variation in &lt;code&gt;log_duration&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id=&#34;comparison-of-results&#34;&gt;Comparison of results&lt;/h2&gt;
&lt;p&gt;We can put the model coefficients side-by-side to compare the value for &lt;code&gt;highearn:after_1980&lt;/code&gt; as we change the model.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;modelsummary&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;list&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Simple&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; model_small, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Full&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; model_big))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table class=&#34;table&#34; style=&#34;width: auto !important; margin-left: auto; margin-right: auto;&#34;&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt;   &lt;/th&gt;
   &lt;th style=&#34;text-align:center;&#34;&gt; Simple &lt;/th&gt;
   &lt;th style=&#34;text-align:center;&#34;&gt; Full &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; (Intercept) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1.126*** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; -1.528*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.031) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.422) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; highearn &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.256*** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; -0.152* &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.047) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.089) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; after_1980 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.008 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.050 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.045) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.041) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;background-color: #F6D645 !important;&#34;&gt; highearn × after_1980 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;background-color: #F6D645 !important;&#34;&gt; 0.191*** &lt;/td&gt;
   &lt;td style=&#34;text-align:center;background-color: #F6D645 !important;&#34;&gt; 0.169*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.069) &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.064) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; male &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; -0.084** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.042) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; married &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.057 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.037) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; age &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.007*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.001) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; hosp &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1.130*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.037) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; indust2 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.184*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.054) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; indust3 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.163*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.038) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; injtype2 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.935*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.144) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; injtype3 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.635*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.085) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; injtype4 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.555*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.093) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; injtype5 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.641*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.085) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; injtype6 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.615*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.086) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; injtype7 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.991*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.191) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; injtype8 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.434*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; (0.119) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; lprewage &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.284*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;box-shadow: 0px 1pxborder-bottom: 1px solid&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;box-shadow: 0px 1pxborder-bottom: 1px solid&#34;&gt;  &lt;/td&gt;
   &lt;td style=&#34;text-align:center;box-shadow: 0px 1pxborder-bottom: 1px solid&#34;&gt; (0.080) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Num.Obs. &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 5626 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 5347 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; R2 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.021 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.190 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; R2 Adj. &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.020 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.187 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; AIC &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 18654.0 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 16684.8 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; BIC &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 18687.2 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 16809.9 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Log.Lik. &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; -9321.997 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; -8323.388 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; F &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 39.540 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 73.459 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Deviance &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 9055.93 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 7042.41 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; DF Resid &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 5622 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 5329 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Sigma &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1.269 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 1.150 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; Statistics &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 39.540 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 73.459 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; p &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.000 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 0.000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; DF &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 3 &lt;/td&gt;
   &lt;td style=&#34;text-align:center;&#34;&gt; 17 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;
&lt;tr&gt;
&lt;td style=&#34;padding: 0; border:0;&#34; colspan=&#34;100%&#34;&gt;
&lt;sup&gt;&lt;/sup&gt; * p &amp;lt; 0.1, ** p &amp;lt; 0.05, *** p &amp;lt; 0.01&lt;/td&gt;
&lt;/tr&gt;
&lt;/tfoot&gt;
&lt;/table&gt;
</description>
    </item>
    
  </channel>
</rss>
