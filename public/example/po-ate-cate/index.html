<!DOCTYPE html>
<html lang="en-us" 
      xmlns:og="http://ogp.me/ns#" 
      xmlns:fb="https://www.facebook.com/2008/fbml">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.2.0 for Hugo" />
  

  

  
  
  
  
  
  

  

  
  
  
    
  
  <meta name="description" content="library(tidyverse) # ggplot, dplyr, and friends library(broom) # Convert models to data frames library(scales) # This makes it easy to format numbers with dollar(), comma(), etc. library(ggdag) # Draw causal diagrams with R library(modelsummary) # Fancy regression tables Theory According to the theory explained in chapter 2 of Mastering &lsquo;Metrics, attending a private university should be causally linked to earnings and income&mdash;that is, going to a private school should make you earn more money." />

  
  <link rel="alternate" hreflang="en-us" href="/example/po-ate-cate/" />

  







  




  
  
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    <meta name="theme-color" content="#5271FF" />
  

  
  
    
    <script src="/js/mathjax-config.js"></script>
  

  
  
  
  
    
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha256-FMvZuGapsJLjouA6k7Eo2lusoAX9i0ShlWFG6qt7SLc=" crossorigin="anonymous">

    
    

    
    
    
      
    
    

    
    
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
    
      
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Sans+Condensed:400,400i,700,700i%7CBarlow:ital,wght@0,400;0,700;1,400;1,700&display=swap">
      
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.563f345701788434b4fee407179620aa.css" />

  



  

  

  




  
  
  

  

  
    <link rel="manifest" href="/index.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hua2ec155b4296a9c9791d015323e16eb5_11927_32x32_fill_lanczos_center_2.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hua2ec155b4296a9c9791d015323e16eb5_11927_180x180_fill_lanczos_center_2.png" />

  <link rel="canonical" href="/example/po-ate-cate/" />

  
  
  
  
  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary" />
  
    <meta property="twitter:site" content="@valentiandrade" />
    <meta property="twitter:creator" content="@valentiandrade" />
  
  <meta property="og:site_name" content="Análisis Estadístico en R" />
  <meta property="og:url" content="/example/po-ate-cate/" />
  <meta property="og:title" content="Potential outcomes, ATEs, and CATEs | Análisis Estadístico en R" />
  <meta property="og:description" content="library(tidyverse) # ggplot, dplyr, and friends library(broom) # Convert models to data frames library(scales) # This makes it easy to format numbers with dollar(), comma(), etc. library(ggdag) # Draw causal diagrams with R library(modelsummary) # Fancy regression tables Theory According to the theory explained in chapter 2 of Mastering &lsquo;Metrics, attending a private university should be causally linked to earnings and income&mdash;that is, going to a private school should make you earn more money." /><meta property="og:image" content="/media/logo_hu02bc8dfe7cae86b2ee03430b67caeaf2_22353_300x300_fit_lanczos_2.png" />
    <meta property="twitter:image" content="/media/logo_hu02bc8dfe7cae86b2ee03430b67caeaf2_22353_300x300_fit_lanczos_2.png" /><meta property="og:locale" content="en-us" />
  
    
      <meta
        property="article:published_time"
        content="2020-09-19T00:00:00&#43;00:00"
      />
    
    <meta property="article:modified_time" content="2020-09-19T00:00:00&#43;00:00">
  

  



  

  

  <link rel="stylesheet" type="text/css" href="/custom-css/print.css" media="print" />

  <link rel="shortcut icon" href="/favicon.ico" />
  <link rel="apple-touch-icon-precomposed" sizes="57x57" href="/img/apple-touch-icon-57x57.png" />
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/img/apple-touch-icon-114x114.png" />
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/img/apple-touch-icon-72x72.png" />
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144x144.png" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/img/apple-touch-icon-120x120.png" />
  <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/img/apple-touch-icon-152x152.png" />
  <link rel="icon" type="image/png" href="/img/favicon-32x32.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="/img/favicon-16x16.png" sizes="16x16" />
  <meta name="application-name" content="2255: Análisis Estadístico en R" />
  <meta name="msapplication-TileColor" content="#FFFFFF" />
  <meta name="msapplication-TileImage" content="/img/mstile-144x144.png" />


  <title>Potential outcomes, ATEs, and CATEs | Análisis Estadístico en R</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper  ">

  
  
  
  
  
  <script src="/js/wowchemy-init.js"></script>

    




    











  


<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container-xl">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/"><img src="/media/logo_hu02bc8dfe7cae86b2ee03430b67caeaf2_22353_0x70_resize_lanczos_2.png" alt="Análisis Estadístico en R"></a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/"><img src="/media/logo_hu02bc8dfe7cae86b2ee03430b67caeaf2_22353_0x70_resize_lanczos_2.png" alt="Análisis Estadístico en R"></a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-end" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        
        <li class="nav-item dropdown">
          <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>Organización</span><span class="caret"></span>
          </a>
          <div class="dropdown-menu">
            
              <a class="dropdown-item" href="/schedule/"><span>Planificación</span></a>
            
              <a class="dropdown-item" href="/syllabus/"><span>Syllabus</span></a>
            
          </div>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/content/"><span>Clases</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link  active" href="/example/"><span>Prácticos</span></a>
        </li>

        
        

        
        <li class="nav-item dropdown">
          <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>Tareas <i class="fab fa-github"></i></span><span class="caret"></span>
          </a>
          <div class="dropdown-menu">
            
              <a class="dropdown-item" href="/assignment/"><span>Tareas</span></a>
            
              <a class="dropdown-item" href="https://classroom.github.com/classrooms/86887318-learn-r-uah-2021"><span>Github Classroom<i class="fab fa-github"></i></span></a>
            
          </div>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/resource/"><span>Recursos</span></a>
        </li>

        
        

        

        
        
        
          
            
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="https://join.slack.com/t/learn-r-uah/shared_invite/zt-sh9uysuu-IzEG8~u5k2YYGWgpAFTRFA" target="_blank" rel="noopener"><span><i class="fab fa-slack"></i></span></a>
        </li>

        
        

        

        
        
        
          
            
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="https://rstudio.cloud/" target="_blank" rel="noopener"><span><i class="fab fa-r-project"></i></span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

      
      

      
      

      
      

      
      

    </ul>

  </div>
</nav>



    

<div class="container-fluid docs">
    <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
            





  
    
  




<form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-3" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <span><i class="fas fa-bars"></i></span>
  </button>

  
</form>

<nav class="collapse docs-links" id="docs-nav">
  

  
  
  
    
  

  
  <div class="docs-toc-item">
    <a class="docs-toc-link" >Información general</a>

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" >Datos</a>

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" >Ejemplos</a>

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/example/rstudio-tidyverse/">Examples</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/example/rstudio-tidyverse/">R, RStudio, and the tidyverse</a>
      </li>

      
      <li >
        <a href="/example/regression/">Regression</a>
      </li>

      
      <li >
        <a href="/example/dags/">DAGs</a>
      </li>

      
      <li class="active">
        <a href="/example/po-ate-cate/">Potential outcomes, ATEs, and CATEs</a>
      </li>

      
      <li >
        <a href="/example/rcts/">RCTs</a>
      </li>

      
      <li >
        <a href="/example/matching-ipw/">Matching and IPW</a>
      </li>

      
      <li >
        <a href="/example/diff-in-diff/">Diff-in-diff</a>
      </li>

      
      <li >
        <a href="/example/rdd/">Regression discontinuity</a>
      </li>

      
      <li >
        <a href="/example/iv/">Instrumental variables</a>
      </li>

      
      <li >
        <a href="/example/cace/">ITT and CACE</a>
      </li>

      
      <li >
        <a href="/example/rdd-fuzzy/">Fuzzy regression discontinuity</a>
      </li>

      
    </ul>
    

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/example/">Overview</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/example/">Code examples</a>
      </li>

      
    </ul>
    

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/example/random-numbers/">Simulated data</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/example/random-numbers/">Random numbers</a>
      </li>

      
      <li >
        <a href="/example/synthetic-data/">Synthetic data</a>
      </li>

      
    </ul>
    

  </div>
  
  
</nav>

        </div>

        
        <div class="d-none d-xl-block col-xl-2 docs-toc">
            <ul class="nav toc-top">
                <li><a href="#" id="back_to_top" class="docs-toc-title">Contents</a></li>
            </ul>

            <nav id="TableOfContents">
  <ul>
    <li><a href="#theory">Theory</a></li>
    <li><a href="#effect-of-private-school-on-earnings-no-controls">Effect of private school on earnings, no controls</a></li>
    <li><a href="#effect-of-private-school-on-earnings-with-regression-and-controls">Effect of private school on earnings, with regression and controls</a></li>
  </ul>
</nav>

 
        </div>
        

        <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">

            <article class="article">

                <div class="docs-article-container">
                    <h1>Potential outcomes, ATEs, and CATEs</h1>

                    

                    

                    

                    <div class="article-style">
                        <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">library</span>(tidyverse)     <span style="color:#75715e"># ggplot, dplyr, and friends</span>
<span style="color:#a6e22e">library</span>(broom)         <span style="color:#75715e"># Convert models to data frames</span>
<span style="color:#a6e22e">library</span>(scales)        <span style="color:#75715e"># This makes it easy to format numbers with dollar(), comma(), etc.</span>
<span style="color:#a6e22e">library</span>(ggdag)         <span style="color:#75715e"># Draw causal diagrams with R</span>
<span style="color:#a6e22e">library</span>(modelsummary)  <span style="color:#75715e"># Fancy regression tables</span>
</code></pre></div><h2 id="theory">Theory</h2>
<p>According to the theory explained in chapter 2 of <em>Mastering &lsquo;Metrics</em>, attending a private university should be causally linked to earnings and income&mdash;that is, going to a private school should make you earn more money. The type of education you receive, however, is not the only factor that influences earnings. People self-select into different types of universities and choose where to apply and which offers to accept. They also choose to not apply to some schools and are also rejected from other schools. Unmeasured characteristics help determine both acceptance to schools and earnings.</p>
<p>We can draw a simplified version of this causal story with a directed acyclic graph (DAG) or causal model:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">dag <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">dagify</span>(Y <span style="color:#f92672">~</span> P <span style="color:#f92672">+</span> G,
              P <span style="color:#f92672">~</span> G,
              exposure <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;P&#34;</span>,
              outcome <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Y&#34;</span>,
              labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(Y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Earnings&#34;</span>, P <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Private university&#34;</span>,
                         G <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Student characteristics (group)&#34;</span>),
              coords <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(x <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(Y <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>, P <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, G <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>),
                            y <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(Y <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, P <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, G <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)))

<span style="color:#a6e22e">ggdag_status</span>(dag, use_labels <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;label&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">guides</span>(color <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>) <span style="color:#f92672">+</span>  <span style="color:#75715e"># Remove legend</span>
  <span style="color:#a6e22e">theme_dag</span>()
</code></pre></div><p><img src="/example/po-ate-cate_files/figure-html/earnings-dag-1.png" width="75%" style="display: block; margin: auto;" /></p>
<h2 id="effect-of-private-school-on-earnings-no-controls">Effect of private school on earnings, no controls</h2>
<p>Because we don&rsquo;t have a time machine, we can&rsquo;t look at individual-level counterfactuals&mdash;we can&rsquo;t send Person 1 to a private school, watch them for 40 years after, and then go back and send Person 1 to a public school and watch them for 40 years. To get around this, we can instead calculated the <em>average</em> treatment effect, or ATE, and find the average of all individual-level causal effects. We can use the information from our theory&rsquo;s DAG to calculate a (hopefully!) accurate ATE.</p>
<p>First we load the data from this CSV file (typed from the table in <em>Mastering &lsquo;Metrics</em>):</p>
<ul>
<li><a href="/data/public_private_earnings.csv"><i class="fas fa-table"></i> <code>public_private_earnings.csv</code></a></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># The data doesn&#39;t come with an indicator variable marking if students went to a</span>
<span style="color:#75715e"># private school, so we create one here. If the string &#34;ivy&#34; is found in the</span>
<span style="color:#75715e"># enrolled column, mark it as true, otherwise mark it as false.</span>
<span style="color:#75715e">#</span>
<span style="color:#75715e"># We also create a variable that indicates if someone is in group A or not that</span>
<span style="color:#75715e"># we&#39;ll use in the regression models. We could technically just include the</span>
<span style="color:#75715e"># group variable in the model, where it would be treated as a dummy variable,</span>
<span style="color:#75715e"># but the reference category would be A, not B, so this is a little trick to</span>
<span style="color:#75715e"># force it to show results for group A.</span>
schools <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read_csv</span>(<span style="color:#e6db74">&#34;data/public_private_earnings.csv&#34;</span>) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">mutate</span>(private <span style="color:#f92672">=</span> <span style="color:#a6e22e">ifelse</span>(<span style="color:#a6e22e">str_detect</span>(enrolled, <span style="color:#e6db74">&#34;ivy&#34;</span>), <span style="color:#66d9ef">TRUE</span>, <span style="color:#66d9ef">FALSE</span>)) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">mutate</span>(group_A <span style="color:#f92672">=</span> <span style="color:#a6e22e">ifelse</span>(group <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;A&#34;</span>, <span style="color:#66d9ef">TRUE</span>, <span style="color:#66d9ef">FALSE</span>))

<span style="color:#75715e"># Only look at groups A and B, since C and D don&#39;t have people in both public</span>
<span style="color:#75715e"># and private schools. | means &#34;or&#34;</span>
schools_small <span style="color:#f92672">&lt;-</span> schools <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">filter</span>(group <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;A&#34;</span> <span style="color:#f92672">|</span> group <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;B&#34;</span>)
</code></pre></div><p>It&rsquo;s really tempting to just find the average income for private school and subtract it from public school, like so:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">schools_small <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(private) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">summarize</span>(avg_earnings <span style="color:#f92672">=</span> <span style="color:#a6e22e">mean</span>(earnings))
<span style="color:#75715e">## # A tibble: 2 x 2</span>
<span style="color:#75715e">##   private avg_earnings</span>
<span style="color:#75715e">##   &lt;lgl&gt;          &lt;dbl&gt;</span>
<span style="color:#75715e">## 1 FALSE          70000</span>
<span style="color:#75715e">## 2 TRUE           90000</span>
</code></pre></div><p>It looks like those who went to private school have $20,000 more in earnings! That&rsquo;s a ton! It&rsquo;s also <em><strong>incredibly wrong</strong></em>. <em><strong>Don&rsquo;t do this!</strong></em> This does not account for any confounding or selection bias. According to our DAG, student characteristics are a huge confounder. We need to account for those.</p>
<p>Following the potential outcomes framework, we can find the ATE by combining the conditional ATEs (or CATEs) for subgroups that are likely to predict outcomes or that bunch up similar observations. Let&rsquo;s use the Group A and B distinction as our subgroups here.</p>
<p>First we can look at the average income for people in each group, divided by whether they went to a private or public school:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">avg_earnings <span style="color:#f92672">&lt;-</span> schools_small <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(group, private) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">summarize</span>(avg_earnings <span style="color:#f92672">=</span> <span style="color:#a6e22e">mean</span>(earnings))

avg_earnings
<span style="color:#75715e">## # A tibble: 4 x 3</span>
<span style="color:#75715e">## # Groups:   group [2]</span>
<span style="color:#75715e">##   group private avg_earnings</span>
<span style="color:#75715e">##   &lt;chr&gt; &lt;lgl&gt;          &lt;dbl&gt;</span>
<span style="color:#75715e">## 1 A     FALSE         110000</span>
<span style="color:#75715e">## 2 A     TRUE          105000</span>
<span style="color:#75715e">## 3 B     FALSE          30000</span>
<span style="color:#75715e">## 4 B     TRUE           60000</span>
</code></pre></div><p>Here we see that group A has higher income on average than group B, regardless of whether they went to a private school. Everyone in group A earns roughly $100,000, while those in group B earn a lot less.</p>
<p>We can find the exact differences in earnings for public vs. private within each group by pulling the values out of the table and taking their differences</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Pulling out each of the numbers is tedious and a good example of why we use</span>
<span style="color:#75715e"># regression instead. filter() selects rows that match the specified conditions</span>
<span style="color:#75715e"># (here where group and private both equal something) and pull extracts a column</span>
<span style="color:#75715e"># from the dataset. Because we&#39;re filtering this data in a way that makes it</span>
<span style="color:#75715e"># only have one row, pull() will extract a single number.</span>

<span style="color:#75715e"># Group A</span>
income_private_A <span style="color:#f92672">&lt;-</span> avg_earnings <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">filter</span>(group <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;A&#34;</span> <span style="color:#f92672">&amp;</span> private <span style="color:#f92672">==</span> <span style="color:#66d9ef">TRUE</span>) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">pull</span>(avg_earnings)

income_public_A <span style="color:#f92672">&lt;-</span> avg_earnings <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">filter</span>(group <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;A&#34;</span> <span style="color:#f92672">&amp;</span> private <span style="color:#f92672">==</span> <span style="color:#66d9ef">FALSE</span>) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">pull</span>(avg_earnings)

cate_a <span style="color:#f92672">&lt;-</span> income_private_A <span style="color:#f92672">-</span> income_public_A
cate_a
<span style="color:#75715e">## [1] -5000</span>

<span style="color:#75715e"># Group B</span>
income_private_B <span style="color:#f92672">&lt;-</span> avg_earnings <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">filter</span>(group <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;B&#34;</span> <span style="color:#f92672">&amp;</span> private <span style="color:#f92672">==</span> <span style="color:#66d9ef">TRUE</span>) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">pull</span>(avg_earnings)

income_public_B <span style="color:#f92672">&lt;-</span> avg_earnings <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">filter</span>(group <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;B&#34;</span> <span style="color:#f92672">&amp;</span> private <span style="color:#f92672">==</span> <span style="color:#66d9ef">FALSE</span>) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">pull</span>(avg_earnings)

cate_b <span style="color:#f92672">&lt;-</span> income_private_B <span style="color:#f92672">-</span> income_public_B
cate_b
<span style="color:#75715e">## [1] 30000</span>
</code></pre></div><p>The private-public earnings gap for people in Group A (or <code>\(\text{CATE}_\text{Group A}\)</code>) is −\$5,000, while for Group B (or <code>\(\text{CATE}_\text{Group B}\)</code>) it is \$30,000. It seems that there&rsquo;s a big effect for Group B, but a small reversed effect for A.</p>
<p>We want to account for how many people are in each group, though, since A has more people than B, so we calculate the proportion of each group in the same and multiply the group differences by those proportions.</p>
<p>$$
\text{ATE} = \pi_\text{Group A} \text{CATE}_\text{Group A} + \pi_\text{Group B} \text{CATE}_\text{Group B}
$$</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># We need to find the proportion of people in each group</span>
prop_in_groups <span style="color:#f92672">&lt;-</span> schools_small <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(group) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">summarize</span>(n <span style="color:#f92672">=</span> <span style="color:#a6e22e">n</span>()) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">mutate</span>(prop <span style="color:#f92672">=</span> n <span style="color:#f92672">/</span> <span style="color:#a6e22e">nrow</span>(schools_small))
prop_in_groups
<span style="color:#75715e">## # A tibble: 2 x 3</span>
<span style="color:#75715e">##   group     n  prop</span>
<span style="color:#75715e">##   &lt;chr&gt; &lt;int&gt; &lt;dbl&gt;</span>
<span style="color:#75715e">## 1 A         3   0.6</span>
<span style="color:#75715e">## 2 B         2   0.4</span>

prop_A <span style="color:#f92672">&lt;-</span> prop_in_groups <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">filter</span>(group <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;A&#34;</span>) <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">pull</span>(prop)
prop_B <span style="color:#f92672">&lt;-</span> prop_in_groups <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">filter</span>(group <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;B&#34;</span>) <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">pull</span>(prop)

<span style="color:#75715e"># With those proportions, we can weight the differences in groups correctly</span>
weighted_effect <span style="color:#f92672">&lt;-</span> (cate_a <span style="color:#f92672">*</span> prop_A) <span style="color:#f92672">+</span> (cate_b <span style="color:#f92672">*</span> prop_B)
weighted_effect
<span style="color:#75715e">## [1] 9000</span>
</code></pre></div><p>From this it looks like attending a private university causes a bump in earnings of $9,000. This is the average treatment effect (ATE).</p>
<h2 id="effect-of-private-school-on-earnings-with-regression-and-controls">Effect of private school on earnings, with regression and controls</h2>
<p>Instead of looking at weighted averages (since that&rsquo;s tedious with just two groups—imagine doing all that with 3+ groups!), we can use a regression model that accounts for differences between groups A and B, since something about group A made them way wealthier than group B regardless of school type.</p>
<p>We do that by predicting earnings based on private/public school attendance while also controlling for group:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">model_earnings <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">lm</span>(earnings <span style="color:#f92672">~</span> private <span style="color:#f92672">+</span> group_A, data <span style="color:#f92672">=</span> schools_small)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">tidy</span>(model_earnings)
<span style="color:#75715e">## # A tibble: 3 x 5</span>
<span style="color:#75715e">##   term        estimate std.error statistic p.value</span>
<span style="color:#75715e">##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;</span>
<span style="color:#75715e">## 1 (Intercept)   40000.    11952.     3.35   0.0789</span>
<span style="color:#75715e">## 2 privateTRUE   10000.    13093.     0.764  0.525 </span>
<span style="color:#75715e">## 3 group_ATRUE   60000.    13093.     4.58   0.0445</span>
</code></pre></div><p>There are three important numbers here. The intercept (or <code>\(\alpha\)</code> in <em>Mastering &lsquo;Metrics</em>, or <code>\(\beta_0\)</code>) is $40,000. This represents the earnings for someone with all the switches and sliders in the model set to 0 or turned off—in this case, someone who went to a public school in group B.</p>
<p>The <code>group_A</code> coefficient shows the effect of just being in that group. For whatever reason, Group A earns an average of $60,000 more than Group B—<em>for reasons other than education</em>. This allows us to control for the effect of selection.</p>
<p>The coefficient for <code>private</code> is the one we care about the most—this is the causal effect of private schools on earnings (assuming we can justify all the controls and the matching into groups). It is <span>$</span>10,000, which means that attending a private school gives you that much of a bump in income. This is larger than the <span>$</span>9,000 we found earlier, but is probably more accurate since we&rsquo;re accounting for other weighted differences between groups.</p>

                    </div>

                    



                    
                    <div class="article-widget">
                        
<div class="post-nav">
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Previous</div>
    <a href="/example/rcts/" rel="next">Randomized controlled trials (RCTs)</a>
  </div>
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Next</div>
    <a href="/example/dags/" rel="prev">DAGs</a>
  </div>
  
</div>

                    </div>
                    
                </div>

                <div class="body-footer">
                    <p>Last updated on September 19, 2020</p>

                    





                    



                </div>

            </article>

            <footer>
    <hr>

    <div class="row course-info">
        <div class="col-md-7">
            <p>
                <strong>2255: Análisis Estadístico en R (II° Semestre- 2021)</strong><br>

                <a href="https://www.uahurtado.cl/" target="_blank" rel="noopener">Universidad Alberto Hurtado</a> &emsp;&emsp;
                <a href="http://sociologia.uahurtado.cl/" target="_blank" rel="noopener">Departamento de Sociología</a>
            </p>

            <p>
                <a href="https://valentinaandrade.netlify.app/" target="_blank" rel="noopener"><i class="fas fa-user"></i>
                    Valentina Andrade</a> &emsp;&emsp;
                <a href="mailto:valentinaandrade@uchile.cl"><i class="fas fa-envelope"></i>
                    valentinaandrade@uchile.cl</a>
            </p>

            <p>
                <i class="far fa-calendar-alt"></i> Clases: Lunes 16.30-17.40 &emsp;&emsp;
                <i class="fas fa-pencil-alt"></i> Práctico: Lunes 18.00-19.20 
                <br><i class="fas fa-university"></i> Online, en link de Zoom
            </p>
        </div>

        <div class="col-md-5 credits">
            <p>All content licensed under a <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" rel="noopener">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>.</p>
            
            <p>Content <i class="fab fa-creative-commons"></i> 2021. Web developed by Andrew Heiss and custom by <a href="https://valentinaandrade.netlify.app/" target="_blank" rel="noopener">Valentina Andrade</a></p>
        
            <p>This site created with the <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> in <a href="https://bookdown.org/yihui/blogdown/" target="_blank" rel="noopener">blogdown</a> and <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a>. </p>
            
            <p><a href="https://github.com/valentinaandrade" target="_blank" rel="noopener"><i class="fab fa-github"></i> View the source at GitHub.</a></p>
        </div>
    </div>
</footer>


        </main>
    </div>
</div>

        

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/instant.page/5.1.0/instantpage.min.js" integrity="sha512-1+qUtKoh9XZW7j+6LhRMAyOrgSQKenQ4mluTR+cvxXjP1Z54RxZuzstR/H9kgPXQsVB8IW7DMDFUJpzLjvhGSQ==" crossorigin="anonymous"></script>

      
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      

      
      

      

      

    

    
    
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.2/anchor.min.js" integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    
    
    

    
    

    
    
    
    

    
    <script src="/js/bootstrap.bundle.min.8b7df62fd2da18ce73e29c13cc0a6198.js"></script>

    
    

    
    
    
    
    
    
    
    
    
    <script src="/en/js/wowchemy.min.c6ceb5c48772e46156651a48070d6139.js"></script>

    

<script src="/js/math-code.js"></script>


    
    

    
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>

</html>
